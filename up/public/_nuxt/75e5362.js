/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{313:function(e,t,n){"use strict";(function(e,r){n.d(t,"a",(function(){return O})),n.d(t,"b",(function(){return z})),n.d(t,"c",(function(){return B})),n.d(t,"d",(function(){return ie})),n.d(t,"e",(function(){return c})),n.d(t,"f",(function(){return l})),n.d(t,"g",(function(){return d})),n.d(t,"h",(function(){return y})),n.d(t,"i",(function(){return m})),n.d(t,"j",(function(){return _})),n.d(t,"k",(function(){return Y})),n.d(t,"l",(function(){return N})),n.d(t,"m",(function(){return se})),n.d(t,"n",(function(){return v})),n.d(t,"o",(function(){return Z})),n.d(t,"p",(function(){return w})),n.d(t,"q",(function(){return ue})),n.d(t,"r",(function(){return re})),n.d(t,"s",(function(){return S})),n.d(t,"t",(function(){return E})),n.d(t,"u",(function(){return C})),n.d(t,"v",(function(){return k})),n.d(t,"w",(function(){return pe})),n.d(t,"x",(function(){return A})),n.d(t,"y",(function(){return Q})),n.d(t,"z",(function(){return D})),n.d(t,"A",(function(){return P})),n.d(t,"B",(function(){return X})),n.d(t,"C",(function(){return M})),n.d(t,"D",(function(){return U})),n.d(t,"E",(function(){return R})),n.d(t,"F",(function(){return x})),n.d(t,"G",(function(){return j})),n.d(t,"H",(function(){return L})),n.d(t,"I",(function(){return F})),n.d(t,"J",(function(){return H})),n.d(t,"K",(function(){return W})),n.d(t,"L",(function(){return map})),n.d(t,"M",(function(){return te})),n.d(t,"N",(function(){return ne})),n.d(t,"O",(function(){return J})),n.d(t,"P",(function(){return fe})),n.d(t,"Q",(function(){return de})),n.d(t,"R",(function(){return K})),n.d(t,"S",(function(){return ce})),n.d(t,"T",(function(){return le})),n.d(t,"U",(function(){return he})),n.d(t,"V",(function(){return V}));const o={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},c=function(e,t){if(!e)throw l(t)},l=function(e){return new Error("Firebase Database ("+o.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},h=function(e){const t=[];let p=0;for(let i=0;i<e.length;i++){let n=e.charCodeAt(i);n<128?t[p++]=n:n<2048?(t[p++]=n>>6|192,t[p++]=63&n|128):55296==(64512&n)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(n=65536+((1023&n)<<10)+(1023&e.charCodeAt(++i)),t[p++]=n>>18|240,t[p++]=n>>12&63|128,t[p++]=n>>6&63|128,t[p++]=63&n|128):(t[p++]=n>>12|224,t[p++]=n>>6&63|128,t[p++]=63&n|128)}return t},d={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(input,e){if(!Array.isArray(input))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,output=[];for(let i=0;i<input.length;i+=3){const e=input[i],n=i+1<input.length,r=n?input[i+1]:0,o=i+2<input.length,c=o?input[i+2]:0,l=e>>2,h=(3&e)<<4|r>>4;let d=(15&r)<<2|c>>6,f=63&c;o||(f=64,n||(d=64)),output.push(t[l],t[h],t[d],t[f])}return output.join("")},encodeString(input,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(input):this.encodeByteArray(h(input),e)},decodeString(input,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(input):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const o=e[n++];if(o<128)t[r++]=String.fromCharCode(o);else if(o>191&&o<224){const c=e[n++];t[r++]=String.fromCharCode((31&o)<<6|63&c)}else if(o>239&&o<365){const u=((7&o)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(u>>10)),t[r++]=String.fromCharCode(56320+(1023&u))}else{const c=e[n++],l=e[n++];t[r++]=String.fromCharCode((15&o)<<12|(63&c)<<6|63&l)}}return t.join("")}(this.decodeStringToByteArray(input,e))},decodeStringToByteArray(input,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,output=[];for(let i=0;i<input.length;){const e=t[input.charAt(i++)],n=i<input.length?t[input.charAt(i)]:0;++i;const r=i<input.length?t[input.charAt(i)]:64;++i;const o=i<input.length?t[input.charAt(i)]:64;if(++i,null==e||null==n||null==r||null==o)throw new f;const c=e<<2|n>>4;if(output.push(c),64!==r){const e=n<<4&240|r>>2;if(output.push(e),64!==o){const e=r<<6&192|o;output.push(e)}}}return output},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}};class f extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const m=function(e){const t=h(e);return d.encodeByteArray(t,!0)},_=function(e){return m(e).replace(/\./g,"")},y=function(e){try{return d.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function v(e){return w(void 0,e)}function w(e,source){if(!(source instanceof Object))return source;switch(source.constructor){case Date:return new Date(source.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return source}for(const t in source)source.hasOwnProperty(t)&&"__proto__"!==t&&(e[t]=w(e[t],source[t]));return e}const I=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e)return e;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,T=()=>{try{return I()||(()=>{if(void 0===r||void 0===r.env)return;const e=r.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&y(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},E=e=>{var t,n;return null===(n=null===(t=T())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},C=e=>{const t=E(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},S=()=>{var e;return null===(e=T())||void 0===e?void 0:e.config},k=e=>{var t;return null===(t=T())||void 0===t?void 0:t[`_${e}`]};class O{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function N(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,sub=e.sub||e.user_id;if(!sub)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:sub,user_id:sub,firebase:{sign_in_provider:"custom",identities:{}}},e);return[_(JSON.stringify({alg:"none",type:"JWT"})),_(JSON.stringify(o)),""].join(".")}function A(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function R(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(A())}function x(){var t;const n=null===(t=T())||void 0===t?void 0:t.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(e){return!1}}function D(){return"object"==typeof self&&self.self===self}function P(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function L(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function M(){const e=A();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function j(){return!0===o.NODE_CLIENT||!0===o.NODE_ADMIN}function F(){return!x()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function U(){try{return"object"==typeof indexedDB}catch(e){return!1}}function V(){return new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",o=self.indexedDB.open(r);o.onsuccess=()=>{o.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},o.onupgradeneeded=()=>{n=!1},o.onerror=()=>{var e;t((null===(e=o.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}class B extends Error{constructor(code,e,t){super(e),this.code=code,this.customData=t,this.name="FirebaseError",Object.setPrototypeOf(this,B.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,z.prototype.create)}}class z{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(code,...data){const e=data[0]||{},t=`${this.service}/${code}`,template=this.errors[code],n=template?function(template,data){return template.replace(G,((e,t)=>{const n=data[t];return null!=n?String(n):`<${t}?>`}))}(template,e):"Error",r=`${this.serviceName}: ${n} (${t}).`;return new B(t,r,e)}}const G=/\{\$([^}]+)}/g;function W(e){return JSON.parse(e)}function K(data){return JSON.stringify(data)}const $=function(e){let header={},t={},data={},n="";try{const r=e.split(".");header=W(y(r[0])||""),t=W(y(r[1])||""),n=r[2],data=t.d||{},delete t.d}catch(e){}return{header:header,claims:t,data:data,signature:n}},H=function(e){const t=$(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},Q=function(e){const t=$(e).claims;return"object"==typeof t&&!0===t.admin};function Y(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function J(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function X(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function map(e,t,n){const r={};for(const o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=t.call(n,e[o],o,e));return r}function Z(a,b){if(a===b)return!0;const e=Object.keys(a),t=Object.keys(b);for(const n of e){if(!t.includes(n))return!1;const e=a[n],r=b[n];if(ee(e)&&ee(r)){if(!Z(e,r))return!1}else if(e!==r)return!1}for(const n of t)if(!e.includes(n))return!1;return!0}function ee(e){return null!==e&&"object"==typeof e}function te(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function ne(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function re(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class ie{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let i=1;i<this.blockSize;++i)this.pad_[i]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let i=0;i<16;i++)n[i]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let i=0;i<16;i++)n[i]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let i=16;i<80;i++){const e=n[i-3]^n[i-8]^n[i-14]^n[i-16];n[i]=4294967295&(e<<1|e>>>31)}let r,o,a=this.chain_[0],b=this.chain_[1],c=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(let i=0;i<80;i++){i<40?i<20?(r=l^b&(c^l),o=1518500249):(r=b^c^l,o=1859775393):i<60?(r=b&c|l&(b|c),o=2400959708):(r=b^c^l,o=3395469782);const e=(a<<5|a>>>27)+r+h+o+n[i]&4294967295;h=l,l=c,c=4294967295&(b<<30|b>>>2),b=a,a=e}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+b&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let r=0;const o=this.buf_;let c=this.inbuf_;for(;r<t;){if(0===c)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(o[c]=e.charCodeAt(r),++c,++r,c===this.blockSize){this.compress_(o),c=0;break}}else for(;r<t;)if(o[c]=e[r],++c,++r,c===this.blockSize){this.compress_(o),c=0;break}}this.inbuf_=c,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let i=0;i<5;i++)for(let t=24;t>=0;t-=8)e[n]=this.chain_[i]>>t&255,++n;return e}}function se(e,t){const n=new oe(e,t);return n.subscribe.bind(n)}class oe{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=ae),void 0===r.error&&(r.error=ae),void 0===r.complete&&(r.complete=ae);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),o}unsubscribeOne(i){void 0!==this.observers&&void 0!==this.observers[i]&&(delete this.observers[i],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,e)}sendOne(i,e){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[i])try{e(this.observers[i])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function ae(){}const ce=function(e,t,n,r){let o;if(r<t?o="at least "+t:r>n&&(o=0===n?"none":"no more than "+n),o){throw new Error(e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+o+".")}};function ue(e,t){return`${e} failed: ${t} argument `}function le(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(ue(e,t)+"must be a valid function.")}function he(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(ue(e,t)+"must be a valid context object.")}const de=function(e){const t=[];let p=0;for(let i=0;i<e.length;i++){let n=e.charCodeAt(i);if(n>=55296&&n<=56319){const t=n-55296;i++,c(i<e.length,"Surrogate pair missing trail surrogate.");n=65536+(t<<10)+(e.charCodeAt(i)-56320)}n<128?t[p++]=n:n<2048?(t[p++]=n>>6|192,t[p++]=63&n|128):n<65536?(t[p++]=n>>12|224,t[p++]=n>>6&63|128,t[p++]=63&n|128):(t[p++]=n>>18|240,t[p++]=n>>12&63|128,t[p++]=n>>6&63|128,t[p++]=63&n|128)}return t},fe=function(e){let p=0;for(let i=0;i<e.length;i++){const t=e.charCodeAt(i);t<128?p++:t<2048?p+=2:t>=55296&&t<=56319?(p+=4,i++):p+=3}return p};function pe(e){return e&&e._delegate?e._delegate:e}}).call(this,n(58),n(167))},314:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return h})),n.d(t,"c",(function(){return l}));var r=n(313);class o{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const c="[DEFAULT]";class l{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new r.a;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(component){if(component.name!==this.name)throw Error(`Mismatching Component ${component.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=component,this.shouldAutoInitialize()){if(function(component){return"EAGER"===component.instantiationMode}(component))try{this.getOrInitializeService({instanceIdentifier:c})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=c){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=c){return this.instances.has(e)}getOptions(e=c){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(e)&&t.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),o=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;o.add(e),this.onInitCallbacks.set(r,o);const c=this.instances.get(r);return c&&e(c,r),()=>{o.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===c?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=c){return this.component?this.component.multipleInstances?e:c:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class h{constructor(e){this.name=e,this.providers=new Map}addComponent(component){const e=this.getProvider(component.name);if(e.isComponentSet())throw new Error(`Component ${component.name} has already been registered with ${this.name}`);e.setComponent(component)}addOrOverwriteComponent(component){this.getProvider(component.name).isComponentSet()&&this.providers.delete(component.name),this.addComponent(component)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new l(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},321:function(e,t,n){"use strict";var r=n(326);n.d(t,"a",(function(){return r.a}));r.a.registerVersion("firebase","10.8.1","app-compat")},322:function(e,t,n){"use strict";n(508)},323:function(e,t,n){"use strict";var r=n(326),o=n(329),c=n(313),l=n(314);const h="firebasestorage.googleapis.com",d="storageBucket";class f extends c.c{constructor(code,e,t=0){super(y(code),`Firebase Storage: ${e} (${y(code)})`),this.status_=t,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,f.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(code){return y(code)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var m,_;function y(code){return"storage/"+code}function v(){return new f(m.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function w(){return new f(m.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function I(){return new f(m.CANCELED,"User canceled the upload/download.")}function T(){return new f(m.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function E(e){return new f(m.INVALID_ARGUMENT,e)}function C(){return new f(m.APP_DELETED,"The Firebase app was deleted.")}function S(e){return new f(m.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function k(e,t){return new f(m.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function O(e){throw new f(m.INTERNAL_ERROR,"Internal error: "+e)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(m||(m={}));class N{constructor(e,path){this.bucket=e,this.path_=path}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=N.makeFromUrl(e,t)}catch(t){return new N(e,"")}if(""===n.path)return n;throw r=e,new f(m.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)";const o=new RegExp("^gs://"+r+"(/(.*))?$","i");function c(e){e.path_=decodeURIComponent(e.path)}const l=t.replace(/[.]/g,"\\."),d=[{regex:o,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${l}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:c},{regex:new RegExp(`^https?://${t===h?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:c}];for(let i=0;i<d.length;i++){const t=d[i],r=t.regex.exec(e);if(r){const e=r[t.indices.bucket];let o=r[t.indices.path];o||(o=""),n=new N(e,o),t.postModify(n);break}}if(null==n)throw function(e){return new f(m.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class A{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function R(p){return"string"==typeof p||p instanceof String}function x(p){return D()&&p instanceof Blob}function D(){return"undefined"!=typeof Blob}function P(e,t,n,r){if(r<t)throw E(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw E(`Invalid value for '${e}'. Expected ${n} or less.`)}function L(e,t,n){let r=t;return null==n&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function M(e){const t=encodeURIComponent;let n="?";for(const r in e)if(e.hasOwnProperty(r)){n=n+(t(r)+"="+t(e[r]))+"&"}return n=n.slice(0,-1),n}function j(e,t){const n=e>=500&&e<600,r=-1!==[408,429].indexOf(e),o=-1!==t.indexOf(e);return n||r||o}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(_||(_={}));class F{constructor(e,t,n,r,o,c,l,h,d,f,m,_=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=o,this.additionalRetryCodes_=c,this.callback_=l,this.errorCallback_=h,this.timeout_=d,this.progressCallback_=f,this.connectionFactory_=m,this.retry=_,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{if(t)return void e(!1,new U(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===_.NO_ERROR,o=n.getStatus();if(!t||j(o,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===_.ABORT;return void e(!1,new U(!1,null,t))}const c=-1!==this.successCodes_.indexOf(o);e(!0,new U(c,n))}))},t=(e,t)=>{const n=this.resolve_,r=this.reject_,o=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(o,o.getResponse());void 0!==e?n(e):n()}catch(e){r(e)}else if(null!==o){const e=v();e.serverResponse=o.getErrorText(),this.errorCallback_?r(this.errorCallback_(o,e)):r(e)}else if(t.canceled){r(this.appDelete_?C():I())}else{r(w())}};this.canceled_?t(0,new U(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,o=null,c=null,l=!1,h=0;function d(){return 2===h}let f=!1;function m(...e){f||(f=!0,t.apply(null,e))}function _(t){o=setTimeout((()=>{o=null,e(v,d())}),t)}function y(){c&&clearTimeout(c)}function v(e,...t){if(f)return void y();if(e)return y(),void m.call(null,e,...t);if(d()||l)return y(),void m.call(null,e,...t);let n;r<64&&(r*=2),1===h?(h=2,n=0):n=1e3*(r+Math.random()),_(n)}let w=!1;function I(e){w||(w=!0,y(),f||(null!==o?(e||(h=2),clearTimeout(o),_(0)):e||(h=1)))}return _(0),c=setTimeout((()=>{l=!0,I(!0)}),n),I}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class U{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function V(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function B(...e){const t=V();if(void 0!==t){const n=new t;for(let i=0;i<e.length;i++)n.append(e[i]);return n.getBlob()}if(D())return new Blob(e);throw new f(m.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function z(e){if("undefined"==typeof atob)throw t="base-64",new f(m.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`);var t;return atob(e)}const G={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class W{constructor(data,e){this.data=data,this.contentType=e||null}}function K(e,t){switch(e){case G.RAW:return new W($(t));case G.BASE64:case G.BASE64URL:return new W(H(e,t));case G.DATA_URL:return new W(function(e){const t=new Q(e);return t.base64?H(G.BASE64,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw k(G.DATA_URL,"Malformed data URL.")}return $(t)}(t.rest)}(t),new Q(t).contentType)}throw v()}function $(e){const b=[];for(let i=0;i<e.length;i++){let t=e.charCodeAt(i);if(t<=127)b.push(t);else if(t<=2047)b.push(192|t>>6,128|63&t);else if(55296==(64512&t)){if(i<e.length-1&&56320==(64512&e.charCodeAt(i+1))){t=65536|(1023&t)<<10|1023&e.charCodeAt(++i),b.push(240|t>>18,128|t>>12&63,128|t>>6&63,128|63&t)}else b.push(239,191,189)}else 56320==(64512&t)?b.push(239,191,189):b.push(224|t>>12,128|t>>6&63,128|63&t)}return new Uint8Array(b)}function H(e,t){switch(e){case G.BASE64:{const n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r){throw k(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?")}break}case G.BASE64URL:{const n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r){throw k(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?")}t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=z(t)}catch(t){if(t.message.includes("polyfill"))throw t;throw k(e,"Invalid character found")}const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}class Q{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw k(G.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;null!=n&&(this.base64=function(s,e){if(!(s.length>=e.length))return!1;return s.substring(s.length-e.length)===e}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class Y{constructor(data,e){let t=0,n="";x(data)?(this.data_=data,t=data.size,n=data.type):data instanceof ArrayBuffer?(e?this.data_=new Uint8Array(data):(this.data_=new Uint8Array(data.byteLength),this.data_.set(new Uint8Array(data))),t=this.data_.length):data instanceof Uint8Array&&(e?this.data_=data:(this.data_=new Uint8Array(data.length),this.data_.set(data)),t=data.length),this.size_=t,this.type_=n}size(){return this.size_}type(){return this.type_}slice(e,t){if(x(this.data_)){const n=function(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.mozSlice?e.mozSlice(t,n):e.slice?e.slice(t,n):null}(this.data_,e,t);return null===n?null:new Y(n)}{const n=new Uint8Array(this.data_.buffer,e,t-e);return new Y(n,!0)}}static getBlob(...e){if(D()){const t=e.map((e=>e instanceof Y?e.data_:e));return new Y(B.apply(null,t))}{const t=e.map((e=>R(e)?K(G.RAW,e).data:e.data_));let n=0;t.forEach((e=>{n+=e.byteLength}));const r=new Uint8Array(n);let o=0;return t.forEach((e=>{for(let i=0;i<e.length;i++)r[o++]=e[i]})),new Y(r,!0)}}uploadData(){return this.data_}}function J(s){let e;try{e=JSON.parse(s)}catch(e){return null}return"object"!=typeof(p=e)||Array.isArray(p)?null:e;var p}function X(path){const e=path.lastIndexOf("/",path.length-2);return-1===e?path:path.slice(e+1)}function Z(e,t){return t}class ee{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||Z}}let te=null;function ne(){if(te)return te;const e=[];e.push(new ee("bucket")),e.push(new ee("generation")),e.push(new ee("metageneration")),e.push(new ee("name","fullPath",!0));const t=new ee("name");t.xform=function(e,t){return function(e){return!R(e)||e.length<2?e:X(e)}(t)},e.push(t);const n=new ee("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new ee("timeCreated")),e.push(new ee("updated")),e.push(new ee("md5Hash",null,!0)),e.push(new ee("cacheControl",null,!0)),e.push(new ee("contentDisposition",null,!0)),e.push(new ee("contentEncoding",null,!0)),e.push(new ee("contentLanguage",null,!0)),e.push(new ee("contentType",null,!0)),e.push(new ee("metadata","customMetadata",!0)),te=e,te}function re(e,t,n){const r={type:"file"},o=n.length;for(let i=0;i<o;i++){const e=n[i];r[e.local]=e.xform(r,t[e.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,path=e.fullPath,r=new N(n,path);return t._makeStorageReference(r)}})}(r,e),r}function ie(e,t,n){const r=J(t);if(null===r)return null;return re(e,r,n)}function se(e,t){const n={},r=t.length;for(let i=0;i<r;i++){const r=t[i];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}const oe="prefixes",ae="items";function ce(e,t,n){const r=J(n);if(null===r)return null;return function(e,t,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[oe])for(const path of n[oe]){const n=path.replace(/\/$/,""),o=e._makeStorageReference(new N(t,n));r.prefixes.push(o)}if(n[ae])for(const o of n[ae]){const n=e._makeStorageReference(new N(t,o.name));r.items.push(n)}return r}(e,t,r)}class ue{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function le(e){if(!e)throw v()}function he(e,t){return function(n,text){const r=ie(e,text,t);return le(null!==r),r}}function de(e,t){return function(n,text){const r=ie(e,text,t);return le(null!==r),function(e,t,n,r){const o=J(t);if(null===o)return null;if(!R(o.downloadTokens))return null;const c=o.downloadTokens;if(0===c.length)return null;const l=encodeURIComponent;return c.split(",").map((t=>{const o=e.bucket,path=e.fullPath;return L("/b/"+l(o)+"/o/"+l(path),n,r)+M({alt:"media",token:t})}))[0]}(r,text,e.host,e._protocol)}}function fe(e){return function(t,n){let r;var path,o;return 401===t.getStatus()?r=t.getErrorText().includes("Firebase App Check token is invalid")?new f(m.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new f(m.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(o=e.bucket,r=new f(m.QUOTA_EXCEEDED,"Quota for bucket '"+o+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(path=e.path,r=new f(m.UNAUTHORIZED,"User does not have permission to access '"+path+"'.")):r=n,r.status=t.getStatus(),r.serverResponse=n.serverResponse,r}}function pe(e){const t=fe(e);return function(n,r){let o=t(n,r);var path;return 404===n.getStatus()&&(path=e.path,o=new f(m.OBJECT_NOT_FOUND,"Object '"+path+"' does not exist.")),o.serverResponse=r.serverResponse,o}}function ge(e,t,n){const r=L(t.fullServerUrl(),e.host,e._protocol),o=e.maxOperationRetryTime,c=new ue(r,"GET",he(e,n),o);return c.errorHandler=pe(t),c}function me(e,t,n,r,o){const c={};t.isRoot?c.prefix="":c.prefix=t.path+"/",n&&n.length>0&&(c.delimiter=n),r&&(c.pageToken=r),o&&(c.maxResults=o);const l=L(t.bucketOnlyServerUrl(),e.host,e._protocol),h=e.maxOperationRetryTime,d=new ue(l,"GET",function(e,t){return function(n,text){const r=ce(e,t,text);return le(null!==r),r}}(e,t.bucket),h);return d.urlParams=c,d.errorHandler=fe(t),d}function _e(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),r}function ye(e,t,n,r,o){const c=t.bucketOnlyServerUrl(),l={"X-Goog-Upload-Protocol":"multipart"};const h=function(){let e="";for(let i=0;i<2;i++)e+=Math.random().toString().slice(2);return e}();l["Content-Type"]="multipart/related; boundary="+h;const d=_e(t,r,o),f="--"+h+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+se(d,n)+"\r\n--"+h+"\r\nContent-Type: "+d.contentType+"\r\n\r\n",m="\r\n--"+h+"--",body=Y.getBlob(f,r,m);if(null===body)throw T();const _={name:d.fullPath},y=L(c,e.host,e._protocol),v=e.maxUploadRetryTime,w=new ue(y,"POST",he(e,n),v);return w.urlParams=_,w.headers=l,w.body=body.uploadData(),w.errorHandler=fe(t),w}class ve{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function we(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){le(!1)}return le(!!n&&-1!==(t||["active"]).indexOf(n)),n}const be=262144;function Ie(e,t,n,r,o,c,l,h){const d=new ve(0,0);if(l?(d.current=l.current,d.total=l.total):(d.current=0,d.total=r.size()),r.size()!==d.total)throw new f(m.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");const _=d.total-d.current;let y=_;o>0&&(y=Math.min(y,o));const v=d.current,w=v+y;let I="";I=0===y?"finalize":_===y?"upload, finalize":"upload";const E={"X-Goog-Upload-Command":I,"X-Goog-Upload-Offset":`${d.current}`},body=r.slice(v,w);if(null===body)throw T();const C=t.maxUploadRetryTime,S=new ue(n,"POST",(function(e,text){const n=we(e,["active","final"]),o=d.current+y,l=r.size();let h;return h="final"===n?he(t,c)(e,text):null,new ve(o,l,"final"===n,h)}),C);return S.headers=E,S.body=body.uploadData(),S.progressCallback=h||null,S.errorHandler=fe(e),S}const Te={STATE_CHANGED:"state_changed"},Ee={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Ce(e){switch(e){case"running":case"pausing":case"canceling":return Ee.RUNNING;case"paused":return Ee.PAUSED;case"success":return Ee.SUCCESS;case"canceled":return Ee.CANCELED;default:return Ee.ERROR}}class Se{constructor(e,t,n){if("function"==typeof e||null!=t||null!=n)this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0;else{const t=e;this.next=t.next,this.error=t.error,this.complete=t.complete}}}function ke(e){return(...t)=>{Promise.resolve().then((()=>e(...t)))}}let Oe=null;class Ne{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=_.NO_ERROR,this.sendPromise_=new Promise((e=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=_.ABORT,e()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=_.NETWORK_ERROR,e()})),this.xhr_.addEventListener("load",(()=>{e()}))}))}send(e,t,body,n){if(this.sent_)throw O("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==n)for(const e in n)n.hasOwnProperty(e)&&this.xhr_.setRequestHeader(e,n[e].toString());return void 0!==body?this.xhr_.send(body):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw O("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw O("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw O("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw O("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(header){return this.xhr_.getResponseHeader(header)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class Ae extends Ne{initXhr(){this.xhr_.responseType="text"}}function Re(){return Oe?Oe():new Ae}class xe{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=ne(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{if(this._request=void 0,this._chunkMultiplier=1,e._codeEquals(m.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const t=this.isExponentialBackoffExpired();if(j(e.status,[])){if(!t)return this.sleepTime=Math.max(2*this.sleepTime,1e3),this._needToFetchStatus=!0,void this.completeTransitions_();e=w()}this._error=e,this._transition("error")}},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals(m.CANCELED)?this.completeTransitions_():(this._error=e,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t,this._start()})),this._promise.then(null,(()=>{}))}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>262144}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout((()=>{this.pendingTimeout=void 0,this._continueUpload()}),this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then((([t,n])=>{switch(this._state){case"running":e(t,n);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}}))}_createResumable(){this._resolveToken(((e,t)=>{const n=function(e,t,n,r,o){const c=t.bucketOnlyServerUrl(),l=_e(t,r,o),h={name:l.fullPath},d=L(c,e.host,e._protocol),f={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":l.contentType,"Content-Type":"application/json; charset=utf-8"},body=se(l,n),m=e.maxUploadRetryTime,_=new ue(d,"POST",(function(e){let t;we(e);try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){le(!1)}return le(R(t)),t}),m);return _.urlParams=h,_.headers=f,_.body=body,_.errorHandler=fe(t),_}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,Re,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()}),this._errorHandler)}))}_fetchStatus(){const e=this._uploadUrl;this._resolveToken(((t,n)=>{const r=function(e,t,n,r){const o=e.maxUploadRetryTime,c=new ue(n,"POST",(function(e){const t=we(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){le(!1)}n||le(!1);const o=Number(n);return le(!isNaN(o)),new ve(o,r.size(),"final"===t)}),o);return c.headers={"X-Goog-Upload-Command":"query"},c.errorHandler=fe(t),c}(this._ref.storage,this._ref._location,e,this._blob),o=this._ref.storage._makeRequest(r,Re,t,n);this._request=o,o.getPromise().then((e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()}),this._errorHandler)}))}_continueUpload(){const e=be*this._chunkMultiplier,t=new ve(this._transferred,this._blob.size()),n=this._uploadUrl;this._resolveToken(((r,o)=>{let c;try{c=Ie(this._ref._location,this._ref.storage,n,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(e){return this._error=e,void this._transition("error")}const l=this._ref.storage._makeRequest(c,Re,r,o,!1);this._request=l,l.getPromise().then((e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()}),this._errorHandler)}))}_increaseMultiplier(){2*(be*this._chunkMultiplier)<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken(((e,t)=>{const n=ge(this._ref.storage,this._ref._location,this._mappings),r=this._ref.storage._makeRequest(n,Re,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._metadata=e,this._transition("success")}),this._metadataErrorHandler)}))}_oneShotUpload(){this._resolveToken(((e,t)=>{const n=ye(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,Re,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")}),this._errorHandler)}))}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":case"error":case"success":this._state=e,this._notifyObservers();break;case"canceled":this._error=I(),this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){const e=Ce(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const o=new Se(t||void 0,n||void 0,r||void 0);return this._addObserver(o),()=>{this._removeObserver(o)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const i=this._observers.indexOf(e);-1!==i&&this._observers.splice(i,1)}_notifyObservers(){this._finishPromise();this._observers.slice().forEach((e=>{this._notifyObserver(e)}))}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(Ce(this._state)){case Ee.SUCCESS:ke(this._resolve.bind(null,this.snapshot))();break;case Ee.CANCELED:case Ee.ERROR:ke(this._reject.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(Ce(this._state)){case Ee.RUNNING:case Ee.PAUSED:e.next&&ke(e.next.bind(e,this.snapshot))();break;case Ee.SUCCESS:e.complete&&ke(e.complete.bind(e))();break;default:e.error&&ke(e.error.bind(e,this._error))()}}resume(){const e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){const e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){const e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class De{constructor(e,t){this._service=e,this._location=t instanceof N?t:N.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new De(e,t)}get root(){const e=new N(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return X(this._location.path)}get storage(){return this._service}get parent(){const e=function(path){if(0===path.length)return null;const e=path.lastIndexOf("/");return-1===e?"":path.slice(0,e)}(this._location.path);if(null===e)return null;const t=new N(this._location.bucket,e);return new De(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw S(e)}}function Pe(e){const t={prefixes:[],items:[]};return Le(e,t).then((()=>t))}async function Le(e,t,n){const r={pageToken:n},o=await Me(e,r);t.prefixes.push(...o.prefixes),t.items.push(...o.items),null!=o.nextPageToken&&await Le(e,t,o.nextPageToken)}function Me(e,t){null!=t&&"number"==typeof t.maxResults&&P("options.maxResults",1,1e3,t.maxResults);const n=t||{},r=me(e.storage,e._location,"/",n.pageToken,n.maxResults);return e.storage.makeRequestWithTokens(r,Re)}function je(e,t){e._throwIfRoot("updateMetadata");const n=function(e,t,n,r){const o=L(t.fullServerUrl(),e.host,e._protocol),body=se(n,r),c=e.maxOperationRetryTime,l=new ue(o,"PATCH",he(e,r),c);return l.headers={"Content-Type":"application/json; charset=utf-8"},l.body=body,l.errorHandler=pe(t),l}(e.storage,e._location,t,ne());return e.storage.makeRequestWithTokens(n,Re)}function Fe(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const r=L(t.fullServerUrl(),e.host,e._protocol),o=e.maxOperationRetryTime,c=new ue(r,"GET",de(e,n),o);return c.errorHandler=pe(t),c}(e.storage,e._location,ne());return e.storage.makeRequestWithTokens(t,Re).then((e=>{if(null===e)throw new f(m.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e}))}function Ue(e){e._throwIfRoot("deleteObject");const t=function(e,t){const n=L(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime,o=new ue(n,"DELETE",(function(e,t){}),r);return o.successCodes=[200,204],o.errorHandler=pe(t),o}(e.storage,e._location);return e.storage.makeRequestWithTokens(t,Re)}function Ve(e,t){const n=function(path,e){const t=e.split("/").filter((component=>component.length>0)).join("/");return 0===path.length?t:path+"/"+t}(e._location.path,t),r=new N(e._location.bucket,n);return new De(e.storage,r)}function qe(e,path){if(e instanceof Ge){const t=e;if(null==t._bucket)throw new f(m.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+d+"' property when initializing the app?");const n=new De(t,t._bucket);return null!=path?qe(n,path):n}return void 0!==path?Ve(e,path):e}function Be(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof Ge)return new De(e,t);throw E("To use ref(service, url), the first argument must be a Storage instance.")}return qe(e,t)}function ze(e,t){const n=null==t?void 0:t[d];return null==n?null:N.makeFromBucketSpec(n,e)}class Ge{constructor(e,t,n,r,o){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=o,this._bucket=null,this._host=h,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?N.makeFromBucketSpec(r,this._host):ze(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=N.makeFromBucketSpec(this._url,e):this._bucket=ze(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(time){P("time",0,Number.POSITIVE_INFINITY,time),this._maxUploadRetryTime=time}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(time){P("time",0,Number.POSITIVE_INFINITY,time),this._maxOperationRetryTime=time}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new De(this,e)}_makeRequest(e,t,n,r,o=!0){if(this._deleted)return new A(C());{const c=function(e,t,n,r,o,c,l=!0){const h=M(e.urlParams),d=e.url+h,f=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(f,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(f,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(f,c),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(f,r),new F(d,e.method,f,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,o,l)}(e,this._appId,n,r,t,this._firebaseVersion,o);return this._requests.add(c),c.getPromise().then((()=>this._requests.delete(c)),(()=>this._requests.delete(c))),c}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const We="@firebase/storage",Ke="0.12.2",$e="storage";function He(e,data,t){return function(e,data,t){return e._throwIfRoot("uploadBytesResumable"),new xe(e,new Y(data),t)}(e=Object(c.w)(e),data,t)}function Qe(e){return function(e){e._throwIfRoot("getMetadata");const t=ge(e.storage,e._location,ne());return e.storage.makeRequestWithTokens(t,Re)}(e=Object(c.w)(e))}function Ye(e,t){return Be(e=Object(c.w)(e),t)}function Je(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`,e._protocol="http";const{mockUserToken:o}=r;o&&(e._overrideAuthToken="string"==typeof o?o:Object(c.l)(o,e.app.options.projectId))}(e,t,n,r)}function Xe(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),c=e.getProvider("app-check-internal");return new Ge(n,r,c,t,o.SDK_VERSION)}Object(o._registerComponent)(new l.a($e,Xe,"PUBLIC").setMultipleInstances(!0)),Object(o.registerVersion)(We,Ke,""),Object(o.registerVersion)(We,Ke,"esm2017");class Ze{constructor(e,t,n){this._delegate=e,this.task=t,this.ref=n}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class et{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new Ze(this._delegate.snapshot,this,this._ref)}then(e,t){return this._delegate.then((t=>{if(e)return e(new Ze(t,this,this._ref))}),t)}on(e,t,n,r){let o;return t&&(o="function"==typeof t?e=>t(new Ze(e,this,this._ref)):{next:t.next?e=>t.next(new Ze(e,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,o,n||void 0,r||void 0)}}class tt{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map((e=>new nt(e,this._service)))}get items(){return this._delegate.items.map((e=>new nt(e,this._service)))}get nextPageToken(){return this._delegate.nextPageToken||null}}class nt{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){const t=function(e,t){return Ve(e,t)}(this._delegate,e);return new nt(t,this.storage)}get root(){return new nt(this._delegate.root,this.storage)}get parent(){const e=this._delegate.parent;return null==e?null:new nt(e,this.storage)}put(data,e){return this._throwIfRoot("put"),new et(He(this._delegate,data,e),this)}putString(e,t=G.RAW,n){this._throwIfRoot("putString");const data=K(t,e),r=Object.assign({},n);return null==r.contentType&&null!=data.contentType&&(r.contentType=data.contentType),new et(new xe(this._delegate,new Y(data.data,!0),r),this)}listAll(){return(e=this._delegate,Pe(e=Object(c.w)(e))).then((e=>new tt(e,this.storage)));var e}list(e){return function(e,t){return Me(e=Object(c.w)(e),t)}(this._delegate,e||void 0).then((e=>new tt(e,this.storage)))}getMetadata(){return Qe(this._delegate)}updateMetadata(e){return function(e,t){return je(e=Object(c.w)(e),t)}(this._delegate,e)}getDownloadURL(){return e=this._delegate,Fe(e=Object(c.w)(e));var e}delete(){return this._throwIfRoot("delete"),e=this._delegate,Ue(e=Object(c.w)(e));var e}_throwIfRoot(e){if(""===this._delegate._location.path)throw S(e)}}class it{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(path){if(st(path))throw E("ref() expected a child path but got a URL, use refFromURL instead.");return new nt(Ye(this._delegate,path),this)}refFromURL(e){if(!st(e))throw E("refFromURL() expected a full URL but got a child path, use ref() instead.");try{N.makeFromUrl(e,this._delegate.host)}catch(e){throw E("refFromUrl() expected a valid full URL but got an invalid one.")}return new nt(Ye(this._delegate,e),this)}setMaxUploadRetryTime(time){this._delegate.maxUploadRetryTime=time}setMaxOperationRetryTime(time){this._delegate.maxOperationRetryTime=time}useEmulator(e,t,n={}){Je(this._delegate,e,t,n)}}function st(path){return/^[A-Za-z]+:\/\//.test(path)}function ot(e,{instanceIdentifier:t}){const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("storage").getImmediate({identifier:t});return new it(n,r)}!function(e){const t={TaskState:Ee,TaskEvent:Te,StringFormat:G,Storage:it,Reference:nt};e.INTERNAL.registerComponent(new l.a("storage-compat",ot,"PUBLIC").setServiceProps(t).setMultipleInstances(!0)),e.registerVersion("@firebase/storage-compat","0.3.5")}(r.a)},324:function(e,t,n){"use strict";var r=n(326),o=n(509),c=n(313),l=n(314);function h(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new o.g("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function d(){if("undefined"==typeof Uint8Array)throw new o.g("unimplemented","Uint8Arrays are not available in this environment.")}function f(){if(!Object(o.r)())throw new o.g("unimplemented","Blobs are unavailable in Firestore in this environment.")}class m{constructor(e){this._delegate=e}static fromBase64String(e){return f(),new m(o.b.fromBase64String(e))}static fromUint8Array(e){return d(),new m(o.b.fromUint8Array(e))}toBase64(){return f(),this._delegate.toBase64()}toUint8Array(){return d(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function _(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const object=e;for(const e of t)if(e in object&&"function"==typeof object[e])return!0;return!1}(e,["next","error","complete"])}class y{enableIndexedDbPersistence(e,t){return Object(o.F)(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return Object(o.G)(e._delegate)}clearIndexedDbPersistence(e){return Object(o.x)(e._delegate)}}class v{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof o.m||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();e.merge||t.host===e.host||Object(o.s)("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){Object(o.A)(this._delegate,e,t,n)}enableNetwork(){return Object(o.H)(this._delegate)}disableNetwork(){return Object(o.D)(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Object(o.t)("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Object(o.lb)(this._delegate)}onSnapshotsInSync(e){return Object(o.Y)(this._delegate,e)}get app(){if(!this._appCompat)throw new o.g("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new P(this,Object(o.y)(this._delegate,e))}catch(e){throw S(e,"collection()","Firestore.collection()")}}doc(e){try{return new C(this,Object(o.E)(this._delegate,e))}catch(e){throw S(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new R(this,Object(o.z)(this._delegate,e))}catch(e){throw S(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return Object(o.db)(this._delegate,(t=>e(new I(this,t))))}batch(){return Object(o.K)(this._delegate),new T(new o.l(this._delegate,(e=>Object(o.L)(this._delegate,e))))}loadBundle(e){return Object(o.V)(this._delegate,e)}namedQuery(e){return Object(o.W)(this._delegate,e).then((e=>e?new R(this,e):null))}}class w extends o.a{constructor(e){super(),this.firestore=e}convertBytes(e){return new m(new o.b(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return C.forKey(t,this.firestore,null)}}class I{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new w(e)}get(e){const t=L(e);return this._delegate.get(t).then((e=>new N(this._firestore,new o.e(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter))))}set(e,data,t){const n=L(e);return t?(h("Transaction.set",t),this._delegate.set(n,data,t)):this._delegate.set(n,data),this}update(e,t,n,...r){const o=L(e);return 2===arguments.length?this._delegate.update(o,t):this._delegate.update(o,t,n,...r),this}delete(e){const t=L(e);return this._delegate.delete(t),this}}class T{constructor(e){this._delegate=e}set(e,data,t){const n=L(e);return t?(h("WriteBatch.set",t),this._delegate.set(n,data,t)):this._delegate.set(n,data),this}update(e,t,n,...r){const o=L(e);return 2===arguments.length?this._delegate.update(o,t):this._delegate.update(o,t,n,...r),this}delete(e){const t=L(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class E{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new o.i(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new A(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=E.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let o=r.get(t);return o||(o=new E(e,new w(e),t),r.set(t,o)),o}}E.INSTANCES=new WeakMap;class C{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new w(e)}static forPath(path,e,t){if(path.length%2!=0)throw new o.g("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${path.canonicalString()} has ${path.length}`);return new C(e,new o.d(e._delegate,t,new o.n(path)))}static forKey(e,t,n){return new C(t,new o.d(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new P(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new P(this.firestore,Object(o.y)(this._delegate,e))}catch(e){throw S(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=Object(c.w)(e))instanceof o.d&&Object(o.cb)(this._delegate,e)}set(e,t){t=h("DocumentReference.set",t);try{return t?Object(o.fb)(this._delegate,e,t):Object(o.fb)(this._delegate,e)}catch(e){throw S(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?Object(o.kb)(this._delegate,e):Object(o.kb)(this._delegate,e,t,...n)}catch(e){throw S(e,"updateDoc()","DocumentReference.update()")}}delete(){return Object(o.B)(this._delegate)}onSnapshot(...e){const t=k(e),n=O(e,(e=>new N(this.firestore,new o.e(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))));return Object(o.X)(this._delegate,t,n)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?Object(o.N)(this._delegate):"server"===(null==e?void 0:e.source)?Object(o.O)(this._delegate):Object(o.M)(this._delegate),t.then((e=>new N(this.firestore,new o.e(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))))}withConverter(e){return new C(this.firestore,e?this._delegate.withConverter(E.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function S(e,t,n){return e.message=e.message.replace(t,n),e}function k(e){for(const t of e)if("object"==typeof t&&!_(t))return t;return{}}function O(e,t){var n,r;let o;return o=_(e[0])?e[0]:_(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{o.next&&o.next(t(e))},error:null===(n=o.error)||void 0===n?void 0:n.bind(o),complete:null===(r=o.complete)||void 0===r?void 0:r.bind(o)}}class N{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new C(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Object(o.hb)(this._delegate,e._delegate)}}class A extends N{data(e){const data=this._delegate.data(e);return this._delegate._converter||Object(o.q)(void 0!==data,"Document in a QueryDocumentSnapshot should exist"),data}}class R{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new w(e)}where(e,t,n){try{return new R(this.firestore,Object(o.ab)(this._delegate,Object(o.mb)(e,t,n)))}catch(e){throw S(e,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new R(this.firestore,Object(o.ab)(this._delegate,Object(o.Z)(e,t)))}catch(e){throw S(e,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new R(this.firestore,Object(o.ab)(this._delegate,Object(o.T)(e)))}catch(e){throw S(e,"limit()","Query.limit()")}}limitToLast(e){try{return new R(this.firestore,Object(o.ab)(this._delegate,Object(o.U)(e)))}catch(e){throw S(e,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new R(this.firestore,Object(o.ab)(this._delegate,Object(o.jb)(...e)))}catch(e){throw S(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new R(this.firestore,Object(o.ab)(this._delegate,Object(o.ib)(...e)))}catch(e){throw S(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new R(this.firestore,Object(o.ab)(this._delegate,Object(o.J)(...e)))}catch(e){throw S(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new R(this.firestore,Object(o.ab)(this._delegate,Object(o.I)(...e)))}catch(e){throw S(e,"endAt()","Query.endAt()")}}isEqual(e){return Object(o.bb)(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?Object(o.Q)(this._delegate):"server"===(null==e?void 0:e.source)?Object(o.R)(this._delegate):Object(o.P)(this._delegate),t.then((e=>new D(this.firestore,new o.j(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))))}onSnapshot(...e){const t=k(e),n=O(e,(e=>new D(this.firestore,new o.j(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))));return Object(o.X)(this._delegate,t,n)}withConverter(e){return new R(this.firestore,e?this._delegate.withConverter(E.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class x{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new A(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class D{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new R(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((e=>new A(this._firestore,e)))}docChanges(e){return this._delegate.docChanges(e).map((e=>new x(this._firestore,e)))}forEach(e,t){this._delegate.forEach((n=>{e.call(t,new A(this._firestore,n))}))}isEqual(e){return Object(o.hb)(this._delegate,e._delegate)}}class P extends R{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new C(this.firestore,e):null}doc(e){try{return new C(this.firestore,void 0===e?Object(o.E)(this._delegate):Object(o.E)(this._delegate,e))}catch(e){throw S(e,"doc()","CollectionReference.doc()")}}add(data){return Object(o.u)(this._delegate,data).then((e=>new C(this.firestore,e)))}isEqual(e){return Object(o.cb)(this._delegate,e._delegate)}withConverter(e){return new P(this.firestore,e?this._delegate.withConverter(E.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function L(e){return Object(o.p)(e,o.d)}class M{constructor(...e){this._delegate=new o.f(...e)}static documentId(){return new M(o.o.keyField().canonicalString())}isEqual(e){return(e=Object(c.w)(e))instanceof o.f&&this._delegate._internalPath.isEqual(e._internalPath)}}class j{constructor(e){this._delegate=e}static serverTimestamp(){const e=Object(o.eb)();return e._methodName="FieldValue.serverTimestamp",new j(e)}static delete(){const e=Object(o.C)();return e._methodName="FieldValue.delete",new j(e)}static arrayUnion(...e){const t=Object(o.w)(...e);return t._methodName="FieldValue.arrayUnion",new j(t)}static arrayRemove(...e){const t=Object(o.v)(...e);return t._methodName="FieldValue.arrayRemove",new j(t)}static increment(e){const t=Object(o.S)(e);return t._methodName="FieldValue.increment",new j(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const F={Firestore:v,GeoPoint:o.h,Timestamp:o.k,Blob:m,Transaction:I,WriteBatch:T,DocumentReference:C,DocumentSnapshot:N,Query:R,QueryDocumentSnapshot:A,QuerySnapshot:D,CollectionReference:P,FieldPath:M,FieldValue:j,setLogLevel:function(e){Object(o.gb)(e)},CACHE_SIZE_UNLIMITED:o.c};var U,V;U=r.a,V=(e,t)=>new v(e,t,new y),U.INTERNAL.registerComponent(new l.a("firestore-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate();return V(t,n)}),"PUBLIC").setServiceProps(Object.assign({},F))),U.registerVersion("@firebase/firestore-compat","0.3.26")},325:function(e,t,n){"use strict";var r=n(326),o=n(314),c=n(511),l=n(313),h=n(327);const d=new h.b("@firebase/database-compat"),f=function(e){const t="FIREBASE WARNING: "+e;d.warn(t)};class m{constructor(e){this._delegate=e}cancel(e){Object(l.S)("OnDisconnect.cancel",0,1,arguments.length),Object(l.T)("OnDisconnect.cancel","onComplete",e,!0);const t=this._delegate.cancel();return e&&t.then((()=>e(null)),(t=>e(t))),t}remove(e){Object(l.S)("OnDisconnect.remove",0,1,arguments.length),Object(l.T)("OnDisconnect.remove","onComplete",e,!0);const t=this._delegate.remove();return e&&t.then((()=>e(null)),(t=>e(t))),t}set(e,t){Object(l.S)("OnDisconnect.set",1,2,arguments.length),Object(l.T)("OnDisconnect.set","onComplete",t,!0);const n=this._delegate.set(e);return t&&n.then((()=>t(null)),(e=>t(e))),n}setWithPriority(e,t,n){Object(l.S)("OnDisconnect.setWithPriority",2,3,arguments.length),Object(l.T)("OnDisconnect.setWithPriority","onComplete",n,!0);const r=this._delegate.setWithPriority(e,t);return n&&r.then((()=>n(null)),(e=>n(e))),r}update(e,t){if(Object(l.S)("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){const t={};for(let i=0;i<e.length;++i)t[""+i]=e[i];e=t,f("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Object(l.T)("OnDisconnect.update","onComplete",t,!0);const n=this._delegate.update(e);return t&&n.then((()=>t(null)),(e=>t(e))),n}}class _{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return Object(l.S)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class y{constructor(e,t){this._database=e,this._delegate=t}val(){return Object(l.S)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return Object(l.S)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return Object(l.S)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return Object(l.S)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(path){return Object(l.S)("DataSnapshot.child",0,1,arguments.length),path=String(path),Object(c.g)("DataSnapshot.child","path",path,!1),new y(this._database,this._delegate.child(path))}hasChild(path){return Object(l.S)("DataSnapshot.hasChild",1,1,arguments.length),Object(c.g)("DataSnapshot.hasChild","path",path,!1),this._delegate.hasChild(path)}getPriority(){return Object(l.S)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return Object(l.S)("DataSnapshot.forEach",1,1,arguments.length),Object(l.T)("DataSnapshot.forEach","action",e,!1),this._delegate.forEach((t=>e(new y(this._database,t))))}hasChildren(){return Object(l.S)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return Object(l.S)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return Object(l.S)("DataSnapshot.ref",0,0,arguments.length),new w(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class v{constructor(e,t){this.database=e,this._delegate=t}on(e,t,n,r){var o;Object(l.S)("Query.on",2,4,arguments.length),Object(l.T)("Query.on","callback",t,!1);const h=v.getCancelAndContextArgs_("Query.on",n,r),d=(e,n)=>{t.call(h.context,new y(this.database,e),n)};d.userCallback=t,d.context=h.context;const f=null===(o=h.cancel)||void 0===o?void 0:o.bind(h.context);switch(e){case"value":return Object(c.B)(this._delegate,d,f),t;case"child_added":return Object(c.x)(this._delegate,d,f),t;case"child_removed":return Object(c.A)(this._delegate,d,f),t;case"child_changed":return Object(c.y)(this._delegate,d,f),t;case"child_moved":return Object(c.z)(this._delegate,d,f),t;default:throw new Error(Object(l.q)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){if(Object(l.S)("Query.off",0,3,arguments.length),function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Object(l.q)(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}("Query.off",e,!0),Object(l.T)("Query.off","callback",t,!0),Object(l.U)("Query.off","context",n,!0),t){const r=()=>{};r.userCallback=t,r.context=n,Object(c.w)(this._delegate,e,r)}else Object(c.w)(this._delegate,e)}get(){return Object(c.q)(this._delegate).then((e=>new y(this.database,e)))}once(e,t,n,r){Object(l.S)("Query.once",1,4,arguments.length),Object(l.T)("Query.once","callback",t,!0);const o=v.getCancelAndContextArgs_("Query.once",n,r),h=new l.a,d=(e,n)=>{const r=new y(this.database,e);t&&t.call(o.context,r,n),h.resolve(r)};d.userCallback=t,d.context=o.context;const f=e=>{o.cancel&&o.cancel.call(o.context,e),h.reject(e)};switch(e){case"value":Object(c.B)(this._delegate,d,f,{onlyOnce:!0});break;case"child_added":Object(c.x)(this._delegate,d,f,{onlyOnce:!0});break;case"child_removed":Object(c.A)(this._delegate,d,f,{onlyOnce:!0});break;case"child_changed":Object(c.y)(this._delegate,d,f,{onlyOnce:!0});break;case"child_moved":Object(c.z)(this._delegate,d,f,{onlyOnce:!0});break;default:throw new Error(Object(l.q)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return h.promise}limitToFirst(e){return Object(l.S)("Query.limitToFirst",1,1,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.u)(e)))}limitToLast(e){return Object(l.S)("Query.limitToLast",1,1,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.v)(e)))}orderByChild(path){return Object(l.S)("Query.orderByChild",1,1,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.C)(path)))}orderByKey(){return Object(l.S)("Query.orderByKey",0,0,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.D)()))}orderByPriority(){return Object(l.S)("Query.orderByPriority",0,0,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.E)()))}orderByValue(){return Object(l.S)("Query.orderByValue",0,0,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.F)()))}startAt(e=null,t){return Object(l.S)("Query.startAt",0,2,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.R)(e,t)))}startAfter(e=null,t){return Object(l.S)("Query.startAfter",0,2,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.Q)(e,t)))}endAt(e=null,t){return Object(l.S)("Query.endAt",0,2,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.l)(e,t)))}endBefore(e=null,t){return Object(l.S)("Query.endBefore",0,2,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.m)(e,t)))}equalTo(e,t){return Object(l.S)("Query.equalTo",1,2,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.n)(e,t)))}toString(){return Object(l.S)("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return Object(l.S)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(Object(l.S)("Query.isEqual",1,1,arguments.length),!(e instanceof v)){throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,n){const r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,Object(l.T)(e,"cancel",r.cancel,!0),r.context=n,Object(l.U)(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(Object(l.q)(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r}get ref(){return new w(this.database,new c.d(this._delegate._repo,this._delegate._path))}}class w extends v{constructor(e,t){super(e,new c.b(t._repo,t._path,new c.c,!1)),this.database=e,this._delegate=t}getKey(){return Object(l.S)("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return Object(l.S)("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new w(this.database,Object(c.i)(this._delegate,e))}getParent(){Object(l.S)("Reference.parent",0,0,arguments.length);const e=this._delegate.parent;return e?new w(this.database,e):null}getRoot(){return Object(l.S)("Reference.root",0,0,arguments.length),new w(this.database,this._delegate.root)}set(e,t){Object(l.S)("Reference.set",1,2,arguments.length),Object(l.T)("Reference.set","onComplete",t,!0);const n=Object(c.N)(this._delegate,e);return t&&n.then((()=>t(null)),(e=>t(e))),n}update(e,t){if(Object(l.S)("Reference.update",1,2,arguments.length),Array.isArray(e)){const t={};for(let i=0;i<e.length;++i)t[""+i]=e[i];e=t,f("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Object(c.h)("Reference.update",this._delegate._path),Object(l.T)("Reference.update","onComplete",t,!0);const n=Object(c.S)(this._delegate,e);return t&&n.then((()=>t(null)),(e=>t(e))),n}setWithPriority(e,t,n){Object(l.S)("Reference.setWithPriority",2,3,arguments.length),Object(l.T)("Reference.setWithPriority","onComplete",n,!0);const r=Object(c.P)(this._delegate,e,t);return n&&r.then((()=>n(null)),(e=>n(e))),r}remove(e){Object(l.S)("Reference.remove",0,1,arguments.length),Object(l.T)("Reference.remove","onComplete",e,!0);const t=Object(c.K)(this._delegate);return e&&t.then((()=>e(null)),(t=>e(t))),t}transaction(e,t,n){Object(l.S)("Reference.transaction",1,3,arguments.length),Object(l.T)("Reference.transaction","transactionUpdate",e,!1),Object(l.T)("Reference.transaction","onComplete",t,!0),function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Object(l.q)(e,t)+"must be a boolean.")}("Reference.transaction","applyLocally",n,!0);const r=Object(c.L)(this._delegate,e,{applyLocally:n}).then((e=>new _(e.committed,new y(this.database,e.snapshot))));return t&&r.then((e=>t(null,e.committed,e.snapshot)),(e=>t(e,!1,null))),r}setPriority(e,t){Object(l.S)("Reference.setPriority",1,2,arguments.length),Object(l.T)("Reference.setPriority","onComplete",t,!0);const n=Object(c.O)(this._delegate,e);return t&&n.then((()=>t(null)),(e=>t(e))),n}push(e,t){Object(l.S)("Reference.push",0,2,arguments.length),Object(l.T)("Reference.push","onComplete",t,!0);const n=Object(c.G)(this._delegate,e),r=n.then((e=>new w(this.database,e)));t&&r.then((()=>t(null)),(e=>t(e)));const o=new w(this.database,n);return o.then=r.then.bind(r),o.catch=r.catch.bind(r,void 0),o}onDisconnect(){return Object(c.h)("Reference.onDisconnect",this._delegate._path),new m(new c.a(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class I{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:c.p,forceLongPolling:c.o}}useEmulator(e,t,n={}){Object(c.j)(this._delegate,e,t,n)}ref(path){if(Object(l.S)("database.ref",0,1,arguments.length),path instanceof w){const e=Object(c.J)(this._delegate,path.toString());return new w(this,e)}{const e=Object(c.I)(this._delegate,path);return new w(this,e)}}refFromURL(e){Object(l.S)("database.refFromURL",1,1,arguments.length);const t=Object(c.J)(this._delegate,e);return new w(this,t)}goOffline(){return Object(l.S)("database.goOffline",0,0,arguments.length),Object(c.r)(this._delegate)}goOnline(){return Object(l.S)("database.goOnline",0,0,arguments.length),Object(c.s)(this._delegate)}}I.ServerValue={TIMESTAMP:Object(c.M)(),increment:e=>Object(c.t)(e)};var T=Object.freeze({__proto__:null,initStandalone:function({app:e,url:t,version:n,customAuthImpl:r,customAppCheckImpl:l,namespace:h,nodeAdmin:d=!1}){Object(c.f)(n);const f=new o.b("database-standalone"),m=new o.c("auth-internal",f);let _;return m.setComponent(new o.a("auth-internal",(()=>r),"PRIVATE")),l&&(_=new o.c("app-check-internal",f),_.setComponent(new o.a("app-check-internal",(()=>l),"PRIVATE"))),{instance:new I(Object(c.e)(e,m,_,t,d),e),namespace:h}}});const E=I.ServerValue;var C;(C=r.a).INTERNAL.registerComponent(new o.a("database-compat",((e,{instanceIdentifier:t})=>{const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("database").getImmediate({identifier:t});return new I(r,n)}),"PUBLIC").setServiceProps({Reference:w,Query:v,Database:I,DataSnapshot:y,enableLogging:c.k,INTERNAL:T,ServerValue:E}).setMultipleInstances(!0)),C.registerVersion("@firebase/database-compat","1.0.3")},326:function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var r=n(313),o=n(314),c=n(329),l=n(327);class h{constructor(e,t){this._delegate=e,this.firebase=t,Object(c._addComponent)(e,new o.a("app-compat",(()=>this),"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((e=>{this._delegate.checkDestroyed(),e()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),Object(c.deleteApp)(this._delegate))))}_getService(e,t=c._DEFAULT_ENTRY_NAME){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=c._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(component){Object(c._addComponent)(this._delegate,component)}_addOrOverwriteComponent(component){Object(c._addOrOverwriteComponent)(this._delegate,component)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const d={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."},f=new r.b("app-compat","Firebase",d);const m=function e(){const t=function(e){const t={},n={__esModule:!0,initializeApp:function(o,l={}){const h=c.initializeApp(o,l);if(Object(r.k)(t,h.name))return t[h.name];const d=new e(h,n);return t[h.name]=d,d},app:o,registerVersion:c.registerVersion,setLogLevel:c.setLogLevel,onLog:c.onLog,apps:null,SDK_VERSION:c.SDK_VERSION,INTERNAL:{registerComponent:function(component){const t=component.name,l=t.replace("-compat","");if(c._registerComponent(component)&&"PUBLIC"===component.type){const c=(e=o())=>{if("function"!=typeof e[l])throw f.create("invalid-app-argument",{appName:t});return e[l]()};void 0!==component.serviceProps&&Object(r.p)(c,component.serviceProps),n[l]=c,e.prototype[l]=function(...e){return this._getService.bind(this,t).apply(this,component.multipleInstances?e:[])}}return"PUBLIC"===component.type?n[l]:null},removeApp:function(e){delete t[e]},useAsService:function(e,t){if("serverAuth"===t)return null;return t},modularAPIs:c}};function o(e){if(e=e||c._DEFAULT_ENTRY_NAME,!Object(r.k)(t,e))throw f.create("no-app",{appName:e});return t[e]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(t).map((e=>t[e]))}}),o.App=e,n}(h);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){Object(r.p)(t,e)},createSubscribe:r.m,ErrorFactory:r.b,deepExtend:r.p}),t}(),_=new l.b("@firebase/app-compat");if(Object(r.z)()&&void 0!==self.firebase){_.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&_.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const y=m;var v;Object(c.registerVersion)("@firebase/app-compat","0.2.28",v)},327:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return f})),n.d(t,"c",(function(){return m})),n.d(t,"d",(function(){return _}));const r=[];var o;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(o||(o={}));const c={debug:o.DEBUG,verbose:o.VERBOSE,info:o.INFO,warn:o.WARN,error:o.ERROR,silent:o.SILENT},l=o.INFO,h={[o.DEBUG]:"log",[o.VERBOSE]:"log",[o.INFO]:"info",[o.WARN]:"warn",[o.ERROR]:"error"},d=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),o=h[t];if(!o)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[o](`[${r}]  ${e.name}:`,...n)};class f{constructor(e){this.name=e,this._logLevel=l,this._logHandler=d,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in o))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?c[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,o.DEBUG,...e),this._logHandler(this,o.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,o.VERBOSE,...e),this._logHandler(this,o.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,o.INFO,...e),this._logHandler(this,o.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,o.WARN,...e),this._logHandler(this,o.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,o.ERROR,...e),this._logHandler(this,o.ERROR,...e)}}function m(e){r.forEach((t=>{t.setLogLevel(e)}))}function _(e,t){for(const n of r){let r=null;t&&t.level&&(r=c[t.level]),n.userLogHandler=null===e?null:(t,n,...c)=>{const l=c.map((e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}})).filter((e=>e)).join(" ");n>=(null!=r?r:t.logLevel)&&e({level:o[n].toLowerCase(),message:l,args:c,type:t.name})}}}},329:function(e,t,n){"use strict";n.r(t),n.d(t,"FirebaseError",(function(){return c.c})),n.d(t,"SDK_VERSION",(function(){return H})),n.d(t,"_DEFAULT_ENTRY_NAME",(function(){return P})),n.d(t,"_addComponent",(function(){return F})),n.d(t,"_addOrOverwriteComponent",(function(){return U})),n.d(t,"_apps",(function(){return M})),n.d(t,"_clearComponents",(function(){return G})),n.d(t,"_components",(function(){return j})),n.d(t,"_getProvider",(function(){return B})),n.d(t,"_registerComponent",(function(){return V})),n.d(t,"_removeServiceInstance",(function(){return z})),n.d(t,"deleteApp",(function(){return X})),n.d(t,"getApp",(function(){return Y})),n.d(t,"getApps",(function(){return J})),n.d(t,"initializeApp",(function(){return Q})),n.d(t,"onLog",(function(){return ee})),n.d(t,"registerVersion",(function(){return Z})),n.d(t,"setLogLevel",(function(){return te}));var r=n(314),o=n(327),c=n(313);const l=(object,e)=>e.some((e=>object instanceof e));let h,d;const f=new WeakMap,m=new WeakMap,_=new WeakMap,y=new WeakMap,v=new WeakMap;let w={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return m.get(e);if("objectStoreNames"===t)return e.objectStoreNames||_.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return E(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function I(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(d||(d=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(C(this),t),E(f.get(this))}:function(...t){return E(e.apply(C(this),t))}:function(t,...n){const r=e.call(C(this),t,...n);return _.set(r,t.sort?t.sort():[t]),E(r)}}function T(e){return"function"==typeof e?I(e):(e instanceof IDBTransaction&&function(e){if(m.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",c),e.removeEventListener("abort",c)},o=()=>{t(),r()},c=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",o),e.addEventListener("error",c),e.addEventListener("abort",c)}));m.set(e,t)}(e),l(e,h||(h=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,w):e)}function E(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",c)},o=()=>{t(E(e.result)),r()},c=()=>{n(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",c)}));return t.then((t=>{t instanceof IDBCursor&&f.set(t,e)})).catch((()=>{})),v.set(t,e),t}(e);if(y.has(e))return y.get(e);const t=T(e);return t!==e&&(y.set(e,t),v.set(t,e)),t}const C=e=>v.get(e);const S=["get","getKey","getAll","getAllKeys","count"],k=["put","add","delete","clear"],O=new Map;function N(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(O.get(t))return O.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=k.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!o&&!S.includes(n))return;const c=async function(e,...t){const c=this.transaction(e,o?"readwrite":"readonly");let l=c.store;return r&&(l=l.index(t.shift())),(await Promise.all([l[n](...t),o&&c.done]))[0]};return O.set(t,c),c}w=(e=>({...e,get:(t,n,r)=>N(t,n)||e.get(t,n,r),has:(t,n)=>!!N(t,n)||e.has(t,n)}))(w);class A{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const component=e.getComponent();return"VERSION"===(null==component?void 0:component.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const R="@firebase/app",x="0.9.28",D=new o.b("@firebase/app"),P="[DEFAULT]",L={[R]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},M=new Map,j=new Map;function F(e,component){try{e.container.addComponent(component)}catch(t){D.debug(`Component ${component.name} failed to register with FirebaseApp ${e.name}`,t)}}function U(e,component){e.container.addOrOverwriteComponent(component)}function V(component){const e=component.name;if(j.has(e))return D.debug(`There were multiple attempts to register component ${e}.`),!1;j.set(e,component);for(const e of M.values())F(e,component);return!0}function B(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function z(e,t,n=P){B(e,t).clearInstance(n)}function G(){j.clear()}const W={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},K=new c.b("app","Firebase",W);class ${constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.a("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw K.create("app-deleted",{appName:this._name})}}const H="10.8.1";function Q(e,t={}){let n=e;if("object"!=typeof t){t={name:t}}const o=Object.assign({name:P,automaticDataCollectionEnabled:!1},t),l=o.name;if("string"!=typeof l||!l)throw K.create("bad-app-name",{appName:String(l)});if(n||(n=Object(c.s)()),!n)throw K.create("no-options");const h=M.get(l);if(h){if(Object(c.o)(n,h.options)&&Object(c.o)(o,h.config))return h;throw K.create("duplicate-app",{appName:l})}const d=new r.b(l);for(const component of j.values())d.addComponent(component);const f=new $(n,o,d);return M.set(l,f),f}function Y(e=P){const t=M.get(e);if(!t&&e===P&&Object(c.s)())return Q();if(!t)throw K.create("no-app",{appName:e});return t}function J(){return Array.from(M.values())}async function X(e){const t=e.name;M.has(t)&&(M.delete(t),await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}function Z(e,t,n){var o;let c=null!==(o=L[e])&&void 0!==o?o:e;n&&(c+=`-${n}`);const l=c.match(/\s|\//),h=t.match(/\s|\//);if(l||h){const e=[`Unable to register library "${c}" with version "${t}":`];return l&&e.push(`library name "${c}" contains illegal characters (whitespace or "/")`),l&&h&&e.push("and"),h&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void D.warn(e.join(" "))}V(new r.a(`${c}-version`,(()=>({library:c,version:t})),"VERSION"))}function ee(e,t){if(null!==e&&"function"!=typeof e)throw K.create("invalid-log-argument");Object(o.d)(e,t)}function te(e){Object(o.c)(e)}const ne="firebase-heartbeat-database",re=1,ie="firebase-heartbeat-store";let se=null;function oe(){return se||(se=function(e,t,{blocked:n,upgrade:r,blocking:o,terminated:c}={}){const l=indexedDB.open(e,t),h=E(l);return r&&l.addEventListener("upgradeneeded",(e=>{r(E(l.result),e.oldVersion,e.newVersion,E(l.transaction),e)})),n&&l.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),h.then((e=>{c&&e.addEventListener("close",(()=>c())),o&&e.addEventListener("versionchange",(e=>o(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),h}(ne,re,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ie)}catch(e){console.warn(e)}}}).catch((e=>{throw K.create("idb-open",{originalErrorMessage:e.message})}))),se}async function ae(e,t){try{const n=(await oe()).transaction(ie,"readwrite"),r=n.objectStore(ie);await r.put(t,ce(e)),await n.done}catch(e){if(e instanceof c.c)D.warn(e.message);else{const t=K.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});D.warn(t.message)}}}function ce(e){return`${e.name}!${e.options.appId}`}class ue{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new he(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=le();if((null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((e=>e.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=le(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){const n=[];let r=e.slice();for(const o of e){const e=n.find((e=>e.agent===o.agent));if(e){if(e.dates.push(o.date),de(n)>t){e.dates.pop();break}}else if(n.push({agent:o.agent,dates:[o.date]}),de(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),o=Object(c.j)(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}}function le(){return(new Date).toISOString().substring(0,10)}class he{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Object(c.D)()&&Object(c.V)().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await oe()).transaction(ie),n=await t.objectStore(ie).get(ce(e));return await t.done,n}catch(e){if(e instanceof c.c)D.warn(e.message);else{const t=K.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});D.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return ae(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return ae(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function de(e){return Object(c.j)(JSON.stringify({version:2,heartbeats:e})).length}var fe;fe="",V(new r.a("platform-logger",(e=>new A(e)),"PRIVATE")),V(new r.a("heartbeat",(e=>new ue(e)),"PRIVATE")),Z(R,x,fe),Z(R,x,"esm2017"),Z("fire-js","")},508:function(e,t,n){"use strict";(function(e){var t=n(326),r=n(581),o=n(314),c=n(313);function l(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function h(e=Object(c.x)()){return!("file:"!==l()&&"ionic:"!==l()&&"capacitor:"!==l()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function d(e=Object(c.x)()){return Object(c.C)()&&11===(null===document||void 0===document?void 0:document.documentMode)||function(e=Object(c.x)()){return/Edge\/\d+/.test(e)}(e)}function f(){try{const e=self.localStorage,t=r.s();if(e)return e.setItem(t,"1"),e.removeItem(t),!d()||Object(c.D)()}catch(e){return m()&&Object(c.D)()}return!1}function m(){return void 0!==e&&"WorkerGlobalScope"in e&&"importScripts"in e}function _(){return("http:"===l()||"https:"===l()||Object(c.A)()||h())&&!(Object(c.H)()||Object(c.F)())&&f()&&!m()}function y(){return h()&&"undefined"!=typeof document}const v={LOCAL:"local",NONE:"none",SESSION:"session"},w=r.p,I="persistence";async function T(e){await e._initializationPromise;const t=E(),n=r.w(I,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function E(){var e;try{return(null===(e="undefined"!=typeof window?window:null)||void 0===e?void 0:e.sessionStorage)||null}catch(e){return null}}const C=r.p;class S{constructor(){this.browserResolver=r.t(r.A),this.cordovaResolver=r.t(r.F),this.underlyingResolver=null,this._redirectPersistence=r.B,this._completeRedirectFn=r.u,this._overrideRedirectResult=r.v}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return y()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return C(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await async function(){return!!y()&&new Promise((e=>{const t=setTimeout((()=>{e(!1)}),1e3);document.addEventListener("deviceready",(()=>{clearTimeout(t),e(!0)}))}))}();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function k(object){return object.unwrap()}function O(object){const{_tokenResponse:e}=object instanceof c.c?object.customData:object;if(!e)return null;if(!(object instanceof c.c)&&"temporaryProof"in e&&"phoneNumber"in e)return r.i.credentialFromResult(object);const t=e.providerId;if(!t||t===r.k.PASSWORD)return null;let n;switch(t){case r.k.GOOGLE:n=r.f;break;case r.k.FACEBOOK:n=r.d;break;case r.k.GITHUB:n=r.e;break;case r.k.TWITTER:n=r.o;break;default:const{oauthIdToken:o,oauthAccessToken:c,oauthTokenSecret:l,pendingToken:h,nonce:d}=e;return c||l||o||h?h?t.startsWith("saml.")?r.m._create(t,h):r.g._fromParams({providerId:t,signInMethod:t,pendingToken:h,idToken:o,accessToken:c}):new r.h(t).credential({idToken:o,accessToken:c,rawNonce:d}):null}return object instanceof c.c?n.credentialFromError(object):n.credentialFromResult(object)}function N(e,t){return t.catch((t=>{throw t instanceof c.c&&function(e,t){var n;const o=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===(null==t?void 0:t.code))t.resolver=new R(e,r.K(e,t));else if(o){const e=O(t),n=t;e&&(n.credential=e,n.tenantId=o.tenantId||void 0,n.email=o.email||void 0,n.phoneNumber=o.phoneNumber||void 0)}}(e,t),t})).then((e=>{const t=e.operationType,n=e.user;return{operationType:t,credential:(o=e,O(o)),additionalUserInfo:r.J(e),user:x.getOrCreate(n)};var o}))}async function A(e,t){const n=await t;return{verificationId:n.verificationId,confirm:t=>N(e,n.confirm(t))}}class R{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return N(k(this.auth),this.resolver.resolveSignIn(e))}}class x{constructor(e){this._delegate=e,this.multiFactor=r.T(e)}static getOrCreate(e){return x.USER_MAP.has(e)||x.USER_MAP.set(e,new x(e)),x.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return N(this.auth,r.P(this._delegate,e))}async linkWithPhoneNumber(e,t){return A(this.auth,r.Q(this._delegate,e,t))}async linkWithPopup(e){return N(this.auth,r.R(this._delegate,e,S))}async linkWithRedirect(e){return await T(r.q(this.auth)),r.S(this._delegate,e,S)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return N(this.auth,r.U(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return A(this.auth,r.V(this._delegate,e,t))}reauthenticateWithPopup(e){return N(this.auth,r.W(this._delegate,e,S))}async reauthenticateWithRedirect(e){return await T(r.q(this.auth)),r.X(this._delegate,e,S)}sendEmailVerification(e){return r.Y(this._delegate,e)}async unlink(e){return await r.jb(this._delegate,e),this}updateEmail(e){return r.kb(this._delegate,e)}updatePassword(e){return r.lb(this._delegate,e)}updatePhoneNumber(e){return r.mb(this._delegate,e)}updateProfile(e){return r.nb(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return r.ob(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}x.USER_MAP=new WeakMap;const D=r.p;class P{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:n}=e.options;D(n,"invalid-api-key",{appName:e.name}),D(n,"invalid-api-key",{appName:e.name});const o="undefined"!=typeof window?S:void 0;this._delegate=t.initialize({options:{persistence:M(n,e.name),popupRedirectResolver:o}}),this._delegate._updateErrorMap(r.H),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?x.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){r.E(this._delegate,e,t)}applyActionCode(code){return r.y(this._delegate,code)}checkActionCode(code){return r.C(this._delegate,code)}confirmPasswordReset(code,e){return r.D(this._delegate,code,e)}async createUserWithEmailAndPassword(e,t){return N(this._delegate,r.G(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return r.I(this._delegate,e)}isSignInWithEmailLink(e){return r.O(this._delegate,e)}async getRedirectResult(){D(_(),this._delegate,"operation-not-supported-in-this-environment");const e=await r.L(this._delegate,S);return e?N(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){r.x(this._delegate,e)}onAuthStateChanged(e,t,n){const{next:r,error:o,complete:c}=L(e,t,n);return this._delegate.onAuthStateChanged(r,o,c)}onIdTokenChanged(e,t,n){const{next:r,error:o,complete:c}=L(e,t,n);return this._delegate.onIdTokenChanged(r,o,c)}sendSignInLinkToEmail(e,t){return r.ab(this._delegate,e,t)}sendPasswordResetEmail(e,t){return r.Z(this._delegate,e,t||void 0)}async setPersistence(e){let t;switch(function(e,t){w(Object.values(v).includes(t),e,"invalid-persistence-type"),Object(c.H)()?w(t!==v.SESSION,e,"unsupported-persistence-type"):Object(c.F)()?w(t===v.NONE,e,"unsupported-persistence-type"):m()?w(t===v.NONE||t===v.LOCAL&&Object(c.D)(),e,"unsupported-persistence-type"):w(t===v.NONE||f(),e,"unsupported-persistence-type")}(this._delegate,e),e){case v.SESSION:t=r.B;break;case v.LOCAL:t=await r.t(r.N)._isAvailable()?r.N:r.z;break;case v.NONE:t=r.M;break;default:return r.r("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return N(this._delegate,r.bb(this._delegate))}signInWithCredential(e){return N(this._delegate,r.cb(this._delegate,e))}signInWithCustomToken(e){return N(this._delegate,r.db(this._delegate,e))}signInWithEmailAndPassword(e,t){return N(this._delegate,r.eb(this._delegate,e,t))}signInWithEmailLink(e,t){return N(this._delegate,r.fb(this._delegate,e,t))}signInWithPhoneNumber(e,t){return A(this._delegate,r.gb(this._delegate,e,t))}async signInWithPopup(e){return D(_(),this._delegate,"operation-not-supported-in-this-environment"),N(this._delegate,r.hb(this._delegate,e,S))}async signInWithRedirect(e){return D(_(),this._delegate,"operation-not-supported-in-this-environment"),await T(this._delegate),r.ib(this._delegate,e,S)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(code){return r.pb(this._delegate,code)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function L(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const o=r;return{next:e=>o(e&&x.getOrCreate(e)),error:t,complete:n}}function M(e,t){const n=function(e,t){const n=E();if(!n)return[];const o=r.w(I,e,t);switch(n.getItem(o)){case v.NONE:return[r.M];case v.LOCAL:return[r.N,r.B];case v.SESSION:return[r.B];default:return[]}}(e,t);if("undefined"==typeof self||n.includes(r.N)||n.push(r.N),"undefined"!=typeof window)for(const e of[r.z,r.B])n.includes(e)||n.push(e);return n.includes(r.M)||n.push(r.M),n}P.Persistence=v;class j{constructor(){this.providerId="phone",this._delegate=new r.i(k(t.a.auth()))}static credential(e,t){return r.i.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}j.PHONE_SIGN_IN_METHOD=r.i.PHONE_SIGN_IN_METHOD,j.PROVIDER_ID=r.i.PROVIDER_ID;const F=r.p;class U{constructor(e,n,o=t.a.app()){var c;F(null===(c=o.options)||void 0===c?void 0:c.apiKey,"invalid-api-key",{appName:o.name}),this._delegate=new r.l(o.auth(),e,n),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}var V;(V=t.a).INTERNAL.registerComponent(new o.a("auth-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new P(t,n)}),"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:r.a.EMAIL_SIGNIN,PASSWORD_RESET:r.a.PASSWORD_RESET,RECOVER_EMAIL:r.a.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:r.a.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:r.a.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:r.a.VERIFY_EMAIL}},EmailAuthProvider:r.c,FacebookAuthProvider:r.d,GithubAuthProvider:r.e,GoogleAuthProvider:r.f,OAuthProvider:r.h,SAMLAuthProvider:r.n,PhoneAuthProvider:j,PhoneMultiFactorGenerator:r.j,RecaptchaVerifier:U,TwitterAuthProvider:r.o,Auth:P,AuthCredential:r.b,Error:c.c}).setInstantiationMode("LAZY").setMultipleInstances(!1)),V.registerVersion("@firebase/auth-compat","0.5.3")}).call(this,n(58))},509:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return ah})),n.d(t,"b",(function(){return nl})),n.d(t,"c",(function(){return Bu})),n.d(t,"d",(function(){return xu})),n.d(t,"e",(function(){return hh})),n.d(t,"f",(function(){return rl})),n.d(t,"g",(function(){return N})),n.d(t,"h",(function(){return sl})),n.d(t,"i",(function(){return dh})),n.d(t,"j",(function(){return fh})),n.d(t,"k",(function(){return W})),n.d(t,"l",(function(){return xh})),n.d(t,"m",(function(){return Tt})),n.d(t,"n",(function(){return J})),n.d(t,"o",(function(){return Y})),n.d(t,"p",(function(){return Su})),n.d(t,"q",(function(){return S})),n.d(t,"r",(function(){return ft})),n.d(t,"s",(function(){return I})),n.d(t,"t",(function(){return Iu})),n.d(t,"u",(function(){return Sh})),n.d(t,"v",(function(){return Uh})),n.d(t,"w",(function(){return Fh})),n.d(t,"x",(function(){return Qu})),n.d(t,"y",(function(){return Pu})),n.d(t,"z",(function(){return Lu})),n.d(t,"A",(function(){return Au})),n.d(t,"B",(function(){return Ch})),n.d(t,"C",(function(){return Mh})),n.d(t,"D",(function(){return Xu})),n.d(t,"E",(function(){return Mu})),n.d(t,"F",(function(){return Ku})),n.d(t,"G",(function(){return $u})),n.d(t,"H",(function(){return Ju})),n.d(t,"I",(function(){return nh})),n.d(t,"J",(function(){return eh})),n.d(t,"K",(function(){return Gu})),n.d(t,"L",(function(){return Nh})),n.d(t,"M",(function(){return mh})),n.d(t,"N",(function(){return yh})),n.d(t,"O",(function(){return vh})),n.d(t,"P",(function(){return wh})),n.d(t,"Q",(function(){return bh})),n.d(t,"R",(function(){return Ih})),n.d(t,"S",(function(){return Vh})),n.d(t,"T",(function(){return Hl})),n.d(t,"U",(function(){return Ql})),n.d(t,"V",(function(){return Zu})),n.d(t,"W",(function(){return el})),n.d(t,"X",(function(){return kh})),n.d(t,"Y",(function(){return Oh})),n.d(t,"Z",(function(){return Kl})),n.d(t,"ab",(function(){return ql})),n.d(t,"bb",(function(){return Fu})),n.d(t,"cb",(function(){return ju})),n.d(t,"db",(function(){return Lh})),n.d(t,"eb",(function(){return jh})),n.d(t,"fb",(function(){return Th})),n.d(t,"gb",(function(){return y})),n.d(t,"hb",(function(){return gh})),n.d(t,"ib",(function(){return Xl})),n.d(t,"jb",(function(){return Jl})),n.d(t,"kb",(function(){return Eh})),n.d(t,"lb",(function(){return Yu})),n.d(t,"mb",(function(){return zl}));var r=n(329),o=n(314),c=n(327),l=n(313),h=n(510);const d="@firebase/firestore";class f{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}f.UNAUTHENTICATED=new f(null),f.GOOGLE_CREDENTIALS=new f("google-credentials-uid"),f.FIRST_PARTY=new f("first-party-uid"),f.MOCK_USER=new f("mock-user");let m="10.8.1";const b=new c.b("@firebase/firestore");function _(){return b.logLevel}function y(e){b.setLogLevel(e)}function v(e,...t){if(b.logLevel<=c.a.DEBUG){const n=t.map(T);b.debug(`Firestore (${m}): ${e}`,...n)}}function w(e,...t){if(b.logLevel<=c.a.ERROR){const n=t.map(T);b.error(`Firestore (${m}): ${e}`,...n)}}function I(e,...t){if(b.logLevel<=c.a.WARN){const n=t.map(T);b.warn(`Firestore (${m}): ${e}`,...n)}}function T(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function E(e="Unexpected state"){const t=`FIRESTORE (${m}) INTERNAL ASSERTION FAILED: `+e;throw w(t),new Error(t)}function C(e,t){e||E()}function S(e,t){e||E()}function k(e,t){return e}const O={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class N extends l.c{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class A{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class R{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class x{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(f.UNAUTHENTICATED)))}shutdown(){}}class D{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class P{constructor(e){this.t=e,this.currentUser=f.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let o=new A;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new A,e.enqueueRetryable((()=>r(this.currentUser)))};const c=()=>{const t=o;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},l=e=>{v("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),c()};this.t.onInit((e=>l(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?l(e):(v("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new A)}}),0),c()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(v("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(C("string"==typeof t.accessToken),new R(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return C(null===e||"string"==typeof e),new f(e)}}class L{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=f.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class M{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new L(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(f.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class j{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class F{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=e=>{null!=e.error&&v("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.R;return this.R=e.token,v("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{v("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):v("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(C("string"==typeof e.token),this.R=e.token,new j(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function U(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class V{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62);let n="";for(;n.length<20;){const r=U(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%62))}return n}}function B(e,t){return e<t?-1:e>t?1:0}function z(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function G(e){return e+"\0"}class W{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new N(O.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new N(O.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new N(O.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new N(O.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return W.fromMillis(Date.now())}static fromDate(e){return W.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new W(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?B(this.nanoseconds,e.nanoseconds):B(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class K{constructor(e){this.timestamp=e}static fromTimestamp(e){return new K(e)}static min(){return new K(new W(0,0))}static max(){return new K(new W(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ${constructor(e,t,n){void 0===t?t=0:t>e.length&&E(),void 0===n?n=e.length-t:n>e.length-t&&E(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===$.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof $?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class H extends ${construct(e,t,n){return new H(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new N(O.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new H(t)}static emptyPath(){return new H([])}}const Q=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Y extends ${construct(e,t,n){return new Y(e,t,n)}static isValidIdentifier(e){return Q.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Y.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Y(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const o=()=>{if(0===n.length)throw new N(O.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new N(O.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new N(O.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(i=!i,r++):"."!==t||i?(n+=t,r++):(o(),r++)}if(o(),i)throw new N(O.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Y(t)}static emptyPath(){return new Y([])}}class J{constructor(e){this.path=e}static fromPath(e){return new J(H.fromString(e))}static fromName(e){return new J(H.fromString(e).popFirst(5))}static empty(){return new J(H.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===H.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return H.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new J(new H(e.slice()))}}class X{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function Z(e){return e.fields.find((e=>2===e.kind))}function ee(e){return e.fields.filter((e=>2!==e.kind))}X.UNKNOWN_ID=-1;class te{constructor(e,t){this.fieldPath=e,this.kind=t}}class ne{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ne(0,se.min())}}function re(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=K.fromTimestamp(1e9===r?new W(n+1,0):new W(n,r));return new se(i,J.empty(),t)}function ie(e){return new se(e.readTime,e.key,-1)}class se{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new se(K.min(),J.empty(),-1)}static max(){return new se(K.max(),J.empty(),-1)}}function oe(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=J.comparator(e.documentKey,t.documentKey),0!==n?n:B(e.largestBatchId,t.largestBatchId))}const ae="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ce{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function ue(e){if(e.code!==O.FAILED_PRECONDITION||e.message!==ae)throw e;v("LocalStore","Unexpectedly lost primary lease")}class le{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&E(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new le(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof le?t:le.resolve(t)}catch(e){return le.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):le.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):le.reject(t)}static resolve(e){return new le(((t,n)=>{t(e)}))}static reject(e){return new le(((t,n)=>{n(e)}))}static waitFor(e){return new le(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=le.resolve(!1);for(const n of e)t=t.next((e=>e?le.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new le(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let c=0;c<i;c++){const a=c;t(e[a]).next((e=>{s[a]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new le(((n,r)=>{const o=()=>{!0===e()?t().next((()=>{o()}),r):n()};o()}))}}class he{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new A,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new pe(e,t.error)):this.V.resolve()},this.transaction.onerror=t=>{const n=ve(t.target.error);this.V.reject(new pe(e,n))}}static open(e,t,n,r){try{return new he(t,e.transaction(r,n))}catch(e){throw new pe(t,e)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(v("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new me(t)}}class de{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===de.S(Object(l.x)())&&w("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return v("SimpleDb","Removing database:",e),_e(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Object(l.D)())return!1;if(de.C())return!0;const e=Object(l.x)(),t=de.S(e),n=0<t&&t<10,r=de.v(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static C(){var t;return void 0!==e&&"YES"===(null===(t=e.__PRIVATE_env)||void 0===t?void 0:t.F)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static v(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(e){return this.db||(v("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new pe(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new N(O.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new N(O.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new pe(e,r))},r.onupgradeneeded=e=>{v("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.p.N(t,r.transaction,e.oldVersion,this.version).next((()=>{v("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.O(e);const t=he.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next((e=>(t.g(),e))).catch((e=>(t.abort(e),le.reject(e)))).toPromise();return s.catch((()=>{})),await t.m,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(v("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class fe{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return _e(this.k.delete())}}class pe extends N{constructor(e,t){super(O.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ge(e){return"IndexedDbTransactionError"===e.name}class me{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(v("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(v("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),_e(n)}add(e){return v("SimpleDb","ADD",this.store.name,e,e),_e(this.store.add(e))}get(e){return _e(this.store.get(e)).next((t=>(void 0===t&&(t=null),v("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return v("SimpleDb","DELETE",this.store.name,e),_e(this.store.delete(e))}count(){return v("SimpleDb","COUNT",this.store.name),_e(this.store.count())}W(e,t){const n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const e=r.getAll(n.range);return new le(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}{const e=this.cursor(n),t=[];return this.G(e,((e,n)=>{t.push(n)})).next((()=>t))}}j(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new le(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}H(e,t){v("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.J=!1;const r=this.cursor(n);return this.G(r,((e,t,n)=>n.delete()))}Y(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.G(r,t)}Z(e){const t=this.cursor({});return new le(((n,r)=>{t.onerror=e=>{const t=ve(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}G(e,t){const n=[];return new le(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new fe(i),o=t(i.primaryKey,i.value,s);if(o instanceof le){const e=o.catch((e=>(s.done(),le.reject(e))));n.push(e)}s.isDone?r():null===s.$?i.continue():i.continue(s.$)}})).next((()=>le.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.J?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function _e(e){return new le(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=ve(e.target.error);n(t)}}))}let ye=!1;function ve(e){const t=de.S(Object(l.x)());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new N("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ye||(ye=!0,setTimeout((()=>{throw e}),0)),e}}return e}class we{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ee(e){v("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{v("IndexBackfiller",`Documents written: ${await this.X.te()}`)}catch(e){ge(e)?v("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):await ue(e)}await this.ee(6e4)}))}}class be{constructor(e,t){this.localStore=e,this.persistence=t}async te(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.ne(t,e)))}ne(e,t){const n=new Set;let r=t,i=!0;return le.doWhile((()=>!0===i&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>{if(null!==t&&!n.has(t))return v("IndexBackfiller",`Processing collection: ${t}`),this.re(e,t,r).next((e=>{r-=e,n.add(t)}));i=!1})))).next((()=>t-r))}re(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next((n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next((()=>this.ie(r,n))).next((n=>(v("IndexBackfiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>i.size))}))))}ie(e,t){let n=e;return t.changes.forEach(((e,t)=>{const r=ie(t);oe(r,n)>0&&(n=r)})),new se(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class Ie{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.se(e),this.oe=e=>t.writeSequenceNumber(e))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.oe&&this.oe(e),e}}function Te(e){return null==e}function Ee(e){return 0===e&&1/e==-1/0}function Ce(e){return"number"==typeof e&&Number.isInteger(e)&&!Ee(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function Se(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Oe(t)),t=ke(e.get(n),t);return Oe(t)}function ke(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function Oe(e){return e+""}function Ne(e){const t=e.length;if(C(t>=2),2===t)return C(""===e.charAt(0)&&""===e.charAt(1)),H.emptyPath();const n=t-2,r=[];let o="";for(let i=0;i<t;){const t=e.indexOf("",i);switch((t<0||t>n)&&E(),e.charAt(t+1)){case"":const s=e.substring(i,t);let n;0===o.length?n=s:(o+=s,n=o,o=""),r.push(n);break;case"":o+=e.substring(i,t),o+="\0";break;case"":o+=e.substring(i,t+1);break;default:E()}i=t+2}return new H(r)}Ie._e=-1;const Ae=["userId","batchId"];function Re(e,t){return[e,Se(t)]}function xe(e,t,n){return[e,Se(t),n]}const De={},Pe=["prefixPath","collectionGroup","readTime","documentId"],Le=["prefixPath","collectionGroup","documentId"],Me=["collectionGroup","readTime","prefixPath","documentId"],je=["canonicalId","targetId"],Fe=["targetId","path"],q=["path","targetId"],Ue=["collectionId","parent"],Ve=["indexId","uid"],qe=["uid","sequenceNumber"],Be=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ze=["indexId","uid","orderedDocumentKey"],Ge=["userId","collectionPath","documentId"],We=["userId","collectionPath","largestBatchId"],Ke=["userId","collectionGroup","largestBatchId"],$e=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],He=[...$e,"documentOverlays"],Qe=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Ye=Qe,Je=[...Ye,"indexConfiguration","indexState","indexEntries"];class Xe extends ce{constructor(e,t){super(),this.ae=e,this.currentSequenceNumber=t}}function Ze(e,t){const n=k(e);return de.M(n.ae,t)}function et(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function tt(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function nt(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class it{constructor(e,t){this.comparator=e,this.root=t||ot.EMPTY}insert(e,t){return new it(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ot.BLACK,null,null))}remove(e){return new it(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ot.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new st(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new st(this.root,e,this.comparator,!1)}getReverseIterator(){return new st(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new st(this.root,e,this.comparator,!0)}}class st{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ot{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:ot.RED,this.left=null!=r?r:ot.EMPTY,this.right=null!=i?i:ot.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new ot(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return ot.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return ot.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ot.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ot.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw E();if(this.right.isRed())throw E();const e=this.left.check();if(e!==this.right.check())throw E();return e+(this.isRed()?0:1)}}ot.EMPTY=null,ot.RED=!0,ot.BLACK=!1,ot.EMPTY=new class{constructor(){this.size=0}get key(){throw E()}get value(){throw E()}get color(){throw E()}get left(){throw E()}get right(){throw E()}copy(e,t,n,r,i){return this}insert(e,t,n){return new ot(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class at{constructor(e){this.comparator=e,this.data=new it(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ct(this.data.getIterator())}getIteratorFrom(e){return new ct(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof at))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new at(this.comparator);return t.data=e,t}}class ct{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ut(e){return e.hasNext()?e.getNext():void 0}class lt{constructor(e){this.fields=e,e.sort(Y.comparator)}static empty(){return new lt([])}unionWith(e){let t=new at(Y.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new lt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return z(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class ht extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function ft(){return"undefined"!=typeof atob}class pt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new ht("Invalid base64 string: "+e):e}}(e);return new pt(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new pt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return B(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}pt.EMPTY_BYTE_STRING=new pt("");const gt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function mt(e){if(C(!!e),"string"==typeof e){let t=0;const n=gt.exec(e);if(C(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:_t(e.seconds),nanos:_t(e.nanos)}}function _t(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function yt(e){return"string"==typeof e?pt.fromBase64String(e):pt.fromUint8Array(e)}function vt(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function wt(e){const t=e.mapValue.fields.__previous_value__;return vt(t)?wt(t):t}function bt(e){const t=mt(e.mapValue.fields.__local_write_time__.timestampValue);return new W(t.seconds,t.nanos)}class It{constructor(e,t,n,r,i,s,o,c,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=c,this.useFetchStreams=a}}class Tt{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Tt("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Tt&&e.projectId===this.projectId&&e.database===this.database}}const Et={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ct={nullValue:"NULL_VALUE"};function St(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?vt(e)?4:Vt(e)?9007199254740991:10:E()}function kt(e,t){if(e===t)return!0;const n=St(e);if(n!==St(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return bt(e).isEqual(bt(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=mt(e.timestampValue),r=mt(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return yt(e.bytesValue).isEqual(yt(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return _t(e.geoPointValue.latitude)===_t(t.geoPointValue.latitude)&&_t(e.geoPointValue.longitude)===_t(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return _t(e.integerValue)===_t(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=_t(e.doubleValue),r=_t(t.doubleValue);return n===r?Ee(n)===Ee(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return z(e.arrayValue.values||[],t.arrayValue.values||[],kt);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(et(n)!==et(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!kt(n[e],r[e])))return!1;return!0}(e,t);default:return E()}}function Ot(e,t){return void 0!==(e.values||[]).find((e=>kt(e,t)))}function Nt(e,t){if(e===t)return 0;const n=St(e),r=St(t);if(n!==r)return B(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return B(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=_t(e.integerValue||e.doubleValue),r=_t(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return At(e.timestampValue,t.timestampValue);case 4:return At(bt(e),bt(t));case 5:return B(e.stringValue,t.stringValue);case 6:return function(e,t){const n=yt(e),r=yt(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=B(n[e],r[e]);if(0!==t)return t}return B(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=B(_t(e.latitude),_t(t.latitude));return 0!==n?n:B(_t(e.longitude),_t(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=Nt(n[e],r[e]);if(t)return t}return B(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Et.mapValue&&t===Et.mapValue)return 0;if(e===Et.mapValue)return 1;if(t===Et.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=B(r[e],s[e]);if(0!==t)return t;const o=Nt(n[r[e]],i[s[e]]);if(0!==o)return o}return B(r.length,s.length)}(e.mapValue,t.mapValue);default:throw E()}}function At(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return B(e,t);const n=mt(e),r=mt(t),i=B(n.seconds,r.seconds);return 0!==i?i:B(n.nanos,r.nanos)}function Rt(e){return xt(e)}function xt(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=mt(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return yt(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return J.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=xt(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${xt(e.fields[i])}`;return n+"}"}(e.mapValue):E()}function Dt(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Pt(e){return!!e&&"integerValue"in e}function Lt(e){return!!e&&"arrayValue"in e}function Mt(e){return!!e&&"nullValue"in e}function jt(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Ft(e){return!!e&&"mapValue"in e}function Ut(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return tt(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Ut(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Ut(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Vt(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function qt(e){return"nullValue"in e?Ct:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?Dt(Tt.empty(),J.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:E()}function Bt(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?Dt(Tt.empty(),J.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?Et:E()}function zt(e,t){const n=Nt(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Gt(e,t){const n=Nt(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Wt{constructor(e){this.value=e}static empty(){return new Wt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Ft(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ut(t)}setAll(e){let t=Y.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Ut(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Ft(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return kt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Ft(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){tt(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new Wt(Ut(this.value))}}function Kt(e){const t=[];return tt(e.fields,((e,n)=>{const r=new Y([e]);if(Ft(n)){const e=Kt(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new lt(t)}class $t{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new $t(e,0,K.min(),K.min(),K.min(),Wt.empty(),0)}static newFoundDocument(e,t,n,r){return new $t(e,1,t,K.min(),n,r,0)}static newNoDocument(e,t){return new $t(e,2,t,K.min(),K.min(),Wt.empty(),0)}static newUnknownDocument(e,t){return new $t(e,3,t,K.min(),K.min(),Wt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(K.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Wt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Wt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=K.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof $t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new $t(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ht{constructor(e,t){this.position=e,this.inclusive=t}}function Qt(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?J.comparator(J.fromName(o.referenceValue),n.key):Nt(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function Yt(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!kt(e.position[n],t.position[n]))return!1;return!0}class Jt{constructor(e,t="asc"){this.field=e,this.dir=t}}function Xt(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Zt{}class en extends Zt{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new hn(e,t,n):"array-contains"===t?new gn(e,n):"in"===t?new mn(e,n):"not-in"===t?new _n(e,n):"array-contains-any"===t?new yn(e,n):new en(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new dn(e,n):new fn(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Nt(t,this.value)):null!==t&&St(this.value)===St(t)&&this.matchesComparison(Nt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return E()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class tn extends Zt{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new tn(e,t)}matches(e){return nn(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function nn(e){return"and"===e.op}function rn(e){return"or"===e.op}function sn(e){return on(e)&&nn(e)}function on(e){for(const t of e.filters)if(t instanceof tn)return!1;return!0}function an(e){if(e instanceof en)return e.field.canonicalString()+e.op.toString()+Rt(e.value);if(sn(e))return e.filters.map((e=>an(e))).join(",");{const t=e.filters.map((e=>an(e))).join(",");return`${e.op}(${t})`}}function cn(e,t){return e instanceof en?function(e,t){return t instanceof en&&e.op===t.op&&e.field.isEqual(t.field)&&kt(e.value,t.value)}(e,t):e instanceof tn?function(e,t){return t instanceof tn&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&cn(n,t.filters[r])),!0)}(e,t):void E()}function un(e,t){const n=e.filters.concat(t);return tn.create(n,e.op)}function ln(e){return e instanceof en?function(e){return`${e.field.canonicalString()} ${e.op} ${Rt(e.value)}`}(e):e instanceof tn?function(e){return e.op.toString()+" {"+e.getFilters().map(ln).join(" ,")+"}"}(e):"Filter"}class hn extends en{constructor(e,t,n){super(e,t,n),this.key=J.fromName(n.referenceValue)}matches(e){const t=J.comparator(e.key,this.key);return this.matchesComparison(t)}}class dn extends en{constructor(e,t){super(e,"in",t),this.keys=pn("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class fn extends en{constructor(e,t){super(e,"not-in",t),this.keys=pn("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function pn(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>J.fromName(e.referenceValue)))}class gn extends en{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Lt(t)&&Ot(t.arrayValue,this.value)}}class mn extends en{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Ot(this.value.arrayValue,t)}}class _n extends en{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ot(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Ot(this.value.arrayValue,t)}}class yn extends en{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Lt(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Ot(this.value.arrayValue,e)))}}class vn{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ce=null}}function wn(e,t=null,n=[],r=[],i=null,s=null,o=null){return new vn(e,t,n,r,i,s,o)}function bn(e){const t=k(e);if(null===t.ce){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>an(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Te(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Rt(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Rt(e))).join(",")),t.ce=e}return t.ce}function In(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Xt(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!cn(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Yt(e.startAt,t.startAt)&&Yt(e.endAt,t.endAt)}function Tn(e){return J.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function En(e,t){return e.filters.filter((e=>e instanceof en&&e.field.isEqual(t)))}function Cn(e,t,n){let r=Ct,i=!0;for(const n of En(e,t)){let e=Ct,t=!0;switch(n.op){case"<":case"<=":e=qt(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=Ct}zt({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];zt({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function Sn(e,t,n){let r=Et,i=!0;for(const n of En(e,t)){let e=Et,t=!0;switch(n.op){case">=":case">":e=Bt(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=Et}Gt({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Gt({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class kn{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=c,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function On(e,t,n,r,i,s,o,c){return new kn(e,t,n,r,i,s,o,c)}function Nn(e){return new kn(e)}function An(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Rn(e){return null!==e.collectionGroup}function xn(e){const t=k(e);if(null===t.le){t.le=[];const e=new Set;for(const n of t.explicitOrderBy)t.le.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new at(Y.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);r.forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.le.push(new Jt(r,n))})),e.has(Y.keyField().canonicalString())||t.le.push(new Jt(Y.keyField(),n))}return t.le}function Dn(e){const t=k(e);return t.he||(t.he=Pn(t,xn(e))),t.he}function Pn(e,t){if("F"===e.limitType)return wn(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new Jt(e.field,t)}));const n=e.endAt?new Ht(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Ht(e.startAt.position,e.startAt.inclusive):null;return wn(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function Ln(e,t){const n=e.filters.concat([t]);return new kn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Mn(e,t,n){return new kn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function jn(e,t){return In(Dn(e),Dn(t))&&e.limitType===t.limitType}function Fn(e){return`${bn(Dn(e))}|lt:${e.limitType}`}function Un(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>ln(e))).join(", ")}]`),Te(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Rt(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Rt(e))).join(",")),`Target(${t})`}(Dn(e))}; limitType=${e.limitType})`}function Vn(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):J.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of xn(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=Qt(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,xn(e),t))&&!(e.endAt&&!function(e,t,n){const r=Qt(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,xn(e),t))}(e,t)}function qn(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Bn(e){return(t,n)=>{let r=!1;for(const i of xn(e)){const e=zn(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function zn(e,t,n){const r=e.field.isKeyField()?J.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Nt(r,i):E()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return E()}}class Gn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){tt(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return nt(this.inner)}size(){return this.innerSize}}const Wn=new it(J.comparator);function Kn(){return Wn}const $n=new it(J.comparator);function Hn(...e){let t=$n;for(const n of e)t=t.insert(n.key,n);return t}function Qn(e){let t=$n;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Yn(){return Xn()}function Jn(){return Xn()}function Xn(){return new Gn((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Zn=new it(J.comparator),er=new at(J.comparator);function nr(...e){let t=er;for(const n of e)t=t.add(n);return t}const rr=new at(B);function ir(){return rr}function sr(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ee(t)?"-0":t}}function or(e){return{integerValue:""+e}}function ar(e,t){return Ce(t)?or(t):sr(e,t)}class cr{constructor(){this._=void 0}}function ur(e,t,n){return e instanceof fr?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&vt(t)&&(t=wt(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof pr?gr(e,t):e instanceof mr?_r(e,t):function(e,t){const n=dr(e,t),r=vr(n)+vr(e.Ie);return Pt(n)&&Pt(e.Ie)?or(r):sr(e.serializer,r)}(e,t)}function lr(e,t,n){return e instanceof pr?gr(e,t):e instanceof mr?_r(e,t):n}function dr(e,t){return e instanceof yr?function(e){return Pt(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class fr extends cr{}class pr extends cr{constructor(e){super(),this.elements=e}}function gr(e,t){const n=wr(t);for(const t of e.elements)n.some((e=>kt(e,t)))||n.push(t);return{arrayValue:{values:n}}}class mr extends cr{constructor(e){super(),this.elements=e}}function _r(e,t){let n=wr(t);for(const t of e.elements)n=n.filter((e=>!kt(e,t)));return{arrayValue:{values:n}}}class yr extends cr{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function vr(e){return _t(e.integerValue||e.doubleValue)}function wr(e){return Lt(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Ir{constructor(e,t){this.field=e,this.transform=t}}class Tr{constructor(e,t){this.version=e,this.transformResults=t}}class Er{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Er}static exists(e){return new Er(void 0,e)}static updateTime(e){return new Er(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Cr(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Sr{}function kr(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new jr(e.key,Er.none()):new xr(e.key,e.data,Er.none());{const n=e.data,r=Wt.empty();let i=new at(Y.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Dr(e.key,r,new lt(i.toArray()),Er.none())}}function Or(e,t,n){e instanceof xr?function(e,t,n){const r=e.value.clone(),i=Lr(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Dr?function(e,t,n){if(!Cr(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Lr(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Pr(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Nr(e,t,n,r){return e instanceof xr?function(e,t,n,r){if(!Cr(e.precondition,t))return n;const i=e.value.clone(),s=Mr(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Dr?function(e,t,n,r){if(!Cr(e.precondition,t))return n;const i=Mr(e.fieldTransforms,r,t),s=t.data;return s.setAll(Pr(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return Cr(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Ar(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=dr(r.transform,e||null);null!=i&&(null===n&&(n=Wt.empty()),n.set(r.field,i))}return n||null}function Rr(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&z(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof pr&&t instanceof pr||e instanceof mr&&t instanceof mr?z(e.elements,t.elements,kt):e instanceof yr&&t instanceof yr?kt(e.Ie,t.Ie):e instanceof fr&&t instanceof fr}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class xr extends Sr{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Dr extends Sr{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Pr(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function Lr(e,t,n){const r=new Map;C(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,c=t.data.field(s.field);r.set(s.field,lr(o,c,n[i]))}return r}function Mr(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,ur(e,s,t))}return r}class jr extends Sr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Fr extends Sr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Ur{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Or(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Nr(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Nr(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Jn();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const c=kr(s,o);null!==c&&n.set(r.key,c),s.isValidDocument()||s.convertToNoDocument(K.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),nr())}isEqual(e){return this.batchId===e.batchId&&z(this.mutations,e.mutations,((e,t)=>Rr(e,t)))&&z(this.baseMutations,e.baseMutations,((e,t)=>Rr(e,t)))}}class Vr{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){C(e.mutations.length===n.length);let r=Zn;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new Vr(e,t,n,r)}}class qr{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Br{constructor(e,t){this.count=e,this.unchangedNames=t}}var zr,Gr;function Wr(e){switch(e){default:return E();case O.CANCELLED:case O.UNKNOWN:case O.DEADLINE_EXCEEDED:case O.RESOURCE_EXHAUSTED:case O.INTERNAL:case O.UNAVAILABLE:case O.UNAUTHENTICATED:return!1;case O.INVALID_ARGUMENT:case O.NOT_FOUND:case O.ALREADY_EXISTS:case O.PERMISSION_DENIED:case O.FAILED_PRECONDITION:case O.ABORTED:case O.OUT_OF_RANGE:case O.UNIMPLEMENTED:case O.DATA_LOSS:return!0}}function Kr(e){if(void 0===e)return w("GRPC error has no .code"),O.UNKNOWN;switch(e){case zr.OK:return O.OK;case zr.CANCELLED:return O.CANCELLED;case zr.UNKNOWN:return O.UNKNOWN;case zr.DEADLINE_EXCEEDED:return O.DEADLINE_EXCEEDED;case zr.RESOURCE_EXHAUSTED:return O.RESOURCE_EXHAUSTED;case zr.INTERNAL:return O.INTERNAL;case zr.UNAVAILABLE:return O.UNAVAILABLE;case zr.UNAUTHENTICATED:return O.UNAUTHENTICATED;case zr.INVALID_ARGUMENT:return O.INVALID_ARGUMENT;case zr.NOT_FOUND:return O.NOT_FOUND;case zr.ALREADY_EXISTS:return O.ALREADY_EXISTS;case zr.PERMISSION_DENIED:return O.PERMISSION_DENIED;case zr.FAILED_PRECONDITION:return O.FAILED_PRECONDITION;case zr.ABORTED:return O.ABORTED;case zr.OUT_OF_RANGE:return O.OUT_OF_RANGE;case zr.UNIMPLEMENTED:return O.UNIMPLEMENTED;case zr.DATA_LOSS:return O.DATA_LOSS;default:return E()}}(Gr=zr||(zr={}))[Gr.OK=0]="OK",Gr[Gr.CANCELLED=1]="CANCELLED",Gr[Gr.UNKNOWN=2]="UNKNOWN",Gr[Gr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Gr[Gr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Gr[Gr.NOT_FOUND=5]="NOT_FOUND",Gr[Gr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Gr[Gr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Gr[Gr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Gr[Gr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Gr[Gr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Gr[Gr.ABORTED=10]="ABORTED",Gr[Gr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Gr[Gr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Gr[Gr.INTERNAL=13]="INTERNAL",Gr[Gr.UNAVAILABLE=14]="UNAVAILABLE",Gr[Gr.DATA_LOSS=15]="DATA_LOSS";let $r=null;function Hr(){return new TextEncoder}const Qr=new h.d([4294967295,4294967295],0);function Yr(e){const t=Hr().encode(e),n=new h.e;return n.update(t),new Uint8Array(n.digest())}function Jr(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new h.d([n,r],0),new h.d([i,s],0)]}class Xr{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Zr(`Invalid padding: ${t}`);if(n<0)throw new Zr(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Zr(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Zr(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=h.d.fromNumber(this.Te)}de(e,t,n){let r=e.add(t.multiply(h.d.fromNumber(n)));return 1===r.compare(Qr)&&(r=new h.d([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;const t=Yr(e),[n,r]=Jr(t);for(let e=0;e<this.hashCount;e++){const t=this.de(n,r,e);if(!this.Ae(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new Xr(i,r,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.Te)return;const t=Yr(e),[n,r]=Jr(t);for(let e=0;e<this.hashCount;e++){const t=this.de(n,r,e);this.Re(t)}}Re(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Zr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ei{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,ti.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new ei(K.min(),r,new it(B),Kn(),nr())}}class ti{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new ti(n,t,nr(),nr(),nr())}}class ni{constructor(e,t,n,r){this.Ve=e,this.removedTargetIds=t,this.key=n,this.me=r}}class ri{constructor(e,t){this.targetId=e,this.fe=t}}class ii{constructor(e,t,n=pt.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class si{constructor(){this.ge=0,this.pe=ci(),this.ye=pt.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=nr(),t=nr(),n=nr();return this.pe.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:E()}})),new ti(this.ye,this.we,e,t,n)}Fe(){this.Se=!1,this.pe=ci()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,C(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class oi{constructor(e){this.Le=e,this.ke=new Map,this.qe=Kn(),this.Qe=ai(),this.Ke=new it(B)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,(t=>{const n=this.ze(t);switch(e.state){case 0:this.je(t)&&n.Ce(e.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(e.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(t);break;case 3:this.je(t)&&(n.Be(),n.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),n.Ce(e.resumeToken));break;default:E()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach(((e,n)=>{this.je(n)&&t(n)}))}Je(e){const t=e.targetId,n=e.fe.count,r=this.Ye(t);if(r){const i=r.target;if(Tn(i))if(0===n){const e=new J(i.path);this.We(t,e,$t.newNoDocument(e,K.min()))}else C(1===n);else{const r=this.Ze(t);if(r!==n){const n=this.Xe(e),i=n?this.et(n,e,r):1;if(0!==i){this.He(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,e)}null==$r||$r.tt(function(e,t,n,r,i){var s,o,c,a,u,l;const h={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},d=t.unchangedNames;return d&&(h.bloomFilter={applied:0===i,hashCount:null!==(s=null==d?void 0:d.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(a=null===(c=null===(o=null==d?void 0:d.bits)||void 0===o?void 0:o.bitmap)||void 0===c?void 0:c.length)&&void 0!==a?a:0,padding:null!==(l=null===(u=null==d?void 0:d.bits)||void 0===u?void 0:u.padding)&&void 0!==l?l:0,mightContain:e=>{var t;return null!==(t=null==r?void 0:r.mightContain(e))&&void 0!==t&&t}}),h}(r,e.fe,this.Le.nt(),n,i))}}}}Xe(e){const t=e.fe.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,o;try{s=yt(n).toUint8Array()}catch(e){if(e instanceof ht)return I("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new Xr(s,r,i)}catch(e){return I(e instanceof Zr?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.Te?null:o}et(e,t,n){return t.fe.count===n-this.rt(e,t.targetId)?0:2}rt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const i=this.Le.nt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.We(t,n,null),r++)})),r}it(e){const t=new Map;this.ke.forEach(((n,r)=>{const i=this.Ye(r);if(i){if(n.current&&Tn(i.target)){const t=new J(i.target.path);null!==this.qe.get(t)||this.st(r,t)||this.We(r,t,$t.newNoDocument(t,e))}n.De&&(t.set(r,n.ve()),n.Fe())}}));let n=nr();this.Qe.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Ye(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.qe.forEach(((t,n)=>n.setReadTime(e)));const r=new ei(e,t,this.Ke,this.qe,n);return this.qe=Kn(),this.Qe=ai(),this.Ke=new it(B),r}Ue(e,t){if(!this.je(e))return;const n=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,n),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,n){if(!this.je(e))return;const r=this.ze(e);this.st(e,t)?r.Me(t,1):r.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),n&&(this.qe=this.qe.insert(t,n))}removeTarget(e){this.ke.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new si,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new at(B),this.Qe=this.Qe.insert(e,t)),t}je(e){const t=null!==this.Ye(e);return t||v("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.ke.get(e);return t&&t.be?null:this.Le._t(e)}He(e){this.ke.set(e,new si),this.Le.getRemoteKeysForTarget(e).forEach((t=>{this.We(e,t,null)}))}st(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function ai(){return new it(J.comparator)}function ci(){return new it(J.comparator)}const ui={asc:"ASCENDING",desc:"DESCENDING"},hi={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},di={and:"AND",or:"OR"};class fi{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function pi(e,t){return e.useProto3Json||Te(t)?t:{value:t}}function gi(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function mi(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function _i(e,t){return gi(e,t.toTimestamp())}function yi(e){return C(!!e),K.fromTimestamp(function(e){const t=mt(e);return new W(t.seconds,t.nanos)}(e))}function vi(e,t){return wi(e,t).canonicalString()}function wi(e,t){const n=function(e){return new H(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function bi(e){const t=H.fromString(e);return C(zi(t)),t}function Ii(e,t){return vi(e.databaseId,t.path)}function Ti(e,t){const n=bi(t);if(n.get(1)!==e.databaseId.projectId)throw new N(O.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new N(O.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new J(ki(n))}function Ei(e,t){return vi(e.databaseId,t)}function Ci(e){const t=bi(e);return 4===t.length?H.emptyPath():ki(t)}function Si(e){return new H(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function ki(e){return C(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Oi(e,t,n){return{name:Ii(e,t),fields:n.value.mapValue.fields}}function Ni(e,t,n){const r=Ti(e,t.name),i=yi(t.updateTime),s=t.createTime?yi(t.createTime):K.min(),o=new Wt({mapValue:{fields:t.fields}}),c=$t.newFoundDocument(r,i,s,o);return n&&c.setHasCommittedMutations(),n?c.setHasCommittedMutations():c}function Ai(e,t){let n;if(t instanceof xr)n={update:Oi(e,t.key,t.value)};else if(t instanceof jr)n={delete:Ii(e,t.key)};else if(t instanceof Dr)n={update:Oi(e,t.key,t.data),updateMask:Bi(t.fieldMask)};else{if(!(t instanceof Fr))return E();n={verify:Ii(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof fr)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof pr)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof mr)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof yr)return{fieldPath:t.field.canonicalString(),increment:n.Ie};throw E()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:_i(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:E()}(e,t.precondition)),n}function Ri(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?Er.updateTime(yi(e.updateTime)):void 0!==e.exists?Er.exists(e.exists):Er.none()}(t.currentDocument):Er.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)C("REQUEST_TIME"===t.setToServerValue),n=new fr;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new pr(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new mr(e)}else"increment"in t?n=new yr(e,t.increment):E();const r=Y.fromServerFormat(t.fieldPath);return new Ir(r,n)}(e,t))):[];if(t.update){t.update.name;const i=Ti(e,t.update.name),s=new Wt({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new lt(t.map((e=>Y.fromServerFormat(e))))}(t.updateMask);return new Dr(i,s,e,n,r)}return new xr(i,s,n,r)}if(t.delete){const r=Ti(e,t.delete);return new jr(r,n)}if(t.verify){const r=Ti(e,t.verify);return new Fr(r,n)}return E()}function xi(e,t){return{documents:[Ei(e,t.path)]}}function Di(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Ei(e,i);const s=function(e){if(0!==e.length)return qi(tn.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const o=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Ui(e.field),direction:Mi(e.dir)}}(e)))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const c=pi(e,t.limit);return null!==c&&(n.structuredQuery.limit=c),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ut:n,parent:i}}function Pi(e){let t=Ci(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){C(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Li(e);return t instanceof tn&&sn(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map((e=>function(e){return new Jt(Vi(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let c=null;n.limit&&(c=function(e){let t;return t="object"==typeof e?e.value:e,Te(t)?null:t}(n.limit));let a=null;n.startAt&&(a=function(e){const t=!!e.before,n=e.values||[];return new Ht(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new Ht(n,t)}(n.endAt)),On(t,i,o,s,c,"F",a,u)}function Li(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Vi(e.unaryFilter.field);return en.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Vi(e.unaryFilter.field);return en.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Vi(e.unaryFilter.field);return en.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Vi(e.unaryFilter.field);return en.create(i,"!=",{nullValue:"NULL_VALUE"});default:return E()}}(e):void 0!==e.fieldFilter?function(e){return en.create(Vi(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return E()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return tn.create(e.compositeFilter.filters.map((e=>Li(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return E()}}(e.compositeFilter.op))}(e):E()}function Mi(e){return ui[e]}function ji(e){return hi[e]}function Fi(e){return di[e]}function Ui(e){return{fieldPath:e.canonicalString()}}function Vi(e){return Y.fromServerFormat(e.fieldPath)}function qi(e){return e instanceof en?function(e){if("=="===e.op){if(jt(e.value))return{unaryFilter:{field:Ui(e.field),op:"IS_NAN"}};if(Mt(e.value))return{unaryFilter:{field:Ui(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(jt(e.value))return{unaryFilter:{field:Ui(e.field),op:"IS_NOT_NAN"}};if(Mt(e.value))return{unaryFilter:{field:Ui(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ui(e.field),op:ji(e.op),value:e.value}}}(e):e instanceof tn?function(e){const t=e.getFilters().map((e=>qi(e)));return 1===t.length?t[0]:{compositeFilter:{op:Fi(e.op),filters:t}}}(e):E()}function Bi(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function zi(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Gi{constructor(e,t,n,r,i=K.min(),s=K.min(),o=pt.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=c}withSequenceNumber(e){return new Gi(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Gi(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Gi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Gi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Wi{constructor(e){this.ct=e}}function Ki(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:$i(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:Ii(e,t.key),fields:t.data.value.mapValue.fields,updateTime:gi(e,t.version.toTimestamp()),createTime:gi(e,t.createTime.toTimestamp())}}(e.ct,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Hi(t.version)};else{if(!t.isUnknownDocument())return E();r.unknownDocument={path:n.path.toArray(),version:Hi(t.version)}}return r}function $i(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Hi(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Qi(e){const t=new W(e.seconds,e.nanoseconds);return K.fromTimestamp(t)}function Yi(e,t){const n=(t.baseMutations||[]).map((t=>Ri(e.ct,t)));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const r=t.mutations.map((t=>Ri(e.ct,t))),i=W.fromMillis(t.localWriteTimeMs);return new Ur(t.batchId,i,n,r)}function Ji(e){const t=Qi(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Qi(e.lastLimboFreeSnapshotVersion):K.min();let r;return r=function(e){return void 0!==e.documents}(e.query)?function(e){return C(1===e.documents.length),Dn(Nn(Ci(e.documents[0])))}(e.query):function(e){return Dn(Pi(e))}(e.query),new Gi(r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,pt.fromBase64String(e.resumeToken))}function Xi(e,t){const n=Hi(t.snapshotVersion),r=Hi(t.lastLimboFreeSnapshotVersion);let i;i=Tn(t.target)?xi(e.ct,t.target):Di(e.ct,t.target).ut;const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:bn(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Zi(e){const t=Pi({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Mn(t,t.limit,"L"):t}function es(e,t){return new qr(t.largestBatchId,Ri(e.ct,t.overlayMutation))}function ts(e,t){const n=t.path.lastSegment();return[e,Se(t.path.popLast()),n]}function ns(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:Hi(r.readTime),documentKey:Se(r.documentKey.path),largestBatchId:r.largestBatchId}}class rs{getBundleMetadata(e,t){return is(e).get(t).next((e=>{if(e)return function(e){return{id:e.bundleId,createTime:Qi(e.createTime),version:e.version}}(e)}))}saveBundleMetadata(e,t){return is(e).put(function(e){return{bundleId:e.id,createTime:Hi(yi(e.createTime)),version:e.version}}(t))}getNamedQuery(e,t){return ss(e).get(t).next((e=>{if(e)return function(e){return{name:e.name,query:Zi(e.bundledQuery),readTime:Qi(e.readTime)}}(e)}))}saveNamedQuery(e,t){return ss(e).put(function(e){return{name:e.name,readTime:Hi(yi(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function is(e){return Ze(e,"bundles")}function ss(e){return Ze(e,"namedQueries")}class os{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const n=t.uid||"";return new os(e,n)}getOverlay(e,t){return as(e).get(ts(this.userId,t)).next((e=>e?es(this.serializer,e):null))}getOverlays(e,t){const n=Yn();return le.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const r=[];return n.forEach(((n,i)=>{const s=new qr(t,i);r.push(this.ht(e,s))})),le.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((e=>r.add(Se(e.getCollectionPath()))));const i=[];return r.forEach((t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(as(e).H("collectionPathOverlayIndex",r))})),le.waitFor(i)}getOverlaysForCollection(e,t,n){const r=Yn(),i=Se(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return as(e).W("collectionPathOverlayIndex",s).next((e=>{for(const t of e){const e=es(this.serializer,t);r.set(e.getKey(),e)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const i=Yn();let s;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return as(e).Y({index:"collectionGroupOverlayIndex",range:o},((e,t,n)=>{const o=es(this.serializer,t);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()})).next((()=>i))}ht(e,t){return as(e).put(function(e,t,n){const[r,i,s]=ts(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Ai(e.ct,n.mutation)}}(this.serializer,this.userId,t))}}function as(e){return Ze(e,"documentOverlays")}class cs{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(_t(e.integerValue));else if("doubleValue"in e){const n=_t(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),Ee(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){const n=e.timestampValue;this.Et(t,20),"string"==typeof n?t.At(n):(t.At(`${n.seconds||""}`),t.dt(n.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(yt(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?Vt(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):E()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const n=e.fields||{};this.Et(t,55);for(const e of Object.keys(n))this.Rt(e,t),this.It(n[e],t)}wt(e,t){const n=e.values||[];this.Et(t,50);for(const e of n)this.It(e,t)}gt(e,t){this.Et(t,37),J.fromName(e).path.forEach((e=>{this.Et(t,60),this.St(e,t)}))}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}function us(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function ls(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=us(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}cs.bt=new cs;class hs{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ct(n.value),n=t.next();this.vt()}Ft(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Mt(n.value),n=t.next();this.xt()}Ot(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ct(e);else if(e<2048)this.Ct(960|e>>>6),this.Ct(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ct(480|e>>>12),this.Ct(128|63&e>>>6),this.Ct(128|63&e);else{const e=t.codePointAt(0);this.Ct(240|e>>>18),this.Ct(128|63&e>>>12),this.Ct(128|63&e>>>6),this.Ct(128|63&e)}}this.vt()}Nt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Mt(e);else if(e<2048)this.Mt(960|e>>>6),this.Mt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Mt(480|e>>>12),this.Mt(128|63&e>>>6),this.Mt(128|63&e);else{const e=t.codePointAt(0);this.Mt(240|e>>>18),this.Mt(128|63&e>>>12),this.Mt(128|63&e>>>6),this.Mt(128|63&e)}}this.xt()}Bt(e){const t=this.Lt(e),n=ls(t);this.kt(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}qt(e){const t=this.Lt(e),n=ls(t);this.kt(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Lt(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}Ct(e){const t=255&e;0===t?(this.Kt(0),this.Kt(255)):255===t?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){const t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class ds{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Bt(e)}Tt(){this.Gt.Qt()}}class fs{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}}class ps{constructor(){this.Gt=new hs,this.zt=new ds(this.Gt),this.jt=new fs(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return 0===e?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}}class gs{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Jt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new gs(this.indexId,this.documentKey,this.arrayValue,n)}}function ms(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=_s(e.arrayValue,t.arrayValue),0!==n?n:(n=_s(e.directionalValue,t.directionalValue),0!==n?n:J.comparator(e.documentKey,t.documentKey)))}function _s(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class ys{constructor(e){this.Yt=new at(((e,t)=>Y.comparator(e.field,t.field))),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];for(const t of e.filters){const e=t;e.isInequality()?this.Yt=this.Yt.add(e):this.Xt.push(e)}}get en(){return this.Yt.size>1}tn(e){if(C(e.collectionGroup===this.collectionId),this.en)return!1;const t=Z(e);if(void 0!==t&&!this.nn(t))return!1;const n=ee(e);let r=new Set,i=0,s=0;for(;i<n.length&&this.nn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Yt.size>0){const e=this.Yt.getIterator().getNext();if(!r.has(e.field.canonicalString())){const t=n[i];if(!this.rn(e,t)||!this.sn(this.Zt[s++],t))return!1}++i}for(;i<n.length;++i){const e=n[i];if(s>=this.Zt.length||!this.sn(this.Zt[s++],e))return!1}return!0}on(){if(this.en)return null;let e=new at(Y.comparator);const t=[];for(const n of this.Xt)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new te(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new te(n.field,0))}for(const n of this.Zt)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new te(n.field,"asc"===n.dir?0:1)));return new X(X.UNKNOWN_ID,this.collectionId,t,ne.empty())}nn(e){for(const t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function vs(e){var t,n;if(C(e instanceof en||e instanceof tn),e instanceof en){if(e instanceof mn){const r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((t=>en.create(e.field,"==",t))))||[];return tn.create(r,"or")}return e}const r=e.filters.map((e=>vs(e)));return tn.create(r,e.op)}function ws(e){if(0===e.getFilters().length)return[];const t=Es(vs(e));return C(Ts(t)),bs(t)||Is(t)?[t]:t.getFilters()}function bs(e){return e instanceof en}function Is(e){return e instanceof tn&&sn(e)}function Ts(e){return bs(e)||Is(e)||function(e){if(e instanceof tn&&rn(e)){for(const t of e.getFilters())if(!bs(t)&&!Is(t))return!1;return!0}return!1}(e)}function Es(e){if(C(e instanceof en||e instanceof tn),e instanceof en)return e;if(1===e.filters.length)return Es(e.filters[0]);const t=e.filters.map((e=>Es(e)));let n=tn.create(t,e.op);return n=ks(n),Ts(n)?n:(C(n instanceof tn),C(nn(n)),C(n.filters.length>1),n.filters.reduce(((e,t)=>Cs(e,t))))}function Cs(e,t){let n;return C(e instanceof en||e instanceof tn),C(t instanceof en||t instanceof tn),n=e instanceof en?t instanceof en?function(e,t){return tn.create([e,t],"and")}(e,t):Ss(e,t):t instanceof en?Ss(t,e):function(e,t){if(C(e.filters.length>0&&t.filters.length>0),nn(e)&&nn(t))return un(e,t.getFilters());const n=rn(e)?e:t,r=rn(e)?t:e,i=n.filters.map((e=>Cs(e,r)));return tn.create(i,"or")}(e,t),ks(n)}function Ss(e,t){if(nn(t))return un(t,e.getFilters());{const n=t.filters.map((t=>Cs(e,t)));return tn.create(n,"or")}}function ks(e){if(C(e instanceof en||e instanceof tn),e instanceof en)return e;const t=e.getFilters();if(1===t.length)return ks(t[0]);if(on(e))return e;const n=t.map((e=>ks(e))),r=[];return n.forEach((t=>{t instanceof en?r.push(t):t instanceof tn&&(t.op===e.op?r.push(...t.filters):r.push(t))})),1===r.length?r[0]:tn.create(r,e.op)}class Os{constructor(){this._n=new Ns}addToCollectionParentIndex(e,t){return this._n.add(t),le.resolve()}getCollectionParents(e,t){return le.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return le.resolve()}deleteFieldIndex(e,t){return le.resolve()}deleteAllFieldIndexes(e){return le.resolve()}createTargetIndexes(e,t){return le.resolve()}getDocumentsMatchingTarget(e,t){return le.resolve(null)}getIndexType(e,t){return le.resolve(0)}getFieldIndexes(e,t){return le.resolve([])}getNextCollectionGroupToUpdate(e){return le.resolve(null)}getMinOffset(e,t){return le.resolve(se.min())}getMinOffsetFromCollectionGroup(e,t){return le.resolve(se.min())}updateCollectionGroup(e,t,n){return le.resolve()}updateIndexEntries(e,t){return le.resolve()}}class Ns{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new at(H.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new at(H.comparator)).toArray()}}const As=new Uint8Array(0);class Rs{constructor(e,t){this.databaseId=t,this.an=new Ns,this.un=new Gn((e=>bn(e)),((e,t)=>In(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.an.add(t)}));const i={collectionId:n,parent:Se(r)};return xs(e).put(i)}return le.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[G(t),""],!1,!0);return xs(e).W(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(Ne(r.parent))}return n}))}addFieldIndex(e,t){const n=Ps(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))}}(t);delete r.indexId;const i=n.add(r);if(t.indexState){const n=Ls(e);return i.next((e=>{n.put(ns(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const n=Ps(e),r=Ls(e),i=Ds(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=Ps(e),n=Ds(e),r=Ls(e);return t.H().next((()=>n.H())).next((()=>r.H()))}createTargetIndexes(e,t){return le.forEach(this.cn(t),(t=>this.getIndexType(e,t).next((n=>{if(0===n||1===n){const n=new ys(t).on();if(null!=n)return this.addFieldIndex(e,n)}}))))}getDocumentsMatchingTarget(e,t){const n=Ds(e);let r=!0;const i=new Map;return le.forEach(this.cn(t),(t=>this.ln(e,t).next((e=>{r&&(r=!!e),i.set(t,e)})))).next((()=>{if(r){let e=nr();const r=[];return le.forEach(i,((i,s)=>{v("IndexedDbIndexManager",`Using index ${function(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`}(i)} to execute ${bn(t)}`);const o=function(e,t){const n=Z(t);if(void 0===n)return null;for(const t of En(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),c=function(e,t){const n=new Map;for(const r of ee(t))for(const t of En(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),a=function(e,t){const n=[];let r=!0;for(const i of ee(t)){const t=0===i.kind?Cn(e,i.fieldPath,e.startAt):Sn(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new Ht(n,r)}(s,i),u=function(e,t){const n=[];let r=!0;for(const i of ee(t)){const t=0===i.kind?Sn(e,i.fieldPath,e.endAt):Cn(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new Ht(n,r)}(s,i),l=this.hn(i,s,a),h=this.hn(i,s,u),d=this.Pn(i,s,c),f=this.In(i.indexId,o,l,a.inclusive,h,u.inclusive,d);return le.forEach(f,(i=>n.j(i,t.limit).next((t=>{t.forEach((t=>{const n=J.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))}))}))))})).next((()=>r))}return le.resolve(null)}))}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:ws(tn.create(e.filters,"and")).map((t=>wn(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.un.set(e,t),t)}In(e,t,n,r,i,s,o){const c=(null!=t?t.length:1)*Math.max(n.length,i.length),a=c/(null!=t?t.length:1),u=[];for(let l=0;l<c;++l){const c=t?this.Tn(t[l/a]):As,h=this.En(e,c,n[l%a],r),d=this.dn(e,c,i[l%a],s),f=o.map((t=>this.En(e,c,t,!0)));u.push(...this.createRange(h,d,f))}return u}En(e,t,n,r){const i=new gs(e,J.empty(),t,n);return r?i:i.Jt()}dn(e,t,n,r){const i=new gs(e,J.empty(),t,n);return r?i.Jt():i}ln(e,t){const n=new ys(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((e=>{let t=null;for(const r of e)n.tn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t}))}getIndexType(e,t){let n=2;const r=this.cn(t);return le.forEach(r,(t=>this.ln(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new at(Y.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>function(e){return null!==e.limit}(t)&&r.length>1&&2===n?1:n))}An(e,t){const n=new ps;for(const r of ee(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.Ht(r.kind);cs.bt.Pt(e,i)}return n.Wt()}Tn(e){const t=new ps;return cs.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){const n=new ps;return cs.bt.Pt(Dt(this.databaseId,t),n.Ht(function(e){const t=ee(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Wt()}Pn(e,t,n){if(null===n)return[];let r=[];r.push(new ps);let i=0;for(const s of ee(e)){const e=n[i++];for(const n of r)if(this.Vn(t,s.fieldPath)&&Lt(e))r=this.mn(r,s,e);else{const t=n.Ht(s.kind);cs.bt.Pt(e,t)}}return this.fn(r)}hn(e,t,n){return this.Pn(e,t,n.position)}fn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Wt();return t}mn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new ps;r.seed(n.Wt()),cs.bt.Pt(e,r.Ht(t.kind)),i.push(r)}return i}Vn(e,t){return!!e.filters.find((e=>e instanceof en&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=Ps(e),r=Ls(e);return(t?n.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.W()).next((e=>{const t=[];return le.forEach(e,(e=>r.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new ne(t.sequenceNumber,new se(Qi(t.readTime),new J(Ne(t.documentKey)),t.largestBatchId)):ne.empty(),r=e.fields.map((([e,t])=>new te(Y.fromServerFormat(e),t)));return new X(e.indexId,e.collectionGroup,r,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:B(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=Ps(e),i=Ls(e);return this.gn(e).next((e=>r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((t=>le.forEach(t,(t=>i.put(ns(t.indexId,this.uid,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return le.forEach(t,((t,r)=>{const i=n.get(t.collectionGroup);return(i?le.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next((i=>(n.set(t.collectionGroup,i),le.forEach(i,(n=>this.pn(e,t,n).next((t=>{const i=this.yn(r,n);return t.isEqual(i)?le.resolve():this.wn(e,r,n,t,i)})))))))}))}Sn(e,t,n,r){return Ds(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.Rn(n,t.key),documentKey:t.key.path.toArray()})}bn(e,t,n,r){return Ds(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.Rn(n,t.key),t.key.path.toArray()])}pn(e,t,n){const r=Ds(e);let i=new at(ms);return r.Y({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.Rn(n,t)])},((e,r)=>{i=i.add(new gs(n.indexId,t,r.arrayValue,r.directionalValue))})).next((()=>i))}yn(e,t){let n=new at(ms);const r=this.An(t,e);if(null==r)return n;const i=Z(t);if(null!=i){const s=e.data.field(i.fieldPath);if(Lt(s))for(const i of s.arrayValue.values||[])n=n.add(new gs(t.indexId,e.key,this.Tn(i),r))}else n=n.add(new gs(t.indexId,e.key,As,r));return n}wn(e,t,n,r,i){v("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){const s=e.getIterator(),o=t.getIterator();let c=ut(s),a=ut(o);for(;c||a;){let e=!1,t=!1;if(c&&a){const r=n(c,a);r<0?t=!0:r>0&&(e=!0)}else null!=c?t=!0:e=!0;e?(r(a),a=ut(o)):t?(i(c),c=ut(s)):(c=ut(s),a=ut(o))}}(r,i,ms,(r=>{s.push(this.Sn(e,t,n,r))}),(r=>{s.push(this.bn(e,t,n,r))})),le.waitFor(s)}gn(e){let t=1;return Ls(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,r)=>{r.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>ms(e,t))).filter(((e,t,n)=>!t||0!==ms(e,n[t-1])));const r=[];r.push(e);for(const i of n){const n=ms(i,e),s=ms(i,t);if(0===n)r[0]=e.Jt();else if(n>0&&s<0)r.push(i),r.push(i.Jt());else if(s>0)break}r.push(t);const i=[];for(let e=0;e<r.length;e+=2){if(this.Dn(r[e],r[e+1]))return[];const t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,As,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,As,[]];i.push(IDBKeyRange.bound(t,n))}return i}Dn(e,t){return ms(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Ms)}getMinOffset(e,t){return le.mapArray(this.cn(t),(t=>this.ln(e,t).next((e=>e||E())))).next(Ms)}}function xs(e){return Ze(e,"collectionParents")}function Ds(e){return Ze(e,"indexEntries")}function Ps(e){return Ze(e,"indexConfiguration")}function Ls(e){return Ze(e,"indexState")}function Ms(e){C(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const i=e[r].indexState.offset;oe(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new se(t.readTime,t.documentKey,n)}const js={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Fs{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Fs(e,Fs.DEFAULT_COLLECTION_PERCENTILE,Fs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Us(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let c=0;const a=r.Y({range:o},((e,t,n)=>(c++,n.delete())));s.push(a.next((()=>{C(1===c)})));const u=[];for(const e of n.mutations){const r=xe(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return le.waitFor(s).next((()=>u))}function Vs(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw E();t=e.noDocument}return JSON.stringify(t).length}Fs.DEFAULT_COLLECTION_PERCENTILE=10,Fs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Fs.DEFAULT=new Fs(41943040,Fs.DEFAULT_COLLECTION_PERCENTILE,Fs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Fs.DISABLED=new Fs(-1,0,0);class qs{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Cn={}}static lt(e,t,n,r){C(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new qs(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return zs(e).Y({index:"userMutationsIndex",range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const i=Gs(e),s=zs(e);return s.add({}).next((o=>{C("number"==typeof o);const c=new Ur(o,t,n,r),a=function(e,t,n){const r=n.baseMutations.map((t=>Ai(e.ct,t))),i=n.mutations.map((t=>Ai(e.ct,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,c),u=[];let l=new at(((e,t)=>B(e.canonicalString(),t.canonicalString())));for(const e of r){const t=xe(this.userId,e.key.path,o);l=l.add(e.key.path.popLast()),u.push(s.put(a)),u.push(i.put(t,De))}return l.forEach((t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.Cn[o]=c.keys()})),le.waitFor(u).next((()=>c))}))}lookupMutationBatch(e,t){return zs(e).get(t).next((e=>e?(C(e.userId===this.userId),Yi(this.serializer,e)):null))}vn(e,t){return this.Cn[t]?le.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.Cn[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return zs(e).Y({index:"userMutationsIndex",range:r},((e,t,r)=>{t.userId===this.userId&&(C(t.batchId>=n),i=Yi(this.serializer,t)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return zs(e).Y({index:"userMutationsIndex",range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return zs(e).W("userMutationsIndex",t).next((e=>e.map((e=>Yi(this.serializer,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Re(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return Gs(e).Y({range:r},((n,r,s)=>{const[o,c,a]=n,u=Ne(c);if(o===this.userId&&t.path.isEqual(u))return zs(e).get(a).next((e=>{if(!e)throw E();C(e.userId===this.userId),i.push(Yi(this.serializer,e))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new at(B);const r=[];return t.forEach((t=>{const i=Re(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=Gs(e).Y({range:s},((e,r,i)=>{const[s,o,c]=e,a=Ne(o);s===this.userId&&t.path.isEqual(a)?n=n.add(c):i.done()}));r.push(o)})),le.waitFor(r).next((()=>this.Fn(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=Re(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new at(B);return Gs(e).Y({range:s},((e,t,i)=>{const[s,c,a]=e,u=Ne(c);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(a)):i.done()})).next((()=>this.Fn(e,o)))}Fn(e,t){const n=[],r=[];return t.forEach((t=>{r.push(zs(e).get(t).next((e=>{if(null===e)throw E();C(e.userId===this.userId),n.push(Yi(this.serializer,e))})))})),le.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return Us(e.ae,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.Mn(t.batchId)})),le.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return le.resolve();const n=IDBKeyRange.lowerBound(function(e){return[e]}(this.userId)),r=[];return Gs(e).Y({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=Ne(e[1]);r.push(t)}else n.done()})).next((()=>{C(0===r.length)}))}))}containsKey(e,t){return Bs(e,this.userId,t)}xn(e){return Ws(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function Bs(e,t,n){const r=Re(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return Gs(e).Y({range:s,J:!0},((e,n,r)=>{const[s,c,a]=e;s===t&&c===i&&(o=!0),r.done()})).next((()=>o))}function zs(e){return Ze(e,"mutations")}function Gs(e){return Ze(e,"documentMutations")}function Ws(e){return Ze(e,"mutationQueues")}class Ks{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new Ks(0)}static Bn(){return new Ks(-1)}}class $s{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Ln(e).next((t=>{const n=new Ks(t.highestTargetId);return t.highestTargetId=n.next(),this.kn(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.Ln(e).next((e=>K.fromTimestamp(new W(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.Ln(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.Ln(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.kn(e,r))))}addTargetData(e,t){return this.qn(e,t).next((()=>this.Ln(e).next((n=>(n.targetCount+=1,this.Qn(t,n),this.kn(e,n))))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>Hs(e).delete(t.targetId))).next((()=>this.Ln(e))).next((t=>(C(t.targetCount>0),t.targetCount-=1,this.kn(e,t))))}removeTargets(e,t,n){let r=0;const i=[];return Hs(e).Y(((s,o)=>{const c=Ji(o);c.sequenceNumber<=t&&null===n.get(c.targetId)&&(r++,i.push(this.removeTargetData(e,c)))})).next((()=>le.waitFor(i))).next((()=>r))}forEachTarget(e,t){return Hs(e).Y(((e,n)=>{const r=Ji(n);t(r)}))}Ln(e){return Qs(e).get("targetGlobalKey").next((e=>(C(null!==e),e)))}kn(e,t){return Qs(e).put("targetGlobalKey",t)}qn(e,t){return Hs(e).put(Xi(this.serializer,t))}Qn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Ln(e).next((e=>e.targetCount))}getTargetData(e,t){const n=bn(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Hs(e).Y({range:r,index:"queryTargetsIndex"},((e,n,r)=>{const s=Ji(n);In(t,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(e,t,n){const r=[],i=Ys(e);return t.forEach((t=>{const s=Se(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))})),le.waitFor(r)}removeMatchingKeys(e,t,n){const r=Ys(e);return le.forEach(t,(t=>{const i=Se(t.path);return le.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=Ys(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Ys(e);let i=nr();return r.Y({range:n,J:!0},((e,t,n)=>{const r=Ne(e[1]),s=new J(r);i=i.add(s)})).next((()=>i))}containsKey(e,t){const n=Se(t.path),r=IDBKeyRange.bound([n],[G(n)],!1,!0);let i=0;return Ys(e).Y({index:"documentTargetsIndex",J:!0,range:r},(([e,t],n,r)=>{0!==e&&(i++,r.done())})).next((()=>i>0))}_t(e,t){return Hs(e).get(t).next((e=>e?Ji(e):null))}}function Hs(e){return Ze(e,"targets")}function Qs(e){return Ze(e,"targetGlobal")}function Ys(e){return Ze(e,"targetDocuments")}function Js([e,t],[n,r]){const i=B(e,n);return 0===i?B(t,r):i}class Xs{constructor(e){this.Kn=e,this.buffer=new at(Js),this.$n=0}Un(){return++this.$n}Wn(e){const t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Js(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Zs{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}zn(e){v("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Gn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){ge(e)?v("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await ue(e)}await this.zn(3e5)}))}}class eo{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return le.resolve(Ie._e);const n=new Xs(t);return this.jn.forEachTarget(e,(e=>n.Wn(e.sequenceNumber))).next((()=>this.jn.Jn(e,(e=>n.Wn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(v("LruGarbageCollector","Garbage collection skipped; disabled"),le.resolve(js)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(v("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),js):this.Yn(e,t)))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let n,r,i,s,o,a,u;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(v("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(u=Date.now(),_()<=c.a.DEBUG&&v("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-l}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(u-a)+"ms\n"+`Total Duration: ${u-l}ms`),le.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}function to(e,t){return new eo(e,t)}class no{constructor(e,t){this.db=e,this.garbageCollector=to(this,t)}Hn(e){const t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Zn(e){let t=0;return this.Jn(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,((e,n)=>t(n)))}addReference(e,t,n){return ro(e,n)}removeReference(e,t,n){return ro(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return ro(e,t)}er(e,t){return function(e,t){let n=!1;return Ws(e).Z((r=>Bs(e,r,t).next((e=>(e&&(n=!0),le.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Xn(e,((s,o)=>{if(o<=t){const t=this.er(e,s).next((t=>{if(!t)return i++,n.getEntry(e,s).next((()=>(n.removeEntry(s,K.min()),Ys(e).delete(function(e){return[0,Se(e.path)]}(s)))))}));r.push(t)}})).next((()=>le.waitFor(r))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return ro(e,t)}Xn(e,t){const n=Ys(e);let r,i=Ie._e;return n.Y({index:"documentTargetsIndex"},(([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==Ie._e&&t(new J(Ne(r)),i),i=o,r=s):i=Ie._e})).next((()=>{i!==Ie._e&&t(new J(Ne(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ro(e,t){return Ys(e).put(function(e,t){return{targetId:0,path:Se(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class io{constructor(){this.changes=new Gn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,$t.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?le.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class so{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return uo(e).put(n)}removeEntry(e,t,n){return uo(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],$i(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.tr(e,n))))}getEntry(e,t){let n=$t.newInvalidDocument(t);return uo(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(lo(t))},((e,r)=>{n=this.nr(t,r)})).next((()=>n))}rr(e,t){let n={size:0,document:$t.newInvalidDocument(t)};return uo(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(lo(t))},((e,r)=>{n={document:this.nr(t,r),size:Vs(r)}})).next((()=>n))}getEntries(e,t){let n=Kn();return this.ir(e,t,((e,t)=>{const r=this.nr(e,t);n=n.insert(e,r)})).next((()=>n))}sr(e,t){let n=Kn(),r=new it(J.comparator);return this.ir(e,t,((e,t)=>{const i=this.nr(e,t);n=n.insert(e,i),r=r.insert(e,Vs(t))})).next((()=>({documents:n,_r:r})))}ir(e,t,n){if(t.isEmpty())return le.resolve();let r=new at(fo);t.forEach((e=>r=r.add(e)));const i=IDBKeyRange.bound(lo(r.first()),lo(r.last())),s=r.getIterator();let o=s.getNext();return uo(e).Y({index:"documentKeyIndex",range:i},((e,t,r)=>{const i=J.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&fo(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.U(lo(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null}))}getDocumentsMatchingQuery(e,t,n,r,i){const s=t.path,o=[s.popLast().toArray(),s.lastSegment(),$i(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return uo(e).W(IDBKeyRange.bound(o,c,!0)).next((e=>{null==i||i.incrementDocumentReadCount(e.length);let n=Kn();for(const i of e){const e=this.nr(J.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(Vn(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n}))}getAllFromCollectionGroup(e,t,n,r){let i=Kn();const s=ho(t,n),o=ho(t,se.max());return uo(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,o,!0)},((e,t,n)=>{const s=this.nr(J.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()})).next((()=>i))}newChangeBuffer(e){return new ao(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return co(e).get("remoteDocumentGlobalKey").next((e=>(C(!!e),e)))}tr(e,t){return co(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){const e=function(e,t){let n;if(t.document)n=Ni(e.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=J.fromSegments(t.noDocument.path),r=Qi(t.noDocument.readTime);n=$t.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return E();{const e=J.fromSegments(t.unknownDocument.path),r=Qi(t.unknownDocument.version);n=$t.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new W(e[0],e[1]);return K.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(K.min()))return e}return $t.newInvalidDocument(e)}}function oo(e){return new so(e)}class ao extends io{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new Gn((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new at(((e,t)=>B(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,s)=>{const o=this.ur.get(i);if(t.push(this.ar.removeEntry(e,i,o.readTime)),s.isValidDocument()){const c=Ki(this.ar.serializer,s);r=r.add(i.path.popLast());const a=Vs(c);n+=a-o.size,t.push(this.ar.addEntry(e,i,c))}else if(n-=o.size,this.trackRemovals){const n=Ki(this.ar.serializer,s.convertToNoDocument(K.min()));t.push(this.ar.addEntry(e,i,n))}})),r.forEach((n=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.ar.updateMetadata(e,n)),le.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next((e=>(this.ur.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.ar.sr(e,t).next((({documents:e,_r:t})=>(t.forEach(((t,n)=>{this.ur.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function co(e){return Ze(e,"remoteDocumentGlobal")}function uo(e){return Ze(e,"remoteDocumentsV14")}function lo(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function ho(e,t){const n=t.documentKey.path.toArray();return[e,$i(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function fo(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=B(n[e],r[e]),i)return i;return i=B(n.length,r.length),i||(i=B(n[n.length-2],r[r.length-2]),i||B(n[n.length-1],r[r.length-1]))}class po{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class go{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Nr(n.mutation,e,lt.empty(),W.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,nr()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=nr()){const r=Yn();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=Hn();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=Yn();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,nr())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=Kn();const s=Xn(),o=Xn();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof Dr)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),Nr(o.mutation,t,o.mutation.getFieldMask(),W.now())):s.set(t.key,lt.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new po(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=Xn();let r=new it(((e,t)=>e-t)),i=nr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||lt.empty();o=i.applyToLocalView(s,o),n.set(e,o);const c=(r.get(i.batchId)||nr()).add(e);r=r.insert(i.batchId,c)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),c=r.key,a=r.value,u=Jn();a.forEach((e=>{if(!i.has(e)){const r=kr(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,c,u))}return le.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return J.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Rn(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):le.resolve(Yn());let o=-1,c=i;return s.next((t=>le.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?le.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{c=c.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,c,t,nr()))).next((e=>({batchId:o,changes:Qn(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new J(t)).next((e=>{let t=Hn();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=Hn();return this.indexManager.getCollectionParents(e,i).next((o=>le.forEach(o,(o=>{const c=function(e,t){return new kn(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,n,r).next((e=>{e.forEach(((e,t)=>{s=s.insert(e,t)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)))).next((e=>{i.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,$t.newInvalidDocument(r)))}));let n=Hn();return e.forEach(((e,r)=>{const s=i.get(e);void 0!==s&&Nr(s.mutation,r,lt.empty(),W.now()),Vn(t,r)&&(n=n.insert(e,r))})),n}))}}class mo{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return le.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:yi(e.createTime)}}(t)),le.resolve()}getNamedQuery(e,t){return le.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(e){return{name:e.name,query:Zi(e.bundledQuery),readTime:yi(e.readTime)}}(t)),le.resolve()}}class _o{constructor(){this.overlays=new it(J.comparator),this.hr=new Map}getOverlay(e,t){return le.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Yn();return le.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.ht(e,t,r)})),le.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.hr.delete(n)),le.resolve()}getOverlaysForCollection(e,t,n){const r=Yn(),i=t.length+1,s=new J(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return le.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new it(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=Yn(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Yn(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return le.resolve(o)}ht(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new qr(t,n));let i=this.hr.get(t);void 0===i&&(i=nr(),this.hr.set(t,i)),this.hr.set(t,i.add(n.key))}}class yo{constructor(){this.Pr=new at(vo.Ir),this.Tr=new at(vo.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const n=new vo(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Ar(new vo(e,t))}Rr(e,t){e.forEach((e=>this.removeReference(e,t)))}Vr(e){const t=new J(new H([])),n=new vo(t,e),r=new vo(t,e+1),i=[];return this.Tr.forEachInRange([n,r],(e=>{this.Ar(e),i.push(e.key)})),i}mr(){this.Pr.forEach((e=>this.Ar(e)))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new J(new H([])),n=new vo(t,e),r=new vo(t,e+1);let i=nr();return this.Tr.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new vo(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class vo{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return J.comparator(e.key,t.key)||B(e.pr,t.pr)}static Er(e,t){return B(e.pr,t.pr)||J.comparator(e.key,t.key)}}class wo{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new at(vo.Ir)}checkEmpty(e){return le.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Ur(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.wr=this.wr.add(new vo(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return le.resolve(s)}lookupMutationBatch(e,t){return le.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.br(n),i=r<0?0:r;return le.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return le.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return le.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new vo(t,0),r=new vo(t,Number.POSITIVE_INFINITY),i=[];return this.wr.forEachInRange([n,r],(e=>{const t=this.Sr(e.pr);i.push(t)})),le.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new at(B);return t.forEach((e=>{const t=new vo(e,0),r=new vo(e,Number.POSITIVE_INFINITY);this.wr.forEachInRange([t,r],(e=>{n=n.add(e.pr)}))})),le.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;J.isDocumentKey(i)||(i=i.child(""));const s=new vo(new J(i),0);let o=new at(B);return this.wr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.pr)),!0)}),s),le.resolve(this.Dr(o))}Dr(e){const t=[];return e.forEach((e=>{const n=this.Sr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){C(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return le.forEach(t.mutations,(r=>{const i=new vo(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.wr=n}))}Mn(e){}containsKey(e,t){const n=new vo(t,0),r=this.wr.firstAfterOrEqual(n);return le.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,le.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class bo{constructor(e){this.vr=e,this.docs=new it(J.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return le.resolve(n?n.document.mutableCopy():$t.newInvalidDocument(t))}getEntries(e,t){let n=Kn();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():$t.newInvalidDocument(e))})),le.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=Kn();const s=t.path,o=new J(s.child("")),c=this.docs.getIteratorFrom(o);for(;c.hasNext();){const{key:e,value:{document:o}}=c.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||oe(ie(o),n)<=0||(r.has(o.key)||Vn(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return le.resolve(i)}getAllFromCollectionGroup(e,t,n,r){E()}Fr(e,t){return le.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Io(this)}getSize(e){return le.resolve(this.size)}}class Io extends io{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.ar.addEntry(e,r)):this.ar.removeEntry(n)})),le.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class To{constructor(e){this.persistence=e,this.Mr=new Gn((e=>bn(e)),In),this.lastRemoteSnapshotVersion=K.min(),this.highestTargetId=0,this.Or=0,this.Nr=new yo,this.targetCount=0,this.Br=Ks.Nn()}forEachTarget(e,t){return this.Mr.forEach(((e,n)=>t(n))),le.resolve()}getLastRemoteSnapshotVersion(e){return le.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return le.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Br.next(),le.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),le.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Br=new Ks(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,le.resolve()}updateTargetData(e,t){return this.qn(t),le.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,le.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Mr.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Mr.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),le.waitFor(i).next((()=>r))}getTargetCount(e){return le.resolve(this.targetCount)}getTargetData(e,t){const n=this.Mr.get(t)||null;return le.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),le.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),le.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),le.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Nr.gr(t);return le.resolve(n)}containsKey(e,t){return le.resolve(this.Nr.containsKey(t))}}class Eo{constructor(e,t){this.Lr={},this.overlays={},this.kr=new Ie(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new To(this),this.indexManager=new Os,this.remoteDocumentCache=function(e){return new bo(e)}((e=>this.referenceDelegate.Kr(e))),this.serializer=new Wi(t),this.$r=new mo(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new _o,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Lr[e.toKey()];return n||(n=new wo(t,this.referenceDelegate),this.Lr[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){v("MemoryPersistence","Starting transaction:",e);const r=new Co(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((e=>this.referenceDelegate.Wr(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Gr(e,t){return le.or(Object.values(this.Lr).map((n=>()=>n.containsKey(e,t))))}}class Co extends ce{constructor(e){super(),this.currentSequenceNumber=e}}class So{constructor(e){this.persistence=e,this.zr=new yo,this.jr=null}static Hr(e){return new So(e)}get Jr(){if(this.jr)return this.jr;throw E()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),le.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),le.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),le.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach((e=>this.Jr.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Jr.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return le.forEach(this.Jr,(n=>{const r=J.fromPath(n);return this.Yr(e,r).next((e=>{e||t.removeEntry(r,K.min())}))})).next((()=>(this.jr=null,t.apply(e))))}updateLimboDocument(e,t){return this.Yr(e,t).next((e=>{e?this.Jr.delete(t.toString()):this.Jr.add(t.toString())}))}Kr(e){return 0}Yr(e,t){return le.or([()=>le.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class ko{constructor(e){this.serializer=e}N(e,t,n,r){const i=new he("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Ae,{unique:!0}),e.createObjectStore("documentMutations")}(e),Oo(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=le.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),Oo(e)),s=s.next((()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:K.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(e,t){return t.store("mutations").W().next((n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Ae,{unique:!0});const r=t.store("mutations"),i=n.map((e=>r.put(e)));return le.waitFor(i)}))}(e,i)))),s=s.next((()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(s=s.next((()=>this.Xr(i)))),n<6&&r>=6&&(s=s.next((()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.ei(i))))),n<7&&r>=7&&(s=s.next((()=>this.ti(i)))),n<8&&r>=8&&(s=s.next((()=>this.ni(e,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(s=s.next((()=>this.ri(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&r>=12&&(s=s.next((()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:Ge});t.createIndex("collectionPathOverlayIndex",We,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",Ke,{unique:!1})}(e)}))),n<13&&r>=13&&(s=s.next((()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:Pe});t.createIndex("documentKeyIndex",Le),t.createIndex("collectionGroupIndex",Me)}(e))).next((()=>this.ii(e,i))).next((()=>e.deleteObjectStore("remoteDocuments")))),n<14&&r>=14&&(s=s.next((()=>this.si(e,i)))),n<15&&r>=15&&(s=s.next((()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Ve}).createIndex("sequenceNumberIndex",qe,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:Be}).createIndex("documentKeyIndex",ze,{unique:!1})}(e)))),s}ei(e){let t=0;return e.store("remoteDocuments").Y(((e,n)=>{t+=Vs(n)})).next((()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Xr(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.W().next((t=>le.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.W("userMutationsIndex",r).next((n=>le.forEach(n,(n=>{C(n.userId===t.userId);const r=Yi(this.serializer,n);return Us(e,t.userId,r).next((()=>{}))}))))}))))}ti(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((e=>{const r=[];return n.Y(((n,i)=>{const s=new H(n),o=function(e){return[0,Se(e)]}(s);r.push(t.get(o).next((n=>n?le.resolve():(n=>t.put({targetId:0,path:Se(n),sequenceNumber:e.highestListenSequenceNumber}))(s))))})).next((()=>le.waitFor(r)))}))}ni(e,t){e.createObjectStore("collectionParents",{keyPath:Ue});const n=t.store("collectionParents"),r=new Ns,o=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Se(r)})}};return t.store("remoteDocuments").Y({J:!0},((e,t)=>{const n=new H(e);return o(n.popLast())})).next((()=>t.store("documentMutations").Y({J:!0},(([e,t,n],r)=>{const i=Ne(t);return o(i.popLast())}))))}ri(e){const t=e.store("targets");return t.Y(((e,n)=>{const r=Ji(n),i=Xi(this.serializer,r);return t.put(i)}))}ii(e,t){const n=t.store("remoteDocuments"),r=[];return n.Y(((e,n)=>{const i=t.store("remoteDocumentsV14"),s=function(e){return e.document?new J(H.fromString(e.document.name).popFirst(5)):e.noDocument?J.fromSegments(e.noDocument.path):e.unknownDocument?J.fromSegments(e.unknownDocument.path):E()}(n).path.toArray(),o={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(o))})).next((()=>le.waitFor(r)))}si(e,t){const n=t.store("mutations"),r=oo(this.serializer),i=new Eo(So.Hr,this.serializer.ct);return n.W().next((e=>{const n=new Map;return e.forEach((e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:nr();Yi(this.serializer,e).keys().forEach((e=>r=r.add(e))),n.set(e.userId,r)})),le.forEach(n,((e,n)=>{const s=new f(n),o=os.lt(this.serializer,s),c=i.getIndexManager(s),a=qs.lt(s,this.serializer,c,i.referenceDelegate);return new go(r,a,o,c).recalculateAndSaveOverlaysForDocumentKeys(new Xe(t,Ie._e),e).next()}))}))}}function Oo(e){e.createObjectStore("targetDocuments",{keyPath:Fe}).createIndex("documentTargetsIndex",q,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",je,{unique:!0}),e.createObjectStore("targetGlobal")}const No="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Ao{constructor(e,t,n,r,i,s,o,c,a,u,l=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.oi=i,this.window=s,this.document=o,this._i=a,this.ai=u,this.ui=l,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=e=>Promise.resolve(),!Ao.D())throw new N(O.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new no(this,r),this.Ti=t+"main",this.serializer=new Wi(c),this.Ei=new de(this.Ti,this.ui,new ko(this.serializer)),this.Qr=new $s(this.referenceDelegate,this.serializer),this.remoteDocumentCache=oo(this.serializer),this.$r=new rs,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,!1===u&&w("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new N(O.FAILED_PRECONDITION,No);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Qr.getHighestSequenceNumber(e)))})).then((e=>{this.kr=new Ie(e,this._i)})).then((()=>{this.qr=!0})).catch((e=>(this.Ei&&this.Ei.close(),Promise.reject(e))))}fi(e){return this.Ii=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.L((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget((async()=>{this.started&&await this.Ai()})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>xo(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.gi(e).next((e=>{e||(this.isPrimary=!1,this.oi.enqueueRetryable((()=>this.Ii(!1))))}))})).next((()=>this.pi(e))).next((t=>this.isPrimary&&!t?this.yi(e).next((()=>!1)):!!t&&this.wi(e).next((()=>!0)))))).catch((e=>{if(ge(e))return v("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return v("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.oi.enqueueRetryable((()=>this.Ii(e))),this.isPrimary=e}))}gi(e){return Ro(e).get("owner").next((e=>le.resolve(this.Si(e))))}bi(e){return xo(e).delete(this.clientId)}async Di(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=Ze(e,"clientMetadata");return t.W().next((e=>{const n=this.vi(e,18e5),r=e.filter((e=>-1===n.indexOf(e)));return le.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.di)for(const t of e)this.di.removeItem(this.Fi(t.clientId))}}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Ai().then((()=>this.Di())).then((()=>this.mi()))))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?le.resolve(!0):Ro(e).get("owner").next((t=>{if(null!==t&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new N(O.FAILED_PRECONDITION,No);return!1}}return!(!this.networkEnabled||!this.inForeground)||xo(e).W().next((e=>void 0===this.vi(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&v("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),await this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(e=>{const t=new Xe(e,Ie._e);return this.yi(t).next((()=>this.bi(t)))})),this.Ei.close(),this.Bi()}vi(e,t){return e.filter((e=>this.Ci(e.updateTimeMs,t)&&!this.Mi(e.clientId)))}Li(){return this.runTransaction("getActiveClients","readonly",(e=>xo(e).W().next((e=>this.vi(e,18e5).map((e=>e.clientId))))))}get started(){return this.qr}getMutationQueue(e,t){return qs.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Rs(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return os.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,n){v("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=function(e){return 15===e?Je:14===e?Ye:13===e?Qe:12===e?He:11===e?$e:void E()}(this.ui);let s;return this.Ei.runTransaction(e,r,i,(r=>(s=new Xe(r,this.kr?this.kr.next():Ie._e),"readwrite-primary"===t?this.gi(s).next((e=>!!e||this.pi(s))).next((t=>{if(!t)throw w(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable((()=>this.Ii(!1))),new N(O.FAILED_PRECONDITION,ae);return n(s)})).next((e=>this.wi(s).next((()=>e)))):this.ki(s).next((()=>n(s)))))).then((e=>(s.raiseOnCommittedEvent(),e)))}ki(e){return Ro(e).get("owner").next((e=>{if(null!==e&&this.Ci(e.leaseTimestampMs,5e3)&&!this.Mi(e.ownerId)&&!this.Si(e)&&!(this.ai||this.allowTabSynchronization&&e.allowTabSynchronization))throw new N(O.FAILED_PRECONDITION,No)}))}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ro(e).put("owner",t)}static D(){return de.D()}yi(e){const t=Ro(e);return t.get("owner").next((e=>this.Si(e)?(v("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):le.resolve()))}Ci(e,t){const n=Date.now();return!(e<n-t||e>n&&(w(`Detected an update time that is in the future: ${e} > ${n}`),1))}Ri(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.li=()=>{this.oi.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.Ai())))},this.document.addEventListener("visibilitychange",this.li),this.inForeground="visible"===this.document.visibilityState)}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();const e=/(?:Version|Mobile)\/1[456]/;Object(l.I)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{const n=null!==(null===(t=this.di)||void 0===t?void 0:t.getItem(this.Fi(e)));return v("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return w("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){w("Failed to set zombie client id.",e)}}Bi(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch(e){}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Ro(e){return Ze(e,"owner")}function xo(e){return Ze(e,"clientMetadata")}function Do(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class Po{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=r}static Ki(e,t){let n=nr(),r=nr();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new Po(e,t.fromCache,n,r)}}class Lo{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Mo{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=Object(l.I)()?8:de.v(Object(l.x)())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.ji(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.Hi(e,t,r,n).next((e=>{i.result=e}))})).next((()=>{if(i.result)return;const n=new Lo;return this.Ji(e,t,n).next((r=>{if(i.result=r,this.Ui)return this.Yi(e,t,n,r.size)}))})).next((()=>i.result))}Yi(e,t,n,r){return n.documentReadCount<this.Wi?(_()<=c.a.DEBUG&&v("QueryEngine","SDK will not create cache indexes for query:",Un(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),le.resolve()):(_()<=c.a.DEBUG&&v("QueryEngine","Query:",Un(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(_()<=c.a.DEBUG&&v("QueryEngine","The SDK decides to create cache indexes for query:",Un(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Dn(t))):le.resolve())}ji(e,t){if(An(t))return le.resolve(null);let n=Dn(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Mn(t,null,"F"),n=Dn(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=nr(...r);return this.zi.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.Zi(t,r);return this.Xi(t,s,i,n.readTime)?this.ji(e,Mn(t,null,"F")):this.es(e,s,t,n)}))))})))))}Hi(e,t,n,r){return An(t)||r.isEqual(K.min())?le.resolve(null):this.zi.getDocuments(e,n).next((i=>{const s=this.Zi(t,i);return this.Xi(t,s,n,r)?le.resolve(null):(_()<=c.a.DEBUG&&v("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Un(t)),this.es(e,s,t,re(r,-1)).next((e=>e)))}))}Zi(e,t){let n=new at(Bn(e));return t.forEach(((t,r)=>{Vn(e,r)&&(n=n.add(r))})),n}Xi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ji(e,t,n){return _()<=c.a.DEBUG&&v("QueryEngine","Using full collection scan to execute query:",Un(t)),this.zi.getDocumentsMatchingQuery(e,t,se.min(),n)}es(e,t,n,r){return this.zi.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class jo{constructor(e,t,n,r){this.persistence=e,this.ts=t,this.serializer=r,this.ns=new it(B),this.rs=new Gn((e=>bn(e)),In),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new go(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.ns)))}}function Fo(e,t,n,r){return new jo(e,t,n,r)}async function Uo(e,t){const n=k(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n._s(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=nr();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({us:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function Vo(e){const t=k(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Qr.getLastRemoteSnapshotVersion(e)))}function qo(e,t,n){let r=nr(),i=nr();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=Kn();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(K.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):v("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{cs:r,ls:i}}))}function Bo(e,t){const n=k(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function zo(e,t){const n=k(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Qr.getTargetData(e,t).next((i=>i?(r=i,le.resolve(r)):n.Qr.allocateTargetId(e).next((i=>(r=new Gi(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Qr.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.ns.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(e.targetId,e),n.rs.set(t,e.targetId)),e}))}async function Go(e,t,n){const r=k(e),i=r.ns.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!ge(e))throw e;v("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.ns=r.ns.remove(t),r.rs.delete(i.target)}function Wo(e,t,n){const r=k(e);let i=K.min(),s=nr();return r.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const r=k(e),i=r.rs.get(n);return void 0!==i?le.resolve(r.ns.get(i)):r.Qr.getTargetData(t,n)}(r,e,Dn(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.ts.getDocumentsMatchingQuery(e,t,n?i:K.min(),n?s:nr()))).next((e=>(Ho(r,qn(t),e),{documents:e,hs:s})))))}function Ko(e,t){const n=k(e),r=k(n.Qr),i=n.ns.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(e=>r._t(e,t).next((e=>e?e.target:null))))}function $o(e,t){const n=k(e),r=n.ss.get(t)||K.min();return n.persistence.runTransaction("Get new document changes","readonly",(e=>n.os.getAllFromCollectionGroup(e,t,re(r,-1),Number.MAX_SAFE_INTEGER))).then((e=>(Ho(n,t,e),e)))}function Ho(e,t,n){let r=e.ss.get(t)||K.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.ss.set(t,r)}async function Qo(e,t,n=nr()){const r=await zo(e,Dn(Zi(t.bundledQuery))),i=k(e);return i.persistence.runTransaction("Save named query","readwrite",(e=>{const s=yi(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.$r.saveNamedQuery(e,t);const o=r.withResumeToken(pt.EMPTY_BYTE_STRING,s);return i.ns=i.ns.insert(o.targetId,o),i.Qr.updateTargetData(e,o).next((()=>i.Qr.removeMatchingKeysForTargetId(e,r.targetId))).next((()=>i.Qr.addMatchingKeys(e,n,r.targetId))).next((()=>i.$r.saveNamedQuery(e,t)))}))}function Yo(e,t){return`firestore_clients_${e}_${t}`}function Jo(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Xo(e,t){return`firestore_targets_${e}_${t}`}class Zo{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Es(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new N(r.error.code,r.error.message))),s?new Zo(e,t,r.state,i):(w("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ea{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Es(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new N(n.error.code,n.error.message))),i?new ea(e,n.state,r):(w("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ta{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=ir();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=Ce(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new ta(e,i):(w("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class na{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new na(t.clientId,t.onlineState):(w("SharedClientState",`Failed to parse online state: ${e}`),null)}}class ra{constructor(){this.activeTargetIds=ir()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ia{constructor(e,t,n,r,i){this.window=e,this.oi=t,this.persistenceKey=n,this.Vs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new it(B),this.started=!1,this.ys=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ws=Yo(this.persistenceKey,this.Vs),this.Ss=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.ps=this.ps.insert(this.Vs,new ra),this.bs=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.vs=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.Fs=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Li();for(const t of e){if(t===this.Vs)continue;const e=this.getItem(Yo(this.persistenceKey,t));if(e){const n=ta.Es(t,e);n&&(this.ps=this.ps.insert(n.clientId,n))}}this.Ms();const t=this.storage.getItem(this.vs);if(t){const e=this.xs(t);e&&this.Os(e)}for(const e of this.ys)this.gs(e);this.ys=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach(((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.Bs(e,"pending")}updateMutationState(e,t,n){this.Bs(e,t,n),this.Ls(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(Xo(this.persistenceKey,e));if(n){const r=ea.Es(e,n);r&&(t=r.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Xo(this.persistenceKey,e))}updateQueryState(e,t,n){this.qs(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.Ls(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return v("SharedClientState","READ",e,t),t}setItem(e,t){v("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){v("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){const t=e;if(t.storageArea===this.storage){if(v("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ws)return void w("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable((async()=>{if(this.started){if(null!==t.key)if(this.bs.test(t.key)){if(null==t.newValue){const e=this.$s(t.key);return this.Us(e,null)}{const e=this.Ws(t.key,t.newValue);if(e)return this.Us(e.clientId,e)}}else if(this.Ds.test(t.key)){if(null!==t.newValue){const e=this.Gs(t.key,t.newValue);if(e)return this.zs(e)}}else if(this.Cs.test(t.key)){if(null!==t.newValue){const e=this.js(t.key,t.newValue);if(e)return this.Hs(e)}}else if(t.key===this.vs){if(null!==t.newValue){const e=this.xs(t.newValue);if(e)return this.Os(e)}}else if(t.key===this.Ss){const e=function(e){let t=Ie._e;if(null!=e)try{const n=JSON.parse(e);C("number"==typeof n),t=n}catch(e){w("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==Ie._e&&this.sequenceNumberHandler(e)}else if(t.key===this.Fs){const e=this.Js(t.newValue);await Promise.all(e.map((e=>this.syncEngine.Ys(e))))}}else this.ys.push(t)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Bs(e,t,n){const r=new Zo(this.currentUser,e,t,n),i=Jo(this.persistenceKey,this.currentUser,e);this.setItem(i,r.ds())}Ls(e){const t=Jo(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){const t={clientId:this.Vs,onlineState:e};this.storage.setItem(this.vs,JSON.stringify(t))}qs(e,t,n){const r=Xo(this.persistenceKey,e),i=new ea(e,t,n);this.setItem(r,i.ds())}Ks(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){const t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){const n=this.$s(e);return ta.Es(n,t)}Gs(e,t){const n=this.Ds.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Zo.Es(new f(i),r,t)}js(e,t){const n=this.Cs.exec(e),r=Number(n[1]);return ea.Es(r,t)}xs(e){return na.Es(e)}Js(e){return JSON.parse(e)}async zs(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Zs(e.batchId,e.state,e.error);v("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){const n=t?this.ps.insert(e,t):this.ps.remove(e),r=this.Ns(this.ps),i=this.Ns(n),s=[],o=[];return i.forEach((e=>{r.has(e)||s.push(e)})),r.forEach((e=>{i.has(e)||o.push(e)})),this.syncEngine.eo(s,o).then((()=>{this.ps=n}))}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=ir();return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class sa{constructor(){this.no=new ra,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new ra,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class oa{io(e){}shutdown(){}}class aa{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){v("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){v("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let ca=null;function ua(){return null===ca?ca=268435456+Math.round(2147483648*Math.random()):ca++,"0x"+ca.toString(16)}const la={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ha{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}}const da="WebChannelConnection";class fa extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.fo=t+"://"+e.host,this.po=`projects/${n}/databases/${r}`,this.yo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get wo(){return!1}So(e,t,n,r,i){const s=ua(),o=this.bo(e,t.toUriEncodedString());v("RestConnection",`Sending RPC '${e}' ${s}:`,o,n);const c={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(c,r,i),this.Co(e,o,c,n).then((t=>(v("RestConnection",`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw I("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t}))}vo(e,t,n,r,i,s){return this.So(e,t,n,r,i)}Do(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+m,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}bo(e,t){const n=la[e];return`${this.fo}/v1/${t}:${n}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,t,n,r){const i=ua();return new Promise(((s,o)=>{const c=new h.h;c.setWithCredentials(!0),c.listenOnce(h.c.COMPLETE,(()=>{try{switch(c.getLastErrorCode()){case h.a.NO_ERROR:const t=c.getResponseJson();v(da,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case h.a.TIMEOUT:v(da,`RPC '${e}' ${i} timed out`),o(new N(O.DEADLINE_EXCEEDED,"Request time out"));break;case h.a.HTTP_ERROR:const n=c.getStatus();if(v(da,`RPC '${e}' ${i} failed with status:`,n,"response text:",c.getResponseText()),n>0){let e=c.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(O).indexOf(t)>=0?t:O.UNKNOWN}(t.status);o(new N(e,t.message))}else o(new N(O.UNKNOWN,"Server responded with status "+c.getStatus()))}else o(new N(O.UNAVAILABLE,"Connection failed."));break;default:E()}}finally{v(da,`RPC '${e}' ${i} completed.`)}}));const a=JSON.stringify(r);v(da,`RPC '${e}' ${i} sending request:`,r),c.send(t,"POST",a,n,15)}))}Fo(e,t,n){const r=ua(),i=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=Object(h.i)(),o=Object(h.j)(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},a=this.longPollingOptions.timeoutSeconds;void 0!==a&&(c.longPollingTimeout=Math.round(1e3*a)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Do(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;const u=i.join("");v(da,`Creating RPC '${e}' stream ${r}: ${u}`,c);const l=s.createWebChannel(u,c);let d=!1,f=!1;const m=new ha({lo:t=>{f?v(da,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(d||(v(da,`Opening RPC '${e}' stream ${r} transport.`),l.open(),d=!0),v(da,`RPC '${e}' stream ${r} sending:`,t),l.send(t))},ho:()=>l.close()}),_=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return _(l,h.g.EventType.OPEN,(()=>{f||v(da,`RPC '${e}' stream ${r} transport opened.`)})),_(l,h.g.EventType.CLOSE,(()=>{f||(f=!0,v(da,`RPC '${e}' stream ${r} transport closed`),m.Vo())})),_(l,h.g.EventType.ERROR,(t=>{f||(f=!0,I(da,`RPC '${e}' stream ${r} transport errored:`,t),m.Vo(new N(O.UNAVAILABLE,"The operation could not be completed")))})),_(l,h.g.EventType.MESSAGE,(t=>{var n;if(!f){const i=t.data[0];C(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){v(da,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=zr[e];if(void 0!==t)return Kr(t)}(t),i=o.message;void 0===n&&(n=O.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),f=!0,m.Vo(new N(n,i)),l.close()}else v(da,`RPC '${e}' stream ${r} received:`,i),m.mo(i)}})),_(o,h.b.STAT_EVENT,(t=>{t.stat===h.f.PROXY?v(da,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===h.f.NOPROXY&&v(da,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{m.Ro()}),0),m}}function pa(){return"undefined"!=typeof window?window:null}function ga(){return"undefined"!=typeof document?document:null}function ma(e){return new fi(e,!0)}class _a{constructor(e,t,n=1e3,r=1.5,i=6e4){this.oi=e,this.timerId=t,this.Mo=n,this.xo=r,this.Oo=i,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();const t=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Lo),r=Math.max(0,t-n);r>0&&v("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.No} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Lo=Date.now(),e()))),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Bo&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){null!==this.Bo&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}}class ya{constructor(e,t,n,r,i,s,o,c){this.oi=e,this.$o=n,this.Uo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=c,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new _a(e,t)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,(()=>this.e_())))}t_(e){this.n_(),this.stream.send(e)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(e,t){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==e?this.jo.reset():t&&t.code===O.RESOURCE_EXHAUSTED?(w(t.toString()),w("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):t&&t.code===O.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.To(t)}i_(){}auth(){this.state=1;const e=this.s_(this.Wo),t=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Wo===t&&this.o_(e,n)}),(t=>{e((()=>{const e=new N(O.UNKNOWN,"Fetching auth token failed: "+t.message);return this.__(e)}))}))}o_(e,t){const n=this.s_(this.Wo);this.stream=this.a_(e,t),this.stream.Po((()=>{n((()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,(()=>(this.Jo()&&(this.state=3),Promise.resolve()))),this.listener.Po())))})),this.stream.To((e=>{n((()=>this.__(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Yo(){this.state=5,this.jo.qo((async()=>{this.state=0,this.start()}))}__(e){return v("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return t=>{this.oi.enqueueAndForget((()=>this.Wo===e?t():(v("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class va extends ya{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}a_(e,t){return this.connection.Fo("Listen",e,t)}onMessage(e){this.jo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:E()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(C(void 0===t||"string"==typeof t),pt.fromBase64String(t||"")):(C(void 0===t||t instanceof Uint8Array),pt.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,c=o&&function(e){const t=void 0===e.code?O.UNKNOWN:Kr(e.code);return new N(t,e.message||"")}(o);n=new ii(r,i,s,c||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=Ti(e,r.document.name),s=yi(r.document.updateTime),o=r.document.createTime?yi(r.document.createTime):K.min(),c=new Wt({mapValue:{fields:r.document.fields}}),a=$t.newFoundDocument(i,s,o,c),u=r.targetIds||[],l=r.removedTargetIds||[];n=new ni(u,l,a.key,a)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=Ti(e,r.document),s=r.readTime?yi(r.readTime):K.min(),o=$t.newNoDocument(i,s),c=r.removedTargetIds||[];n=new ni([],c,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=Ti(e,r.document),s=r.removedTargetIds||[];n=new ni([],s,i,null)}else{if(!("filter"in t))return E();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new Br(r,i),o=e.targetId;n=new ri(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return K.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?K.min():t.readTime?yi(t.readTime):K.min()}(e);return this.listener.u_(t,n)}c_(e){const t={};t.database=Si(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Tn(r)?{documents:xi(e,r)}:{query:Di(e,r).ut},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=mi(e,t.resumeToken);const r=pi(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(K.min())>0){n.readTime=gi(e,t.snapshotVersion.toTimestamp());const r=pi(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return E()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.t_(t)}l_(e){const t={};t.database=Si(this.serializer),t.removeTarget=e,this.t_(t)}}class wa extends ya{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,t){return this.connection.Fo("Write",e,t)}onMessage(e){if(C(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();const t=function(e,t){return e&&e.length>0?(C(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?yi(e.updateTime):yi(t);return n.isEqual(K.min())&&(n=yi(t)),new Tr(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=yi(e.commitTime);return this.listener.T_(n,t)}return C(!e.writeResults||0===e.writeResults.length),this.h_=!0,this.listener.E_()}d_(){const e={};e.database=Si(this.serializer),this.t_(e)}I_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>Ai(this.serializer,e)))};this.t_(t)}}class ba extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new N(O.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,n,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.So(e,wi(t,n),r,i,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===O.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new N(O.UNKNOWN,e.toString())}))}vo(e,t,n,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.vo(e,wi(t,n),r,s,o,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===O.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new N(O.UNKNOWN,e.toString())}))}terminate(){this.A_=!0,this.connection.terminate()}}class Ia{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve()))))}S_(e){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,"Online"===e&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(w(t),this.g_=!1):v("OnlineStateTracker",t)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class Ta{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=i,this.M_.io((e=>{n.enqueueAndForget((async()=>{xa(this)&&(v("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=k(e);t.v_.add(4),await Ca(t),t.x_.set("Unknown"),t.v_.delete(4),await Ea(t)}(this))}))})),this.x_=new Ia(n,r)}}async function Ea(e){if(xa(e))for(const t of e.F_)await t(!0)}async function Ca(e){for(const t of e.F_)await t(!1)}function Sa(e,t){const n=k(e);n.C_.has(t.targetId)||(n.C_.set(t.targetId,t),Ra(n)?Aa(n):Ya(n).Jo()&&Oa(n,t))}function ka(e,t){const n=k(e),r=Ya(n);n.C_.delete(t),r.Jo()&&Na(n,t),0===n.C_.size&&(r.Jo()?r.Xo():xa(n)&&n.x_.set("Unknown"))}function Oa(e,t){if(e.O_.Oe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(K.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Ya(e).c_(t)}function Na(e,t){e.O_.Oe(t),Ya(e).l_(t)}function Aa(e){e.O_=new oi({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),_t:t=>e.C_.get(t)||null,nt:()=>e.datastore.serializer.databaseId}),Ya(e).start(),e.x_.p_()}function Ra(e){return xa(e)&&!Ya(e).Ho()&&e.C_.size>0}function xa(e){return 0===k(e).v_.size}function Da(e){e.O_=void 0}async function Pa(e){e.C_.forEach(((t,n)=>{Oa(e,t)}))}async function La(e,t){Da(e),Ra(e)?(e.x_.S_(t),Aa(e)):e.x_.set("Unknown")}async function Ma(e,t,n){if(e.x_.set("Online"),t instanceof ii&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.C_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.C_.delete(r),e.O_.removeTarget(r))}(e,t)}catch(n){v("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await ja(e,n)}else if(t instanceof ni?e.O_.$e(t):t instanceof ri?e.O_.Je(t):e.O_.Ge(t),!n.isEqual(K.min()))try{const t=await Vo(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.O_.it(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.C_.get(r);i&&e.C_.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.C_.get(t);if(!r)return;e.C_.set(t,r.withResumeToken(pt.EMPTY_BYTE_STRING,r.snapshotVersion)),Na(e,t);const i=new Gi(r.target,t,n,r.sequenceNumber);Oa(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){v("RemoteStore","Failed to raise snapshot:",t),await ja(e,t)}}async function ja(e,t,n){if(!ge(t))throw t;e.v_.add(1),await Ca(e),e.x_.set("Offline"),n||(n=()=>Vo(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{v("RemoteStore","Retrying IndexedDB access"),await n(),e.v_.delete(1),await Ea(e)}))}function Fa(e,t){return t().catch((n=>ja(e,n,t)))}async function Ua(e){const t=k(e),n=Ja(t);let r=t.D_.length>0?t.D_[t.D_.length-1].batchId:-1;for(;Va(t);)try{const e=await Bo(t.localStore,r);if(null===e){0===t.D_.length&&n.Xo();break}r=e.batchId,qa(t,e)}catch(e){await ja(t,e)}Ba(t)&&za(t)}function Va(e){return xa(e)&&e.D_.length<10}function qa(e,t){e.D_.push(t);const n=Ja(e);n.Jo()&&n.P_&&n.I_(t.mutations)}function Ba(e){return xa(e)&&!Ja(e).Ho()&&e.D_.length>0}function za(e){Ja(e).start()}async function Ga(e){Ja(e).d_()}async function Wa(e){const t=Ja(e);for(const n of e.D_)t.I_(n.mutations)}async function Ka(e,t,n){const r=e.D_.shift(),i=Vr.from(r,t,n);await Fa(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await Ua(e)}async function $a(e,t){t&&Ja(e).P_&&await async function(e,t){if(function(e){return Wr(e)&&e!==O.ABORTED}(t.code)){const n=e.D_.shift();Ja(e).Zo(),await Fa(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Ua(e)}}(e,t),Ba(e)&&za(e)}async function Ha(e,t){const n=k(e);n.asyncQueue.verifyOperationInProgress(),v("RemoteStore","RemoteStore received new credentials");const r=xa(n);n.v_.add(3),await Ca(n),r&&n.x_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.v_.delete(3),await Ea(n)}async function Qa(e,t){const n=k(e);t?(n.v_.delete(2),await Ea(n)):t||(n.v_.add(2),await Ca(n),n.x_.set("Unknown"))}function Ya(e){return e.N_||(e.N_=function(e,t,n){const r=k(e);return r.R_(),new va(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:Pa.bind(null,e),To:La.bind(null,e),u_:Ma.bind(null,e)}),e.F_.push((async t=>{t?(e.N_.Zo(),Ra(e)?Aa(e):e.x_.set("Unknown")):(await e.N_.stop(),Da(e))}))),e.N_}function Ja(e){return e.B_||(e.B_=function(e,t,n){const r=k(e);return r.R_(),new wa(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:Ga.bind(null,e),To:$a.bind(null,e),E_:Wa.bind(null,e),T_:Ka.bind(null,e)}),e.F_.push((async t=>{t?(e.B_.Zo(),await Ua(e)):(await e.B_.stop(),e.D_.length>0&&(v("RemoteStore",`Stopping write stream with ${e.D_.length} pending writes`),e.D_=[]))}))),e.B_}class Xa{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new A,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new Xa(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new N(O.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Za(e,t){if(w("AsyncQueue",`${t}: ${e}`),ge(e))return new N(O.UNAVAILABLE,`${t}: ${e}`);throw e}class ec{constructor(e){this.comparator=e?(t,n)=>e(t,n)||J.comparator(t.key,n.key):(e,t)=>J.comparator(e.key,t.key),this.keyedMap=Hn(),this.sortedSet=new it(this.comparator)}static emptySet(e){return new ec(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ec))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new ec;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class tc{constructor(){this.L_=new it(J.comparator)}track(e){const t=e.doc.key,n=this.L_.get(t);n?0!==e.type&&3===n.type?this.L_=this.L_.insert(t,e):3===e.type&&1!==n.type?this.L_=this.L_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.L_=this.L_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.L_=this.L_.remove(t):1===e.type&&2===n.type?this.L_=this.L_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):E():this.L_=this.L_.insert(t,e)}k_(){const e=[];return this.L_.inorderTraversal(((t,n)=>{e.push(n)})),e}}class nc{constructor(e,t,n,r,i,s,o,c,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=c,this.hasCachedResults=a}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new nc(e,t,ec.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&jn(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class rc{constructor(){this.q_=void 0,this.Q_=[]}}class ic{constructor(){this.queries=new Gn((e=>Fn(e)),jn),this.onlineState="Unknown",this.K_=new Set}}async function sc(e,t){const n=k(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new rc),i)try{s.q_=await n.onListen(r)}catch(e){const n=Za(e,`Initialization of query '${Un(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.Q_.push(t),t.U_(n.onlineState),s.q_&&t.W_(s.q_)&&uc(n)}async function oc(e,t){const n=k(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.Q_.indexOf(t);e>=0&&(s.Q_.splice(e,1),i=0===s.Q_.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function ac(e,t){const n=k(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.Q_)t.W_(e)&&(r=!0);i.q_=e}}r&&uc(n)}function cc(e,t,n){const r=k(e),i=r.queries.get(t);if(i)for(const e of i.Q_)e.onError(n);r.queries.delete(t)}function uc(e){e.K_.forEach((e=>{e.next()}))}class lc{constructor(e,t,n){this.query=e,this.G_=t,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=n||{}}W_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new nc(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.z_?this.H_(e)&&(this.G_.next(e),t=!0):this.J_(e,this.onlineState)&&(this.Y_(e),t=!0),this.j_=e,t}onError(e){this.G_.error(e)}U_(e){this.onlineState=e;let t=!1;return this.j_&&!this.z_&&this.J_(this.j_,e)&&(this.Y_(this.j_),t=!0),t}J_(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Z_||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}H_(e){if(e.docChanges.length>0)return!0;const t=this.j_&&this.j_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Y_(e){e=nc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.z_=!0,this.G_.next(e)}}class hc{constructor(e,t){this.X_=e,this.byteLength=t}ea(){return"metadata"in this.X_}}class dc{constructor(e){this.serializer=e}Ps(e){return Ti(this.serializer,e)}Is(e){return e.metadata.exists?Ni(this.serializer,e.document,!1):$t.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return yi(e)}}class fc{constructor(e,t,n){this.ta=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=pc(e)}na(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.X_.namedQuery)this.queries.push(e.X_.namedQuery);else if(e.X_.documentMetadata){this.documents.push({metadata:e.X_.documentMetadata}),e.X_.documentMetadata.exists||++t;const n=H.fromString(e.X_.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.X_.document&&(this.documents[this.documents.length-1].document=e.X_.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ra(e){const t=new Map,n=new dc(this.serializer);for(const r of e)if(r.metadata.queries){const e=n.Ps(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||nr()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=k(e);let s=nr(),o=Kn();for(const e of n){const n=t.Ps(e.metadata.name);e.document&&(s=s.add(n));const r=t.Is(e);r.setReadTime(t.Ts(e.metadata.readTime)),o=o.insert(n,r)}const c=i.os.newChangeBuffer({trackRemovals:!0}),a=await zo(i,function(e){return Dn(Nn(H.fromString(`__bundle__/docs/${e}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",(e=>qo(e,c,o).next((t=>(c.apply(e),t))).next((t=>i.Qr.removeMatchingKeysForTargetId(e,a.targetId).next((()=>i.Qr.addMatchingKeys(e,s,a.targetId))).next((()=>i.localDocuments.getLocalViewOfDocuments(e,t.cs,t.ls))).next((()=>t.cs))))))}(this.localStore,new dc(this.serializer),this.documents,this.ta.id),t=this.ra(this.documents);for(const e of this.queries)await Qo(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,ia:this.collectionGroups,sa:e}}}function pc(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class gc{constructor(e){this.key=e}}class mc{constructor(e){this.key=e}}class _c{constructor(e,t){this.query=e,this.oa=t,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=nr(),this.mutatedKeys=nr(),this.ua=Bn(e),this.ca=new ec(this.ua)}get la(){return this.oa}ha(e,t){const n=t?t.Pa:new tc,r=t?t.ca:this.ca;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const c="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,a="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=Vn(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.Ia(u,l)||(n.track({type:2,doc:l}),f=!0,(c&&this.ua(l,c)>0||a&&this.ua(l,a)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(c||a)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{ca:s,Pa:n,Xi:o,mutatedKeys:i}}Ia(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.ca;this.ca=e.ca,this.mutatedKeys=e.mutatedKeys;const s=e.Pa.k_();s.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return E()}};return n(e)-n(t)}(e.type,t.type)||this.ua(e.doc,t.doc))),this.Ta(n),r=null!=r&&r;const o=t&&!r?this.Ea():[],c=0===this.aa.size&&this.current&&!r?1:0,a=c!==this._a;return this._a=c,0!==s.length||a?{snapshot:new nc(this.query,e.ca,i,s,e.mutatedKeys,0===c,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),da:o}:{da:o}}U_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new tc,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{da:[]}}Aa(e){return!this.oa.has(e)&&!!this.ca.has(e)&&!this.ca.get(e).hasLocalMutations}Ta(e){e&&(e.addedDocuments.forEach((e=>this.oa=this.oa.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.oa=this.oa.delete(e))),this.current=e.current)}Ea(){if(!this.current)return[];const e=this.aa;this.aa=nr(),this.ca.forEach((e=>{this.Aa(e.key)&&(this.aa=this.aa.add(e.key))}));const t=[];return e.forEach((e=>{this.aa.has(e)||t.push(new mc(e))})),this.aa.forEach((n=>{e.has(n)||t.push(new gc(n))})),t}Ra(e){this.oa=e.hs,this.aa=nr();const t=this.ha(e.documents);return this.applyChanges(t,!0)}Va(){return nc.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,0===this._a,this.hasCachedResults)}}class yc{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class vc{constructor(e){this.key=e,this.ma=!1}}class wc{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.fa={},this.ga=new Gn((e=>Fn(e)),jn),this.pa=new Map,this.ya=new Set,this.wa=new it(J.comparator),this.Sa=new Map,this.ba=new yo,this.Da={},this.Ca=new Map,this.va=Ks.Bn(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return!0===this.Fa}}async function bc(e,t){const n=$c(e);let r,i;const s=n.ga.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Va();else{const e=await zo(n.localStore,Dn(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await Ic(n,t,r,"current"===s,e.resumeToken),n.isPrimaryClient&&Sa(n.remoteStore,e)}return i}async function Ic(e,t,n,r,i){e.Ma=(t,n,r)=>async function(e,t,n,r){let i=t.view.ha(n);i.Xi&&(i=await Wo(e.localStore,t.query,!1).then((({documents:e})=>t.view.ha(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),c=t.view.applyChanges(i,e.isPrimaryClient,s,o);return Dc(e,t.targetId,c.da),c.snapshot}(e,t,n,r);const s=await Wo(e.localStore,t,!0),o=new _c(t,s.hs),c=o.ha(s.documents),a=ti.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(c,e.isPrimaryClient,a);Dc(e,n,u.da);const l=new yc(t,n,o);return e.ga.set(t,l),e.pa.has(n)?e.pa.get(n).push(t):e.pa.set(n,[t]),u.snapshot}async function Tc(e,t){const n=k(e),r=n.ga.get(t),i=n.pa.get(r.targetId);if(i.length>1)return n.pa.set(r.targetId,i.filter((e=>!jn(e,t)))),void n.ga.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Go(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),ka(n.remoteStore,r.targetId),Rc(n,r.targetId)})).catch(ue)):(Rc(n,r.targetId),await Go(n.localStore,r.targetId,!0))}async function Ec(e,t){const n=k(e);try{const e=await function(e,t){const n=k(e),r=t.snapshotVersion;let i=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;const o=[];t.targetChanges.forEach(((s,c)=>{const a=i.get(c);if(!a)return;o.push(n.Qr.removeMatchingKeys(e,s.removedDocuments,c).next((()=>n.Qr.addMatchingKeys(e,s.addedDocuments,c))));let u=a.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(c)?u=u.withResumeToken(pt.EMPTY_BYTE_STRING,K.min()).withLastLimboFreeSnapshotVersion(K.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(c,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,u,s)&&o.push(n.Qr.updateTargetData(e,u))}));let c=Kn(),a=nr();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(qo(e,s,t.documentUpdates).next((e=>{c=e.cs,a=e.ls}))),!r.isEqual(K.min())){const t=n.Qr.getLastRemoteSnapshotVersion(e).next((t=>n.Qr.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return le.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,c,a))).next((()=>c))})).then((e=>(n.ns=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Sa.get(t);r&&(C(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.ma=!0:e.modifiedDocuments.size>0?C(r.ma):e.removedDocuments.size>0&&(C(r.ma),r.ma=!1))})),await Mc(n,e,t)}catch(e){await ue(e)}}function Cc(e,t,n){const r=k(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.ga.forEach(((n,r)=>{const i=r.view.U_(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=k(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.Q_)e.U_(t)&&(r=!0)})),r&&uc(n)}(r.eventManager,t),e.length&&r.fa.u_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Sc(e,t,n){const r=k(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Sa.get(t),s=i&&i.key;if(s){let e=new it(J.comparator);e=e.insert(s,$t.newNoDocument(s,K.min()));const n=nr().add(s),i=new ei(K.min(),new Map,new it(B),e,n);await Ec(r,i),r.wa=r.wa.remove(s),r.Sa.delete(t),Lc(r)}else await Go(r.localStore,t,!1).then((()=>Rc(r,t,n))).catch(ue)}async function kc(e,t){const n=k(e),r=t.batch.batchId;try{const e=await function(e,t){const n=k(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.os.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=le.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);C(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=nr();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);Ac(n,r,null),Nc(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Mc(n,e)}catch(e){await ue(e)}}async function Oc(e,t,n){const r=k(e);try{const e=await function(e,t){const n=k(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(C(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);Ac(r,t,n),Nc(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Mc(r,e)}catch(n){await ue(n)}}function Nc(e,t){(e.Ca.get(t)||[]).forEach((e=>{e.resolve()})),e.Ca.delete(t)}function Ac(e,t,n){const r=k(e);let i=r.Da[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Da[r.currentUser.toKey()]=i}}function Rc(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.pa.get(t))e.ga.delete(r),n&&e.fa.xa(r,n);e.pa.delete(t),e.isPrimaryClient&&e.ba.Vr(t).forEach((t=>{e.ba.containsKey(t)||xc(e,t)}))}function xc(e,t){e.ya.delete(t.path.canonicalString());const n=e.wa.get(t);null!==n&&(ka(e.remoteStore,n),e.wa=e.wa.remove(t),e.Sa.delete(n),Lc(e))}function Dc(e,t,n){for(const r of n)r instanceof gc?(e.ba.addReference(r.key,t),Pc(e,r)):r instanceof mc?(v("SyncEngine","Document no longer in limbo: "+r.key),e.ba.removeReference(r.key,t),e.ba.containsKey(r.key)||xc(e,r.key)):E()}function Pc(e,t){const n=t.key,r=n.path.canonicalString();e.wa.get(n)||e.ya.has(r)||(v("SyncEngine","New document in limbo: "+n),e.ya.add(r),Lc(e))}function Lc(e){for(;e.ya.size>0&&e.wa.size<e.maxConcurrentLimboResolutions;){const t=e.ya.values().next().value;e.ya.delete(t);const n=new J(H.fromString(t)),r=e.va.next();e.Sa.set(r,new vc(n)),e.wa=e.wa.insert(n,r),Sa(e.remoteStore,new Gi(Dn(Nn(n.path)),r,"TargetPurposeLimboResolution",Ie._e))}}async function Mc(e,t,n){const r=k(e),i=[],s=[],o=[];r.ga.isEmpty()||(r.ga.forEach(((e,c)=>{o.push(r.Ma(c,t,n).then((e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(c.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=Po.Ki(c.targetId,e);s.push(t)}})))})),await Promise.all(o),r.fa.u_(i),await async function(e,t){const n=k(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>le.forEach(t,(t=>le.forEach(t.qi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>le.forEach(t.Qi,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!ge(e))throw e;v("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.ns.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(t,i)}}}(r.localStore,s))}async function jc(e,t){const n=k(e);if(!n.currentUser.isEqual(t)){v("SyncEngine","User change. New user:",t.toKey());const e=await Uo(n.localStore,t);n.currentUser=t,function(e,t){e.Ca.forEach((e=>{e.forEach((e=>{e.reject(new N(O.CANCELLED,t))}))})),e.Ca.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Mc(n,e.us)}}function Fc(e,t){const n=k(e),r=n.Sa.get(t);if(r&&r.ma)return nr().add(r.key);{let e=nr();const r=n.pa.get(t);if(!r)return e;for(const t of r){const r=n.ga.get(t);e=e.unionWith(r.view.la)}return e}}async function Uc(e,t){const n=k(e),r=await Wo(n.localStore,t.query,!0),i=t.view.Ra(r);return n.isPrimaryClient&&Dc(n,t.targetId,i.da),i}async function Vc(e,t){const n=k(e);return $o(n.localStore,t).then((e=>Mc(n,e)))}async function qc(e,t,n,r){const i=k(e),s=await function(e,t){const n=k(e),r=k(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>r.vn(e,t).next((t=>t?n.localDocuments.getDocuments(e,t):le.resolve(null)))))}(i.localStore,t);null!==s?("pending"===n?await Ua(i.remoteStore):"acknowledged"===n||"rejected"===n?(Ac(i,t,r||null),Nc(i,t),function(e,t){k(k(e).mutationQueue).Mn(t)}(i.localStore,t)):E(),await Mc(i,s)):v("SyncEngine","Cannot apply mutation batch with id: "+t)}async function Bc(e,t,n){const r=k(e),i=[],s=[];for(const e of t){let t;const n=r.pa.get(e);if(n&&0!==n.length){t=await zo(r.localStore,Dn(n[0]));for(const e of n){const t=r.ga.get(e),n=await Uc(r,t);n.snapshot&&s.push(n.snapshot)}}else{const n=await Ko(r.localStore,e);t=await zo(r.localStore,n),await Ic(r,zc(n),e,!1,t.resumeToken)}i.push(t)}return r.fa.u_(s),i}function zc(e){return On(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Gc(e){return function(e){return k(k(e).persistence).Li()}(k(e).localStore)}async function Wc(e,t,n,r){const i=k(e);if(i.Fa)return void v("SyncEngine","Ignoring unexpected query state notification.");const s=i.pa.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{const e=await $o(i.localStore,qn(s[0])),r=ei.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,pt.EMPTY_BYTE_STRING);await Mc(i,e,r);break}case"rejected":await Go(i.localStore,t,!0),Rc(i,t,r);break;default:E()}}async function Kc(e,t,n){const r=$c(e);if(r.Fa){for(const e of t){if(r.pa.has(e)){v("SyncEngine","Adding an already active target "+e);continue}const t=await Ko(r.localStore,e),n=await zo(r.localStore,t);await Ic(r,zc(t),n.targetId,!1,n.resumeToken),Sa(r.remoteStore,n)}for(const e of n)r.pa.has(e)&&await Go(r.localStore,e,!1).then((()=>{ka(r.remoteStore,e),Rc(r,e)})).catch(ue)}}function $c(e){const t=k(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Ec.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Fc.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Sc.bind(null,t),t.fa.u_=ac.bind(null,t.eventManager),t.fa.xa=cc.bind(null,t.eventManager),t}function Hc(e){const t=k(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=kc.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Oc.bind(null,t),t}class Qc{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=ma(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Fo(this.persistence,new Mo,e.initialUser,this.serializer)}createPersistence(e){return new Eo(So.Hr,this.serializer)}createSharedClientState(e){return new sa}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Yc extends Qc{constructor(e,t,n){super(),this.Na=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Na.initialize(this,e),await Hc(this.Na.syncEngine),await Ua(this.Na.remoteStore),await this.persistence.fi((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}createLocalStore(e){return Fo(this.persistence,new Mo,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new Zs(n,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new be(t,this.persistence);return new we(e.asyncQueue,n)}createPersistence(e){const t=Do(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Fs.withCacheSize(this.cacheSizeBytes):Fs.DEFAULT;return new Ao(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,pa(),ga(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new sa}}class Jc extends Yc{constructor(e,t){super(e,t,!1),this.Na=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Na.syncEngine;this.sharedClientState instanceof ia&&(this.sharedClientState.syncEngine={Zs:qc.bind(null,t),Xs:Wc.bind(null,t),eo:Kc.bind(null,t),Li:Gc.bind(null,t),Ys:Vc.bind(null,t)},await this.sharedClientState.start()),await this.persistence.fi((async e=>{await async function(e,t){const n=k(e);if($c(n),Hc(n),!0===t&&!0!==n.Fa){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await Bc(n,e.toArray());n.Fa=!0,await Qa(n.remoteStore,!0);for(const e of t)Sa(n.remoteStore,e)}else if(!1===t&&!1!==n.Fa){const e=[];let t=Promise.resolve();n.pa.forEach(((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then((()=>(Rc(n,i),Go(n.localStore,i,!0)))),ka(n.remoteStore,i)})),await t,await Bc(n,e),function(e){const t=k(e);t.Sa.forEach(((e,n)=>{ka(t.remoteStore,n)})),t.ba.mr(),t.Sa=new Map,t.wa=new it(J.comparator)}(n),n.Fa=!1,await Qa(n.remoteStore,!1)}}(this.Na.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())}))}createSharedClientState(e){const t=pa();if(!ia.D(t))throw new N(O.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Do(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new ia(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Xc{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Cc(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=jc.bind(null,this.syncEngine),await Qa(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new ic}createDatastore(e){const t=ma(e.databaseInfo.databaseId),n=function(e){return new fa(e)}(e.databaseInfo);return function(e,t,n,r){return new ba(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new Ta(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(e=>Cc(this.syncEngine,e,0)),aa.D()?new aa:new oa)}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const c=new wc(e,t,n,r,i,s);return o&&(c.Fa=!0),c}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e;await async function(e){const t=k(e);v("RemoteStore","RemoteStore shutting down."),t.v_.add(5),await Ca(t),t.M_.shutdown(),t.x_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate()}}function Zc(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class eu{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ba(this.observer.next,e)}error(e){this.observer.error?this.Ba(this.observer.error,e):w("Uncaught Error in snapshot listener:",e.toString())}La(){this.muted=!0}Ba(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class tu{constructor(e,t){this.ka=e,this.serializer=t,this.metadata=new A,this.buffer=new Uint8Array,this.qa=new TextDecoder("utf-8"),this.Qa().then((e=>{e&&e.ea()?this.metadata.resolve(e.X_.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.X_)}`))}),(e=>this.metadata.reject(e)))}close(){return this.ka.cancel()}async getMetadata(){return this.metadata.promise}async Oa(){return await this.getMetadata(),this.Qa()}async Qa(){const e=await this.Ka();if(null===e)return null;const t=this.qa.decode(e),n=Number(t);isNaN(n)&&this.$a(`length string (${t}) is not valid number`);const r=await this.Ua(n);return new hc(JSON.parse(r),e.length+n)}Wa(){return this.buffer.findIndex((e=>e==="{".charCodeAt(0)))}async Ka(){for(;this.Wa()<0&&!await this.Ga(););if(0===this.buffer.length)return null;const e=this.Wa();e<0&&this.$a("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Ua(e){for(;this.buffer.length<e;)await this.Ga()&&this.$a("Reached the end of bundle when more is expected.");const t=this.qa.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}$a(e){throw this.ka.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ga(){const e=await this.ka.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class nu{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new N(O.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(e,t){const n=k(e),r={documents:t.map((e=>Ii(n.serializer,e)))},i=await n.vo("BatchGetDocuments",n.serializer.databaseId,H.emptyPath(),r,t.length),s=new Map;i.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){C(!!t.found),t.found.name,t.found.updateTime;const n=Ti(e,t.found.name),r=yi(t.found.updateTime),i=t.found.createTime?yi(t.found.createTime):K.min(),s=new Wt({mapValue:{fields:t.found.fields}});return $t.newFoundDocument(n,r,i,s)}(e,t):"missing"in t?function(e,t){C(!!t.missing),C(!!t.readTime);const n=Ti(e,t.missing),r=yi(t.readTime);return $t.newNoDocument(n,r)}(e,t):E()}(n.serializer,e);s.set(t.key.toString(),t)}));const o=[];return t.forEach((e=>{const t=s.get(e.toString());C(!!t),o.push(t)})),o}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new jr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=J.fromPath(t);this.mutations.push(new Fr(n,this.precondition(n)))})),await async function(e,t){const n=k(e),r={writes:t.map((e=>Ai(n.serializer,e)))};await n.So("Commit",n.serializer.databaseId,H.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw E();t=K.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new N(O.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(K.min())?Er.exists(!1):Er.updateTime(t):Er.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(K.min()))throw new N(O.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Er.updateTime(t)}return Er.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class ru{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.za=n.maxAttempts,this.jo=new _a(this.asyncQueue,"transaction_retry")}ja(){this.za-=1,this.Ha()}Ha(){this.jo.qo((async()=>{const e=new nu(this.datastore),t=this.Ja(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.Ya(e)}))))})).catch((e=>{this.Ya(e)}))}))}Ja(e){try{const t=this.updateFunction(e);return!Te(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Ya(e){this.za>0&&this.Za(e)?(this.za-=1,this.asyncQueue.enqueueAndForget((()=>(this.Ha(),Promise.resolve())))):this.deferred.reject(e)}Za(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Wr(t)}return!1}}class iu{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=f.UNAUTHENTICATED,this.clientId=V.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{v("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(v("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new N(O.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new A;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Za(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function su(e,t){e.asyncQueue.verifyOperationInProgress(),v("FirestoreClient","Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await Uo(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function ou(e,t){e.asyncQueue.verifyOperationInProgress();const n=await cu(e);v("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>Ha(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Ha(t.remoteStore,n))),e._onlineComponents=t}function au(e){return"FirebaseError"===e.name?e.code===O.FAILED_PRECONDITION||e.code===O.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function cu(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){v("FirestoreClient","Using user provided OfflineComponentProvider");try{await su(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!au(n))throw n;I("Error using user provided cache. Falling back to memory cache: "+n),await su(e,new Qc)}}else v("FirestoreClient","Using default OfflineComponentProvider"),await su(e,new Qc);return e._offlineComponents}async function uu(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(v("FirestoreClient","Using user provided OnlineComponentProvider"),await ou(e,e._uninitializedComponentsProvider._online)):(v("FirestoreClient","Using default OnlineComponentProvider"),await ou(e,new Xc))),e._onlineComponents}function lu(e){return cu(e).then((e=>e.persistence))}function hu(e){return cu(e).then((e=>e.localStore))}function du(e){return uu(e).then((e=>e.remoteStore))}function fu(e){return uu(e).then((e=>e.syncEngine))}function pu(e){return uu(e).then((e=>e.datastore))}async function gu(e){const t=await uu(e),n=t.eventManager;return n.onListen=bc.bind(null,t.syncEngine),n.onUnlisten=Tc.bind(null,t.syncEngine),n}function mu(e,t,n={}){const r=new A;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new eu({next:s=>{t.enqueueAndForget((()=>oc(e,o)));const c=s.docs.has(n);!c&&s.fromCache?i.reject(new N(O.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&s.fromCache&&r&&"server"===r.source?i.reject(new N(O.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new lc(Nn(n.path),s,{includeMetadataChanges:!0,Z_:!0});return sc(e,o)}(await gu(e),e.asyncQueue,t,n,r))),r.promise}function _u(e,t,n={}){const r=new A;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new eu({next:n=>{t.enqueueAndForget((()=>oc(e,o))),n.fromCache&&"server"===r.source?i.reject(new N(O.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new lc(n,s,{includeMetadataChanges:!0,Z_:!0});return sc(e,o)}(await gu(e),e.asyncQueue,t,n,r))),r.promise}function yu(e,t,n,r){const i=function(e,t){let n;return n="string"==typeof e?Hr().encode(e):e,function(e,t){return new tu(e,t)}(function(e,t){if(e instanceof Uint8Array)return Zc(e,t);if(e instanceof ArrayBuffer)return Zc(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,ma(t));e.asyncQueue.enqueueAndForget((async()=>{!function(e,t,n){const r=k(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=k(e),r=yi(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(e=>n.$r.getBundleMetadata(e,t.id))).then((e=>!!e&&e.createTime.compareTo(r)>=0))}(e.localStore,r))return await t.close(),n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(pc(r));const i=new fc(r,e.localStore,t.serializer);let s=await t.Oa();for(;s;){const e=await i.na(s);e&&n._updateProgress(e),s=await t.Oa()}const o=await i.complete();return await Mc(e,o.sa,void 0),await function(e,t){const n=k(e);return n.persistence.runTransaction("Save bundle","readwrite",(e=>n.$r.saveBundleMetadata(e,t)))}(e.localStore,r),n._completeWith(o.progress),Promise.resolve(o.ia)}catch(e){return I("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(r,t,n).then((e=>{r.sharedClientState.notifyBundleLoaded(e)}))}(await fu(e),i,r)}))}function vu(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const wu=new Map;function bu(e,t,n){if(!n)throw new N(O.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Iu(e,t,n,r){if(!0===t&&!0===r)throw new N(O.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Tu(e){if(!J.isDocumentKey(e))throw new N(O.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Eu(e){if(J.isDocumentKey(e))throw new N(O.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Cu(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":E()}function Su(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new N(O.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Cu(e);throw new N(O.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function ku(e,t){if(t<=0)throw new N(O.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class Ou{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new N(O.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new N(O.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Iu("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=vu(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new N(O.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new N(O.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new N(O.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Nu{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ou({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new N(O.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new N(O.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ou(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new x;switch(e.type){case"firstParty":return new M(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new N(O.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=wu.get(e);t&&(v("ComponentProvider","Removing Datastore"),wu.delete(e),t.terminate())}(this),Promise.resolve()}}function Au(e,t,n,r={}){var i;const s=(e=Su(e,Nu))._getSettings(),o=`${t}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&I("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=f.MOCK_USER;else{t=Object(l.l)(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new N(O.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new f(s)}e._authCredentials=new D(new R(t,n))}}class Ru{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Ru(this.firestore,e,this._query)}}class xu{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Du(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new xu(this.firestore,e,this._key)}}class Du extends Ru{constructor(e,t,n){super(e,t,Nn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new xu(this.firestore,null,new J(e))}withConverter(e){return new Du(this.firestore,e,this._path)}}function Pu(e,t,...n){if(e=Object(l.w)(e),bu("collection","path",t),e instanceof Nu){const r=H.fromString(t,...n);return Eu(r),new Du(e,null,r)}{if(!(e instanceof xu||e instanceof Du))throw new N(O.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(H.fromString(t,...n));return Eu(r),new Du(e.firestore,null,r)}}function Lu(e,t){if(e=Su(e,Nu),bu("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new N(O.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ru(e,null,function(e){return new kn(H.emptyPath(),e)}(t))}function Mu(e,t,...n){if(e=Object(l.w)(e),1===arguments.length&&(t=V.newId()),bu("doc","path",t),e instanceof Nu){const r=H.fromString(t,...n);return Tu(r),new xu(e,null,new J(r))}{if(!(e instanceof xu||e instanceof Du))throw new N(O.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(H.fromString(t,...n));return Tu(r),new xu(e.firestore,e instanceof Du?e.converter:null,new J(r))}}function ju(e,t){return e=Object(l.w)(e),t=Object(l.w)(t),(e instanceof xu||e instanceof Du)&&(t instanceof xu||t instanceof Du)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function Fu(e,t){return e=Object(l.w)(e),t=Object(l.w)(t),e instanceof Ru&&t instanceof Ru&&e.firestore===t.firestore&&jn(e._query,t._query)&&e.converter===t.converter}class Uu{constructor(){this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new _a(this,"async_queue_retry"),this._u=()=>{const e=ga();e&&v("AsyncQueue","Visibility state changed to "+e.visibilityState),this.jo.Ko()};const e=ga();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this._u)}get isShuttingDown(){return this.tu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.au(),this.uu(e)}enterRestrictedMode(e){if(!this.tu){this.tu=!0,this.su=e||!1;const t=ga();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._u)}}enqueue(e){if(this.au(),this.tu)return new Promise((()=>{}));const t=new A;return this.uu((()=>this.tu&&this.su?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.eu.push(e),this.cu())))}async cu(){if(0!==this.eu.length){try{await this.eu[0](),this.eu.shift(),this.jo.reset()}catch(e){if(!ge(e))throw e;v("AsyncQueue","Operation failed with retryable error: "+e)}this.eu.length>0&&this.jo.qo((()=>this.cu()))}}uu(e){const t=this.Xa.then((()=>(this.iu=!0,e().catch((e=>{this.ru=e,this.iu=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw w("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.iu=!1,e))))));return this.Xa=t,t}enqueueAfterDelay(e,t,n){this.au(),this.ou.indexOf(e)>-1&&(t=0);const r=Xa.createAndSchedule(this,e,t,n,(e=>this.lu(e)));return this.nu.push(r),r}au(){this.ru&&E()}verifyOperationInProgress(){}async hu(){let e;do{e=this.Xa,await e}while(e!==this.Xa)}Pu(e){for(const t of this.nu)if(t.timerId===e)return!0;return!1}Iu(e){return this.hu().then((()=>{this.nu.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.nu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.hu()}))}Tu(e){this.ou.push(e)}lu(e){const t=this.nu.indexOf(e);this.nu.splice(t,1)}}function Vu(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of t)if(e in n&&"function"==typeof n[e])return!0;return!1}(e,["next","error","complete"])}class qu{constructor(){this._progressObserver={},this._taskCompletionResolver=new A,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}const Bu=-1;class zu extends Nu{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Uu,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Wu(this),this._firestoreClient.terminate()}}function Gu(e){return e._firestoreClient||Wu(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Wu(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new It(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,vu(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new iu(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function Ku(e,t){tl(e=Su(e,zu));const n=Gu(e);if(n._uninitializedComponentsProvider)throw new N(O.FAILED_PRECONDITION,"SDK cache is already specified.");I("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=e._freezeSettings(),i=new Xc;return Hu(n,i,new Yc(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}function $u(e){tl(e=Su(e,zu));const t=Gu(e);if(t._uninitializedComponentsProvider)throw new N(O.FAILED_PRECONDITION,"SDK cache is already specified.");I("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=e._freezeSettings(),r=new Xc;return Hu(t,r,new Jc(r,n.cacheSizeBytes))}function Hu(e,t,n){const r=new A;return e.asyncQueue.enqueue((async()=>{try{await su(e,n),await ou(e,t),r.resolve()}catch(e){const t=e;if(!au(t))throw t;I("Error enabling indexeddb cache. Falling back to memory cache: "+t),r.reject(t)}})).then((()=>r.promise))}function Qu(e){if(e._initialized&&!e._terminated)throw new N(O.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new A;return e._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(e){if(!de.D())return Promise.resolve();const t=e+"main";await de.delete(t)}(Do(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function Yu(e){return function(e){const t=new A;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t){const n=k(e);xa(n.remoteStore)||v("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=k(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e)))}(n.localStore);if(-1===e)return void t.resolve();const r=n.Ca.get(e)||[];r.push(t),n.Ca.set(e,r)}catch(e){const n=Za(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await fu(e),t))),t.promise}(Gu(e=Su(e,zu)))}function Ju(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await lu(e),n=await du(e);return t.setNetworkEnabled(!0),function(e){const t=k(e);return t.v_.delete(0),Ea(t)}(n)}))}(Gu(e=Su(e,zu)))}function Xu(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await lu(e),n=await du(e);return t.setNetworkEnabled(!1),async function(e){const t=k(e);t.v_.add(0),await Ca(t),t.x_.set("Offline")}(n)}))}(Gu(e=Su(e,zu)))}function Zu(e,t){const n=Gu(e=Su(e,zu)),r=new qu;return yu(n,e._databaseId,t,r),r}function el(e,t){return function(e,t){return e.asyncQueue.enqueue((async()=>function(e,t){const n=k(e);return n.persistence.runTransaction("Get named query","readonly",(e=>n.$r.getNamedQuery(e,t)))}(await hu(e),t)))}(Gu(e=Su(e,zu)),t).then((t=>t?new Ru(e,null,t.query):null))}function tl(e){if(e._initialized||e._terminated)throw new N(O.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class nl{constructor(e){this._byteString=e}static fromBase64String(e){try{return new nl(pt.fromBase64String(e))}catch(e){throw new N(O.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new nl(pt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class rl{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new N(O.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Y(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class il{constructor(e){this._methodName=e}}class sl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new N(O.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new N(O.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return B(this._lat,e._lat)||B(this._long,e._long)}}const al=/^__.*__$/;class cl{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Dr(e,this.data,this.fieldMask,t,this.fieldTransforms):new xr(e,this.data,t,this.fieldTransforms)}}class ll{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Dr(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function hl(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw E()}}class fl{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Eu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get du(){return this.settings.du}Au(e){return new fl(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ru(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Au({path:n,Vu:!1});return r.mu(e),r}fu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Au({path:n,Vu:!1});return r.Eu(),r}gu(e){return this.Au({path:void 0,Vu:!0})}pu(e){return Dl(e,this.settings.methodName,this.settings.yu||!1,this.path,this.settings.wu)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}Eu(){if(this.path)for(let e=0;e<this.path.length;e++)this.mu(this.path.get(e))}mu(e){if(0===e.length)throw this.pu("Document fields must not be empty");if(hl(this.du)&&al.test(e))throw this.pu('Document fields cannot begin and end with "__"')}}class pl{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||ma(e)}Su(e,t,n,r=!1){return new fl({du:e,methodName:t,wu:n,path:Y.emptyPath(),Vu:!1,yu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function gl(e){const t=e._freezeSettings(),n=ma(e._databaseId);return new pl(e._databaseId,!!t.ignoreUndefinedProperties,n)}function ml(e,t,n,r,i,s={}){const o=e.Su(s.merge||s.mergeFields?2:0,t,n,i);Nl("Data must be an object, but it was:",o,r);const c=kl(r,o);let a,u;if(s.merge)a=new lt(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=Al(t,r,n);if(!o.contains(i))throw new N(O.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Pl(e,i)||e.push(i)}a=new lt(e),u=o.fieldTransforms.filter((e=>a.covers(e.field)))}else a=null,u=o.fieldTransforms;return new cl(new Wt(c),a,u)}class _l extends il{_toFieldTransform(e){if(2!==e.du)throw 1===e.du?e.pu(`${this._methodName}() can only appear at the top level of your update data`):e.pu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof _l}}function yl(e,t,n){return new fl({du:3,wu:t.settings.wu,methodName:e._methodName,Vu:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class vl extends il{_toFieldTransform(e){return new Ir(e.path,new fr)}isEqual(e){return e instanceof vl}}class wl extends il{constructor(e,t){super(e),this.bu=t}_toFieldTransform(e){const t=yl(this,e,!0),n=this.bu.map((e=>Sl(e,t))),r=new pr(n);return new Ir(e.path,r)}isEqual(e){return e instanceof wl&&Object(l.o)(this.bu,e.bu)}}class bl extends il{constructor(e,t){super(e),this.bu=t}_toFieldTransform(e){const t=yl(this,e,!0),n=this.bu.map((e=>Sl(e,t))),r=new mr(n);return new Ir(e.path,r)}isEqual(e){return e instanceof bl&&Object(l.o)(this.bu,e.bu)}}class Il extends il{constructor(e,t){super(e),this.Du=t}_toFieldTransform(e){const t=new yr(e.serializer,ar(e.serializer,this.Du));return new Ir(e.path,t)}isEqual(e){return e instanceof Il&&this.Du===e.Du}}function Tl(e,t,n,r){const i=e.Su(1,t,n);Nl("Data must be an object, but it was:",i,r);const s=[],o=Wt.empty();tt(r,((e,r)=>{const c=xl(t,e,n);r=Object(l.w)(r);const a=i.fu(c);if(r instanceof _l)s.push(c);else{const e=Sl(r,a);null!=e&&(s.push(c),o.set(c,e))}}));const c=new lt(s);return new ll(o,c,i.fieldTransforms)}function El(e,t,n,r,i,s){const o=e.Su(1,t,n),c=[Al(t,r,n)],a=[i];if(s.length%2!=0)throw new N(O.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)c.push(Al(t,s[e])),a.push(s[e+1]);const u=[],h=Wt.empty();for(let e=c.length-1;e>=0;--e)if(!Pl(u,c[e])){const t=c[e];let n=a[e];n=Object(l.w)(n);const r=o.fu(t);if(n instanceof _l)u.push(t);else{const e=Sl(n,r);null!=e&&(u.push(t),h.set(t,e))}}const d=new lt(u);return new ll(h,d,o.fieldTransforms)}function Cl(e,t,n,r=!1){return Sl(n,e.Su(r?4:3,t))}function Sl(e,t){if(Ol(e=Object(l.w)(e)))return Nl("Unsupported field value:",t,e),kl(e,t);if(e instanceof il)return function(e,t){if(!hl(t.du))throw t.pu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.pu(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Vu&&4!==t.du)throw t.pu("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Sl(i,t.gu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=Object(l.w)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return ar(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=W.fromDate(e);return{timestampValue:gi(t.serializer,n)}}if(e instanceof W){const n=new W(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:gi(t.serializer,n)}}if(e instanceof sl)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof nl)return{bytesValue:mi(t.serializer,e._byteString)};if(e instanceof xu){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.pu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:vi(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.pu(`Unsupported field value: ${Cu(e)}`)}(e,t)}function kl(e,t){const n={};return nt(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):tt(e,((e,r)=>{const i=Sl(r,t.Ru(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function Ol(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof W||e instanceof sl||e instanceof nl||e instanceof xu||e instanceof il)}function Nl(e,t,n){if(!Ol(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Cu(n);throw"an object"===r?t.pu(e+" a custom object"):t.pu(e+" "+r)}}function Al(e,t,n){if((t=Object(l.w)(t))instanceof rl)return t._internalPath;if("string"==typeof t)return xl(e,t);throw Dl("Field path arguments must be of type string or ",e,!1,void 0,n)}const Rl=new RegExp("[~\\*/\\[\\]]");function xl(e,t,n){if(t.search(Rl)>=0)throw Dl(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new rl(...t.split("."))._internalPath}catch(r){throw Dl(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Dl(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let c=`Function ${t}() called with invalid data`;n&&(c+=" (via `toFirestore()`)"),c+=". ";let a="";return(s||o)&&(a+=" (found",s&&(a+=` in field ${r}`),o&&(a+=` in document ${i}`),a+=")"),new N(O.INVALID_ARGUMENT,c+e+a)}function Pl(e,t){return e.some((e=>e.isEqual(t)))}class Ll{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new xu(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Ml(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(jl("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Ml extends Ll{data(){return super.data()}}function jl(e,t){return"string"==typeof t?xl(e,t):t instanceof rl?t._internalPath:t._delegate._internalPath}function Fl(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new N(O.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Ul{}class Vl extends Ul{}function ql(e,t,...n){let r=[];t instanceof Ul&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof Gl)).length,n=e.filter((e=>e instanceof Bl)).length;if(t>1||t>0&&n>0)throw new N(O.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class Bl extends Vl{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Bl(e,t,n)}_apply(e){const t=this._parse(e);return oh(e._query,t),new Ru(e.firestore,e.converter,Ln(e._query,t))}_parse(e){const t=gl(e.firestore),n=function(e,t,n,r,i,s,o){let c;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new N(O.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){sh(o,s);const t=[];for(const n of o)t.push(ih(r,e,n));c={arrayValue:{values:t}}}else c=ih(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||sh(o,s),c=Cl(n,t,o,"in"===s||"not-in"===s);return en.create(i,s,c)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function zl(e,t,n){const r=t,i=jl("where",e);return Bl._create(i,r,n)}class Gl extends Ul{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Gl(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:tn.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)oh(n,e),n=Ln(n,e)}(e._query,t),new Ru(e.firestore,e.converter,Ln(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Wl extends Vl{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Wl(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new N(O.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new N(O.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Jt(t,n)}(e._query,this._field,this._direction);return new Ru(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new kn(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function Kl(e,t="asc"){const n=t,r=jl("orderBy",e);return Wl._create(r,n)}class $l extends Vl{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new $l(e,t,n)}_apply(e){return new Ru(e.firestore,e.converter,Mn(e._query,this._limit,this._limitType))}}function Hl(e){return ku("limit",e),$l._create("limit",e,"F")}function Ql(e){return ku("limitToLast",e),$l._create("limitToLast",e,"L")}class Yl extends Vl{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Yl(e,t,n)}_apply(e){const t=rh(e,this.type,this._docOrFields,this._inclusive);return new Ru(e.firestore,e.converter,function(e,t){return new kn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}function Jl(...e){return Yl._create("startAt",e,!0)}function Xl(...e){return Yl._create("startAfter",e,!1)}class Zl extends Vl{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Zl(e,t,n)}_apply(e){const t=rh(e,this.type,this._docOrFields,this._inclusive);return new Ru(e.firestore,e.converter,function(e,t){return new kn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function eh(...e){return Zl._create("endBefore",e,!1)}function nh(...e){return Zl._create("endAt",e,!0)}function rh(e,t,n,r){if(n[0]=Object(l.w)(n[0]),n[0]instanceof Ll)return function(e,t,n,r,i){if(!r)throw new N(O.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of xn(e))if(n.field.isKeyField())s.push(Dt(t,r.key));else{const e=r.data.field(n.field);if(vt(e))throw new N(O.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new N(O.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new Ht(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=gl(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new N(O.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const c=[];for(let s=0;s<i.length;s++){const a=i[s];if(o[s].field.isKeyField()){if("string"!=typeof a)throw new N(O.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof a}`);if(!Rn(e)&&-1!==a.indexOf("/"))throw new N(O.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${a}' contains a slash.`);const n=e.path.child(H.fromString(a));if(!J.isDocumentKey(n))throw new N(O.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new J(n);c.push(Dt(t,i))}else{const e=Cl(n,r,a);c.push(e)}}return new Ht(c,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function ih(e,t,n){if("string"==typeof(n=Object(l.w)(n))){if(""===n)throw new N(O.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Rn(t)&&-1!==n.indexOf("/"))throw new N(O.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(H.fromString(n));if(!J.isDocumentKey(r))throw new N(O.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Dt(e,new J(r))}if(n instanceof xu)return Dt(e,n._key);throw new N(O.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Cu(n)}.`)}function sh(e,t){if(!Array.isArray(e)||0===e.length)throw new N(O.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function oh(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new N(O.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new N(O.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class ah{convertValue(e,t="none"){switch(St(e)){case 0:return null;case 1:return e.booleanValue;case 2:return _t(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(yt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw E()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return tt(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new sl(_t(e.latitude),_t(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=wt(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(bt(e));default:return null}}convertTimestamp(e){const t=mt(e);return new W(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=H.fromString(e);C(zi(n));const r=new Tt(n.get(1),n.get(3)),i=new J(n.popFirst(5));return r.isEqual(t)||w(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function ch(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class uh extends ah{constructor(e){super(),this.firestore=e}convertBytes(e){return new nl(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new xu(this.firestore,null,t)}}class lh{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class hh extends Ll{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new dh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(jl("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class dh extends hh{data(e={}){return super.data(e)}}class fh{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new lh(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new dh(this._firestore,this._userDataWriter,n.key,n,new lh(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new N(O.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new dh(e._firestore,e._userDataWriter,n.doc.key,n.doc,new lh(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new dh(e._firestore,e._userDataWriter,t.doc.key,t.doc,new lh(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:ph(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function ph(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return E()}}function gh(e,t){return e instanceof hh&&t instanceof hh?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof fh&&t instanceof fh&&e._firestore===t._firestore&&Fu(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function mh(e){e=Su(e,xu);const t=Su(e.firestore,zu);return mu(Gu(t),e._key).then((n=>Ah(t,e,n)))}class _h extends ah{constructor(e){super(),this.firestore=e}convertBytes(e){return new nl(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new xu(this.firestore,null,t)}}function yh(e){e=Su(e,xu);const t=Su(e.firestore,zu),n=Gu(t),r=new _h(t);return function(e,t){const n=new A;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await function(e,t){const n=k(e);return n.persistence.runTransaction("read document","readonly",(e=>n.localDocuments.getDocument(e,t)))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new N(O.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=Za(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await hu(e),t,n))),n.promise}(n,e._key).then((n=>new hh(t,r,e._key,n,new lh(null!==n&&n.hasLocalMutations,!0),e.converter)))}function vh(e){e=Su(e,xu);const t=Su(e.firestore,zu);return mu(Gu(t),e._key,{source:"server"}).then((n=>Ah(t,e,n)))}function wh(e){e=Su(e,Ru);const t=Su(e.firestore,zu),n=Gu(t),r=new _h(t);return Fl(e._query),_u(n,e._query).then((n=>new fh(t,r,e,n)))}function bh(e){e=Su(e,Ru);const t=Su(e.firestore,zu),n=Gu(t),r=new _h(t);return function(e,t){const n=new A;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await Wo(e,t,!0),i=new _c(t,r.hs),s=i.ha(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){const r=Za(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await hu(e),t,n))),n.promise}(n,e._query).then((n=>new fh(t,r,e,n)))}function Ih(e){e=Su(e,Ru);const t=Su(e.firestore,zu),n=Gu(t),r=new _h(t);return _u(n,e._query,{source:"server"}).then((n=>new fh(t,r,e,n)))}function Th(e,t,n){e=Su(e,xu);const r=Su(e.firestore,zu),i=ch(e.converter,t,n);return Nh(r,[ml(gl(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Er.none())])}function Eh(e,t,n,...r){e=Su(e,xu);const i=Su(e.firestore,zu),s=gl(i);let o;return o="string"==typeof(t=Object(l.w)(t))||t instanceof rl?El(s,"updateDoc",e._key,t,n,r):Tl(s,"updateDoc",e._key,t),Nh(i,[o.toMutation(e._key,Er.exists(!0))])}function Ch(e){return Nh(Su(e.firestore,zu),[new jr(e._key,Er.none())])}function Sh(e,t){const n=Su(e.firestore,zu),r=Mu(e),i=ch(e.converter,t);return Nh(n,[ml(gl(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Er.exists(!1))]).then((()=>r))}function kh(e,...t){var n,r,i;e=Object(l.w)(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||Vu(t[o])||(s=t[o],o++);const c={includeMetadataChanges:s.includeMetadataChanges};if(Vu(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let a,u,h;if(e instanceof xu)u=Su(e.firestore,zu),h=Nn(e._key.path),a={next:n=>{t[o]&&t[o](Ah(u,e,n))},error:t[o+1],complete:t[o+2]};else{const n=Su(e,Ru);u=Su(n.firestore,zu),h=n._query;const r=new _h(u);a={next:e=>{t[o]&&t[o](new fh(u,r,n,e))},error:t[o+1],complete:t[o+2]},Fl(e._query)}return function(e,t,n,r){const i=new eu(r),s=new lc(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>sc(await gu(e),s))),()=>{i.La(),e.asyncQueue.enqueueAndForget((async()=>oc(await gu(e),s)))}}(Gu(u),h,c,a)}function Oh(e,t){return function(e,t){const n=new eu(t);return e.asyncQueue.enqueueAndForget((async()=>function(e,t){k(e).K_.add(t),t.next()}(await gu(e),n))),()=>{n.La(),e.asyncQueue.enqueueAndForget((async()=>function(e,t){k(e).K_.delete(t)}(await gu(e),n)))}}(Gu(e=Su(e,zu)),Vu(t)?t:{next:t})}function Nh(e,t){return function(e,t){const n=new A;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=Hc(e);try{const e=await function(e,t){const n=k(e),r=W.now(),i=t.reduce(((e,t)=>e.add(t.key)),nr());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let c=Kn(),a=nr();return n.os.getEntries(e,i).next((e=>{c=e,c.forEach(((e,t)=>{t.isValidDocument()||(a=a.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,c))).next((i=>{s=i;const o=[];for(const e of t){const t=Ar(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new Dr(e.key,t,Kt(t.value.mapValue),Er.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,a);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:Qn(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Da[e.currentUser.toKey()];r||(r=new it(B)),r=r.insert(t,n),e.Da[e.currentUser.toKey()]=r}(r,e.batchId,n),await Mc(r,e.changes),await Ua(r.remoteStore)}catch(e){const t=Za(e,"Failed to persist write");n.reject(t)}}(await fu(e),t,n))),n.promise}(Gu(e),t)}function Ah(e,t,n){const r=n.docs.get(t._key),i=new _h(e);return new hh(e,i,t._key,r,new lh(n.hasPendingWrites,n.fromCache),t.converter)}const Rh={maxAttempts:5};class xh{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=gl(e)}set(e,t,n){this._verifyNotCommitted();const r=Dh(e,this._firestore),i=ch(r.converter,t,n),s=ml(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,Er.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const i=Dh(e,this._firestore);let s;return s="string"==typeof(t=Object(l.w)(t))||t instanceof rl?El(this._dataReader,"WriteBatch.update",i._key,t,n,r):Tl(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,Er.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Dh(e,this._firestore);return this._mutations=this._mutations.concat(new jr(t._key,Er.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new N(O.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Dh(e,t){if((e=Object(l.w)(e)).firestore!==t)throw new N(O.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class Ph extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=gl(e)}get(e){const t=Dh(e,this._firestore),n=new uh(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return E();const r=e[0];if(r.isFoundDocument())return new Ll(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new Ll(this._firestore,n,t._key,null,t.converter);throw E()}))}set(e,t,n){const r=Dh(e,this._firestore),i=ch(r.converter,t,n),s=ml(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){const i=Dh(e,this._firestore);let s;return s="string"==typeof(t=Object(l.w)(t))||t instanceof rl?El(this._dataReader,"Transaction.update",i._key,t,n,r):Tl(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}delete(e){const t=Dh(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Dh(e,this._firestore),n=new _h(this._firestore);return super.get(e).then((e=>new hh(this._firestore,n,t._key,e._document,new lh(!1,!1),t.converter)))}}function Lh(e,t,n){e=Su(e,zu);const r=Object.assign(Object.assign({},Rh),n);return function(e){if(e.maxAttempts<1)throw new N(O.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){const r=new A;return e.asyncQueue.enqueueAndForget((async()=>{const i=await pu(e);new ru(e.asyncQueue,i,n,t,r).ja()})),r.promise}(Gu(e),(n=>t(new Ph(e,n))),r)}function Mh(){return new _l("deleteField")}function jh(){return new vl("serverTimestamp")}function Fh(...e){return new wl("arrayUnion",e)}function Uh(...e){return new bl("arrayRemove",e)}function Vh(e){return new Il("increment",e)}new WeakMap;!function(e,t=!0){!function(e){m=e}(r.SDK_VERSION),Object(r._registerComponent)(new o.a("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new zu(new P(e.getProvider("auth-internal")),new F(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new N(O.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Tt(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),Object(r.registerVersion)(d,"4.4.3",e),Object(r.registerVersion)(d,"4.4.3","esm2017")}()}).call(this,n(167))},510:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return Tr})),n.d(t,"b",(function(){return Cr})),n.d(t,"c",(function(){return Er})),n.d(t,"d",(function(){return Ar})),n.d(t,"e",(function(){return Nr})),n.d(t,"f",(function(){return Sr})),n.d(t,"g",(function(){return kr})),n.d(t,"h",(function(){return Or})),n.d(t,"i",(function(){return wr})),n.d(t,"j",(function(){return Ir}));var r,o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},c={},l=l||{},h=o||self;function d(a){var b=typeof a;return"array"==(b="object"!=b?b:a?Array.isArray(a)?"array":b:"null")||"object"==b&&"number"==typeof a.length}function p(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var f="closure_uid_"+(1e9*Math.random()>>>0),m=0;function _(a,b,e){return a.call.apply(a.bind,arguments)}function y(a,b,e){if(!a)throw Error();if(2<arguments.length){var t=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,t),a.apply(b,e)}}return function(){return a.apply(b,arguments)}}function q(a,b,e){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?_:y).apply(null,arguments)}function v(a,b){var e=Array.prototype.slice.call(arguments,1);return function(){var t=e.slice();return t.push.apply(t,arguments),a.apply(this,t)}}function w(a,b){function e(){}e.prototype=b.prototype,a.$=b.prototype,a.prototype=new e,a.prototype.constructor=a,a.ac=function(e,t,n){for(var r=Array(arguments.length-2),o=2;o<arguments.length;o++)r[o-2]=arguments[o];return b.prototype[t].apply(e,r)}}function I(){this.s=this.s,this.o=this.o}I.prototype.s=!1,I.prototype.sa=function(){var a;!this.s&&(this.s=!0,this.N(),0)&&(a=this,Object.prototype.hasOwnProperty.call(a,f)&&a[f]||(a[f]=++m))},I.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const T=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"==typeof a)return"string"!=typeof b||1!=b.length?-1:a.indexOf(b,0);for(let e=0;e<a.length;e++)if(e in a&&a[e]===b)return e;return-1};function E(a){const b=a.length;if(0<b){const e=Array(b);for(let t=0;t<b;t++)e[t]=a[t];return e}return[]}function C(a,b){for(let e=1;e<arguments.length;e++){const t=arguments[e];if(d(t)){const e=a.length||0,n=t.length||0;a.length=e+n;for(let r=0;r<n;r++)a[e+r]=t[r]}else a.push(t)}}function S(a,b){this.type=a,this.g=this.target=b,this.defaultPrevented=!1}S.prototype.h=function(){this.defaultPrevented=!0};var k=function(){if(!h.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const e=()=>{};h.addEventListener("test",e,b),h.removeEventListener("test",e,b)}catch(e){}return a}();function O(a){return/^[\s\xa0]*$/.test(a)}function N(){var a=h.navigator;return a&&(a=a.userAgent)?a:""}function A(a){return-1!=N().indexOf(a)}function R(a){return R[" "](a),a}R[" "]=function(){};var x,a,D,P=A("Opera"),L=A("Trident")||A("MSIE"),M=A("Edge"),j=M||L,F=A("Gecko")&&!(-1!=N().toLowerCase().indexOf("webkit")&&!A("Edge"))&&!(A("Trident")||A("MSIE"))&&!A("Edge"),U=-1!=N().toLowerCase().indexOf("webkit")&&!A("Edge");function V(){var a=h.document;return a?a.documentMode:void 0}e:{var B="",z=(a=N(),F?/rv:([^\);]+)(\)|;)/.exec(a):M?/Edge\/([\d\.]+)/.exec(a):L?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a):U?/WebKit\/(\S+)/.exec(a):P?/(?:Version)[ \/]?(\S+)/.exec(a):void 0);if(z&&(B=z?z[1]:""),L){var G=V();if(null!=G&&G>parseFloat(B)){x=String(G);break e}}x=B}if(h.document&&L){var W=V();D=W||(parseInt(x,10)||void 0)}else D=void 0;var K=D;function $(a,b){if(S.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var e=this.type=a.type,t=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=b,b=a.relatedTarget){if(F){e:{try{R(b.nodeName);var n=!0;break e}catch(e){}n=!1}n||(b=null)}}else"mouseover"==e?b=a.fromElement:"mouseout"==e&&(b=a.toElement);this.relatedTarget=b,t?(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:H[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&$.$.h.call(this)}}w($,S);var H={2:"touch",3:"pen",4:"mouse"};$.prototype.h=function(){$.$.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var Q="closure_listenable_"+(1e6*Math.random()|0),Y=0;function J(a,b,e,t,n){this.listener=a,this.proxy=null,this.src=b,this.type=e,this.capture=!!t,this.la=n,this.key=++Y,this.fa=this.ia=!1}function X(a){a.fa=!0,a.listener=null,a.proxy=null,a.src=null,a.la=null}function Z(a,b,e){for(const t in a)b.call(e,a[t],t,a)}function ee(a){const b={};for(const e in a)b[e]=a[e];return b}const te="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ne(a,b){let e,t;for(let n=1;n<arguments.length;n++){for(e in t=arguments[n],t)a[e]=t[e];for(let n=0;n<te.length;n++)e=te[n],Object.prototype.hasOwnProperty.call(t,e)&&(a[e]=t[e])}}function re(a){this.src=a,this.g={},this.h=0}function ie(a,b){var e=b.type;if(e in a.g){var t,n=a.g[e],r=T(n,b);(t=0<=r)&&Array.prototype.splice.call(n,r,1),t&&(X(b),0==a.g[e].length&&(delete a.g[e],a.h--))}}function se(a,b,e,t){for(var n=0;n<a.length;++n){var r=a[n];if(!r.fa&&r.listener==b&&r.capture==!!e&&r.la==t)return n}return-1}re.prototype.add=function(a,b,e,t,n){var r=a.toString();(a=this.g[r])||(a=this.g[r]=[],this.h++);var o=se(a,b,t,n);return-1<o?(b=a[o],e||(b.ia=!1)):((b=new J(b,this.src,r,!!t,n)).ia=e,a.push(b)),b};var oe="closure_lm_"+(1e6*Math.random()|0),ae={};function ce(a,b,e,t,n){if(t&&t.once)return le(a,b,e,t,n);if(Array.isArray(b)){for(var r=0;r<b.length;r++)ce(a,b[r],e,t,n);return null}return e=_e(e),a&&a[Q]?a.O(b,e,p(t)?!!t.capture:!!t,n):ue(a,b,e,!1,t,n)}function ue(a,b,e,t,n,r){if(!b)throw Error("Invalid event type");var o=p(n)?!!n.capture:!!n,c=ge(a);if(c||(a[oe]=c=new re(a)),(e=c.add(b,e,t,o,r)).proxy)return e;if(t=function(){function a(e){return b.call(a.src,a.listener,e)}const b=pe;return a}(),e.proxy=t,t.src=a,t.listener=e,a.addEventListener)k||(n=o),void 0===n&&(n=!1),a.addEventListener(b.toString(),t,n);else if(a.attachEvent)a.attachEvent(fe(b.toString()),t);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(t)}return e}function le(a,b,e,t,n){if(Array.isArray(b)){for(var r=0;r<b.length;r++)le(a,b[r],e,t,n);return null}return e=_e(e),a&&a[Q]?a.P(b,e,p(t)?!!t.capture:!!t,n):ue(a,b,e,!0,t,n)}function he(a,b,e,t,n){if(Array.isArray(b))for(var r=0;r<b.length;r++)he(a,b[r],e,t,n);else t=p(t)?!!t.capture:!!t,e=_e(e),a&&a[Q]?(a=a.i,(b=String(b).toString())in a.g&&(-1<(e=se(r=a.g[b],e,t,n))&&(X(r[e]),Array.prototype.splice.call(r,e,1),0==r.length&&(delete a.g[b],a.h--)))):a&&(a=ge(a))&&(b=a.g[b.toString()],a=-1,b&&(a=se(b,e,t,n)),(e=-1<a?b[a]:null)&&de(e))}function de(a){if("number"!=typeof a&&a&&!a.fa){var b=a.src;if(b&&b[Q])ie(b.i,a);else{var e=a.type,t=a.proxy;b.removeEventListener?b.removeEventListener(e,t,a.capture):b.detachEvent?b.detachEvent(fe(e),t):b.addListener&&b.removeListener&&b.removeListener(t),(e=ge(b))?(ie(e,a),0==e.h&&(e.src=null,b[oe]=null)):X(a)}}}function fe(a){return a in ae?ae[a]:ae[a]="on"+a}function pe(a,b){if(a.fa)a=!0;else{b=new $(b,this);var e=a.listener,t=a.la||a.src;a.ia&&de(a),a=e.call(t,b)}return a}function ge(a){return(a=a[oe])instanceof re?a:null}var me="__closure_events_fn_"+(1e9*Math.random()>>>0);function _e(a){return"function"==typeof a?a:(a[me]||(a[me]=function(b){return a.handleEvent(b)}),a[me])}function ye(){I.call(this),this.i=new re(this),this.S=this,this.J=null}function ve(a,b){var e,t=a.J;if(t)for(e=[];t;t=t.J)e.push(t);if(a=a.S,t=b.type||b,"string"==typeof b)b=new S(b,a);else if(b instanceof S)b.target=b.target||a;else{var n=b;ne(b=new S(t,a),n)}if(n=!0,e)for(var r=e.length-1;0<=r;r--){var o=b.g=e[r];n=we(o,t,!0,b)&&n}if(n=we(o=b.g=a,t,!0,b)&&n,n=we(o,t,!1,b)&&n,e)for(r=0;r<e.length;r++)n=we(o=b.g=e[r],t,!1,b)&&n}function we(a,b,e,t){if(!(b=a.i.g[String(b)]))return!0;b=b.concat();for(var n=!0,r=0;r<b.length;++r){var o=b[r];if(o&&!o.fa&&o.capture==e){var c=o.listener,l=o.la||o.src;o.ia&&ie(a.i,o),n=!1!==c.call(l,t)&&n}}return n&&!t.defaultPrevented}w(ye,I),ye.prototype[Q]=!0,ye.prototype.removeEventListener=function(a,b,e,t){he(this,a,b,e,t)},ye.prototype.N=function(){if(ye.$.N.call(this),this.i){var e,a=this.i;for(e in a.g){for(var t=a.g[e],n=0;n<t.length;n++)X(t[n]);delete a.g[e],a.h--}}this.J=null},ye.prototype.O=function(a,b,e,t){return this.i.add(String(a),b,!1,e,t)},ye.prototype.P=function(a,b,e,t){return this.i.add(String(a),b,!0,e,t)};var be=h.JSON.stringify;function Ie(){var a=Ne;let b=null;return a.g&&(b=a.g,a.g=a.g.next,a.g||(a.h=null),b.next=null),b}var Te=new class{constructor(a,b){this.i=a,this.j=b,this.h=0,this.g=null}get(){let a;return 0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}((()=>new Ee),(a=>a.reset()));class Ee{constructor(){this.next=this.g=this.h=null}set(a,b){this.h=a,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}}function Ce(a){var b=1;a=a.split(":");const e=[];for(;0<b&&a.length;)e.push(a.shift()),b--;return a.length&&e.push(a.join(":")),e}function Se(a){h.setTimeout((()=>{throw a}),0)}let ke,Oe=!1,Ne=new class{constructor(){this.h=this.g=null}add(a,b){const e=Te.get();e.set(a,b),this.h?this.h.next=e:this.g=e,this.h=e}},Ae=()=>{const a=h.Promise.resolve(void 0);ke=()=>{a.then(Re)}};var Re=()=>{for(var a;a=Ie();){try{a.h.call(a.g)}catch(e){Se(e)}var b=Te;b.j(a),100>b.h&&(b.h++,a.next=b.g,b.g=a)}Oe=!1};function xe(a,b){ye.call(this),this.h=a||1,this.g=b||h,this.j=q(this.qb,this),this.l=Date.now()}function De(a){a.ga=!1,a.T&&(a.g.clearTimeout(a.T),a.T=null)}function Pe(a,b,e){if("function"==typeof a)e&&(a=q(a,e));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=q(a.handleEvent,a)}return 2147483647<Number(b)?-1:h.setTimeout(a,b||0)}function Le(a){a.g=Pe((()=>{a.g=null,a.i&&(a.i=!1,Le(a))}),a.j);const b=a.h;a.h=null,a.m.apply(null,b)}w(xe,ye),(r=xe.prototype).ga=!1,r.T=null,r.qb=function(){if(this.ga){var a=Date.now()-this.l;0<a&&a<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-a):(this.T&&(this.g.clearTimeout(this.T),this.T=null),ve(this,"tick"),this.ga&&(De(this),this.start()))}},r.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.N=function(){xe.$.N.call(this),De(this),delete this.g};class Me extends I{constructor(a,b){super(),this.m=a,this.j=b,this.h=null,this.i=!1,this.g=null}l(a){this.h=arguments,this.g?this.i=!0:Le(this)}N(){super.N(),this.g&&(h.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function je(a){I.call(this),this.h=a,this.g={}}w(je,I);var Fe=[];function Ue(a,b,e,t){Array.isArray(e)||(e&&(Fe[0]=e.toString()),e=Fe);for(var n=0;n<e.length;n++){var r=ce(b,e[n],t||a.handleEvent,!1,a.h||a);if(!r)break;a.g[r.key]=r}}function Ve(a){Z(a.g,(function(b,e){this.g.hasOwnProperty(e)&&de(b)}),a),a.g={}}function qe(){this.g=!0}function Be(a,b,e,t){a.info((function(){return"XMLHTTP TEXT ("+b+"): "+function(a,b){if(!a.g)return b;if(!b)return null;try{var e=JSON.parse(b);if(e)for(a=0;a<e.length;a++)if(Array.isArray(e[a])){var t=e[a];if(!(2>t.length)){var n=t[1];if(Array.isArray(n)&&!(1>n.length)){var r=n[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<n.length;o++)n[o]=""}}}return be(e)}catch(e){return b}}(a,e)+(t?" "+t:"")}))}je.prototype.N=function(){je.$.N.call(this),Ve(this)},je.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},qe.prototype.Ea=function(){this.g=!1},qe.prototype.info=function(){};var ze={},Ge=null;function We(){return Ge=Ge||new ye}function Ke(a){S.call(this,ze.Ta,a)}function $e(a){const b=We();ve(b,new Ke(b))}function He(a,b){S.call(this,ze.STAT_EVENT,a),this.stat=b}function Qe(a){const b=We();ve(b,new He(b,a))}function Ye(a,b){S.call(this,ze.Ua,a),this.size=b}function Je(a,b){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return h.setTimeout((function(){a()}),b)}ze.Ta="serverreachability",w(Ke,S),ze.STAT_EVENT="statevent",w(He,S),ze.Ua="timingevent",w(Ye,S);var Xe={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Ze={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function et(){}function tt(a){return a.h||(a.h=a.i())}function nt(){}et.prototype.h=null;var it,st={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function ot(){S.call(this,"d")}function at(){S.call(this,"c")}function ct(){}function ut(a,b,e,t){this.l=a,this.j=b,this.m=e,this.W=t||1,this.U=new je(this),this.P=ht,a=j?125:void 0,this.V=new xe(a),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new lt}function lt(){this.i=null,this.g="",this.h=!1}w(ot,S),w(at,S),w(ct,et),ct.prototype.g=function(){return new XMLHttpRequest},ct.prototype.i=function(){return{}},it=new ct;var ht=45e3,ft={},pt={};function gt(a,b,e){a.L=1,a.A=Pt(Nt(b)),a.u=e,a.S=!0,mt(a,null)}function mt(a,b){a.G=Date.now(),wt(a),a.B=Nt(a.A);var e=a.B,t=a.W;Array.isArray(t)||(t=[String(t)]),$t(e.i,"t",t),a.o=0,e=a.l.J,a.h=new lt,a.g=Kn(a.l,e?b:null,!a.u),0<a.O&&(a.M=new Me(q(a.Pa,a,a.g),a.O)),Ue(a.U,a.g,"readystatechange",a.nb),b=a.I?ee(a.I):{},a.u?(a.v||(a.v="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.g.ha(a.B,a.v,a.u,b)):(a.v="GET",a.g.ha(a.B,a.v,null,b)),$e(),function(a,b,e,t,n,r){a.info((function(){if(a.g)if(r)for(var o="",c=r.split("&"),l=0;l<c.length;l++){var h=c[l].split("=");if(1<h.length){var u=h[0];h=h[1];var d=u.split("_");o=2<=d.length&&"type"==d[1]?o+(u+"=")+h+"&":o+(u+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+t+") [attempt "+n+"]: "+b+"\n"+e+"\n"+o}))}(a.j,a.v,a.B,a.m,a.W,a.u)}function _t(a){return!!a.g&&("GET"==a.v&&2!=a.L&&a.l.Ha)}function yt(a,b,e){let t,n=!0;for(;!a.J&&a.o<e.length;){if(t=vt(a,e),t==pt){4==b&&(a.s=4,Qe(14),n=!1),Be(a.j,a.m,null,"[Incomplete Response]");break}if(t==ft){a.s=4,Qe(15),Be(a.j,a.m,e,"[Invalid Chunk]"),n=!1;break}Be(a.j,a.m,t,null),Ct(a,t)}_t(a)&&0!=a.o&&(a.h.g=a.h.g.slice(a.o),a.o=0),4!=b||0!=e.length||a.h.h||(a.s=1,Qe(16),n=!1),a.i=a.i&&n,n?0<e.length&&!a.ba&&(a.ba=!0,(b=a.l).g==a&&b.ca&&!b.M&&(b.l.info("Great, no buffering proxy detected. Bytes received: "+e.length),Fn(b),b.M=!0,Qe(11))):(Be(a.j,a.m,e,"[Invalid Chunked Response]"),Et(a),Tt(a))}function vt(a,b){var e=a.o,t=b.indexOf("\n",e);return-1==t?pt:(e=Number(b.substring(e,t)),isNaN(e)?ft:(t+=1)+e>b.length?pt:(b=b.slice(t,t+e),a.o=t+e,b))}function wt(a){a.Y=Date.now()+a.P,bt(a,a.P)}function bt(a,b){if(null!=a.C)throw Error("WatchDog timer not null");a.C=Je(q(a.lb,a),b)}function It(a){a.C&&(h.clearTimeout(a.C),a.C=null)}function Tt(a){0==a.l.H||a.J||qn(a.l,a)}function Et(a){It(a);var b=a.M;b&&"function"==typeof b.sa&&b.sa(),a.M=null,De(a.V),Ve(a.U),a.g&&(b=a.g,a.g=null,b.abort(),b.sa())}function Ct(a,b){try{var e=a.l;if(0!=e.H&&(e.g==a||Zt(e.i,a)))if(!a.K&&Zt(e.i,a)&&3==e.H){try{var t=e.Ja.g.parse(b)}catch(e){t=null}if(Array.isArray(t)&&3==t.length){var n=t;if(0==n[0]){e:if(!e.u){if(e.g){if(!(e.g.G+3e3<a.G))break e;Vn(e),An(e)}jn(e),Qe(18)}}else e.Fa=n[1],0<e.Fa-e.V&&37500>n[2]&&e.G&&0==e.A&&!e.v&&(e.v=Je(q(e.ib,e),6e3));if(1>=Xt(e.i)&&e.oa){try{e.oa()}catch(e){}e.oa=void 0}}else zn(e,11)}else if((a.K||e.g==a)&&Vn(e),!O(b))for(n=e.Ja.g.parse(b),b=0;b<n.length;b++){let h=n[b];if(e.V=h[0],h=h[1],2==e.H)if("c"==h[0]){e.K=h[1],e.pa=h[2];const u=h[3];null!=u&&(e.ra=u,e.l.info("VER="+e.ra));const n=h[4];null!=n&&(e.Ga=n,e.l.info("SVER="+e.Ga));const d=h[5];null!=d&&"number"==typeof d&&0<d&&(t=1.5*d,e.L=t,e.l.info("backChannelRequestTimeoutMs_="+t)),t=e;const f=a.g;if(f){const e=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var r=t.i;r.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(en(r,r.h),r.h=null))}if(t.F){const e=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(t.Da=e,Dt(t.I,t.F,e))}}e.H=3,e.h&&e.h.Ba(),e.ca&&(e.S=Date.now()-a.G,e.l.info("Handshake RTT: "+e.S+"ms"));var o=a;if((t=e).wa=Wn(t,t.J?t.pa:null,t.Y),o.K){tn(t.i,o);var c=o,l=t.L;l&&c.setTimeout(l),c.C&&(It(c),wt(c)),t.g=o}else Mn(t);0<e.j.length&&xn(e)}else"stop"!=h[0]&&"close"!=h[0]||zn(e,7);else 3==e.H&&("stop"==h[0]||"close"==h[0]?"stop"==h[0]?zn(e,7):Nn(e):"noop"!=h[0]&&e.h&&e.h.Aa(h),e.A=0)}$e()}catch(e){}}function St(a,b){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,void 0);else if(d(a)||"string"==typeof a)Array.prototype.forEach.call(a,b,void 0);else for(var e=function(a){if(a.ta&&"function"==typeof a.ta)return a.ta();if(!a.Z||"function"!=typeof a.Z){if("undefined"!=typeof Map&&a instanceof Map)return Array.from(a.keys());if(!("undefined"!=typeof Set&&a instanceof Set)){if(d(a)||"string"==typeof a){var b=[];a=a.length;for(var e=0;e<a;e++)b.push(e);return b}b=[],e=0;for(const t in a)b[e++]=t;return b}}}(a),t=function(a){if(a.Z&&"function"==typeof a.Z)return a.Z();if("undefined"!=typeof Map&&a instanceof Map||"undefined"!=typeof Set&&a instanceof Set)return Array.from(a.values());if("string"==typeof a)return a.split("");if(d(a)){for(var b=[],e=a.length,t=0;t<e;t++)b.push(a[t]);return b}for(t in b=[],e=0,a)b[e++]=a[t];return b}(a),n=t.length,r=0;r<n;r++)b.call(void 0,t[r],e&&e[r],a)}(r=ut.prototype).setTimeout=function(a){this.P=a},r.nb=function(a){a=a.target;const b=this.M;b&&3==Tn(a)?b.l():this.Pa(a)},r.Pa=function(a){try{if(a==this.g)e:{const u=Tn(this.g);var b=this.g.Ia();this.g.da();if(!(3>u)&&(3!=u||j||this.g&&(this.h.h||this.g.ja()||En(this.g)))){this.J||4!=u||7==b||$e(),It(this);var e=this.g.da();this.ca=e;t:if(_t(this)){var t=En(this.g);a="";var n=t.length,r=4==Tn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Et(this),Tt(this);var o="";break t}this.h.i=new h.TextDecoder}for(b=0;b<n;b++)this.h.h=!0,a+=this.h.i.decode(t[b],{stream:r&&b==n-1});t.length=0,this.h.g+=a,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==e,function(a,b,e,t,n,r,o){a.info((function(){return"XMLHTTP RESP ("+t+") [ attempt "+n+"]: "+b+"\n"+e+"\n"+r+" "+o}))}(this.j,this.v,this.B,this.m,this.W,u,e),this.i){if(this.aa&&!this.K){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!O(c)){var d=c;break t}}d=null}if(!(e=d)){this.i=!1,this.s=3,Qe(12),Et(this),Tt(this);break e}Be(this.j,this.m,e,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ct(this,e)}this.S?(yt(this,u,o),j&&this.i&&3==u&&(Ue(this.U,this.V,"tick",this.mb),this.V.start())):(Be(this.j,this.m,o,null),Ct(this,o)),4==u&&Et(this),this.i&&!this.J&&(4==u?qn(this.l,this):(this.i=!1,wt(this)))}else(function(a){const b={};a=(a.g&&2<=Tn(a)&&a.g.getAllResponseHeaders()||"").split("\r\n");for(let t=0;t<a.length;t++){if(O(a[t]))continue;var e=Ce(a[t]);const n=e[0];if("string"!=typeof(e=e[1]))continue;e=e.trim();const r=b[n]||[];b[n]=r,r.push(e)}!function(a,b){for(const e in a)b.call(void 0,a[e],e,a)}(b,(function(e){return e.join(", ")}))})(this.g),400==e&&0<o.indexOf("Unknown SID")?(this.s=3,Qe(12)):(this.s=0,Qe(13)),Et(this),Tt(this)}}}catch(e){}},r.mb=function(){if(this.g){var a=Tn(this.g),b=this.g.ja();this.o<b.length&&(It(this),yt(this,a,b),this.i&&4!=a&&wt(this))}},r.cancel=function(){this.J=!0,Et(this)},r.lb=function(){this.C=null;const a=Date.now();0<=a-this.Y?(function(a,b){a.info((function(){return"TIMEOUT: "+b}))}(this.j,this.B),2!=this.L&&($e(),Qe(17)),Et(this),this.s=2,Tt(this)):bt(this,this.Y-a)};var kt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ot(a){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,a instanceof Ot){this.h=a.h,At(this,a.j),this.s=a.s,this.g=a.g,Rt(this,a.m),this.l=a.l;var b=a.i,e=new zt;e.i=b.i,b.g&&(e.g=new Map(b.g),e.h=b.h),xt(this,e),this.o=a.o}else a&&(b=String(a).match(kt))?(this.h=!1,At(this,b[1]||"",!0),this.s=Lt(b[2]||""),this.g=Lt(b[3]||"",!0),Rt(this,b[4]),this.l=Lt(b[5]||"",!0),xt(this,b[6]||"",!0),this.o=Lt(b[7]||"")):(this.h=!1,this.i=new zt(null,this.h))}function Nt(a){return new Ot(a)}function At(a,b,e){a.j=e?Lt(b,!0):b,a.j&&(a.j=a.j.replace(/:$/,""))}function Rt(a,b){if(b){if(b=Number(b),isNaN(b)||0>b)throw Error("Bad port number "+b);a.m=b}else a.m=null}function xt(a,b,e){b instanceof zt?(a.i=b,function(a,b){b&&!a.j&&(Gt(a),a.i=null,a.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Wt(this,t),$t(this,n,e))}),a)),a.j=b}(a.i,a.h)):(e||(b=Mt(b,qt)),a.i=new zt(b,a.h))}function Dt(a,b,e){a.i.set(b,e)}function Pt(a){return Dt(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function Lt(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Mt(a,b,e){return"string"==typeof a?(a=encodeURI(a).replace(b,jt),e&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function jt(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}Ot.prototype.toString=function(){var a=[],b=this.j;b&&a.push(Mt(b,Ft,!0),":");var e=this.g;return(e||"file"==b)&&(a.push("//"),(b=this.s)&&a.push(Mt(b,Ft,!0),"@"),a.push(encodeURIComponent(String(e)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(e=this.m)&&a.push(":",String(e))),(e=this.l)&&(this.g&&"/"!=e.charAt(0)&&a.push("/"),a.push(Mt(e,"/"==e.charAt(0)?Vt:Ut,!0))),(e=this.i.toString())&&a.push("?",e),(e=this.o)&&a.push("#",Mt(e,Bt)),a.join("")};var Ft=/[#\/\?@]/g,Ut=/[#\?:]/g,Vt=/[#\?]/g,qt=/[#\?@]/g,Bt=/#/g;function zt(a,b){this.h=this.g=null,this.i=a||null,this.j=!!b}function Gt(a){a.g||(a.g=new Map,a.h=0,a.i&&function(a,b){if(a){a=a.split("&");for(var e=0;e<a.length;e++){var t=a[e].indexOf("="),n=null;if(0<=t){var r=a[e].substring(0,t);n=a[e].substring(t+1)}else r=a[e];b(r,n?decodeURIComponent(n.replace(/\+/g," ")):"")}}}(a.i,(function(b,e){a.add(decodeURIComponent(b.replace(/\+/g," ")),e)})))}function Wt(a,b){Gt(a),b=Ht(a,b),a.g.has(b)&&(a.i=null,a.h-=a.g.get(b).length,a.g.delete(b))}function Kt(a,b){return Gt(a),b=Ht(a,b),a.g.has(b)}function $t(a,b,e){Wt(a,b),0<e.length&&(a.i=null,a.g.set(Ht(a,b),E(e)),a.h+=e.length)}function Ht(a,b){return b=String(b),a.j&&(b=b.toLowerCase()),b}(r=zt.prototype).add=function(a,b){Gt(this),this.i=null,a=Ht(this,a);var e=this.g.get(a);return e||this.g.set(a,e=[]),e.push(b),this.h+=1,this},r.forEach=function(a,b){Gt(this),this.g.forEach((function(e,t){e.forEach((function(e){a.call(b,e,t,this)}),this)}),this)},r.ta=function(){Gt(this);const a=Array.from(this.g.values()),b=Array.from(this.g.keys()),e=[];for(let t=0;t<b.length;t++){const n=a[t];for(let r=0;r<n.length;r++)e.push(b[t])}return e},r.Z=function(a){Gt(this);let b=[];if("string"==typeof a)Kt(this,a)&&(b=b.concat(this.g.get(Ht(this,a))));else{a=Array.from(this.g.values());for(let e=0;e<a.length;e++)b=b.concat(a[e])}return b},r.set=function(a,b){return Gt(this),this.i=null,Kt(this,a=Ht(this,a))&&(this.h-=this.g.get(a).length),this.g.set(a,[b]),this.h+=1,this},r.get=function(a,b){return a&&0<(a=this.Z(a)).length?String(a[0]):b},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],b=Array.from(this.g.keys());for(var e=0;e<b.length;e++){var t=b[e];const r=encodeURIComponent(String(t)),o=this.Z(t);for(t=0;t<o.length;t++){var n=r;""!==o[t]&&(n+="="+encodeURIComponent(String(o[t]))),a.push(n)}}return this.i=a.join("&")};var Qt=class{constructor(a,b){this.g=a,this.map=b}};function Yt(a){this.l=a||dd,h.PerformanceNavigationTiming?a=0<(a=h.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):a=!!(h.g&&h.g.Ka&&h.g.Ka()&&h.g.Ka().dc),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var dd=10;function Jt(a){return!!a.h||!!a.g&&a.g.size>=a.j}function Xt(a){return a.h?1:a.g?a.g.size:0}function Zt(a,b){return a.h?a.h==b:!!a.g&&a.g.has(b)}function en(a,b){a.g?a.g.add(b):a.h=b}function tn(a,b){a.h&&a.h==b?a.h=null:a.g&&a.g.has(b)&&a.g.delete(b)}function nn(a){if(null!=a.h)return a.i.concat(a.h.F);if(null!=a.g&&0!==a.g.size){let b=a.i;for(const e of a.g.values())b=b.concat(e.F);return b}return E(a.i)}Yt.prototype.cancel=function(){if(this.i=nn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}};var rn=class{stringify(a){return h.JSON.stringify(a,void 0)}parse(a){return h.JSON.parse(a,void 0)}};function sn(){this.g=new rn}function on(a,b,e){const t=e||"";try{St(a,(function(e,n){let r=e;p(e)&&(r=be(e)),b.push(t+n+"="+encodeURIComponent(r))}))}catch(e){throw b.push(t+"type="+encodeURIComponent("_badmap")),e}}function an(a,b,e,t,n){try{b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null,n(t)}catch(e){}}function cn(a){this.l=a.ec||null,this.j=a.ob||!1}function un(a,b){ye.call(this),this.F=a,this.u=b,this.m=void 0,this.readyState=ln,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}w(cn,et),cn.prototype.g=function(){return new un(this.l,this.j)},cn.prototype.i=function(a){return function(){return a}}({}),w(un,ye);var ln=0;function hn(a){a.j.read().then(a.Xa.bind(a)).catch(a.ka.bind(a))}function dn(a){a.readyState=4,a.l=null,a.j=null,a.A=null,fn(a)}function fn(a){a.onreadystatechange&&a.onreadystatechange.call(a)}(r=un.prototype).open=function(a,b){if(this.readyState!=ln)throw this.abort(),Error("Error reopening a connection");this.C=a,this.B=b,this.readyState=1,fn(this)},r.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const b={headers:this.v,method:this.C,credentials:this.m,cache:void 0};a&&(b.body=a),(this.F||h).fetch(new Request(this.B,b)).then(this.$a.bind(this),this.ka.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,dn(this)),this.readyState=ln},r.$a=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,fn(this)),this.g&&(this.readyState=3,fn(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==h.ReadableStream&&"body"in a){if(this.j=a.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;hn(this)}else a.text().then(this.Za.bind(this),this.ka.bind(this))},r.Xa=function(a){if(this.g){if(this.u&&a.value)this.response.push(a.value);else if(!this.u){var b=a.value?a.value:new Uint8Array(0);(b=this.A.decode(b,{stream:!a.done}))&&(this.response=this.responseText+=b)}a.done?dn(this):fn(this),3==this.readyState&&hn(this)}},r.Za=function(a){this.g&&(this.response=this.responseText=a,dn(this))},r.Ya=function(a){this.g&&(this.response=a,dn(this))},r.ka=function(){this.g&&dn(this)},r.setRequestHeader=function(a,b){this.v.append(a,b)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],b=this.h.entries();for(var e=b.next();!e.done;)e=e.value,a.push(e[0]+": "+e[1]),e=b.next();return a.join("\r\n")},Object.defineProperty(un.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}});var pn=h.JSON.parse;function gn(a){ye.call(this),this.headers=new Map,this.u=a||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=mn,this.L=this.M=!1}w(gn,ye);var mn="",td=/^https?$/i,_n=["POST","PUT"];function yn(a,b){a.h=!1,a.g&&(a.l=!0,a.g.abort(),a.l=!1),a.j=b,a.m=5,vn(a),bn(a)}function vn(a){a.F||(a.F=!0,ve(a,"complete"),ve(a,"error"))}function wn(a){if(a.h&&void 0!==l&&(!a.C[1]||4!=Tn(a)||2!=a.da()))if(a.v&&4==Tn(a))Pe(a.La,0,a);else if(ve(a,"readystatechange"),4==Tn(a)){a.h=!1;try{const o=a.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break e;default:b=!1}var e;if(!(e=b)){var t;if(t=0===o){var n=String(a.I).match(kt)[1]||null;!n&&h.self&&h.self.location&&(n=h.self.location.protocol.slice(0,-1)),t=!td.test(n?n.toLowerCase():"")}e=t}if(e)ve(a,"complete"),ve(a,"success");else{a.m=6;try{var r=2<Tn(a)?a.g.statusText:""}catch(e){r=""}a.j=r+" ["+a.da()+"]",vn(a)}}finally{bn(a)}}}function bn(a,b){if(a.g){In(a);const e=a.g,t=a.C[0]?()=>{}:null;a.g=null,a.C=null,b||ve(a,"ready");try{e.onreadystatechange=t}catch(e){}}}function In(a){a.g&&a.L&&(a.g.ontimeout=null),a.A&&(h.clearTimeout(a.A),a.A=null)}function Tn(a){return a.g?a.g.readyState:0}function En(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.K){case mn:case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Cn(a){let b="";return Z(a,(function(e,t){b+=t,b+=":",b+=e,b+="\r\n"})),b}function Sn(a,b,e){e:{for(t in e){var t=!1;break e}t=!0}t||(e=Cn(e),"string"==typeof a?null!=e&&encodeURIComponent(String(e)):Dt(a,b,e))}function kn(a,b,e){return e&&e.internalChannelParams&&e.internalChannelParams[a]||b}function On(a){this.Ga=0,this.j=[],this.l=new qe,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=kn("failFast",!1,a),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=kn("baseRetryDelayMs",5e3,a),this.hb=kn("retryDelaySeedMs",1e4,a),this.eb=kn("forwardChannelMaxRetries",2,a),this.xa=kn("forwardChannelRequestTimeoutMs",2e4,a),this.va=a&&a.xmlHttpFactory||void 0,this.Ha=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.i=new Yt(a&&a.concurrentRequestLimit),this.Ja=new sn,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=a&&a.bc||!1,a&&a.Ea&&this.l.Ea(),a&&a.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&a&&a.detectBufferingProxy||!1,this.qa=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.qa=a.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Nn(a){if(Rn(a),3==a.H){var b=a.W++,e=Nt(a.I);if(Dt(e,"SID",a.K),Dt(e,"RID",b),Dt(e,"TYPE","terminate"),Pn(a,e),(b=new ut(a,a.l,b)).L=2,b.A=Pt(Nt(e)),e=!1,h.navigator&&h.navigator.sendBeacon)try{e=h.navigator.sendBeacon(b.A.toString(),"")}catch(e){}!e&&h.Image&&((new Image).src=b.A,e=!0),e||(b.g=Kn(b.l,null),b.g.ha(b.A)),b.G=Date.now(),wt(b)}Gn(a)}function An(a){a.g&&(Fn(a),a.g.cancel(),a.g=null)}function Rn(a){An(a),a.u&&(h.clearTimeout(a.u),a.u=null),Vn(a),a.i.cancel(),a.m&&("number"==typeof a.m&&h.clearTimeout(a.m),a.m=null)}function xn(a){if(!Jt(a.i)&&!a.m){a.m=!0;var b=a.Na;ke||Ae(),Oe||(ke(),Oe=!0),Ne.add(b,a),a.C=0}}function Dn(a,b){var e;e=b?b.m:a.W++;const t=Nt(a.I);Dt(t,"SID",a.K),Dt(t,"RID",e),Dt(t,"AID",a.V),Pn(a,t),a.o&&a.s&&Sn(t,a.o,a.s),e=new ut(a,a.l,e,a.C+1),null===a.o&&(e.I=a.s),b&&(a.j=b.F.concat(a.j)),b=Ln(a,e,1e3),e.setTimeout(Math.round(.5*a.xa)+Math.round(.5*a.xa*Math.random())),en(a.i,e),gt(e,t,b)}function Pn(a,b){a.na&&Z(a.na,(function(e,t){Dt(b,t,e)})),a.h&&St({},(function(e,t){Dt(b,t,e)}))}function Ln(a,b,e){e=Math.min(a.j.length,e);var t=a.h?q(a.h.Va,a.h,a):null;e:{var n=a.j;let r=-1;for(;;){const o=["count="+e];-1==r?0<e?(r=n[0].g,o.push("ofs="+r)):r=0:o.push("ofs="+r);let c=!0;for(let l=0;l<e;l++){let e=n[l].g;const u=n[l].map;if(e-=r,0>e)r=Math.max(0,n[l].g-100),c=!1;else try{on(u,o,"req"+e+"_")}catch(e){t&&t(u)}}if(c){t=o.join("&");break e}}}return a=a.j.splice(0,e),b.F=a,t}function Mn(a){if(!a.g&&!a.u){a.ba=1;var b=a.Ma;ke||Ae(),Oe||(ke(),Oe=!0),Ne.add(b,a),a.A=0}}function jn(a){return!(a.g||a.u||3<=a.A)&&(a.ba++,a.u=Je(q(a.Ma,a),Bn(a,a.A)),a.A++,!0)}function Fn(a){null!=a.B&&(h.clearTimeout(a.B),a.B=null)}function Un(a){a.g=new ut(a,a.l,"rpc",a.ba),null===a.o&&(a.g.I=a.s),a.g.O=0;var b=Nt(a.wa);Dt(b,"RID","rpc"),Dt(b,"SID",a.K),Dt(b,"AID",a.V),Dt(b,"CI",a.G?"0":"1"),!a.G&&a.qa&&Dt(b,"TO",a.qa),Dt(b,"TYPE","xmlhttp"),Pn(a,b),a.o&&a.s&&Sn(b,a.o,a.s),a.L&&a.g.setTimeout(a.L);var e=a.g;a=a.pa,e.L=1,e.A=Pt(Nt(b)),e.u=null,e.S=!0,mt(e,a)}function Vn(a){null!=a.v&&(h.clearTimeout(a.v),a.v=null)}function qn(a,b){var e=null;if(a.g==b){Vn(a),Fn(a),a.g=null;var t=2}else{if(!Zt(a.i,b))return;e=b.F,tn(a.i,b),t=1}if(0!=a.H)if(b.i)if(1==t){e=b.u?b.u.length:0,b=Date.now()-b.G;var n=a.C;ve(t=We(),new Ye(t,e)),xn(a)}else Mn(a);else if(3==(n=b.s)||0==n&&0<b.ca||!(1==t&&function(a,b){return!(Xt(a.i)>=a.i.j-(a.m?1:0)||(a.m?(a.j=b.F.concat(a.j),0):1==a.H||2==a.H||a.C>=(a.cb?0:a.eb)||(a.m=Je(q(a.Na,a,b),Bn(a,a.C)),a.C++,0)))}(a,b)||2==t&&jn(a)))switch(e&&0<e.length&&(b=a.i,b.i=b.i.concat(e)),n){case 1:zn(a,5);break;case 4:zn(a,10);break;case 3:zn(a,6);break;default:zn(a,2)}}function Bn(a,b){let e=a.ab+Math.floor(Math.random()*a.hb);return a.isActive()||(e*=2),e*b}function zn(a,b){if(a.l.info("Error code "+b),2==b){var e=null;a.h&&(e=null);var t=q(a.pb,a);e||(e=new Ot("//www.google.com/images/cleardot.gif"),h.location&&"http"==h.location.protocol||At(e,"https"),Pt(e)),function(a,b){const e=new qe;if(h.Image){const t=new Image;t.onload=v(an,e,t,"TestLoadImage: loaded",!0,b),t.onerror=v(an,e,t,"TestLoadImage: error",!1,b),t.onabort=v(an,e,t,"TestLoadImage: abort",!1,b),t.ontimeout=v(an,e,t,"TestLoadImage: timeout",!1,b),h.setTimeout((function(){t.ontimeout&&t.ontimeout()}),1e4),t.src=a}else b(!1)}(e.toString(),t)}else Qe(2);a.H=0,a.h&&a.h.za(b),Gn(a),Rn(a)}function Gn(a){if(a.H=0,a.ma=[],a.h){const b=nn(a.i);0==b.length&&0==a.j.length||(C(a.ma,b),C(a.ma,a.j),a.i.i.length=0,E(a.j),a.j.length=0),a.h.ya()}}function Wn(a,b,e){var t=e instanceof Ot?Nt(e):new Ot(e);if(""!=t.g)b&&(t.g=b+"."+t.g),Rt(t,t.m);else{var n=h.location;t=n.protocol,b=b?b+"."+n.hostname:n.hostname,n=+n.port;var r=new Ot(null);t&&At(r,t),b&&(r.g=b),n&&Rt(r,n),e&&(r.l=e),t=r}return e=a.F,b=a.Da,e&&b&&Dt(t,e,b),Dt(t,"VER",a.ra),Pn(a,t),t}function Kn(a,b,e){if(b&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return(b=a.Ha&&!a.va?new gn(new cn({ob:e})):new gn(a.va)).Oa(a.J),b}function $n(){}function Hn(){if(L&&!(10<=Number(K)))throw Error("Environmental error: no available transport.")}function Qn(a,b){ye.call(this),this.g=new On(b),this.l=a,this.h=b&&b.messageUrlParams||null,a=b&&b.messageHeaders||null,b&&b.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.s=a,a=b&&b.initMessageHeaders||null,b&&b.messageContentType&&(a?a["X-WebChannel-Content-Type"]=b.messageContentType:a={"X-WebChannel-Content-Type":b.messageContentType}),b&&b.Ca&&(a?a["X-WebChannel-Client-Profile"]=b.Ca:a={"X-WebChannel-Client-Profile":b.Ca}),this.g.U=a,(a=b&&b.cc)&&!O(a)&&(this.g.o=a),this.A=b&&b.supportsCrossDomainXhr||!1,this.v=b&&b.sendRawJson||!1,(b=b&&b.httpSessionIdParam)&&!O(b)&&(this.g.F=b,null!==(a=this.h)&&b in a&&(b in(a=this.h)&&delete a[b])),this.j=new Xn(this)}function Yn(a){ot.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var b=a.__sm__;if(b){e:{for(const e in b){a=e;break e}a=void 0}(this.i=a)&&(a=this.i,b=null!==b&&a in b?b[a]:void 0),this.data=b}else this.data=a}function Jn(){at.call(this),this.status=1}function Xn(a){this.g=a}function Zn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function er(a,b,e){e||(e=0);var t=Array(16);if("string"==typeof b)for(var n=0;16>n;++n)t[n]=b.charCodeAt(e++)|b.charCodeAt(e++)<<8|b.charCodeAt(e++)<<16|b.charCodeAt(e++)<<24;else for(n=0;16>n;++n)t[n]=b[e++]|b[e++]<<8|b[e++]<<16|b[e++]<<24;b=a.g[0],e=a.g[1],n=a.g[2];var r=a.g[3],o=b+(r^e&(n^r))+t[0]+3614090360&4294967295;o=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=e+(o<<7&4294967295|o>>>25))+((o=r+(n^b&(e^n))+t[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=n+(e^r&(b^e))+t[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=e+(b^n&(r^b))+t[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=b+(r^e&(n^r))+t[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=r+(n^b&(e^n))+t[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=n+(e^r&(b^e))+t[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=e+(b^n&(r^b))+t[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=b+(r^e&(n^r))+t[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=r+(n^b&(e^n))+t[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=n+(e^r&(b^e))+t[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=e+(b^n&(r^b))+t[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=b+(r^e&(n^r))+t[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=r+(n^b&(e^n))+t[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=n+(e^r&(b^e))+t[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=e+(b^n&(r^b))+t[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=b+(n^r&(e^n))+t[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=r+(e^n&(b^e))+t[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=n+(b^e&(r^b))+t[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=e+(r^b&(n^r))+t[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=b+(n^r&(e^n))+t[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=r+(e^n&(b^e))+t[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=n+(b^e&(r^b))+t[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=e+(r^b&(n^r))+t[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=b+(n^r&(e^n))+t[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=r+(e^n&(b^e))+t[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=n+(b^e&(r^b))+t[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=e+(r^b&(n^r))+t[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=b+(n^r&(e^n))+t[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=r+(e^n&(b^e))+t[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=n+(b^e&(r^b))+t[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=e+(r^b&(n^r))+t[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=b+(e^n^r)+t[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=r+(b^e^n)+t[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=n+(r^b^e)+t[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=e+(n^r^b)+t[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=b+(e^n^r)+t[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=r+(b^e^n)+t[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=n+(r^b^e)+t[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=e+(n^r^b)+t[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=b+(e^n^r)+t[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=r+(b^e^n)+t[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=n+(r^b^e)+t[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=e+(n^r^b)+t[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=b+(e^n^r)+t[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=r+(b^e^n)+t[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=n+(r^b^e)+t[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=e+(n^r^b)+t[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=b+(n^(e|~r))+t[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=r+(e^(b|~n))+t[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=n+(b^(r|~e))+t[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=e+(r^(n|~b))+t[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=b+(n^(e|~r))+t[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=r+(e^(b|~n))+t[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=n+(b^(r|~e))+t[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=e+(r^(n|~b))+t[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=b+(n^(e|~r))+t[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=r+(e^(b|~n))+t[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=n+(b^(r|~e))+t[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=e+(r^(n|~b))+t[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((r=(b=e+((o=b+(n^(e|~r))+t[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=r+(e^(b|~n))+t[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((n=r+((o=n+(b^(r|~e))+t[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~b))+t[9]+3951481745&4294967295,a.g[0]=a.g[0]+b&4294967295,a.g[1]=a.g[1]+(n+(o<<21&4294967295|o>>>11))&4294967295,a.g[2]=a.g[2]+n&4294967295,a.g[3]=a.g[3]+r&4294967295}function nr(a,b){this.h=b;for(var e=[],t=!0,n=a.length-1;0<=n;n--){var r=0|a[n];t&&r==b||(e[n]=r,t=!1)}this.g=e}(r=gn.prototype).Oa=function(a){this.M=a},r.ha=function(a,b,e,t){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+a);b=b?b.toUpperCase():"GET",this.I=a,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():it.g(),this.C=this.u?tt(this.u):tt(it),this.g.onreadystatechange=q(this.La,this);try{this.G=!0,this.g.open(b,String(a),!0),this.G=!1}catch(e){return void yn(this,e)}if(a=e||"",e=new Map(this.headers),t)if(Object.getPrototypeOf(t)===Object.prototype)for(var n in t)e.set(n,t[n]);else{if("function"!=typeof t.keys||"function"!=typeof t.get)throw Error("Unknown input type for opt_headers: "+String(t));for(const n of t.keys())e.set(n,t.get(n))}t=Array.from(e.keys()).find((e=>"content-type"==e.toLowerCase())),n=h.FormData&&a instanceof h.FormData,!(0<=T(_n,b))||t||n||e.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,n]of e)this.g.setRequestHeader(t,n);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{In(this),0<this.B&&((this.L=function(a){return L&&"number"==typeof a.timeout&&void 0!==a.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=q(this.ua,this)):this.A=Pe(this.ua,this.B,this)),this.v=!0,this.g.send(a),this.v=!1}catch(e){yn(this,e)}},r.ua=function(){void 0!==l&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ve(this,"timeout"),this.abort(8))},r.abort=function(a){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=a||7,ve(this,"complete"),ve(this,"abort"),bn(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),bn(this,!0)),gn.$.N.call(this)},r.La=function(){this.s||(this.G||this.v||this.l?wn(this):this.kb())},r.kb=function(){wn(this)},r.isActive=function(){return!!this.g},r.da=function(){try{return 2<Tn(this)?this.g.status:-1}catch(e){return-1}},r.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},r.Wa=function(a){if(this.g){var b=this.g.responseText;return a&&0==b.indexOf(a)&&(b=b.substring(a.length)),pn(b)}},r.Ia=function(){return this.m},r.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(r=On.prototype).ra=8,r.H=1,r.Na=function(a){if(this.m)if(this.m=null,1==this.H){if(!a){this.W=Math.floor(1e5*Math.random()),a=this.W++;const n=new ut(this,this.l,a);let r=this.s;if(this.U&&(r?(r=ee(r),ne(r,this.U)):r=this.U),null!==this.o||this.O||(n.I=r,r=null),this.P)e:{for(var b=0,e=0;e<this.j.length;e++){var t=this.j[e];if(void 0===(t="__data__"in t.map&&"string"==typeof(t=t.map.__data__)?t.length:void 0))break;if(4096<(b+=t)){b=e;break e}if(4096===b||e===this.j.length-1){b=e+1;break e}}b=1e3}else b=1e3;b=Ln(this,n,b),Dt(e=Nt(this.I),"RID",a),Dt(e,"CVER",22),this.F&&Dt(e,"X-HTTP-Session-Id",this.F),Pn(this,e),r&&(this.O?b="headers="+encodeURIComponent(String(Cn(r)))+"&"+b:this.o&&Sn(e,this.o,r)),en(this.i,n),this.bb&&Dt(e,"TYPE","init"),this.P?(Dt(e,"$req",b),Dt(e,"SID","null"),n.aa=!0,gt(n,e,null)):gt(n,e,b),this.H=2}}else 3==this.H&&(a?Dn(this,a):0==this.j.length||Jt(this.i)||Dn(this))},r.Ma=function(){if(this.u=null,Un(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var a=2*this.S;this.l.info("BP detection timer enabled: "+a),this.B=Je(q(this.jb,this),a)}},r.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Qe(10),An(this),Un(this))},r.ib=function(){null!=this.v&&(this.v=null,An(this),jn(this),Qe(19))},r.pb=function(a){a?(this.l.info("Successfully pinged google.com"),Qe(2)):(this.l.info("Failed to ping google.com"),Qe(1))},r.isActive=function(){return!!this.h&&this.h.isActive(this)},(r=$n.prototype).Ba=function(){},r.Aa=function(){},r.za=function(){},r.ya=function(){},r.isActive=function(){return!0},r.Va=function(){},Hn.prototype.g=function(a,b){return new Qn(a,b)},w(Qn,ye),Qn.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var a=this.g,b=this.l,e=this.h||void 0;Qe(0),a.Y=b,a.na=e||{},a.G=a.aa,a.I=Wn(a,null,a.Y),xn(a)},Qn.prototype.close=function(){Nn(this.g)},Qn.prototype.u=function(a){var b=this.g;if("string"==typeof a){var e={};e.__data__=a,a=e}else this.v&&((e={}).__data__=be(a),a=e);b.j.push(new Qt(b.fb++,a)),3==b.H&&xn(b)},Qn.prototype.N=function(){this.g.h=null,delete this.j,Nn(this.g),delete this.g,Qn.$.N.call(this)},w(Yn,ot),w(Jn,at),w(Xn,$n),Xn.prototype.Ba=function(){ve(this.g,"a")},Xn.prototype.Aa=function(a){ve(this.g,new Yn(a))},Xn.prototype.za=function(a){ve(this.g,new Jn)},Xn.prototype.ya=function(){ve(this.g,"b")},w(Zn,(function(){this.blockSize=-1})),Zn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Zn.prototype.j=function(a,b){void 0===b&&(b=a.length);for(var e=b-this.blockSize,t=this.m,n=this.h,r=0;r<b;){if(0==n)for(;r<=e;)er(this,a,r),r+=this.blockSize;if("string"==typeof a){for(;r<b;)if(t[n++]=a.charCodeAt(r++),n==this.blockSize){er(this,t),n=0;break}}else for(;r<b;)if(t[n++]=a[r++],n==this.blockSize){er(this,t),n=0;break}}this.h=n,this.i+=b},Zn.prototype.l=function(){var a=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);a[0]=128;for(var b=1;b<a.length-8;++b)a[b]=0;var e=8*this.i;for(b=a.length-8;b<a.length;++b)a[b]=255&e,e/=256;for(this.j(a),a=Array(16),b=e=0;4>b;++b)for(var t=0;32>t;t+=8)a[e++]=this.g[b]>>>t&255;return a};var rr={};function ir(a){return-128<=a&&128>a?function(a,b){var e=rr;return Object.prototype.hasOwnProperty.call(e,a)?e[a]:e[a]=b(a)}(a,(function(b){return new nr([0|b],0>b?-1:0)})):new nr([0|a],0>a?-1:0)}function sr(a){if(isNaN(a)||!isFinite(a))return ar;if(0>a)return fr(sr(-a));for(var b=[],e=1,t=0;a>=e;t++)b[t]=a/e|0,e*=or;return new nr(b,0)}var or=4294967296,ar=ir(0),cr=ir(1),ur=ir(16777216);function lr(a){if(0!=a.h)return!1;for(var b=0;b<a.g.length;b++)if(0!=a.g[b])return!1;return!0}function dr(a){return-1==a.h}function fr(a){for(var b=a.g.length,e=[],t=0;t<b;t++)e[t]=~a.g[t];return new nr(e,~a.h).add(cr)}function pr(a,b){return a.add(fr(b))}function gr(a,b){for(;(65535&a[b])!=a[b];)a[b+1]+=a[b]>>>16,a[b]&=65535,b++}function mr(a,b){this.g=a,this.h=b}function _r(a,b){if(lr(b))throw Error("division by zero");if(lr(a))return new mr(ar,ar);if(dr(a))return b=_r(fr(a),b),new mr(fr(b.g),fr(b.h));if(dr(b))return b=_r(a,fr(b)),new mr(fr(b.g),b.h);if(30<a.g.length){if(dr(a)||dr(b))throw Error("slowDivide_ only works with positive integers.");for(var e=cr,t=b;0>=t.X(a);)e=yr(e),t=yr(t);var n=vr(e,1),r=vr(t,1);for(t=vr(t,2),e=vr(e,2);!lr(t);){var o=r.add(t);0>=o.X(a)&&(n=n.add(e),r=o),t=vr(t,1),e=vr(e,1)}return b=pr(a,n.R(b)),new mr(n,b)}for(n=ar;0<=a.X(b);){for(e=Math.max(1,Math.floor(a.ea()/b.ea())),t=48>=(t=Math.ceil(Math.log(e)/Math.LN2))?1:Math.pow(2,t-48),o=(r=sr(e)).R(b);dr(o)||0<o.X(a);)o=(r=sr(e-=t)).R(b);lr(r)&&(r=cr),n=n.add(r),a=pr(a,o)}return new mr(n,a)}function yr(a){for(var b=a.g.length+1,e=[],t=0;t<b;t++)e[t]=a.D(t)<<1|a.D(t-1)>>>31;return new nr(e,a.h)}function vr(a,b){var e=b>>5;b%=32;for(var t=a.g.length-e,n=[],r=0;r<t;r++)n[r]=0<b?a.D(r+e)>>>b|a.D(r+e+1)<<32-b:a.D(r+e);return new nr(n,a.h)}(r=nr.prototype).ea=function(){if(dr(this))return-fr(this).ea();for(var a=0,b=1,e=0;e<this.g.length;e++){var t=this.D(e);a+=(0<=t?t:or+t)*b,b*=or}return a},r.toString=function(a){if(2>(a=a||10)||36<a)throw Error("radix out of range: "+a);if(lr(this))return"0";if(dr(this))return"-"+fr(this).toString(a);for(var b=sr(Math.pow(a,6)),e=this,t="";;){var n=_r(e,b).g,r=((0<(e=pr(e,n.R(b))).g.length?e.g[0]:e.h)>>>0).toString(a);if(lr(e=n))return r+t;for(;6>r.length;)r="0"+r;t=r+t}},r.D=function(a){return 0>a?0:a<this.g.length?this.g[a]:this.h},r.X=function(a){return dr(a=pr(this,a))?-1:lr(a)?0:1},r.abs=function(){return dr(this)?fr(this):this},r.add=function(a){for(var b=Math.max(this.g.length,a.g.length),e=[],t=0,n=0;n<=b;n++){var r=t+(65535&this.D(n))+(65535&a.D(n)),o=(r>>>16)+(this.D(n)>>>16)+(a.D(n)>>>16);t=o>>>16,r&=65535,o&=65535,e[n]=o<<16|r}return new nr(e,-2147483648&e[e.length-1]?-1:0)},r.R=function(a){if(lr(this)||lr(a))return ar;if(dr(this))return dr(a)?fr(this).R(fr(a)):fr(fr(this).R(a));if(dr(a))return fr(this.R(fr(a)));if(0>this.X(ur)&&0>a.X(ur))return sr(this.ea()*a.ea());for(var b=this.g.length+a.g.length,e=[],t=0;t<2*b;t++)e[t]=0;for(t=0;t<this.g.length;t++)for(var n=0;n<a.g.length;n++){var r=this.D(t)>>>16,o=65535&this.D(t),c=a.D(n)>>>16,l=65535&a.D(n);e[2*t+2*n]+=o*l,gr(e,2*t+2*n),e[2*t+2*n+1]+=r*l,gr(e,2*t+2*n+1),e[2*t+2*n+1]+=o*c,gr(e,2*t+2*n+1),e[2*t+2*n+2]+=r*c,gr(e,2*t+2*n+2)}for(t=0;t<b;t++)e[t]=e[2*t+1]<<16|e[2*t];for(t=b;t<2*b;t++)e[t]=0;return new nr(e,0)},r.gb=function(a){return _r(this,a).h},r.and=function(a){for(var b=Math.max(this.g.length,a.g.length),e=[],t=0;t<b;t++)e[t]=this.D(t)&a.D(t);return new nr(e,this.h&a.h)},r.or=function(a){for(var b=Math.max(this.g.length,a.g.length),e=[],t=0;t<b;t++)e[t]=this.D(t)|a.D(t);return new nr(e,this.h|a.h)},r.xor=function(a){for(var b=Math.max(this.g.length,a.g.length),e=[],t=0;t<b;t++)e[t]=this.D(t)^a.D(t);return new nr(e,this.h^a.h)},Hn.prototype.createWebChannel=Hn.prototype.g,Qn.prototype.send=Qn.prototype.u,Qn.prototype.open=Qn.prototype.m,Qn.prototype.close=Qn.prototype.close,Xe.NO_ERROR=0,Xe.TIMEOUT=8,Xe.HTTP_ERROR=6,Ze.COMPLETE="complete",nt.EventType=st,st.OPEN="a",st.CLOSE="b",st.ERROR="c",st.MESSAGE="d",ye.prototype.listen=ye.prototype.O,gn.prototype.listenOnce=gn.prototype.P,gn.prototype.getLastError=gn.prototype.Sa,gn.prototype.getLastErrorCode=gn.prototype.Ia,gn.prototype.getStatus=gn.prototype.da,gn.prototype.getResponseJson=gn.prototype.Wa,gn.prototype.getResponseText=gn.prototype.ja,gn.prototype.send=gn.prototype.ha,gn.prototype.setWithCredentials=gn.prototype.Oa,Zn.prototype.digest=Zn.prototype.l,Zn.prototype.reset=Zn.prototype.reset,Zn.prototype.update=Zn.prototype.j,nr.prototype.add=nr.prototype.add,nr.prototype.multiply=nr.prototype.R,nr.prototype.modulo=nr.prototype.gb,nr.prototype.compare=nr.prototype.X,nr.prototype.toNumber=nr.prototype.ea,nr.prototype.toString=nr.prototype.toString,nr.prototype.getBits=nr.prototype.D,nr.fromNumber=sr,nr.fromString=function e(a,b){if(0==a.length)throw Error("number format error: empty string");if(2>(b=b||10)||36<b)throw Error("radix out of range: "+b);if("-"==a.charAt(0))return fr(e(a.substring(1),b));if(0<=a.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=sr(Math.pow(b,8)),n=ar,r=0;r<a.length;r+=8){var o=Math.min(8,a.length-r),c=parseInt(a.substring(r,r+o),b);8>o?(o=sr(Math.pow(b,o)),n=n.R(o).add(sr(c))):n=(n=n.R(t)).add(sr(c))}return n};var wr=c.createWebChannelTransport=function(){return new Hn},Ir=c.getStatEventTarget=function(){return We()},Tr=c.ErrorCode=Xe,Er=c.EventType=Ze,Cr=c.Event=ze,Sr=c.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},kr=(c.FetchXmlHttpFactory=cn,c.WebChannel=nt),Or=c.XhrIo=gn,Nr=c.Md5=Zn,Ar=c.Integer=nr}).call(this,n(58))},511:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return Qi})),n.d(t,"b",(function(){return Yi})),n.d(t,"c",(function(){return Nt})),n.d(t,"d",(function(){return es})),n.d(t,"e",(function(){return Hs})),n.d(t,"f",(function(){return m})),n.d(t,"g",(function(){return si})),n.d(t,"h",(function(){return ai})),n.d(t,"i",(function(){return is})),n.d(t,"j",(function(){return Zs})),n.d(t,"k",(function(){return no})),n.d(t,"l",(function(){return Ts})),n.d(t,"m",(function(){return Cs})),n.d(t,"n",(function(){return zs})),n.d(t,"o",(function(){return Xs})),n.d(t,"p",(function(){return Js})),n.d(t,"q",(function(){return hs})),n.d(t,"r",(function(){return eo})),n.d(t,"s",(function(){return to})),n.d(t,"t",(function(){return so})),n.d(t,"u",(function(){return Rs})),n.d(t,"v",(function(){return Ds})),n.d(t,"w",(function(){return ws})),n.d(t,"x",(function(){return ms})),n.d(t,"y",(function(){return _s})),n.d(t,"z",(function(){return ys})),n.d(t,"A",(function(){return vs})),n.d(t,"B",(function(){return gs})),n.d(t,"C",(function(){return Ls})),n.d(t,"D",(function(){return js})),n.d(t,"E",(function(){return Us})),n.d(t,"F",(function(){return qs})),n.d(t,"G",(function(){return ss})),n.d(t,"H",(function(){return Gs})),n.d(t,"I",(function(){return ns})),n.d(t,"J",(function(){return rs})),n.d(t,"K",(function(){return os})),n.d(t,"L",(function(){return ao})),n.d(t,"M",(function(){return io})),n.d(t,"N",(function(){return as})),n.d(t,"O",(function(){return cs})),n.d(t,"P",(function(){return us})),n.d(t,"Q",(function(){return Ns})),n.d(t,"R",(function(){return ks})),n.d(t,"S",(function(){return ls}));var r=n(329),o=n(314),c=n(313),l=n(327);const h="@firebase/database",d="1.0.3";let f="";function m(e){f=e}class _{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Object(c.R)(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Object(c.K)(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class y{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Object(c.k)(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const v=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new _(t)}}catch(e){}return new y},w=v("localStorage"),I=v("sessionStorage"),T=new l.b("@firebase/database"),E=function(){let e=1;return function(){return e++}}(),C=function(e){const t=Object(c.Q)(e),n=new c.d;n.update(t);const r=n.digest();return c.g.encodeByteArray(r)},S=function(...e){let t="";for(let i=0;i<e.length;i++){const n=e[i];Array.isArray(n)||n&&"object"==typeof n&&"number"==typeof n.length?t+=S.apply(null,n):t+="object"==typeof n?Object(c.R)(n):n,t+=" "}return t};let k=null,O=!0;const N=function(e,t){Object(c.e)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(T.logLevel=l.a.VERBOSE,k=T.log.bind(T),t&&I.set("logging_enabled",!0)):"function"==typeof e?k=e:(k=null,I.remove("logging_enabled"))},A=function(...e){if(!0===O&&(O=!1,null===k&&!0===I.get("logging_enabled")&&N(!0)),k){const t=S.apply(null,e);k(t)}},R=function(e){return function(...t){A(e,...t)}},x=function(...e){const t="FIREBASE INTERNAL ERROR: "+S(...e);T.error(t)},D=function(...e){const t=`FIREBASE FATAL ERROR: ${S(...e)}`;throw T.error(t),new Error(t)},P=function(...e){const t="FIREBASE WARNING: "+S(...e);T.warn(t)},L=function(data){return"number"==typeof data&&(data!=data||data===Number.POSITIVE_INFINITY||data===Number.NEGATIVE_INFINITY)},M="[MIN_NAME]",j="[MAX_NAME]",F=function(a,b){if(a===b)return 0;if(a===M||b===j)return-1;if(b===M||a===j)return 1;{const e=$(a),t=$(b);return null!==e?null!==t?e-t==0?a.length-b.length:e-t:-1:null!==t?1:a<b?-1:1}},U=function(a,b){return a===b?0:a<b?-1:1},V=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Object(c.R)(t))},B=function(e){if("object"!=typeof e||null===e)return Object(c.R)(e);const t=[];for(const n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=Object(c.R)(t[i]),n+=":",n+=B(e[t[i]]);return n+="}",n},z=function(e,t){const n=e.length;if(n<=t)return[e];const r=[];for(let o=0;o<n;o+=t)o+t>n?r.push(e.substring(o,n)):r.push(e.substring(o,o+t));return r};function G(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const W=function(e){Object(c.e)(!L(e),"Invalid JSON number");const t=1023;let s,n,r,o,i;0===e?(n=0,r=0,s=1/e==-1/0?1:0):(s=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(o=Math.min(Math.floor(Math.log(e)/Math.LN2),t),n=o+t,r=Math.round(e*Math.pow(2,52-o)-Math.pow(2,52))):(n=0,r=Math.round(e/Math.pow(2,-1074))));const l=[];for(i=52;i;i-=1)l.push(r%2?1:0),r=Math.floor(r/2);for(i=11;i;i-=1)l.push(n%2?1:0),n=Math.floor(n/2);l.push(s?1:0),l.reverse();const h=l.join("");let d="";for(i=0;i<64;i+=8){let e=parseInt(h.substr(i,8),2).toString(16);1===e.length&&(e="0"+e),d+=e}return d.toLowerCase()};const K=new RegExp("^-?(0*)\\d{1,10}$"),$=function(e){if(K.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},H=function(e){try{e()}catch(e){setTimeout((()=>{const t=e.stack||"";throw P("Exception was thrown by user callback.",t),e}),Math.floor(0))}},Q=function(e,time){const t=setTimeout(e,time);return"number"==typeof t&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(t):"object"==typeof t&&t.unref&&t.unref(),t};class Y{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((e=>this.appCheck=e))}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){P(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class J{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(A("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',P(e)}}class X{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}X.OWNER="owner";const Z="5",ee=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,te="ac",ne="websocket",re="long_polling";class ie{constructor(e,t,n,r,o=!1,c="",l=!1,h=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=o,this.persistenceKey=c,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=h,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=w.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&w.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function se(e,t,n){let r;if(Object(c.e)("string"==typeof t,"typeof type must == string"),Object(c.e)("object"==typeof n,"typeof params must == object"),t===ne)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==re)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const o=[];return G(n,((e,t)=>{o.push(e+"="+t)})),r+o.join("&")}class oe{constructor(){this.counters_={}}incrementCounter(e,t=1){Object(c.k)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Object(c.n)(this.counters_)}}const ae={},ce={};function ue(e){const t=e.toString();return ae[t]||(ae[t]=new oe),ae[t]}class le{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,data){for(this.pendingResponses[e]=data;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<e.length;++i)e[i]&&H((()=>{this.onMessage_(e[i])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const he="start";class de{constructor(e,t,n,r,o,c,l){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=o,this.transportSessionId=c,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=R(e),this.stats_=ue(t),this.urlFn=e=>(this.appCheckToken&&(e[te]=this.appCheckToken),se(t,re,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new le(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if(Object(c.G)()||"complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new fe(((...e)=>{const[t,n,r,o,c]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===he)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...e)=>{const[t,data]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,data)}),(()=>{this.onClosed_()}),this.urlFn);const e={};e[he]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=Z,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[te]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&ee.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){de.forceAllow_=!0}static forceDisallow(){de.forceDisallow_=!0}static isAvailable(){return!Object(c.G)()&&(!!de.forceAllow_||!(de.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(data){const e=Object(c.R)(data);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const t=Object(c.i)(e),n=z(t,1840);for(let i=0;i<n.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Object(c.G)())return;this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Object(c.R)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class fe{constructor(e,t,n,r){if(this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,Object(c.G)())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=E(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=fe.createIFrame_();let script="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){script='<script>document.domain="'+document.domain+'";<\/script>'}const n="<html><body>"+script+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(n),this.myIFrame.doc.close()}catch(e){A("frame writing exception"),e.stack&&A(e.stack),A(e)}}}static createIFrame_(){const iframe=document.createElement("iframe");if(iframe.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(iframe);try{iframe.contentWindow.document||A("No IE domain setting required")}catch(e){const t=document.domain;iframe.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return iframe.contentDocument?iframe.doc=iframe.contentDocument:iframe.contentWindow?iframe.doc=iframe.contentWindow.document:iframe.document&&(iframe.doc=iframe.document),iframe}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;{const e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,data){this.pendingSegs.push({seg:e,ts:t,d:data}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(r),n()}))}addTag(e,t){Object(c.G)()?this.doNodeLongPoll(e,t):setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{A("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}}),Math.floor(1))}}let pe=null;"undefined"!=typeof MozWebSocket?pe=MozWebSocket:"undefined"!=typeof WebSocket&&(pe=WebSocket);class ge{constructor(e,t,n,r,o,c,l){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=R(this.connId),this.stats_=ue(t),this.connURL=ge.connectionURL_(t,c,l,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,o){const l={};return l.v=Z,!Object(c.G)()&&"undefined"!=typeof location&&location.hostname&&ee.test(location.hostname)&&(l.r="f"),t&&(l.s=t),n&&(l.ls=n),r&&(l[te]=r),o&&(l.p=o),se(e,ne,l)}open(t,n){this.onDisconnect=n,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,w.set("previous_websocket_failure",!0);try{let t;if(Object(c.G)()){const n=this.nodeAdmin?"AdminNode":"Node";t={headers:{"User-Agent":`Firebase/${Z}/${f}/${e.platform}/${n}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(t.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(t.headers["X-Firebase-AppCheck"]=this.appCheckToken);const r=e.env,o=0===this.connURL.indexOf("wss://")?r.HTTPS_PROXY||r.https_proxy:r.HTTP_PROXY||r.http_proxy;o&&(t.proxy={origin:o})}this.mySock=new pe(this.connURL,[],t)}catch(e){this.log_("Error instantiating WebSocket.");const t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){ge.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==pe&&!ge.forceDisallow_}static previouslyFailed(){return w.isInMemoryStorage||!0===w.get("previous_websocket_failure")}markConnectionHealthy(){w.remove("previous_websocket_failure")}appendFrame_(data){if(this.frames.push(data),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=Object(c.K)(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(data){if(Object(c.e)(null===this.frames,"We already have a frame buffer"),data.length<=6){const e=Number(data);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),data}handleIncomingFrame(e){if(null===this.mySock)return;const data=e.data;if(this.bytesReceived+=data.length,this.stats_.incrementCounter("bytes_received",data.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(data);else{const e=this.extractFrameCount_(data);null!==e&&this.appendFrame_(e)}}send(data){this.resetKeepAlive();const e=Object(c.R)(data);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const t=z(e,16384);t.length>1&&this.sendString_(String(t.length));for(let i=0;i<t.length;i++)this.sendString_(t[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ge.responsesRequiredToBeHealthy=2,ge.healthyTimeout=3e4;class me{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[de,ge]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=ge&&ge.isAvailable();let n=t&&!ge.previouslyFailed();if(e.webSocketOnly&&(t||P("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[ge];else{const e=this.transports_=[];for(const t of me.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);me.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}me.globalTransportInitialized_=!1;class _e{constructor(e,t,n,r,o,c,l,h,d,f){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=o,this.onMessage_=c,this.onReady_=l,this.onDisconnect_=h,this.onKill_=d,this.lastSessionId=f,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=R("c:"+this.id+":"),this.transportManager_=new me(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=Q((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=V("t",e),data=V("d",e);if("c"===t)this.onSecondaryControl_(data);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(data)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=V("t",e),data=V("d",e);"c"===t?this.onControl_(data):"d"===t&&this.onDataMessage_(data)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=V("t",e);if("d"in e){const n=e.d;if("h"===t){const e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?x("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):x("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Z!==n&&P("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),Q((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Q((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(w.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(data){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(data)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class ye{put(e,data,t,n){}merge(e,data,t,n){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,data,t){}onDisconnectMerge(e,data,t){}onDisconnectCancel(e,t){}reportStats(e){}}class ve{constructor(e){this.allowedEvents_=e,this.listeners_={},Object(c.e)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let i=0;i<n.length;i++)n[i].callback.apply(n[i].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(e){Object(c.e)(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class we extends ve{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Object(c.E)()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new we}getInitialEvent(e){return Object(c.e)("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const be=32,Ie=768;class Te{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[t]=this.pieces_[i],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let i=this.pieceNum_;i<this.pieces_.length;i++)""!==this.pieces_[i]&&(e+="/"+this.pieces_[i]);return e||"/"}}function Ee(){return new Te("")}function Ce(path){return path.pieceNum_>=path.pieces_.length?null:path.pieces_[path.pieceNum_]}function Se(path){return path.pieces_.length-path.pieceNum_}function ke(path){let e=path.pieceNum_;return e<path.pieces_.length&&e++,new Te(path.pieces_,e)}function Oe(path){return path.pieceNum_<path.pieces_.length?path.pieces_[path.pieces_.length-1]:null}function Ne(path,e=0){return path.pieces_.slice(path.pieceNum_+e)}function Ae(path){if(path.pieceNum_>=path.pieces_.length)return null;const e=[];for(let i=path.pieceNum_;i<path.pieces_.length-1;i++)e.push(path.pieces_[i]);return new Te(e,0)}function Re(path,e){const t=[];for(let i=path.pieceNum_;i<path.pieces_.length;i++)t.push(path.pieces_[i]);if(e instanceof Te)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{const n=e.split("/");for(let i=0;i<n.length;i++)n[i].length>0&&t.push(n[i])}return new Te(t,0)}function xe(path){return path.pieceNum_>=path.pieces_.length}function De(e,t){const n=Ce(e),r=Ce(t);if(null===n)return t;if(n===r)return De(ke(e),ke(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Pe(e,t){const n=Ne(e,0),r=Ne(t,0);for(let i=0;i<n.length&&i<r.length;i++){const e=F(n[i],r[i]);if(0!==e)return e}return n.length===r.length?0:n.length<r.length?-1:1}function Le(path,e){if(Se(path)!==Se(e))return!1;for(let i=path.pieceNum_,t=e.pieceNum_;i<=path.pieces_.length;i++,t++)if(path.pieces_[i]!==e.pieces_[t])return!1;return!0}function Me(path,e){let i=path.pieceNum_,t=e.pieceNum_;if(Se(path)>Se(e))return!1;for(;i<path.pieces_.length;){if(path.pieces_[i]!==e.pieces_[t])return!1;++i,++t}return!0}class je{constructor(path,e){this.errorPrefix_=e,this.parts_=Ne(path,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Object(c.P)(this.parts_[i]);Fe(this)}}function Fe(e){if(e.byteLength_>Ie)throw new Error(e.errorPrefix_+"has a key path longer than "+Ie+" bytes ("+e.byteLength_+").");if(e.parts_.length>be)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+be+") or object contains a cycle "+Ue(e))}function Ue(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class Ve extends ve{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}static getInstance(){return new Ve}getInitialEvent(e){return Object(c.e)("visible"===e,"Unknown event type: "+e),[this.visible_]}}const qe=1e3;class Be extends ye{constructor(e,t,n,r,o,l,h,d){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=l,this.appCheckTokenProvider_=h,this.authOverride_=d,this.id=Be.nextPersistentConnectionId_++,this.log_=R("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=qe,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,d&&!Object(c.G)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Ve.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&we.getInstance().on("online",this.onOnline_,this)}sendRequest(e,body,t){const n=++this.requestNumber_,r={r:n,a:e,b:body};this.log_(Object(c.R)(r)),Object(c.e)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),t&&(this.requestCBHash_[n]=t)}get(e){this.initConnection_();const t=new c.a,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,n,r){this.initConnection_();const o=e._queryIdentifier,l=e._path.toString();this.log_("Listen called for "+l+" "+o),this.listens.has(l)||this.listens.set(l,new Map),Object(c.e)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Object(c.e)(!this.listens.get(l).has(o),"listen() called twice for same path/queryId.");const h={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(l).set(o,h),this.connected_&&this.sendListen_(h)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);const o={p:n};e.tag&&(o.q=t._queryObject,o.t=e.tag),o.h=e.hashFn(),this.sendRequest("q",o,(o=>{const c=o.d,l=o.s;Be.warnOnListenWarnings_(c,t);(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",o),"ok"!==l&&this.removeListen_(n,r),e.onComplete&&e.onComplete(l,c))}))}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&Object(c.k)(e,"w")){const n=Object(c.O)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();P(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||Object(c.y)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=Object(c.J)(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,data=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,data))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,data=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,data)}))}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),Object(c.e)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const o={p:e};r&&(o.q=n,o.t=r),this.sendRequest("n",o)}onDisconnectPut(e,data,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,data,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:data,onComplete:t})}onDisconnectMerge(e,data,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,data,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:data,onComplete:t})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,data,n){const r={p:t,d:data};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,(e=>{n&&setTimeout((()=>{n(e.s,e.d)}),Math.floor(0))}))}put(e,data,t,n){this.putInternal("p",e,data,t,n)}merge(e,data,t,n){this.putInternal("m",e,data,t,n)}putInternal(e,t,data,n,r){this.initConnection_();const o={p:t,d:data};void 0!==r&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:n}),this.outstandingPutCount_++;const c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Object(c.R)(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,body){this.log_("handleServerMessage",e,body),"d"===e?this.onDataUpdate_(body.p,body.d,!1,body.t):"m"===e?this.onDataUpdate_(body.p,body.d,!0,body.t):"c"===e?this.onListenRevoked_(body.p,body.q):"ac"===e?this.onAuthRevoked_(body.s,body.d):"apc"===e?this.onAppCheckRevoked_(body.s,body.d):"sd"===e?this.onSecurityDebugPacket_(body):x("Unrecognized action received from server: "+Object(c.R)(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Object(c.e)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=qe,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=qe,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=qe),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+Be.nextConnectionId_++,o=this.lastSessionId;let l=!1,h=null;const d=function(){h?h.close():(l=!0,n())},f=function(e){Object(c.e)(h,"sendRequest call when we're not connected not allowed."),h.sendRequest(e)};this.realtime_={close:d,sendRequest:f};const m=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[c,d]=await Promise.all([this.authTokenProvider_.getToken(m),this.appCheckTokenProvider_.getToken(m)]);l?A("getToken() completed but was canceled"):(A("getToken() completed. Creating connection."),this.authToken_=c&&c.accessToken,this.appCheckToken_=d&&d.token,h=new _e(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,(e=>{P(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),o))}catch(e){this.log_("Failed to get token: "+e),l||(this.repoInfo_.nodeAdmin&&P(e),d())}}}interrupt(e){A("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){A("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Object(c.B)(this.interruptReasons_)&&(this.reconnectDelay_=qe,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let i=0;i<this.outstandingPuts_.length;i++){const e=this.outstandingPuts_[i];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[i],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((q=>B(q))).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new Te(e).toString();let r;if(this.listens.has(n)){const map=this.listens.get(n);r=map.get(t),map.delete(t),0===map.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){A("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){A("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(body){this.securityDebugCallback_?this.securityDebugCallback_(body):"msg"in body&&console.log("FIREBASE: "+body.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let i=0;i<this.outstandingPuts_.length;i++)this.outstandingPuts_[i]&&this.sendPut_(i);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let i=0;i<this.outstandingGets_.length;i++)this.outstandingGets_[i]&&this.sendGet_(i)}sendConnectStats_(){const e={};let t="js";Object(c.G)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+f.replace(/\./g,"-")]=1,Object(c.E)()?e["framework.cordova"]=1:Object(c.H)()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=we.getInstance().currentlyOnline();return Object(c.B)(this.interruptReasons_)&&e}}Be.nextPersistentConnectionId_=0,Be.nextConnectionId_=0;class ze{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new ze(e,t)}}class Ge{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new ze(M,e),r=new ze(M,t);return 0!==this.compare(n,r)}minPost(){return ze.MIN}}let We;class Ke extends Ge{static get __EMPTY_NODE(){return We}static set __EMPTY_NODE(e){We=e}compare(a,b){return F(a.name,b.name)}isDefinedOn(e){throw Object(c.f)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return ze.MIN}maxPost(){return new ze(j,We)}makePost(e,t){return Object(c.e)("string"==typeof e,"KeyIndex indexValue must always be a string."),new ze(e,We)}toString(){return".key"}}const $e=new Ke;class He{constructor(e,t,n,r,o=null){this.isReverse_=r,this.resultGenerator_=o,this.nodeStack_=[];let c=1;for(;!e.isEmpty();)if(c=t?n(e.key,t):1,r&&(c*=-1),c<0)e=this.isReverse_?e.left:e.right;else{if(0===c){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Qe{constructor(e,t,n,r,o){this.key=e,this.value=t,this.color=null!=n?n:Qe.RED,this.left=null!=r?r:Ye.EMPTY_NODE,this.right=null!=o?o:Ye.EMPTY_NODE}copy(e,t,n,r,o){return new Qe(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=o?o:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const o=n(e,r.key);return r=o<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===o?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return Ye.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Ye.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Qe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Qe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Qe.RED=!0,Qe.BLACK=!1;class Ye{constructor(e,t=Ye.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Ye(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Qe.BLACK,null,null))}remove(e){return new Ye(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Qe.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new He(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new He(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new He(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new He(this.root_,null,this.comparator_,!0,e)}}function Je(e,t){return F(e.name,t.name)}function Xe(e,t){return F(e,t)}let Ze;Ye.EMPTY_NODE=new class{copy(e,t,n,r,o){return this}insert(e,t,n){return new Qe(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const et=function(e){return"number"==typeof e?"number:"+W(e):"string:"+e},tt=function(e){if(e.isLeafNode()){const t=e.val();Object(c.e)("string"==typeof t||"number"==typeof t||"object"==typeof t&&Object(c.k)(t,".sv"),"Priority must be a string or number.")}else Object(c.e)(e===Ze||e.isEmpty(),"priority of unexpected type.");Object(c.e)(e===Ze||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let nt,it,st;class ot{constructor(e,t=ot.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Object(c.e)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),tt(this.priorityNode_)}static set __childrenNodeConstructor(e){nt=e}static get __childrenNodeConstructor(){return nt}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new ot(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:ot.__childrenNodeConstructor.EMPTY_NODE}getChild(path){return xe(path)?this:".priority"===Ce(path)?this.priorityNode_:ot.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:ot.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(path,e){const t=Ce(path);return null===t?e:e.isEmpty()&&".priority"!==t?this:(Object(c.e)(".priority"!==t||1===Se(path),".priority must be the last token in a path"),this.updateImmediateChild(t,ot.__childrenNodeConstructor.EMPTY_NODE.updateChild(ke(path),e)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+et(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?W(this.value_):this.value_,this.lazyHash_=C(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===ot.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof ot.__childrenNodeConstructor?-1:(Object(c.e)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,r=ot.VALUE_TYPE_ORDER.indexOf(t),o=ot.VALUE_TYPE_ORDER.indexOf(n);return Object(c.e)(r>=0,"Unknown leaf type: "+t),Object(c.e)(o>=0,"Unknown leaf type: "+n),r===o?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}ot.VALUE_TYPE_ORDER=["object","boolean","number","string"];const at=new class extends Ge{compare(a,b){const e=a.node.getPriority(),t=b.node.getPriority(),n=e.compareTo(t);return 0===n?F(a.name,b.name):n}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return ze.MIN}maxPost(){return new ze(j,new ot("[PRIORITY-POST]",st))}makePost(e,t){const n=it(e);return new ze(t,new ot("[PRIORITY-POST]",n))}toString(){return".priority"}},ct=Math.log(2);class ut{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/ct,10)),this.current_=this.count-1;const mask=(n=this.count,parseInt(Array(n+1).join("1"),2));var n;this.bits_=e+1&mask}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const lt=function(e,t,n,r){e.sort(t);const o=function(t,r){const c=r-t;let l,h;if(0===c)return null;if(1===c)return l=e[t],h=n?n(l):l,new Qe(h,l.node,Qe.BLACK,null,null);{const d=parseInt(c/2,10)+t,f=o(t,d),m=o(d+1,r);return l=e[d],h=n?n(l):l,new Qe(h,l.node,Qe.BLACK,f,m)}},c=function(t){let r=null,c=null,l=e.length;const h=function(t,r){const c=l-t,h=l;l-=t;const f=o(c+1,h),m=e[c],_=n?n(m):m;d(new Qe(_,m.node,r,null,f))},d=function(e){r?(r.left=e,r=e):(c=e,r=e)};for(let i=0;i<t.count;++i){const e=t.nextBitIsOne(),n=Math.pow(2,t.count-(i+1));e?h(n,Qe.BLACK):(h(n,Qe.BLACK),h(n,Qe.RED))}return c}(new ut(e.length));return new Ye(r||t,c)};let ht;const ft={};class pt{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return Object(c.e)(ft&&at,"ChildrenNode.ts has not been loaded"),ht=ht||new pt({".priority":ft},{".priority":at}),ht}get(e){const t=Object(c.O)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Ye?t:null}hasIndex(e){return Object(c.k)(this.indexSet_,e.toString())}addIndex(e,t){Object(c.e)(e!==$e,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const o=t.getIterator(ze.Wrap);let l,h=o.getNext();for(;h;)r=r||e.isDefinedOn(h.node),n.push(h),h=o.getNext();l=r?lt(n,e.getCompare()):ft;const d=e.toString(),f=Object.assign({},this.indexSet_);f[d]=e;const m=Object.assign({},this.indexes_);return m[d]=l,new pt(m,f)}addToIndexes(e,t){const n=Object(c.L)(this.indexes_,((n,r)=>{const o=Object(c.O)(this.indexSet_,r);if(Object(c.e)(o,"Missing index implementation for "+r),n===ft){if(o.isDefinedOn(e.node)){const n=[],r=t.getIterator(ze.Wrap);let c=r.getNext();for(;c;)c.name!==e.name&&n.push(c),c=r.getNext();return n.push(e),lt(n,o.getCompare())}return ft}{const r=t.get(e.name);let o=n;return r&&(o=o.remove(new ze(e.name,r))),o.insert(e,e.node)}}));return new pt(n,this.indexSet_)}removeFromIndexes(e,t){const n=Object(c.L)(this.indexes_,(n=>{if(n===ft)return n;{const r=t.get(e.name);return r?n.remove(new ze(e.name,r)):n}}));return new pt(n,this.indexSet_)}}let gt;class mt{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&tt(this.priorityNode_),this.children_.isEmpty()&&Object(c.e)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return gt||(gt=new mt(new Ye(Xe),null,pt.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||gt}updatePriority(e){return this.children_.isEmpty()?this:new mt(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?gt:t}}getChild(path){const e=Ce(path);return null===e?this:this.getImmediateChild(e).getChild(ke(path))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(Object(c.e)(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new ze(e,t);let r,o;t.isEmpty()?(r=this.children_.remove(e),o=this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(e,t),o=this.indexMap_.addToIndexes(n,this.children_));const c=r.isEmpty()?gt:this.priorityNode_;return new mt(r,c,o)}}updateChild(path,e){const t=Ce(path);if(null===t)return e;{Object(c.e)(".priority"!==Ce(path)||1===Se(path),".priority must be the last token in a path");const n=this.getImmediateChild(t).updateChild(ke(path),e);return this.updateImmediateChild(t,n)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,r=0,o=!0;if(this.forEachChild(at,((c,l)=>{t[c]=l.val(e),n++,o&&mt.INTEGER_REGEXP_.test(c)?r=Math.max(r,Number(c)):o=!1})),!e&&o&&r<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+et(this.getPriority().val())+":"),this.forEachChild(at,((t,n)=>{const r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":C(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const n=r.getPredecessorKey(new ze(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new ze(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new ze(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,ze.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)<0;)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,ze.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===_t?-1:0}withIndex(e){if(e===$e||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new mt(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===$e||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(at),n=t.getIterator(at);let r=e.getNext(),o=n.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=e.getNext(),o=n.getNext()}return null===r&&null===o}return!1}return!1}}resolveIndex_(e){return e===$e?null:this.indexMap_.get(e.toString())}}mt.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const _t=new class extends mt{constructor(){super(new Ye(Xe),mt.EMPTY_NODE,pt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return mt.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(ze,{MIN:{value:new ze(M,mt.EMPTY_NODE)},MAX:{value:new ze(j,_t)}}),Ke.__EMPTY_NODE=mt.EMPTY_NODE,ot.__childrenNodeConstructor=mt,Ze=_t,function(e){st=e}(_t);const yt=!0;function vt(e,t=null){if(null===e)return mt.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),Object(c.e)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e){return new ot(e,vt(t))}if(e instanceof Array||!yt){let n=mt.EMPTY_NODE;return G(e,((t,r)=>{if(Object(c.k)(e,t)&&"."!==t.substring(0,1)){const e=vt(r);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}})),n.updatePriority(vt(t))}{const n=[];let r=!1;if(G(e,((e,t)=>{if("."!==e.substring(0,1)){const o=vt(t);o.isEmpty()||(r=r||!o.getPriority().isEmpty(),n.push(new ze(e,o)))}})),0===n.length)return mt.EMPTY_NODE;const o=lt(n,Je,(e=>e.name),Xe);if(r){const e=lt(n,at.getCompare());return new mt(o,vt(t),new pt({".priority":e},{".priority":at}))}return new mt(o,vt(t),pt.Default)}}!function(e){it=e}(vt);class wt extends Ge{constructor(e){super(),this.indexPath_=e,Object(c.e)(!xe(e)&&".priority"!==Ce(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(a,b){const e=this.extractChild(a.node),t=this.extractChild(b.node),n=e.compareTo(t);return 0===n?F(a.name,b.name):n}makePost(e,t){const n=vt(e),r=mt.EMPTY_NODE.updateChild(this.indexPath_,n);return new ze(t,r)}maxPost(){const e=mt.EMPTY_NODE.updateChild(this.indexPath_,_t);return new ze(j,e)}toString(){return Ne(this.indexPath_,0).join("/")}}const bt=new class extends Ge{compare(a,b){const e=a.node.compareTo(b.node);return 0===e?F(a.name,b.name):e}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return ze.MIN}maxPost(){return ze.MAX}makePost(e,t){const n=vt(e);return new ze(t,n)}toString(){return".value"}};function It(e){return{type:"value",snapshotNode:e}}function Tt(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Et(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Ct(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class St{constructor(e){this.index_=e}updateChild(e,t,n,r,source,o){Object(c.e)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(t);return l.getChild(r).equals(n.getChild(r))&&l.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(Et(t,l)):Object(c.e)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(Tt(t,n)):o.trackChildChange(Ct(t,n,l))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(at,((e,r)=>{t.hasChild(e)||n.trackChildChange(Et(e,r))})),t.isLeafNode()||t.forEachChild(at,((t,r)=>{if(e.hasChild(t)){const o=e.getImmediateChild(t);o.equals(r)||n.trackChildChange(Ct(t,r,o))}else n.trackChildChange(Tt(t,r))}))),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?mt.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class kt{constructor(e){this.indexedFilter_=new St(e.getIndex()),this.index_=e.getIndex(),this.startPost_=kt.getStartPost_(e),this.endPost_=kt.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,r,source,o){return this.matches(new ze(t,n))||(n=mt.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,source,o)}updateFullNode(e,t,n){t.isLeafNode()&&(t=mt.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(mt.EMPTY_NODE);const o=this;return t.forEachChild(at,((e,t)=>{o.matches(new ze(e,t))||(r=r.updateImmediateChild(e,mt.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class Ot{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new kt(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,source,o){return this.rangedFilter_.matches(new ze(t,n))||(n=mt.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,source,o):this.fullLimitUpdateChild_(e,t,n,source,o)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=mt.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;r=mt.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;r=r.updateImmediateChild(t.name,t.node),n++}}}else{let e;r=t.withIndex(this.index_),r=r.updatePriority(mt.EMPTY_NODE),e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);let n=0;for(;e.hasNext();){const t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:r=r.updateImmediateChild(t.name,mt.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,source,r){let o;if(this.reverse_){const e=this.index_.getCompare();o=(a,b)=>e(b,a)}else o=this.index_.getCompare();const l=e;Object(c.e)(l.numChildren()===this.limit_,"");const h=new ze(t,n),d=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),f=this.rangedFilter_.matches(h);if(l.hasChild(t)){const e=l.getImmediateChild(t);let c=source.getChildAfterChild(this.index_,d,this.reverse_);for(;null!=c&&(c.name===t||l.hasChild(c.name));)c=source.getChildAfterChild(this.index_,c,this.reverse_);const m=null==c?1:o(c,h);if(f&&!n.isEmpty()&&m>=0)return null!=r&&r.trackChildChange(Ct(t,n,e)),l.updateImmediateChild(t,n);{null!=r&&r.trackChildChange(Et(t,e));const n=l.updateImmediateChild(t,mt.EMPTY_NODE);return null!=c&&this.rangedFilter_.matches(c)?(null!=r&&r.trackChildChange(Tt(c.name,c.node)),n.updateImmediateChild(c.name,c.node)):n}}return n.isEmpty()?e:f&&o(d,h)>=0?(null!=r&&(r.trackChildChange(Et(d.name,d.node)),r.trackChildChange(Tt(t,n))),l.updateImmediateChild(t,n).updateImmediateChild(d.name,mt.EMPTY_NODE)):e}}class Nt{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=at}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return Object(c.e)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Object(c.e)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:M}hasEnd(){return this.endSet_}getIndexEndValue(){return Object(c.e)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Object(c.e)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:j}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return Object(c.e)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===at}copy(){const e=new Nt;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function At(e,t,n){const r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function Rt(e,t,n){const r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function xt(e,t){const n=e.copy();return n.index_=t,n}function Dt(e){const t={};if(e.isDefault())return t;let n;if(e.index_===at?n="$priority":e.index_===bt?n="$value":e.index_===$e?n="$key":(Object(c.e)(e.index_ instanceof wt,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=Object(c.R)(n),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=Object(c.R)(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+Object(c.R)(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=Object(c.R)(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+Object(c.R)(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function Pt(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==at&&(t.i=e.index_.toString()),t}class Lt extends ye{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=R("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(Object(c.e)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,r){const o=e._path.toString();this.log_("Listen called for "+o+" "+e._queryIdentifier);const l=Lt.getListenId_(e,n),h={};this.listens_[l]=h;const d=Dt(e._queryParams);this.restRequest_(o+".json",d,((e,t)=>{let data=t;if(404===e&&(data=null,e=null),null===e&&this.onDataUpdate_(o,data,!1,n),Object(c.O)(this.listens_,l)===h){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",r(t,null)}}))}unlisten(e,t){const n=Lt.getListenId_(e,t);delete this.listens_[n]}get(e){const t=Dt(e._queryParams),n=e._path.toString(),r=new c.a;return this.restRequest_(n+".json",t,((e,t)=>{let data=t;404===e&&(data=null,e=null),null===e?(this.onDataUpdate_(n,data,!1,null),r.resolve(data)):r.reject(new Error(data))})),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([r,o])=>{r&&r.accessToken&&(t.auth=r.accessToken),o&&o.token&&(t.ac=o.token);const l=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Object(c.M)(t);this.log_("Sending REST request for "+l);const h=new XMLHttpRequest;h.onreadystatechange=()=>{if(n&&4===h.readyState){this.log_("REST Response for "+l+" received. status:",h.status,"response:",h.responseText);let e=null;if(h.status>=200&&h.status<300){try{e=Object(c.K)(h.responseText)}catch(e){P("Failed to parse JSON response for "+l+": "+h.responseText)}n(null,e)}else 401!==h.status&&404!==h.status&&P("Got unsuccessful REST response for "+l+" Status: "+h.status),n(h.status);n=null}},h.open("GET",l,!0),h.send()}))}}class Mt{constructor(){this.rootNode_=mt.EMPTY_NODE}getNode(path){return this.rootNode_.getChild(path)}updateSnapshot(path,e){this.rootNode_=this.rootNode_.updateChild(path,e)}}function jt(){return{value:null,children:new Map}}function Ft(e,path,data){if(xe(path))e.value=data,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(path,data);else{const t=Ce(path);e.children.has(t)||e.children.set(t,jt());Ft(e.children.get(t),path=ke(path),data)}}function Ut(e,path){if(xe(path))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;{const t=e.value;return e.value=null,t.forEachChild(at,((t,n)=>{Ft(e,new Te(t),n)})),Ut(e,path)}}if(e.children.size>0){const t=Ce(path);if(path=ke(path),e.children.has(t)){Ut(e.children.get(t),path)&&e.children.delete(t)}return 0===e.children.size}return!0}function Vt(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,r)=>{Vt(r,new Te(t.toString()+"/"+e),n)}))}class qt{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&G(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class Bt{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new qt(e);const n=1e4+2e4*Math.random();Q(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;G(e,((e,r)=>{r>0&&Object(c.k)(this.statsToReport_,e)&&(t[e]=r,n=!0)})),n&&this.server_.reportStats(t),Q(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var zt;function Gt(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(zt||(zt={}));class Wt{constructor(path,e,t){this.path=path,this.affectedTree=e,this.revert=t,this.type=zt.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(xe(this.path)){if(null!=this.affectedTree.value)return Object(c.e)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Te(e));return new Wt(Ee(),t,this.revert)}}return Object(c.e)(Ce(this.path)===e,"operationForChild called for unrelated child."),new Wt(ke(this.path),this.affectedTree,this.revert)}}class Kt{constructor(source,path){this.source=source,this.path=path,this.type=zt.LISTEN_COMPLETE}operationForChild(e){return xe(this.path)?new Kt(this.source,Ee()):new Kt(this.source,ke(this.path))}}class $t{constructor(source,path,e){this.source=source,this.path=path,this.snap=e,this.type=zt.OVERWRITE}operationForChild(e){return xe(this.path)?new $t(this.source,Ee(),this.snap.getImmediateChild(e)):new $t(this.source,ke(this.path),this.snap)}}class Ht{constructor(source,path,e){this.source=source,this.path=path,this.children=e,this.type=zt.MERGE}operationForChild(e){if(xe(this.path)){const t=this.children.subtree(new Te(e));return t.isEmpty()?null:t.value?new $t(this.source,Ee(),t.value):new Ht(this.source,Ee(),t)}return Object(c.e)(Ce(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Ht(this.source,ke(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Qt{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(path){if(xe(path))return this.isFullyInitialized()&&!this.filtered_;const e=Ce(path);return this.isCompleteForChild(e)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Yt{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Jt(e,t,n,r,o,l){const h=r.filter((e=>e.type===n));h.sort(((a,b)=>function(e,a,b){if(null==a.childName||null==b.childName)throw Object(c.f)("Should only compare child_ events.");const t=new ze(a.childName,a.snapshotNode),n=new ze(b.childName,b.snapshotNode);return e.index_.compare(t,n)}(e,a,b))),h.forEach((n=>{const r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,l);o.forEach((o=>{o.respondsTo(n.type)&&t.push(o.createEvent(r,e.query_))}))}))}function Xt(e,t){return{eventCache:e,serverCache:t}}function Zt(e,t,n,r){return Xt(new Qt(t,n,r),e.serverCache)}function en(e,t,n,r){return Xt(e.eventCache,new Qt(t,n,r))}function tn(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function nn(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let rn;class sn{constructor(e,t=(()=>(rn||(rn=new Ye(U)),rn))()){this.value=e,this.children=t}static fromObject(e){let t=new sn(null);return G(e,((e,n)=>{t=t.set(new Te(e),n)})),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Ee(),value:this.value};if(xe(e))return null;{const n=Ce(e),r=this.children.get(n);if(null!==r){const o=r.findRootMostMatchingPathAndValue(ke(e),t);if(null!=o){return{path:Re(new Te(n),o.path),value:o.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(xe(e))return this;{const t=Ce(e),n=this.children.get(t);return null!==n?n.subtree(ke(e)):new sn(null)}}set(e,t){if(xe(e))return new sn(t,this.children);{const n=Ce(e),r=(this.children.get(n)||new sn(null)).set(ke(e),t),o=this.children.insert(n,r);return new sn(this.value,o)}}remove(e){if(xe(e))return this.children.isEmpty()?new sn(null):new sn(null,this.children);{const t=Ce(e),n=this.children.get(t);if(n){const r=n.remove(ke(e));let o;return o=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&o.isEmpty()?new sn(null):new sn(this.value,o)}return this}}get(e){if(xe(e))return this.value;{const t=Ce(e),n=this.children.get(t);return n?n.get(ke(e)):null}}setTree(e,t){if(xe(e))return t;{const n=Ce(e),r=(this.children.get(n)||new sn(null)).setTree(ke(e),t);let o;return o=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new sn(this.value,o)}}fold(e){return this.fold_(Ee(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((r,o)=>{n[r]=o.fold_(Re(e,r),t)})),t(e,this.value,n)}findOnPath(path,e){return this.findOnPath_(path,Ee(),e)}findOnPath_(e,t,n){const r=!!this.value&&n(t,this.value);if(r)return r;if(xe(e))return null;{const r=Ce(e),o=this.children.get(r);return o?o.findOnPath_(ke(e),Re(t,r),n):null}}foreachOnPath(path,e){return this.foreachOnPath_(path,Ee(),e)}foreachOnPath_(e,t,n){if(xe(e))return this;{this.value&&n(t,this.value);const r=Ce(e),o=this.children.get(r);return o?o.foreachOnPath_(ke(e),Re(t,r),n):new sn(null)}}foreach(e){this.foreach_(Ee(),e)}foreach_(e,t){this.children.inorderTraversal(((n,r)=>{r.foreach_(Re(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class on{constructor(e){this.writeTree_=e}static empty(){return new on(new sn(null))}}function an(e,path,t){if(xe(path))return new on(new sn(t));{const n=e.writeTree_.findRootMostValueAndPath(path);if(null!=n){const r=n.path;let o=n.value;const c=De(r,path);return o=o.updateChild(c,t),new on(e.writeTree_.set(r,o))}{const n=new sn(t),r=e.writeTree_.setTree(path,n);return new on(r)}}}function cn(e,path,t){let n=e;return G(t,((e,t)=>{n=an(n,Re(path,e),t)})),n}function un(e,path){if(xe(path))return on.empty();{const t=e.writeTree_.setTree(path,new sn(null));return new on(t)}}function ln(e,path){return null!=hn(e,path)}function hn(e,path){const t=e.writeTree_.findRootMostValueAndPath(path);return null!=t?e.writeTree_.get(t.path).getChild(De(t.path,path)):null}function dn(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(at,((e,n)=>{t.push(new ze(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new ze(e,n.value))})),t}function fn(e,path){if(xe(path))return e;{const t=hn(e,path);return new on(null!=t?new sn(t):e.writeTree_.subtree(path))}}function pn(e){return e.writeTree_.isEmpty()}function gn(e,t){return mn(Ee(),e.writeTree_,t)}function mn(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal(((t,o)=>{".priority"===t?(Object(c.e)(null!==o.value,"Priority writes must always be leaf nodes"),r=o.value):n=mn(Re(e,t),o,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(Re(e,".priority"),r)),n}}function _n(e,path){return An(path,e)}function yn(e,t){const n=e.allWrites.findIndex((s=>s.writeId===t));Object(c.e)(n>=0,"removeWrite called with nonexistent writeId.");const r=e.allWrites[n];e.allWrites.splice(n,1);let o=r.visible,l=!1,i=e.allWrites.length-1;for(;o&&i>=0;){const t=e.allWrites[i];t.visible&&(i>=n&&vn(t,r.path)?o=!1:Me(r.path,t.path)&&(l=!0)),i--}if(o){if(l)return function(e){e.visibleWrites=bn(e.allWrites,wn,Ee()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(r.snap)e.visibleWrites=un(e.visibleWrites,r.path);else{G(r.children,(t=>{e.visibleWrites=un(e.visibleWrites,Re(r.path,t))}))}return!0}return!1}function vn(e,path){if(e.snap)return Me(e.path,path);for(const t in e.children)if(e.children.hasOwnProperty(t)&&Me(Re(e.path,t),path))return!0;return!1}function wn(e){return e.visible}function bn(e,filter,t){let n=on.empty();for(let i=0;i<e.length;++i){const r=e[i];if(filter(r)){const e=r.path;let o;if(r.snap)Me(t,e)?(o=De(t,e),n=an(n,o,r.snap)):Me(e,t)&&(o=De(e,t),n=an(n,Ee(),r.snap.getChild(o)));else{if(!r.children)throw Object(c.f)("WriteRecord should have .snap or .children");if(Me(t,e))o=De(t,e),n=cn(n,o,r.children);else if(Me(e,t))if(o=De(e,t),xe(o))n=cn(n,Ee(),r.children);else{const e=Object(c.O)(r.children,Ce(o));if(e){const t=e.getChild(ke(o));n=an(n,Ee(),t)}}}}}return n}function In(e,t,n,r,o){if(r||o){const c=fn(e.visibleWrites,t);if(!o&&pn(c))return n;if(o||null!=n||ln(c,Ee())){const filter=function(e){return(e.visible||o)&&(!r||!~r.indexOf(e.writeId))&&(Me(e.path,t)||Me(t,e.path))};return gn(bn(e.allWrites,filter,t),n||mt.EMPTY_NODE)}return null}{const r=hn(e.visibleWrites,t);if(null!=r)return r;{const r=fn(e.visibleWrites,t);if(pn(r))return n;if(null!=n||ln(r,Ee())){return gn(r,n||mt.EMPTY_NODE)}return null}}}function Tn(e,t,n,r){return In(e.writeTree,e.treePath,t,n,r)}function En(e,t){return function(e,t,n){let r=mt.EMPTY_NODE;const o=hn(e.visibleWrites,t);if(o)return o.isLeafNode()||o.forEachChild(at,((e,t)=>{r=r.updateImmediateChild(e,t)})),r;if(n){const o=fn(e.visibleWrites,t);return n.forEachChild(at,((e,t)=>{const n=gn(fn(o,new Te(e)),t);r=r.updateImmediateChild(e,n)})),dn(o).forEach((e=>{r=r.updateImmediateChild(e.name,e.node)})),r}return dn(fn(e.visibleWrites,t)).forEach((e=>{r=r.updateImmediateChild(e.name,e.node)})),r}(e.writeTree,e.treePath,t)}function Cn(e,path,t,n){return function(e,t,n,r,o){Object(c.e)(r||o,"Either existingEventSnap or existingServerSnap must exist");const path=Re(t,n);if(ln(e.visibleWrites,path))return null;{const t=fn(e.visibleWrites,path);return pn(t)?o.getChild(n):gn(t,o.getChild(n))}}(e.writeTree,e.treePath,path,t,n)}function Sn(e,path){return function(e,path){return hn(e.visibleWrites,path)}(e.writeTree,Re(e.treePath,path))}function kn(e,t,n,r,o,c){return function(e,t,n,r,o,c,l){let h;const d=fn(e.visibleWrites,t),f=hn(d,Ee());if(null!=f)h=f;else{if(null==n)return[];h=gn(d,n)}if(h=h.withIndex(l),h.isEmpty()||h.isLeafNode())return[];{const e=[],t=l.getCompare(),n=c?h.getReverseIteratorFrom(r,l):h.getIteratorFrom(r,l);let d=n.getNext();for(;d&&e.length<o;)0!==t(d,r)&&e.push(d),d=n.getNext();return e}}(e.writeTree,e.treePath,t,n,r,o,c)}function On(e,t,n){return function(e,t,n,r){const path=Re(t,n),o=hn(e.visibleWrites,path);if(null!=o)return o;if(r.isCompleteForChild(n))return gn(fn(e.visibleWrites,path),r.getNode().getImmediateChild(n));return null}(e.writeTree,e.treePath,t,n)}function Nn(e,t){return An(Re(e.treePath,t),e.writeTree)}function An(path,e){return{treePath:path,writeTree:e}}class Rn{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;Object(c.e)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),Object(c.e)(".priority"!==n,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const o=r.type;if("child_added"===t&&"child_removed"===o)this.changeMap.set(n,Ct(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===o)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===o)this.changeMap.set(n,Et(n,r.oldSnap));else if("child_changed"===t&&"child_added"===o)this.changeMap.set(n,Tt(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==o)throw Object(c.f)("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,Ct(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const xn=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class Dn{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Qt(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return On(this.writes_,e,t)}}getChildAfterChild(e,t,n){const r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:nn(this.viewCache_),o=kn(this.writes_,r,t,1,n,e);return 0===o.length?null:o[0]}}function Pn(e,t,n,r,o){const l=new Rn;let h,d;if(n.type===zt.OVERWRITE){const f=n;f.source.fromUser?h=jn(e,t,f.path,f.snap,r,o,l):(Object(c.e)(f.source.fromServer,"Unknown source."),d=f.source.tagged||t.serverCache.isFiltered()&&!xe(f.path),h=Mn(e,t,f.path,f.snap,r,o,d,l))}else if(n.type===zt.MERGE){const f=n;f.source.fromUser?h=function(e,t,path,n,r,o,c){let l=t;return n.foreach(((n,h)=>{const d=Re(path,n);Fn(t,Ce(d))&&(l=jn(e,l,d,h,r,o,c))})),n.foreach(((n,h)=>{const d=Re(path,n);Fn(t,Ce(d))||(l=jn(e,l,d,h,r,o,c))})),l}(e,t,f.path,f.children,r,o,l):(Object(c.e)(f.source.fromServer,"Unknown source."),d=f.source.tagged||t.serverCache.isFiltered(),h=Vn(e,t,f.path,f.children,r,o,d,l))}else if(n.type===zt.ACK_USER_WRITE){const d=n;h=d.revert?function(e,t,path,n,r,o){let l;if(null!=Sn(n,path))return t;{const source=new Dn(n,t,r),h=t.eventCache.getNode();let d;if(xe(path)||".priority"===Ce(path)){let r;if(t.serverCache.isFullyInitialized())r=Tn(n,nn(t));else{const e=t.serverCache.getNode();Object(c.e)(e instanceof mt,"serverChildren would be complete if leaf node"),r=En(n,e)}d=e.filter.updateFullNode(h,r,o)}else{const r=Ce(path);let c=On(n,r,t.serverCache);null==c&&t.serverCache.isCompleteForChild(r)&&(c=h.getImmediateChild(r)),d=null!=c?e.filter.updateChild(h,r,c,ke(path),source,o):t.eventCache.getNode().hasChild(r)?e.filter.updateChild(h,r,mt.EMPTY_NODE,ke(path),source,o):h,d.isEmpty()&&t.serverCache.isFullyInitialized()&&(l=Tn(n,nn(t)),l.isLeafNode()&&(d=e.filter.updateFullNode(d,l,o)))}return l=t.serverCache.isFullyInitialized()||null!=Sn(n,Ee()),Zt(t,d,l,e.filter.filtersNodes())}}(e,t,d.path,r,o,l):function(e,t,n,r,o,c,l){if(null!=Sn(o,n))return t;const h=t.serverCache.isFiltered(),d=t.serverCache;if(null!=r.value){if(xe(n)&&d.isFullyInitialized()||d.isCompleteForPath(n))return Mn(e,t,n,d.getNode().getChild(n),o,c,h,l);if(xe(n)){let r=new sn(null);return d.getNode().forEachChild($e,((e,t)=>{r=r.set(new Te(e),t)})),Vn(e,t,n,r,o,c,h,l)}return t}{let f=new sn(null);return r.foreach(((e,t)=>{const r=Re(n,e);d.isCompleteForPath(r)&&(f=f.set(e,d.getNode().getChild(r)))})),Vn(e,t,n,f,o,c,h,l)}}(e,t,d.path,d.affectedTree,r,o,l)}else{if(n.type!==zt.LISTEN_COMPLETE)throw Object(c.f)("Unknown operation type: "+n.type);h=function(e,t,path,n,r){const o=t.serverCache,c=en(t,o.getNode(),o.isFullyInitialized()||xe(path),o.isFiltered());return Ln(e,c,path,n,xn,r)}(e,t,n.path,r,l)}const f=l.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){const o=r.getNode().isLeafNode()||r.getNode().isEmpty(),c=tn(e);(n.length>0||!e.eventCache.isFullyInitialized()||o&&!r.getNode().equals(c)||!r.getNode().getPriority().equals(c.getPriority()))&&n.push(It(tn(t)))}}(t,h,f),{viewCache:h,changes:f}}function Ln(e,t,n,r,source,o){const l=t.eventCache;if(null!=Sn(r,n))return t;{let h,d;if(xe(n))if(Object(c.e)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=nn(t),c=En(r,n instanceof mt?n:mt.EMPTY_NODE);h=e.filter.updateFullNode(t.eventCache.getNode(),c,o)}else{const n=Tn(r,nn(t));h=e.filter.updateFullNode(t.eventCache.getNode(),n,o)}else{const f=Ce(n);if(".priority"===f){Object(c.e)(1===Se(n),"Can't have a priority with additional path components");const o=l.getNode();d=t.serverCache.getNode();const f=Cn(r,n,o,d);h=null!=f?e.filter.updatePriority(o,f):l.getNode()}else{const c=ke(n);let m;if(l.isCompleteForChild(f)){d=t.serverCache.getNode();const e=Cn(r,n,l.getNode(),d);m=null!=e?l.getNode().getImmediateChild(f).updateChild(c,e):l.getNode().getImmediateChild(f)}else m=On(r,f,t.serverCache);h=null!=m?e.filter.updateChild(l.getNode(),f,m,c,source,o):l.getNode()}}return Zt(t,h,l.isFullyInitialized()||xe(n),e.filter.filtersNodes())}}function Mn(e,t,n,r,o,c,l,h){const d=t.serverCache;let f;const m=l?e.filter:e.filter.getIndexedFilter();if(xe(n))f=m.updateFullNode(d.getNode(),r,null);else if(m.filtersNodes()&&!d.isFiltered()){const e=d.getNode().updateChild(n,r);f=m.updateFullNode(d.getNode(),e,null)}else{const e=Ce(n);if(!d.isCompleteForPath(n)&&Se(n)>1)return t;const o=ke(n),c=d.getNode().getImmediateChild(e).updateChild(o,r);f=".priority"===e?m.updatePriority(d.getNode(),c):m.updateChild(d.getNode(),e,c,o,xn,null)}const _=en(t,f,d.isFullyInitialized()||xe(n),m.filtersNodes());return Ln(e,_,n,o,new Dn(o,_,c),h)}function jn(e,t,n,r,o,c,l){const h=t.eventCache;let d,f;const source=new Dn(o,t,c);if(xe(n))f=e.filter.updateFullNode(t.eventCache.getNode(),r,l),d=Zt(t,f,!0,e.filter.filtersNodes());else{const o=Ce(n);if(".priority"===o)f=e.filter.updatePriority(t.eventCache.getNode(),r),d=Zt(t,f,h.isFullyInitialized(),h.isFiltered());else{const c=ke(n),f=h.getNode().getImmediateChild(o);let m;if(xe(c))m=r;else{const e=source.getCompleteChild(o);m=null!=e?".priority"===Oe(c)&&e.getChild(Ae(c)).isEmpty()?e:e.updateChild(c,r):mt.EMPTY_NODE}if(f.equals(m))d=t;else{d=Zt(t,e.filter.updateChild(h.getNode(),o,m,c,source,l),h.isFullyInitialized(),e.filter.filtersNodes())}}}return d}function Fn(e,t){return e.eventCache.isCompleteForChild(t)}function Un(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function Vn(e,t,path,n,r,o,c,l){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let h,d=t;h=xe(path)?n:new sn(null).setTree(path,n);const f=t.serverCache.getNode();return h.children.inorderTraversal(((n,h)=>{if(f.hasChild(n)){const f=Un(0,t.serverCache.getNode().getImmediateChild(n),h);d=Mn(e,d,new Te(n),f,r,o,c,l)}})),h.children.inorderTraversal(((n,h)=>{const m=!t.serverCache.isCompleteForChild(n)&&null===h.value;if(!f.hasChild(n)&&!m){const f=Un(0,t.serverCache.getNode().getImmediateChild(n),h);d=Mn(e,d,new Te(n),f,r,o,c,l)}})),d}class qn{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new St(n.getIndex()),filter=(o=n).loadsAllData()?new St(o.getIndex()):o.hasLimit()?new Ot(o):new kt(o);var o;this.processor_=function(filter){return{filter:filter}}(filter);const c=t.serverCache,l=t.eventCache,h=r.updateFullNode(mt.EMPTY_NODE,c.getNode(),null),d=filter.updateFullNode(mt.EMPTY_NODE,l.getNode(),null),f=new Qt(h,c.isFullyInitialized(),r.filtersNodes()),m=new Qt(d,l.isFullyInitialized(),filter.filtersNodes());this.viewCache_=Xt(m,f),this.eventGenerator_=new Yt(this.query_)}get query(){return this.query_}}function Bn(view,path){const e=nn(view.viewCache_);return e&&(view.query._queryParams.loadsAllData()||!xe(path)&&!e.getImmediateChild(Ce(path)).isEmpty())?e.getChild(path):null}function zn(view){return 0===view.eventRegistrations_.length}function Gn(view,e,t){const n=[];if(t){Object(c.e)(null==e,"A cancel should cancel all event registrations.");const path=view.query._path;view.eventRegistrations_.forEach((e=>{const r=e.createCancelEvent(t,path);r&&n.push(r)}))}if(e){let t=[];for(let i=0;i<view.eventRegistrations_.length;++i){const n=view.eventRegistrations_[i];if(n.matches(e)){if(e.hasAnyCallback()){t=t.concat(view.eventRegistrations_.slice(i+1));break}}else t.push(n)}view.eventRegistrations_=t}else view.eventRegistrations_=[];return n}function Wn(view,e,t,n){e.type===zt.MERGE&&null!==e.source.queryId&&(Object(c.e)(nn(view.viewCache_),"We should always have a full cache before handling merges"),Object(c.e)(tn(view.viewCache_),"Missing event cache, even though we have a server cache"));const r=view.viewCache_,o=Pn(view.processor_,r,e,t,n);var l,h;return l=view.processor_,h=o.viewCache,Object(c.e)(h.eventCache.getNode().isIndexed(l.filter.getIndex()),"Event snap not indexed"),Object(c.e)(h.serverCache.getNode().isIndexed(l.filter.getIndex()),"Server snap not indexed"),Object(c.e)(o.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),view.viewCache_=o.viewCache,Kn(view,o.changes,o.viewCache.eventCache.getNode(),null)}function Kn(view,e,t,n){const r=n?[n]:view.eventRegistrations_;return function(e,t,n,r){const o=[],c=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&c.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),Jt(e,o,"child_removed",t,r,n),Jt(e,o,"child_added",t,r,n),Jt(e,o,"child_moved",c,r,n),Jt(e,o,"child_changed",t,r,n),Jt(e,o,"value",t,r,n),o}(view.eventGenerator_,e,t,r)}let $n,Hn;class Qn{constructor(){this.views=new Map}}function Yn(e,t,n,r){const o=t.source.queryId;if(null!==o){const view=e.views.get(o);return Object(c.e)(null!=view,"SyncTree gave us an op for an invalid query."),Wn(view,t,n,r)}{let o=[];for(const view of e.views.values())o=o.concat(Wn(view,t,n,r));return o}}function Jn(e,t,n,r,o){const c=t._queryIdentifier,view=e.views.get(c);if(!view){let e=Tn(n,o?r:null),c=!1;e?c=!0:r instanceof mt?(e=En(n,r),c=!1):(e=mt.EMPTY_NODE,c=!1);const l=Xt(new Qt(e,c,!1),new Qt(r,o,!1));return new qn(t,l)}return view}function Xn(e,t,n,r,o,c){const view=Jn(e,t,r,o,c);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,view),function(view,e){view.eventRegistrations_.push(e)}(view,n),function(view,e){const t=view.viewCache_.eventCache,n=[];t.getNode().isLeafNode()||t.getNode().forEachChild(at,((e,t)=>{n.push(Tt(e,t))}));return t.isFullyInitialized()&&n.push(It(t.getNode())),Kn(view,n,t.getNode(),e)}(view,n)}function Zn(e,t,n,r){const o=t._queryIdentifier,l=[];let h=[];const d=sr(e);if("default"===o)for(const[t,view]of e.views.entries())h=h.concat(Gn(view,n,r)),zn(view)&&(e.views.delete(t),view.query._queryParams.loadsAllData()||l.push(view.query));else{const view=e.views.get(o);view&&(h=h.concat(Gn(view,n,r)),zn(view)&&(e.views.delete(o),view.query._queryParams.loadsAllData()||l.push(view.query)))}return d&&!sr(e)&&l.push(new(Object(c.e)($n,"Reference.ts has not been loaded"),$n)(t._repo,t._path)),{removed:l,events:h}}function er(e){const t=[];for(const view of e.views.values())view.query._queryParams.loadsAllData()||t.push(view);return t}function nr(e,path){let t=null;for(const view of e.views.values())t=t||Bn(view,path);return t}function rr(e,t){if(t._queryParams.loadsAllData())return or(e);{const n=t._queryIdentifier;return e.views.get(n)}}function ir(e,t){return null!=rr(e,t)}function sr(e){return null!=or(e)}function or(e){for(const view of e.views.values())if(view.query._queryParams.loadsAllData())return view;return null}let ar=1;class cr{constructor(e){this.listenProvider_=e,this.syncPointTree_=new sn(null),this.pendingWriteTree_={visibleWrites:on.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function ur(e,path,t,n,r){return function(e,path,t,n,r){Object(c.e)(n>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),e.allWrites.push({path:path,snap:t,writeId:n,visible:r}),r&&(e.visibleWrites=an(e.visibleWrites,path,t)),e.lastWriteId=n}(e.pendingWriteTree_,path,t,n,r),r?vr(e,new $t({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},path,t)):[]}function lr(e,path,t,n){!function(e,path,t,n){Object(c.e)(n>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:path,children:t,writeId:n,visible:!0}),e.visibleWrites=cn(e.visibleWrites,path,t),e.lastWriteId=n}(e.pendingWriteTree_,path,t,n);const r=sn.fromObject(t);return vr(e,new Ht({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},path,r))}function dr(e,t,n=!1){const r=function(e,t){for(let i=0;i<e.allWrites.length;i++){const n=e.allWrites[i];if(n.writeId===t)return n}return null}(e.pendingWriteTree_,t);if(yn(e.pendingWriteTree_,t)){let t=new sn(null);return null!=r.snap?t=t.set(Ee(),!0):G(r.children,(e=>{t=t.set(new Te(e),!0)})),vr(e,new Wt(r.path,t,n))}return[]}function fr(e,path,t){return vr(e,new $t({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},path,t))}function pr(e,t,n,r,o=!1){const path=t._path,c=e.syncPointTree_.get(path);let l=[];if(c&&("default"===t._queryIdentifier||ir(c,t))){const h=Zn(c,t,n,r);0===c.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(path));const d=h.removed;if(l=h.events,!o){const n=-1!==d.findIndex((e=>e._queryParams.loadsAllData())),o=e.syncPointTree_.findOnPath(path,((e,t)=>sr(t)));if(n&&!o){const t=e.syncPointTree_.subtree(path);if(!t.isEmpty()){const n=function(e){return e.fold(((e,t,n)=>{if(t&&sr(t)){return[or(t)]}{let e=[];return t&&(e=er(t)),G(n,((t,n)=>{e=e.concat(n)})),e}}))}(t);for(let i=0;i<n.length;++i){const view=n[i],t=view.query,r=Tr(e,view);e.listenProvider_.startListening(Nr(t),Er(e,t),r.hashFn,r.onComplete)}}}if(!o&&d.length>0&&!r)if(n){const n=null;e.listenProvider_.stopListening(Nr(t),n)}else d.forEach((t=>{const n=e.queryToTagMap.get(Cr(t));e.listenProvider_.stopListening(Nr(t),n)}))}!function(e,t){for(let n=0;n<t.length;++n){const r=t[n];if(!r._queryParams.loadsAllData()){const t=Cr(r),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,d)}return l}function gr(e,path,t,n){const r=Sr(e,n);if(null!=r){const n=kr(r),o=n.path,c=n.queryId,l=De(o,path);return Or(e,o,new $t(Gt(c),l,t))}return[]}function mr(e,t,n,r=!1){const path=t._path;let o=null,l=!1;e.syncPointTree_.foreachOnPath(path,((e,t)=>{const n=De(e,path);o=o||nr(t,n),l=l||sr(t)}));let h,d=e.syncPointTree_.get(path);if(d?(l=l||sr(d),o=o||nr(d,Ee())):(d=new Qn,e.syncPointTree_=e.syncPointTree_.set(path,d)),null!=o)h=!0;else{h=!1,o=mt.EMPTY_NODE;e.syncPointTree_.subtree(path).foreachChild(((e,t)=>{const n=nr(t,Ee());n&&(o=o.updateImmediateChild(e,n))}))}const f=ir(d,t);if(!f&&!t._queryParams.loadsAllData()){const n=Cr(t);Object(c.e)(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");const r=ar++;e.queryToTagMap.set(n,r),e.tagToQueryMap.set(r,n)}let m=Xn(d,t,n,_n(e.pendingWriteTree_,path),o,h);if(!f&&!l&&!r){const view=rr(d,t);m=m.concat(function(e,t,view){const path=t._path,n=Er(e,t),r=Tr(e,view),o=e.listenProvider_.startListening(Nr(t),n,r.hashFn,r.onComplete),l=e.syncPointTree_.subtree(path);if(n)Object(c.e)(!sr(l.value),"If we're adding a query, it shouldn't be shadowed");else{const t=l.fold(((e,t,n)=>{if(!xe(e)&&t&&sr(t))return[or(t).query];{let e=[];return t&&(e=e.concat(er(t).map((view=>view.query)))),G(n,((t,n)=>{e=e.concat(n)})),e}}));for(let i=0;i<t.length;++i){const n=t[i];e.listenProvider_.stopListening(Nr(n),Er(e,n))}}return o}(e,t,view))}return m}function _r(e,path,t){const n=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(path,((e,t)=>{const n=nr(t,De(e,path));if(n)return n}));return In(n,path,r,t,!0)}function yr(e,t){const path=t._path;let n=null;e.syncPointTree_.foreachOnPath(path,((e,t)=>{const r=De(e,path);n=n||nr(t,r)}));let r=e.syncPointTree_.get(path);r?n=n||nr(r,Ee()):(r=new Qn,e.syncPointTree_=e.syncPointTree_.set(path,r));const o=null!=n,c=o?new Qt(n,!0,!1):null;return function(view){return tn(view.viewCache_)}(Jn(r,t,_n(e.pendingWriteTree_,t._path),o?c.getNode():mt.EMPTY_NODE,o))}function vr(e,t){return wr(t,e.syncPointTree_,null,_n(e.pendingWriteTree_,Ee()))}function wr(e,t,n,r){if(xe(e.path))return Ir(e,t,n,r);{const o=t.get(Ee());null==n&&null!=o&&(n=nr(o,Ee()));let c=[];const l=Ce(e.path),h=e.operationForChild(l),d=t.children.get(l);if(d&&h){const e=n?n.getImmediateChild(l):null,t=Nn(r,l);c=c.concat(wr(h,d,e,t))}return o&&(c=c.concat(Yn(o,e,r,n))),c}}function Ir(e,t,n,r){const o=t.get(Ee());null==n&&null!=o&&(n=nr(o,Ee()));let c=[];return t.children.inorderTraversal(((t,o)=>{const l=n?n.getImmediateChild(t):null,h=Nn(r,t),d=e.operationForChild(t);d&&(c=c.concat(Ir(d,o,l,h)))})),o&&(c=c.concat(Yn(o,e,r,n))),c}function Tr(e,view){const t=view.query,n=Er(e,t);return{hashFn:()=>{const e=function(view){return view.viewCache_.serverCache.getNode()}(view)||mt.EMPTY_NODE;return e.hash()},onComplete:r=>{if("ok"===r)return n?function(e,path,t){const n=Sr(e,t);if(n){const t=kr(n),r=t.path,o=t.queryId,c=De(r,path);return Or(e,r,new Kt(Gt(o),c))}return[]}(e,t._path,n):function(e,path){return vr(e,new Kt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},path))}(e,t._path);{const n=function(code,e){let t="Unknown Error";"too_big"===code?t="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===code?t="Client doesn't have permission to access the desired data.":"unavailable"===code&&(t="The service is unavailable");const n=new Error(code+" at "+e._path.toString()+": "+t);return n.code=code.toUpperCase(),n}(r,t);return pr(e,t,null,n)}}}}function Er(e,t){const n=Cr(t);return e.queryToTagMap.get(n)}function Cr(e){return e._path.toString()+"$"+e._queryIdentifier}function Sr(e,t){return e.tagToQueryMap.get(t)}function kr(e){const t=e.indexOf("$");return Object(c.e)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Te(e.substr(0,t))}}function Or(e,t,n){const r=e.syncPointTree_.get(t);Object(c.e)(r,"Missing sync point for query tag that we're tracking");return Yn(r,n,_n(e.pendingWriteTree_,t),null)}function Nr(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(Object(c.e)(Hn,"Reference.ts has not been loaded"),Hn)(e._repo,e._path):e}class Ar{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Ar(t)}node(){return this.node_}}class Rr{constructor(e,path){this.syncTree_=e,this.path_=path}getImmediateChild(e){const t=Re(this.path_,e);return new Rr(this.syncTree_,t)}node(){return _r(this.syncTree_,this.path_)}}const xr=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},Dr=function(e,t,n){return e&&"object"==typeof e?(Object(c.e)(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?Pr(e[".sv"],t,n):"object"==typeof e[".sv"]?Lr(e[".sv"],t):void Object(c.e)(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Pr=function(e,t,n){if("timestamp"===e)return n.timestamp;Object(c.e)(!1,"Unexpected server value: "+e)},Lr=function(e,t,n){e.hasOwnProperty("increment")||Object(c.e)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const r=e.increment;"number"!=typeof r&&Object(c.e)(!1,"Unexpected increment value: "+r);const o=t.node();if(Object(c.e)(null!=o,"Expected ChildrenNode.EMPTY_NODE for nulls"),!o.isLeafNode())return r;const l=o.getValue();return"number"!=typeof l?r:l+r},Mr=function(path,e,t,n){return Fr(e,new Rr(t,path),n)},jr=function(e,t,n){return Fr(e,new Ar(t),n)};function Fr(e,t,n){const r=e.getPriority().val(),o=Dr(r,t.getImmediateChild(".priority"),n);let c;if(e.isLeafNode()){const r=e,c=Dr(r.getValue(),t,n);return c!==r.getValue()||o!==r.getPriority().val()?new ot(c,vt(o)):e}{const r=e;return c=r,o!==r.getPriority().val()&&(c=c.updatePriority(new ot(o))),r.forEachChild(at,((e,r)=>{const o=Fr(r,t.getImmediateChild(e),n);o!==r&&(c=c.updateImmediateChild(e,o))})),c}}class Ur{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function Vr(e,t){let path=t instanceof Te?t:new Te(t),n=e,r=Ce(path);for(;null!==r;){const e=Object(c.O)(n.node.children,r)||{children:{},childCount:0};n=new Ur(r,n,e),path=ke(path),r=Ce(path)}return n}function qr(e){return e.node.value}function Br(e,t){e.node.value=t,$r(e)}function zr(e){return e.node.childCount>0}function Gr(e,t){G(e.node.children,((n,r)=>{t(new Ur(n,e,r))}))}function Wr(e,t,n,r){n&&!r&&t(e),Gr(e,(e=>{Wr(e,t,!0,r)})),n&&r&&t(e)}function Kr(e){return new Te(null===e.parent?e.name:Kr(e.parent)+"/"+e.name)}function $r(e){null!==e.parent&&function(e,t,n){const r=function(e){return void 0===qr(e)&&!zr(e)}(n),o=Object(c.k)(e.node.children,t);r&&o?(delete e.node.children[t],e.node.childCount--,$r(e)):r||o||(e.node.children[t]=n.node,e.node.childCount++,$r(e))}(e.parent,e.name,e)}const Hr=/[\[\].#$\/\u0000-\u001F\u007F]/,Qr=/[\[\].#$\u0000-\u001F\u007F]/,Yr=10485760,Jr=function(e){return"string"==typeof e&&0!==e.length&&!Hr.test(e)},Xr=function(e){return"string"==typeof e&&0!==e.length&&!Qr.test(e)},Zr=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!L(e)||e&&"object"==typeof e&&Object(c.k)(e,".sv")},ei=function(e,t,path,n){n&&void 0===t||ti(Object(c.q)(e,"value"),t,path)},ti=function(e,data,t){const path=t instanceof Te?new je(t,e):t;if(void 0===data)throw new Error(e+"contains undefined "+Ue(path));if("function"==typeof data)throw new Error(e+"contains a function "+Ue(path)+" with contents = "+data.toString());if(L(data))throw new Error(e+"contains "+data.toString()+" "+Ue(path));if("string"==typeof data&&data.length>Yr/3&&Object(c.P)(data)>Yr)throw new Error(e+"contains a string greater than "+Yr+" utf8 bytes "+Ue(path)+" ('"+data.substring(0,50)+"...')");if(data&&"object"==typeof data){let t=!1,n=!1;if(G(data,((r,o)=>{if(".value"===r)t=!0;else if(".priority"!==r&&".sv"!==r&&(n=!0,!Jr(r)))throw new Error(e+" contains an invalid key ("+r+") "+Ue(path)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=Object(c.P)(t),Fe(e)}(path,r),ti(e,o,path),function(e){const t=e.parts_.pop();e.byteLength_-=Object(c.P)(t),e.parts_.length>0&&(e.byteLength_-=1)}(path)})),t&&n)throw new Error(e+' contains ".value" child '+Ue(path)+" in addition to actual children.")}},ni=function(e,data,path,t){if(t&&void 0===data)return;const n=Object(c.q)(e,"values");if(!data||"object"!=typeof data||Array.isArray(data))throw new Error(n+" must be an object containing the children to replace.");const r=[];G(data,((e,t)=>{const o=new Te(e);if(ti(n,t,Re(path,o)),".priority"===Oe(o)&&!Zr(t))throw new Error(n+"contains an invalid value for '"+o.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(o)})),function(e,t){let i,n;for(i=0;i<t.length;i++){n=t[i];const r=Ne(n);for(let t=0;t<r.length;t++)if(".priority"===r[t]&&t===r.length-1);else if(!Jr(r[t]))throw new Error(e+"contains an invalid key ("+r[t]+") in path "+n.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(Pe);let r=null;for(i=0;i<t.length;i++){if(n=t[i],null!==r&&Me(r,n))throw new Error(e+"contains a path "+r.toString()+" that is ancestor of another path "+n.toString());r=n}}(n,r)},ri=function(e,t,n){if(!n||void 0!==t){if(L(t))throw new Error(Object(c.q)(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Zr(t))throw new Error(Object(c.q)(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},ii=function(e,t,n,r){if(!(r&&void 0===n||Jr(n)))throw new Error(Object(c.q)(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},si=function(e,t,n,r){if(!(r&&void 0===n||Xr(n)))throw new Error(Object(c.q)(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},oi=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),si(e,t,n,r)},ai=function(e,path){if(".info"===Ce(path))throw new Error(e+" failed = Can't modify data under /.info/")},ci=function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Jr(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Xr(e)}(n))throw new Error(Object(c.q)(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class ui{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function hi(e,t){let n=null;for(let i=0;i<t.length;i++){const data=t[i],path=data.getPath();null===n||Le(path,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:path}),n.events.push(data)}n&&e.eventLists_.push(n)}function di(e,path,t){hi(e,t),pi(e,(e=>Le(e,path)))}function fi(e,t,n){hi(e,n),pi(e,(e=>Me(e,t)||Me(t,e)))}function pi(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){const r=e.eventLists_[i];if(r){t(r.path)?(gi(e.eventLists_[i]),e.eventLists_[i]=null):n=!1}}n&&(e.eventLists_=[]),e.recursionDepth_--}function gi(e){for(let i=0;i<e.events.length;i++){const t=e.events[i];if(null!==t){e.events[i]=null;const n=t.getEventRunner();k&&A("event: "+t.toString()),H(n)}}}const mi="repo_interrupt",_i=25;class yi{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ui,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=jt(),this.transactionQueueTree_=new Ur,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function vi(e,t,n){if(e.stats_=ue(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new Lt(e.repoInfo_,((t,data,n,r)=>{Ii(e,t,data,n,r)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>Ti(e,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Object(c.R)(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new Be(e.repoInfo_,t,((t,data,n,r)=>{Ii(e,t,data,n,r)}),(t=>{Ti(e,t)}),(t=>{!function(e,t){G(t,((t,n)=>{Ei(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(e,t){const n=e.toString();return ce[n]||(ce[n]=t()),ce[n]}(e.repoInfo_,(()=>new Bt(e.stats_,e.server_))),e.infoData_=new Mt,e.infoSyncTree_=new cr({startListening:(t,n,r,o)=>{let c=[];const l=e.infoData_.getNode(t._path);return l.isEmpty()||(c=fr(e.infoSyncTree_,t._path,l),setTimeout((()=>{o("ok")}),0)),c},stopListening:()=>{}}),Ei(e,"connected",!1),e.serverSyncTree_=new cr({startListening:(t,n,r,o)=>(e.server_.listen(t,r,n,((n,data)=>{const r=o(n,data);fi(e.eventQueue_,t._path,r)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function wi(e){const t=e.infoData_.getNode(new Te(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function bi(e){return xr({timestamp:wi(e)})}function Ii(e,t,data,n,r){e.dataUpdateCount++;const path=new Te(t);data=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,data):data;let o=[];if(r)if(n){const t=Object(c.L)(data,(e=>vt(e)));o=function(e,path,t,n){const r=Sr(e,n);if(r){const n=kr(r),o=n.path,c=n.queryId,l=De(o,path),h=sn.fromObject(t);return Or(e,o,new Ht(Gt(c),l,h))}return[]}(e.serverSyncTree_,path,t,r)}else{const t=vt(data);o=gr(e.serverSyncTree_,path,t,r)}else if(n){const t=Object(c.L)(data,(e=>vt(e)));o=function(e,path,t){const n=sn.fromObject(t);return vr(e,new Ht({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},path,n))}(e.serverSyncTree_,path,t)}else{const t=vt(data);o=fr(e.serverSyncTree_,path,t)}let l=path;o.length>0&&(l=Li(e,path)),fi(e.eventQueue_,l,o)}function Ti(e,t){Ei(e,"connected",t),!1===t&&function(e){Ri(e,"onDisconnectEvents");const t=bi(e),n=jt();Vt(e.onDisconnect_,Ee(),((path,r)=>{const o=Mr(path,r,e.serverSyncTree_,t);Ft(n,path,o)}));let r=[];Vt(n,Ee(),((path,t)=>{r=r.concat(fr(e.serverSyncTree_,path,t));const n=Vi(e,path);Li(e,n)})),e.onDisconnect_=jt(),fi(e.eventQueue_,Ee(),r)}(e)}function Ei(e,t,n){const path=new Te("/.info/"+t),r=vt(n);e.infoData_.updateSnapshot(path,r);const o=fr(e.infoSyncTree_,path,r);fi(e.eventQueue_,path,o)}function Ci(e){return e.nextWriteId_++}function Si(e,path,t,n,r){Ri(e,"set",{path:path.toString(),value:t,priority:n});const o=bi(e),c=vt(t,n),l=_r(e.serverSyncTree_,path),h=jr(c,l,o),d=Ci(e),f=ur(e.serverSyncTree_,path,h,d,!0);hi(e.eventQueue_,f),e.server_.put(path.toString(),c.val(!0),((t,n)=>{const o="ok"===t;o||P("set at "+path+" failed: "+t);const c=dr(e.serverSyncTree_,d,!o);fi(e.eventQueue_,path,c),xi(e,r,t,n)}));const m=Vi(e,path);Li(e,m),fi(e.eventQueue_,m,[])}function ki(e,path,t){e.server_.onDisconnectCancel(path.toString(),((n,r)=>{"ok"===n&&Ut(e.onDisconnect_,path),xi(e,t,n,r)}))}function Oi(e,path,t,n){const r=vt(t);e.server_.onDisconnectPut(path.toString(),r.val(!0),((t,o)=>{"ok"===t&&Ft(e.onDisconnect_,path,r),xi(e,n,t,o)}))}function Ni(e,t,n){let r;r=".info"===Ce(t._path)?pr(e.infoSyncTree_,t,n):pr(e.serverSyncTree_,t,n),di(e.eventQueue_,t._path,r)}function Ai(e){e.persistentConnection_&&e.persistentConnection_.interrupt(mi)}function Ri(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),A(n,...t)}function xi(e,t,n,r){t&&H((()=>{if("ok"===n)t(null);else{const code=(n||"error").toUpperCase();let e=code;r&&(e+=": "+r);const o=new Error(e);o.code=code,t(o)}}))}function Di(e,path,t){return _r(e.serverSyncTree_,path,t)||mt.EMPTY_NODE}function Pi(e,t=e.transactionQueueTree_){if(t||Ui(e,t),qr(t)){const n=ji(e,t);Object(c.e)(n.length>0,"Sending zero length transaction queue");n.every((e=>0===e.status))&&function(e,path,t){const n=t.map((e=>e.currentWriteId)),r=Di(e,path,n);let o=r;const l=r.hash();for(let i=0;i<t.length;i++){const e=t[i];Object(c.e)(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const n=De(path,e.path);o=o.updateChild(n,e.currentOutputSnapshotRaw)}const h=o.val(!0),d=path;e.server_.put(d.toString(),h,(n=>{Ri(e,"transaction put response",{path:d.toString(),status:n});let r=[];if("ok"===n){const n=[];for(let i=0;i<t.length;i++)t[i].status=2,r=r.concat(dr(e.serverSyncTree_,t[i].currentWriteId)),t[i].onComplete&&n.push((()=>t[i].onComplete(null,!0,t[i].currentOutputSnapshotResolved))),t[i].unwatcher();Ui(e,Vr(e.transactionQueueTree_,path)),Pi(e,e.transactionQueueTree_),fi(e.eventQueue_,path,r);for(let i=0;i<n.length;i++)H(n[i])}else{if("datastale"===n)for(let i=0;i<t.length;i++)3===t[i].status?t[i].status=4:t[i].status=0;else{P("transaction at "+d.toString()+" failed: "+n);for(let i=0;i<t.length;i++)t[i].status=4,t[i].abortReason=n}Li(e,path)}}),l)}(e,Kr(t),n)}else zr(t)&&Gr(t,(t=>{Pi(e,t)}))}function Li(e,t){const n=Mi(e,t),path=Kr(n);return function(e,t,path){if(0===t.length)return;const n=[];let r=[];const o=t.filter((q=>0===q.status)),l=o.map((q=>q.currentWriteId));for(let i=0;i<t.length;i++){const o=t[i],d=De(path,o.path);let f,m=!1;if(Object(c.e)(null!==d,"rerunTransactionsUnderNode_: relativePath should not be null."),4===o.status)m=!0,f=o.abortReason,r=r.concat(dr(e.serverSyncTree_,o.currentWriteId,!0));else if(0===o.status)if(o.retryCount>=_i)m=!0,f="maxretry",r=r.concat(dr(e.serverSyncTree_,o.currentWriteId,!0));else{const n=Di(e,o.path,l);o.currentInputSnapshot=n;const h=t[i].update(n.val());if(void 0!==h){ti("transaction failed: Data returned ",h,o.path);let t=vt(h);"object"==typeof h&&null!=h&&Object(c.k)(h,".priority")||(t=t.updatePriority(n.getPriority()));const d=o.currentWriteId,f=bi(e),m=jr(t,n,f);o.currentOutputSnapshotRaw=t,o.currentOutputSnapshotResolved=m,o.currentWriteId=Ci(e),l.splice(l.indexOf(d),1),r=r.concat(ur(e.serverSyncTree_,o.path,m,o.currentWriteId,o.applyLocally)),r=r.concat(dr(e.serverSyncTree_,d,!0))}else m=!0,f="nodata",r=r.concat(dr(e.serverSyncTree_,o.currentWriteId,!0))}fi(e.eventQueue_,path,r),r=[],m&&(t[i].status=2,h=t[i].unwatcher,setTimeout(h,Math.floor(0)),t[i].onComplete&&("nodata"===f?n.push((()=>t[i].onComplete(null,!1,t[i].currentInputSnapshot))):n.push((()=>t[i].onComplete(new Error(f),!1,null)))))}var h;Ui(e,e.transactionQueueTree_);for(let i=0;i<n.length;i++)H(n[i]);Pi(e,e.transactionQueueTree_)}(e,ji(e,n),path),path}function Mi(e,path){let t,n=e.transactionQueueTree_;for(t=Ce(path);null!==t&&void 0===qr(n);)n=Vr(n,t),t=Ce(path=ke(path));return n}function ji(e,t){const n=[];return Fi(e,t,n),n.sort(((a,b)=>a.order-b.order)),n}function Fi(e,t,n){const r=qr(t);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);Gr(t,(t=>{Fi(e,t,n)}))}function Ui(e,t){const n=qr(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,Br(t,n.length>0?n:void 0)}Gr(t,(t=>{Ui(e,t)}))}function Vi(e,path){const t=Kr(Mi(e,path)),n=Vr(e.transactionQueueTree_,path);return function(e,t,n){let r=n?e:e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}}(n,(t=>{qi(e,t)})),qi(e,n),Wr(n,(t=>{qi(e,t)})),t}function qi(e,t){const n=qr(t);if(n){const r=[];let o=[],l=-1;for(let i=0;i<n.length;i++)3===n[i].status||(1===n[i].status?(Object(c.e)(l===i-1,"All SENT items should be at beginning of queue."),l=i,n[i].status=3,n[i].abortReason="set"):(Object(c.e)(0===n[i].status,"Unexpected transaction status in abort"),n[i].unwatcher(),o=o.concat(dr(e.serverSyncTree_,n[i].currentWriteId,!0)),n[i].onComplete&&r.push(n[i].onComplete.bind(null,new Error("set"),!1,null))));-1===l?Br(t,void 0):n.length=l+1,fi(e.eventQueue_,Kr(t),o);for(let i=0;i<r.length;i++)H(r[i])}}const Bi=function(e,t){const n=zi(e),r=n.namespace;"firebase.com"===n.domain&&D(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||D("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&P("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const o="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new ie(n.host,n.secure,r,o,t,"",r!==n.subdomain),path:new Te(n.pathString)}},zi=function(e){let t="",n="",r="",o="",c="",l=!0,h="https",d=443;if("string"==typeof e){let f=e.indexOf("//");f>=0&&(h=e.substring(0,f-1),e=e.substring(f+2));let m=e.indexOf("/");-1===m&&(m=e.length);let _=e.indexOf("?");-1===_&&(_=e.length),t=e.substring(0,Math.min(m,_)),m<_&&(o=function(e){let t="";const n=e.split("/");for(let i=0;i<n.length;i++)if(n[i].length>0){let e=n[i];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(e){}t+="/"+e}return t}(e.substring(m,_)));const y=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):P(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,_)));f=t.indexOf(":"),f>=0?(l="https"===h||"wss"===h,d=parseInt(t.substring(f+1),10)):f=t.length;const v=t.slice(0,f);if("localhost"===v.toLowerCase())n="localhost";else if(v.split(".").length<=2)n=v;else{const e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),c=r}"ns"in y&&(c=y.ns)}return{host:t,port:d,domain:n,subdomain:r,secure:l,scheme:h,pathString:o,namespace:c}},Gi="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Wi=function(){let e=0;const t=[];return function(n){const r=n===e;let i;e=n;const o=new Array(8);for(i=7;i>=0;i--)o[i]=Gi.charAt(n%64),n=Math.floor(n/64);Object(c.e)(0===n,"Cannot push at time == 0");let l=o.join("");if(r){for(i=11;i>=0&&63===t[i];i--)t[i]=0;t[i]++}else for(i=0;i<12;i++)t[i]=Math.floor(64*Math.random());for(i=0;i<12;i++)l+=Gi.charAt(t[i]);return Object(c.e)(20===l.length,"nextPushId: Length should be 20."),l}}();class Ki{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Object(c.R)(this.snapshot.exportVal())}}class $i{constructor(e,t,path){this.eventRegistration=e,this.error=t,this.path=path}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Hi{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return Object(c.e)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Qi{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new c.a;return ki(this._repo,this._path,e.wrapCallback((()=>{}))),e.promise}remove(){ai("OnDisconnect.remove",this._path);const e=new c.a;return Oi(this._repo,this._path,null,e.wrapCallback((()=>{}))),e.promise}set(e){ai("OnDisconnect.set",this._path),ei("OnDisconnect.set",e,this._path,!1);const t=new c.a;return Oi(this._repo,this._path,e,t.wrapCallback((()=>{}))),t.promise}setWithPriority(e,t){ai("OnDisconnect.setWithPriority",this._path),ei("OnDisconnect.setWithPriority",e,this._path,!1),ri("OnDisconnect.setWithPriority",t,!1);const n=new c.a;return function(e,path,t,n,r){const o=vt(t,n);e.server_.onDisconnectPut(path.toString(),o.val(!0),((t,n)=>{"ok"===t&&Ft(e.onDisconnect_,path,o),xi(0,r,t,n)}))}(this._repo,this._path,e,t,n.wrapCallback((()=>{}))),n.promise}update(e){ai("OnDisconnect.update",this._path),ni("OnDisconnect.update",e,this._path,!1);const t=new c.a;return function(e,path,t,n){if(Object(c.B)(t))return A("onDisconnect().update() called with empty data.  Don't do anything."),void xi(0,n,"ok",void 0);e.server_.onDisconnectMerge(path.toString(),t,((r,o)=>{"ok"===r&&G(t,((t,n)=>{const r=vt(n);Ft(e.onDisconnect_,Re(path,t),r)})),xi(0,n,r,o)}))}(this._repo,this._path,e,t.wrapCallback((()=>{}))),t.promise}}class Yi{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return xe(this._path)?null:Oe(this._path)}get ref(){return new es(this._repo,this._path)}get _queryIdentifier(){const e=Pt(this._queryParams),t=B(e);return"{}"===t?"default":t}get _queryObject(){return Pt(this._queryParams)}isEqual(e){if(!((e=Object(c.w)(e))instanceof Yi))return!1;const t=this._repo===e._repo,n=Le(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(path){let e="";for(let i=path.pieceNum_;i<path.pieces_.length;i++)""!==path.pieces_[i]&&(e+="/"+encodeURIComponent(String(path.pieces_[i])));return e||"/"}(this._path)}}function Ji(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function Xi(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===$e){const r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",o="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==M)throw new Error(r);if("string"!=typeof t)throw new Error(o)}if(e.hasEnd()){if(e.getIndexEndName()!==j)throw new Error(r);if("string"!=typeof n)throw new Error(o)}}else if(e.getIndex()===at){if(null!=t&&!Zr(t)||null!=n&&!Zr(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Object(c.e)(e.getIndex()instanceof wt||e.getIndex()===bt,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Zi(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class es extends Yi{constructor(e,path){super(e,path,new Nt,!1)}get parent(){const e=Ae(this._path);return null===e?null:new es(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class ts{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(path){const e=new Te(path),t=is(this.ref,path);return new ts(this._node.getChild(e),t,at)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,((t,n)=>e(new ts(n,is(this.ref,t),at))))}hasChild(path){const e=new Te(path);return!this._node.getChild(e).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ns(e,path){return(e=Object(c.w)(e))._checkNotDeleted("ref"),void 0!==path?is(e._root,path):e._root}function rs(e,t){(e=Object(c.w)(e))._checkNotDeleted("refFromURL");const n=Bi(t,e._repo.repoInfo_.nodeAdmin);ci("refFromURL",n);const r=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||r.host===e._repo.repoInfo_.host||D("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+e._repo.repoInfo_.host+")"),ns(e,n.path.toString())}function is(e,path){return null===Ce((e=Object(c.w)(e))._path)?oi("child","path",path,!1):si("child","path",path,!1),new es(e._repo,Re(e._path,path))}function ss(e,t){e=Object(c.w)(e),ai("push",e._path),ei("push",t,e._path,!0);const n=wi(e._repo),r=Wi(n),o=is(e,r),l=is(e,r);let h;return h=null!=t?as(l,t).then((()=>l)):Promise.resolve(l),o.then=h.then.bind(h),o.catch=h.then.bind(h,void 0),o}function os(e){return ai("remove",e._path),as(e,null)}function as(e,t){e=Object(c.w)(e),ai("set",e._path),ei("set",t,e._path,!1);const n=new c.a;return Si(e._repo,e._path,t,null,n.wrapCallback((()=>{}))),n.promise}function cs(e,t){e=Object(c.w)(e),ai("setPriority",e._path),ri("setPriority",t,!1);const n=new c.a;return Si(e._repo,Re(e._path,".priority"),t,null,n.wrapCallback((()=>{}))),n.promise}function us(e,t,n){if(ai("setWithPriority",e._path),ei("setWithPriority",t,e._path,!1),ri("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";const r=new c.a;return Si(e._repo,e._path,t,n,r.wrapCallback((()=>{}))),r.promise}function ls(e,t){ni("update",t,e._path,!1);const n=new c.a;return function(e,path,t,n){Ri(e,"update",{path:path.toString(),value:t});let r=!0;const o=bi(e),c={};if(G(t,((t,n)=>{r=!1,c[t]=Mr(Re(path,t),vt(n),e.serverSyncTree_,o)})),r)A("update() called with empty data.  Don't do anything."),xi(0,n,"ok",void 0);else{const r=Ci(e),o=lr(e.serverSyncTree_,path,c,r);hi(e.eventQueue_,o),e.server_.merge(path.toString(),t,((t,o)=>{const c="ok"===t;c||P("update at "+path+" failed: "+t);const l=dr(e.serverSyncTree_,r,!c),h=l.length>0?Li(e,path):path;fi(e.eventQueue_,h,l),xi(0,n,t,o)})),G(t,(t=>{const n=Vi(e,Re(path,t));Li(e,n)})),fi(e.eventQueue_,path,[])}}(e._repo,e._path,t,n.wrapCallback((()=>{}))),n.promise}function hs(e){e=Object(c.w)(e);const t=new Hi((()=>{})),n=new ds(t);return function(e,t,n){const r=yr(e.serverSyncTree_,t);return null!=r?Promise.resolve(r):e.server_.get(t).then((r=>{const o=vt(r).withIndex(t._queryParams.getIndex());let c;if(mr(e.serverSyncTree_,t,n,!0),t._queryParams.loadsAllData())c=fr(e.serverSyncTree_,t._path,o);else{const n=Er(e.serverSyncTree_,t);c=gr(e.serverSyncTree_,t._path,o,n)}return fi(e.eventQueue_,t._path,c),pr(e.serverSyncTree_,t,n,null,!0),o}),(n=>(Ri(e,"get for query "+Object(c.R)(t)+" failed: "+n),Promise.reject(new Error(n)))))}(e._repo,e,n).then((t=>new ts(t,new es(e._repo,e._path),e._queryParams.getIndex())))}class ds{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new Ki("value",this,new ts(e.snapshotNode,new es(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,path){return this.callbackContext.hasCancelCallback?new $i(this,e,path):null}matches(e){return e instanceof ds&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class fs{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,path){return this.callbackContext.hasCancelCallback?new $i(this,e,path):null}createEvent(e,t){Object(c.e)(null!=e.childName,"Child events should have a childName.");const n=is(new es(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new Ki(e.type,this,new ts(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof fs&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function ps(e,t,n,r,o){let c;if("object"==typeof r&&(c=void 0,o=r),"function"==typeof r&&(c=r),o&&o.onlyOnce){const t=n,r=(n,r)=>{Ni(e._repo,e,h),t(n,r)};r.userCallback=n.userCallback,r.context=n.context,n=r}const l=new Hi(n,c||void 0),h="value"===t?new ds(l):new fs(t,l);return function(e,t,n){let r;r=".info"===Ce(t._path)?mr(e.infoSyncTree_,t,n):mr(e.serverSyncTree_,t,n),di(e.eventQueue_,t._path,r)}(e._repo,e,h),()=>Ni(e._repo,e,h)}function gs(e,t,n,r){return ps(e,"value",t,n,r)}function ms(e,t,n,r){return ps(e,"child_added",t,n,r)}function _s(e,t,n,r){return ps(e,"child_changed",t,n,r)}function ys(e,t,n,r){return ps(e,"child_moved",t,n,r)}function vs(e,t,n,r){return ps(e,"child_removed",t,n,r)}function ws(e,t,n){let r=null;const o=n?new Hi(n):null;"value"===t?r=new ds(o):t&&(r=new fs(t,o)),Ni(e._repo,e,r)}class bs{}class Is extends bs{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){ei("endAt",this._value,e._path,!0);const t=Rt(e._queryParams,this._value,this._key);if(Zi(t),Xi(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Yi(e._repo,e._path,t,e._orderByCalled)}}function Ts(e,t){return ii("endAt","key",t,!0),new Is(e,t)}class Es extends bs{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){ei("endBefore",this._value,e._path,!1);const t=function(e,t,n){let r;return r=e.index_===$e||n?Rt(e,t,n):Rt(e,t,M),r.endBeforeSet_=!0,r}(e._queryParams,this._value,this._key);if(Zi(t),Xi(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Yi(e._repo,e._path,t,e._orderByCalled)}}function Cs(e,t){return ii("endBefore","key",t,!0),new Es(e,t)}class Ss extends bs{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){ei("startAt",this._value,e._path,!0);const t=At(e._queryParams,this._value,this._key);if(Zi(t),Xi(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Yi(e._repo,e._path,t,e._orderByCalled)}}function ks(e=null,t){return ii("startAt","key",t,!0),new Ss(e,t)}class Os extends bs{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){ei("startAfter",this._value,e._path,!1);const t=function(e,t,n){let r;return r=e.index_===$e||n?At(e,t,n):At(e,t,j),r.startAfterSet_=!0,r}(e._queryParams,this._value,this._key);if(Zi(t),Xi(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Yi(e._repo,e._path,t,e._orderByCalled)}}function Ns(e,t){return ii("startAfter","key",t,!0),new Os(e,t)}class As extends bs{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Yi(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}(e._queryParams,this._limit),e._orderByCalled)}}function Rs(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new As(e)}class xs extends bs{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Yi(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}(e._queryParams,this._limit),e._orderByCalled)}}function Ds(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new xs(e)}class Ps extends bs{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Ji(e,"orderByChild");const t=new Te(this._path);if(xe(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const n=new wt(t),r=xt(e._queryParams,n);return Xi(r),new Yi(e._repo,e._path,r,!0)}}function Ls(path){if("$key"===path)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===path)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===path)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return si("orderByChild","path",path,!1),new Ps(path)}class Ms extends bs{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Ji(e,"orderByKey");const t=xt(e._queryParams,$e);return Xi(t),new Yi(e._repo,e._path,t,!0)}}function js(){return new Ms}class Fs extends bs{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Ji(e,"orderByPriority");const t=xt(e._queryParams,at);return Xi(t),new Yi(e._repo,e._path,t,!0)}}function Us(){return new Fs}class Vs extends bs{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Ji(e,"orderByValue");const t=xt(e._queryParams,bt);return Xi(t),new Yi(e._repo,e._path,t,!0)}}function qs(){return new Vs}class Bs extends bs{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(ei("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Is(this._value,this._key)._apply(new Ss(this._value,this._key)._apply(e))}}function zs(e,t){return ii("equalTo","key",t,!0),new Bs(e,t)}function Gs(e,...t){let n=Object(c.w)(e);for(const e of t)n=e._apply(n);return n}!function(e){Object(c.e)(!$n,"__referenceConstructor has already been defined"),$n=e}(es),function(e){Object(c.e)(!Hn,"__referenceConstructor has already been defined"),Hn=e}(es);const Ws="FIREBASE_DATABASE_EMULATOR_HOST",Ks={};let $s=!1;function Hs(t,n,r,o,c){let l=o||t.options.databaseURL;void 0===l&&(t.options.projectId||D("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),A("Using default host for project ",t.options.projectId),l=`${t.options.projectId}-default-rtdb.firebaseio.com`);let h,d,f=Bi(l,c),m=f.repoInfo;void 0!==e&&e.env&&(d=e.env[Ws]),d?(h=!0,l=`http://${d}?ns=${m.namespace}`,f=Bi(l,c),m=f.repoInfo):h=!f.repoInfo.secure;const _=c&&h?new X(X.OWNER):new J(t.name,t.options,n);ci("Invalid Firebase Database URL",f),xe(f.path)||D("Database URL must point to the root of a Firebase Database (not including a child path).");const y=function(e,t,n,r){let o=Ks[t.name];o||(o={},Ks[t.name]=o);let c=o[e.toURLString()];c&&D("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return c=new yi(e,$s,n,r),o[e.toURLString()]=c,c}(m,t,_,new Y(t.name,r));return new Qs(y,t)}class Qs{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(vi(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new es(this._repo,Ee())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const n=Ks[t];n&&n[e.key]===e||D(`Database ${t}(${e.repoInfo_}) has already been deleted.`),Ai(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&D("Cannot call "+e+" on a deleted database.")}}function Ys(){me.IS_TRANSPORT_INITIALIZED&&P("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Js(){Ys(),de.forceDisallow()}function Xs(){Ys(),ge.forceDisallow(),de.forceAllow()}function Zs(e,t,n,r={}){(e=Object(c.w)(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&D("Cannot call useEmulator() after instance has already been initialized.");const o=e._repoInternal;let l;if(o.repoInfo_.nodeAdmin)r.mockUserToken&&D('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),l=new X(X.OWNER);else if(r.mockUserToken){const t="string"==typeof r.mockUserToken?r.mockUserToken:Object(c.l)(r.mockUserToken,e.app.options.projectId);l=new X(t)}!function(e,t,n,r){e.repoInfo_=new ie(`${t}:${n}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0),r&&(e.authTokenProvider_=r)}(o,t,n,l)}function eo(e){(e=Object(c.w)(e))._checkNotDeleted("goOffline"),Ai(e._repo)}function to(e){var t;(e=Object(c.w)(e))._checkNotDeleted("goOnline"),(t=e._repo).persistentConnection_&&t.persistentConnection_.resume(mi)}function no(e,t){N(e,t)}const ro={".sv":"timestamp"};function io(){return ro}function so(e){return{".sv":{increment:e}}}class oo{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function ao(e,t,n){var r;if(e=Object(c.w)(e),ai("Reference.transaction",e._path),".length"===e.key||".keys"===e.key)throw"Reference.transaction failed: "+e.key+" is a read-only object.";const o=null===(r=null==n?void 0:n.applyLocally)||void 0===r||r,l=new c.a,h=gs(e,(()=>{}));return function(e,path,t,n,r,o){Ri(e,"transaction on "+path);const l={path:path,update:t,onComplete:n,status:null,order:E(),applyLocally:o,retryCount:0,unwatcher:r,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},h=Di(e,path,void 0);l.currentInputSnapshot=h;const d=l.update(h.val());if(void 0===d)l.unwatcher(),l.currentOutputSnapshotRaw=null,l.currentOutputSnapshotResolved=null,l.onComplete&&l.onComplete(null,!1,l.currentInputSnapshot);else{ti("transaction failed: Data returned ",d,l.path),l.status=0;const t=Vr(e.transactionQueueTree_,path),n=qr(t)||[];let r;n.push(l),Br(t,n),"object"==typeof d&&null!==d&&Object(c.k)(d,".priority")?(r=Object(c.O)(d,".priority"),Object(c.e)(Zr(r),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):r=(_r(e.serverSyncTree_,path)||mt.EMPTY_NODE).getPriority().val();const o=bi(e),f=vt(d,r),m=jr(f,h,o);l.currentOutputSnapshotRaw=f,l.currentOutputSnapshotResolved=m,l.currentWriteId=Ci(e);const _=ur(e.serverSyncTree_,path,m,l.currentWriteId,l.applyLocally);fi(e.eventQueue_,path,_),Pi(e,e.transactionQueueTree_)}}(e._repo,e._path,t,((t,n,r)=>{let o=null;t?l.reject(t):(o=new ts(r,new es(e._repo,e._path),at),l.resolve(new oo(n,o)))}),h,o),l.promise}Be.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Be.prototype.echo=function(data,e){this.sendRequest("echo",{d:data},e)};var co;m(r.SDK_VERSION),Object(r._registerComponent)(new o.a("database",((e,{instanceIdentifier:t})=>Hs(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)),"PUBLIC").setMultipleInstances(!0)),Object(r.registerVersion)(h,d,co),Object(r.registerVersion)(h,d,"esm2017")}).call(this,n(167))},581:function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return Ue})),n.d(t,"c",(function(){return Xe})),n.d(t,"d",(function(){return nt})),n.d(t,"e",(function(){return st})),n.d(t,"f",(function(){return it})),n.d(t,"g",(function(){return He})),n.d(t,"h",(function(){return tt})),n.d(t,"i",(function(){return Wn})),n.d(t,"j",(function(){return Hr})),n.d(t,"k",(function(){return d})),n.d(t,"l",(function(){return Fn})),n.d(t,"m",(function(){return ot})),n.d(t,"n",(function(){return at})),n.d(t,"o",(function(){return ct})),n.d(t,"p",(function(){return O})),n.d(t,"q",(function(){return Oe})),n.d(t,"r",(function(){return T})),n.d(t,"s",(function(){return gn})),n.d(t,"t",(function(){return ue})),n.d(t,"u",(function(){return mr})),n.d(t,"v",(function(){return cr})),n.d(t,"w",(function(){return de})),n.d(t,"y",(function(){return Dt})),n.d(t,"z",(function(){return hn})),n.d(t,"A",(function(){return Wr})),n.d(t,"B",(function(){return fn})),n.d(t,"C",(function(){return Pt})),n.d(t,"D",(function(){return xt})),n.d(t,"E",(function(){return Me})),n.d(t,"G",(function(){return Mt})),n.d(t,"H",(function(){return _})),n.d(t,"I",(function(){return qt})),n.d(t,"J",(function(){return en})),n.d(t,"K",(function(){return rn})),n.d(t,"L",(function(){return gr})),n.d(t,"M",(function(){return he})),n.d(t,"N",(function(){return On})),n.d(t,"O",(function(){return Ut})),n.d(t,"P",(function(){return Tt})),n.d(t,"Q",(function(){return qn})),n.d(t,"R",(function(){return nr})),n.d(t,"S",(function(){return pr})),n.d(t,"T",(function(){return an})),n.d(t,"U",(function(){return Et})),n.d(t,"V",(function(){return Bn})),n.d(t,"W",(function(){return er})),n.d(t,"X",(function(){return fr})),n.d(t,"Y",(function(){return Bt})),n.d(t,"Z",(function(){return Rt})),n.d(t,"ab",(function(){return Ft})),n.d(t,"bb",(function(){return ft})),n.d(t,"cb",(function(){return It})),n.d(t,"db",(function(){return Ct})),n.d(t,"eb",(function(){return jt})),n.d(t,"fb",(function(){return Vt})),n.d(t,"gb",(function(){return Vn})),n.d(t,"hb",(function(){return Zn})),n.d(t,"ib",(function(){return dr})),n.d(t,"jb",(function(){return _t})),n.d(t,"kb",(function(){return Wt})),n.d(t,"lb",(function(){return Kt})),n.d(t,"mb",(function(){return Gn})),n.d(t,"nb",(function(){return Gt})),n.d(t,"ob",(function(){return zt})),n.d(t,"pb",(function(){return Lt})),n.d(t,"x",(function(){return fi})),n.d(t,"F",(function(){return hi}));var r=n(313),o=n(329),c=n(327);function l(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;var h=n(314);const d={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},f={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function m(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const _=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}},y=m,v=new r.b("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),w=new c.b("@firebase/auth");function I(e,...t){w.logLevel<=c.a.ERROR&&w.error(`Auth (${o.SDK_VERSION}): ${e}`,...t)}function T(e,...t){throw k(e,...t)}function E(e,...t){return k(e,...t)}function C(e,code,t){const n=Object.assign(Object.assign({},y()),{[code]:t});return new r.b("auth","Firebase",n).create(code,{appName:e.name})}function S(e,object,t){if(!(object instanceof t))throw t.name!==object.constructor.name&&T(e,"argument-error"),C(e,"argument-error",`Type of ${object.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function k(e,...t){if("string"!=typeof e){const code=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(code,...n)}return v.create(e,...t)}function O(e,t,...n){if(!e)throw k(t,...n)}function N(e){const t="INTERNAL ASSERTION FAILED: "+e;throw I(t),new Error(t)}function A(e,t){e||N(t)}function R(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function x(){return"http:"===D()||"https:"===D()}function D(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class P{constructor(e,t){this.shortDelay=e,this.longDelay=t,A(t>e,"Short delay should be less than long delay!"),this.isMobile=Object(r.E)()||Object(r.H)()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(x()||Object(r.A)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function L(e,path){A(e.emulator,"Emulator should always be set here");const{url:t}=e.emulator;return path?`${t}${path.startsWith("/")?path.slice(1):path}`:t}class M{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void N("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void N("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void N("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const j={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},F=new P(3e4,6e4);function U(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function V(e,t,path,n,o={}){return B(e,o,(async()=>{let body={},o={};n&&("GET"===t?o=n:body={body:JSON.stringify(n)});const c=Object(r.M)(Object.assign({key:e.config.apiKey},o)).slice(1),l=await e._getAdditionalHeaders();return l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode),M.fetch()(G(e,e.config.apiHost,path,c),Object.assign({method:t,headers:l,referrerPolicy:"no-referrer"},body))}))}async function B(e,t,n){e._canInitEmulator=!1;const o=Object.assign(Object.assign({},j),t);try{const t=new K(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const c=await r.json();if("needConfirmation"in c)throw $(e,"account-exists-with-different-credential",c);if(r.ok&&!("errorMessage"in c))return c;{const t=r.ok?c.errorMessage:c.error.message,[n,l]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw $(e,"credential-already-in-use",c);if("EMAIL_EXISTS"===n)throw $(e,"email-already-in-use",c);if("USER_DISABLED"===n)throw $(e,"user-disabled",c);const h=o[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw C(e,h,l);T(e,h)}}catch(t){if(t instanceof r.c)throw t;T(e,"network-request-failed",{message:String(t)})}}async function z(e,t,path,n,r={}){const o=await V(e,t,path,n,r);return"mfaPendingCredential"in o&&T(e,"multi-factor-auth-required",{_serverResponse:o}),o}function G(e,t,path,n){const base=`${t}${path}?${n}`;return e.config.emulator?L(e.config,base):`${e.config.apiScheme}://${base}`}function W(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class K{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(E(this.auth,"network-request-failed"))),F.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function $(e,code,t){const n={appName:e.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const r=E(e,code,n);return r.customData._tokenResponse=t,r}function H(e){return void 0!==e&&void 0!==e.getResponse}function Q(e){return void 0!==e&&void 0!==e.enterprise}class Y{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return W(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}async function J(e,t){return V(e,"GET","/v2/recaptchaConfig",U(e,t))}function X(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Z(e){return 1e3*Number(e)}function ee(e){const[t,n,o]=e.split(".");if(void 0===t||void 0===n||void 0===o)return I("JWT malformed, contained fewer than 3 sections"),null;try{const e=Object(r.h)(n);return e?JSON.parse(e):(I("Failed to decode base64 JWT payload"),null)}catch(e){return I("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function te(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof r.c&&function({code:code}){return"auth/user-disabled"===code||"auth/user-token-expired"===code}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class ne{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class re{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=X(this.lastLoginAt),this.creationTime=X(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ie(e){var t;const n=e.auth,r=await e.getIdToken(),o=await te(e,async function(e,t){return V(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));O(null==o?void 0:o.users.length,n,"internal-error");const c=o.users[0];e._notifyReloadListener(c);const h=(null===(t=c.providerUserInfo)||void 0===t?void 0:t.length)?c.providerUserInfo.map((e=>{var{providerId:t}=e,n=l(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[];const d=(f=e.providerData,m=h,[...f.filter((e=>!m.some((t=>t.providerId===e.providerId)))),...m]);var f,m;const _=e.isAnonymous,y=!(e.email&&c.passwordHash||(null==d?void 0:d.length)),v=!!_&&y,w={uid:c.localId,displayName:c.displayName||null,photoURL:c.photoUrl||null,email:c.email||null,emailVerified:c.emailVerified||!1,phoneNumber:c.phoneNumber||null,tenantId:c.tenantId||null,providerData:d,metadata:new re(c.createdAt,c.lastLoginAt),isAnonymous:v};Object.assign(e,w)}class se{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){O(e.idToken,"internal-error"),O(void 0!==e.idToken,"internal-error"),O(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=ee(e);return O(t,"internal-error"),O(void 0!==t.exp,"internal-error"),O(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return O(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:o,expiresIn:c}=await async function(e,t){const n=await B(e,{},(async()=>{const body=Object(r.M)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:o}=e.config,c=G(e,n,"/v1/token",`key=${o}`),l=await e._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",M.fetch()(c,{method:"POST",headers:l,body:body})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,o,Number(c))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,object){const{refreshToken:t,accessToken:n,expirationTime:r}=object,o=new se;return t&&(O("string"==typeof t,"internal-error",{appName:e}),o.refreshToken=t),n&&(O("string"==typeof n,"internal-error",{appName:e}),o.accessToken=n),r&&(O("number"==typeof r,"internal-error",{appName:e}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new se,this.toJSON())}_performRefresh(){return N("not implemented")}}function oe(e,t){O("string"==typeof e||void 0===e,"internal-error",{appName:t})}class ae{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,o=l(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ne(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=o.displayName||null,this.email=o.email||null,this.emailVerified=o.emailVerified||!1,this.phoneNumber=o.phoneNumber||null,this.photoURL=o.photoURL||null,this.isAnonymous=o.isAnonymous||!1,this.tenantId=o.tenantId||null,this.providerData=o.providerData?[...o.providerData]:[],this.metadata=new re(o.createdAt||void 0,o.lastLoginAt||void 0)}async getIdToken(e){const t=await te(this,this.stsTokenManager.getToken(this.auth,e));return O(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=Object(r.w)(e),o=await n.getIdToken(t),c=ee(o);O(c&&c.exp&&c.auth_time&&c.iat,n.auth,"internal-error");const l="object"==typeof c.firebase?c.firebase:void 0,h=null==l?void 0:l.sign_in_provider;return{claims:c,token:o,authTime:X(Z(c.auth_time)),issuedAtTime:X(Z(c.iat)),expirationTime:X(Z(c.exp)),signInProvider:h||null,signInSecondFactor:(null==l?void 0:l.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=Object(r.w)(e);await ie(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(O(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ae(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){O(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await ie(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await te(this,async function(e,t){return V(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,object){var t,n,r,o,c,l,h,d;const f=null!==(t=object.displayName)&&void 0!==t?t:void 0,m=null!==(n=object.email)&&void 0!==n?n:void 0,_=null!==(r=object.phoneNumber)&&void 0!==r?r:void 0,y=null!==(o=object.photoURL)&&void 0!==o?o:void 0,v=null!==(c=object.tenantId)&&void 0!==c?c:void 0,w=null!==(l=object._redirectEventId)&&void 0!==l?l:void 0,I=null!==(h=object.createdAt)&&void 0!==h?h:void 0,T=null!==(d=object.lastLoginAt)&&void 0!==d?d:void 0,{uid:E,emailVerified:C,isAnonymous:S,providerData:k,stsTokenManager:N}=object;O(E&&N,e,"internal-error");const A=se.fromJSON(this.name,N);O("string"==typeof E,e,"internal-error"),oe(f,e.name),oe(m,e.name),O("boolean"==typeof C,e,"internal-error"),O("boolean"==typeof S,e,"internal-error"),oe(_,e.name),oe(y,e.name),oe(v,e.name),oe(w,e.name),oe(I,e.name),oe(T,e.name);const R=new ae({uid:E,auth:e,email:m,emailVerified:C,displayName:f,isAnonymous:S,photoURL:y,phoneNumber:_,tenantId:v,stsTokenManager:A,createdAt:I,lastLoginAt:T});return k&&Array.isArray(k)&&(R.providerData=k.map((e=>Object.assign({},e)))),w&&(R._redirectEventId=w),R}static async _fromIdTokenResponse(e,t,n=!1){const r=new se;r.updateFromServerResponse(t);const o=new ae({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await ie(o),o}}const ce=new Map;function ue(e){A(e instanceof Function,"Expected a class definition");let t=ce.get(e);return t?(A(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,ce.set(e,t),t)}class le{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}le.type="NONE";const he=le;function de(e,t,n){return`firebase:${e}:${t}:${n}`}class fe{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:o}=this.auth;this.fullUserKey=de(this.userKey,r.apiKey,o),this.fullPersistenceKey=de("persistence",r.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ae._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new fe(ue(he),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let o=r[0]||ue(he);const c=de(n,e.config.apiKey,e.name);let l=null;for(const n of t)try{const t=await n._get(c);if(t){const r=ae._fromJSON(e,t);n!==o&&(l=r),o=n;break}}catch(e){}const h=r.filter((p=>p._shouldAllowMigration));return o._shouldAllowMigration&&h.length?(o=h[0],l&&await o._set(c,l.toJSON()),await Promise.all(t.map((async e=>{if(e!==o)try{await e._remove(c)}catch(e){}}))),new fe(o,e,n)):new fe(o,e,n)}}function pe(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ye(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(ge(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(we(t))return"Blackberry";if(be(t))return"Webos";if(me(t))return"Safari";if((t.includes("chrome/")||_e(t))&&!t.includes("edge/"))return"Chrome";if(ve(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function ge(e=Object(r.x)()){return/firefox\//i.test(e)}function me(e=Object(r.x)()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function _e(e=Object(r.x)()){return/crios\//i.test(e)}function ye(e=Object(r.x)()){return/iemobile/i.test(e)}function ve(e=Object(r.x)()){return/android/i.test(e)}function we(e=Object(r.x)()){return/blackberry/i.test(e)}function be(e=Object(r.x)()){return/webos/i.test(e)}function Ie(e=Object(r.x)()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Te(e=Object(r.x)()){return Ie(e)||ve(e)||be(e)||we(e)||/windows phone/i.test(e)||ye(e)}function Ee(e,t=[]){let n;switch(e){case"Browser":n=pe(Object(r.x)());break;case"Worker":n=`${pe(Object(r.x)())}-${e}`;break;default:n=e}const c=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${o.SDK_VERSION}/${c}`}class Ce{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class Se{constructor(e){var t,n,r,o;const c=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=c.minPasswordLength)&&void 0!==t?t:6,c.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=c.maxPasswordLength),void 0!==c.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=c.containsLowercaseCharacter),void 0!==c.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=c.containsUppercaseCharacter),void 0!==c.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=c.containsNumericCharacter),void 0!==c.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=c.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(o=e.forceUpgradeOnSignin)&&void 0!==o&&o,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,o,c,l;const h={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,h),this.validatePasswordCharacterOptions(e,h),h.isValid&&(h.isValid=null===(t=h.meetsMinPasswordLength)||void 0===t||t),h.isValid&&(h.isValid=null===(n=h.meetsMaxPasswordLength)||void 0===n||n),h.isValid&&(h.isValid=null===(r=h.containsLowercaseLetter)||void 0===r||r),h.isValid&&(h.isValid=null===(o=h.containsUppercaseLetter)||void 0===o||o),h.isValid&&(h.isValid=null===(c=h.containsNumericCharacter)||void 0===c||c),h.isValid&&(h.isValid=null===(l=h.containsNonAlphanumericCharacter)||void 0===l||l),h}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class ke{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ne(this),this.idTokenSubscription=new Ne(this),this.beforeStateQueue=new Ce(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=v,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ue(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await fe.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let r=n,o=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,c=null==r?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);n&&n!==c||!(null==l?void 0:l.user)||(r=l.user,o=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(o)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return O(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ie(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?Object(r.w)(e):null;return t&&O(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&O(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(ue(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return V(e,"GET","/v2/passwordPolicy",U(e,t))}(this),t=new Se(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new r.b("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return V(e,"POST","/v2/accounts:revokeToken",U(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ue(e)||this._popupRedirectResolver;O(t,this,"argument-error"),this.redirectPersistenceManager=await fe.create(this,[ue(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const o="function"==typeof t?t:t.next.bind(t);let c=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(O(l,this,"internal-error"),l.then((()=>{c||o(this.currentUser)})),"function"==typeof t){const o=e.addObserver(t,n,r);return()=>{c=!0,o()}}{const n=e.addObserver(t);return()=>{c=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return O(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ee(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){w.logLevel<=c.a.WARN&&w.warn(`Auth (${o.SDK_VERSION}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function Oe(e){return Object(r.w)(e)}class Ne{constructor(e){this.auth=e,this.observer=null,this.addObserver=Object(r.m)((e=>this.observer=e))}get next(){return O(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Ae={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Re(e){return Ae.loadJS(e)}function xe(e){return`__${e}${Math.floor(1e6*Math.random())}`}class De{constructor(e){this.type="recaptcha-enterprise",this.auth=Oe(e)}async verify(e="verify",t=!1){function n(t,n,r){const o=window.grecaptcha;Q(o)?o.enterprise.ready((()=>{o.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{J(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new Y(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((o=>{if(!t&&Q(window.grecaptcha))n(o,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=Ae.recaptchaEnterpriseScript;0!==t.length&&(t+=o),Re(t).then((()=>{n(o,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function Pe(e,t,n,r=!1){const o=new De(e);let c;try{c=await o.verify(n)}catch(e){c=await o.verify(n,!0)}const l=Object.assign({},t);return r?Object.assign(l,{captchaResp:c}):Object.assign(l,{captchaResponse:c}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function Le(e,t,n,r){var o;if(null===(o=e._getRecaptchaConfig())||void 0===o?void 0:o.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await Pe(e,t,n,"getOobCode"===n);return r(e,o)}return r(e,t).catch((async o=>{if("auth/missing-recaptcha-token"===o.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await Pe(e,t,n,"getOobCode"===n);return r(e,o)}return Promise.reject(o)}))}function Me(e,t,n){const r=Oe(e);O(r._canInitEmulator,r,"emulator-config-failed"),O(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const o=!!(null==n?void 0:n.disableWarnings),c=je(t),{host:l,port:h}=function(e){const t=je(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",o=/^(\[[^\]]+\])(:|$)/.exec(r);if(o){const e=o[1];return{host:e,port:Fe(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Fe(t)}}}(t),d=null===h?"":`:${h}`;r.config.emulator={url:`${c}//${l}${d}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:l,port:h,protocol:c.replace(":",""),options:Object.freeze({disableWarnings:o})}),o||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function je(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Fe(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Ue{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return N("not implemented")}_getIdTokenResponse(e){return N("not implemented")}_linkToIdToken(e,t){return N("not implemented")}_getReauthenticationResolver(e){return N("not implemented")}}async function Ve(e,t){return V(e,"POST","/v1/accounts:resetPassword",U(e,t))}async function qe(e,t){return V(e,"POST","/v1/accounts:signUp",t)}async function Be(e,t){return z(e,"POST","/v1/accounts:signInWithPassword",U(e,t))}async function ze(e,t){return V(e,"POST","/v1/accounts:sendOobCode",U(e,t))}async function Ge(e,t){return ze(e,t)}async function We(e,t){return ze(e,t)}class Ke extends Ue{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Ke(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Ke(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Le(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Be);case"emailLink":return async function(e,t){return z(e,"POST","/v1/accounts:signInWithEmailLink",U(e,t))}(e,{email:this._email,oobCode:this._password});default:T(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Le(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",qe);case"emailLink":return async function(e,t){return z(e,"POST","/v1/accounts:signInWithEmailLink",U(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:T(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function $e(e,t){return z(e,"POST","/v1/accounts:signInWithIdp",U(e,t))}class He extends Ue{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new He(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):T("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,o=l(t,["providerId","signInMethod"]);if(!n||!r)return null;const c=new He(n,r);return c.idToken=o.idToken||void 0,c.accessToken=o.accessToken||void 0,c.secret=o.secret,c.nonce=o.nonce,c.pendingToken=o.pendingToken||null,c}_getIdTokenResponse(e){return $e(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,$e(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,$e(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Object(r.M)(t)}return e}}const Qe={USER_NOT_FOUND:"user-not-found"};class Ye extends Ue{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Ye({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Ye({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return z(e,"POST","/v1/accounts:signInWithPhoneNumber",U(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await z(e,"POST","/v1/accounts:signInWithPhoneNumber",U(e,t));if(n.temporaryProof)throw $(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return z(e,"POST","/v1/accounts:signInWithPhoneNumber",U(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Qe)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:o}=e;return n||t||r||o?new Ye({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:o}):null}}class Je{constructor(e){var t,n,o,c,l,h;const d=Object(r.N)(Object(r.r)(e)),f=null!==(t=d.apiKey)&&void 0!==t?t:null,code=null!==(n=d.oobCode)&&void 0!==n?n:null,m=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(o=d.mode)&&void 0!==o?o:null);O(f&&code&&m,"argument-error"),this.apiKey=f,this.operation=m,this.code=code,this.continueUrl=null!==(c=d.continueUrl)&&void 0!==c?c:null,this.languageCode=null!==(l=d.languageCode)&&void 0!==l?l:null,this.tenantId=null!==(h=d.tenantId)&&void 0!==h?h:null}static parseLink(link){const e=function(e){const link=Object(r.N)(Object(r.r)(e)).link,t=link?Object(r.N)(Object(r.r)(link)).deep_link_id:null,n=Object(r.N)(Object(r.r)(e)).deep_link_id;return(n?Object(r.N)(Object(r.r)(n)).link:null)||n||t||link||e}(link);try{return new Je(e)}catch(e){return null}}}class Xe{constructor(){this.providerId=Xe.PROVIDER_ID}static credential(e,t){return Ke._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Je.parseLink(t);return O(n,"argument-error"),Ke._fromEmailAndCode(e,n.code,n.tenantId)}}Xe.PROVIDER_ID="password",Xe.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Xe.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Ze{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class et extends Ze{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class tt extends et{static credentialFromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return O("providerId"in t&&"signInMethod"in t,"argument-error"),He._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return O(e.idToken||e.accessToken,"argument-error"),He._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return tt.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return tt.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:o,nonce:c,providerId:l}=e;if(!(n||r||t||o))return null;if(!l)return null;try{return new tt(l)._credential({idToken:t,accessToken:n,nonce:c,pendingToken:o})}catch(e){return null}}}class nt extends et{constructor(){super("facebook.com")}static credential(e){return He._fromParams({providerId:nt.PROVIDER_ID,signInMethod:nt.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return nt.credentialFromTaggedObject(e)}static credentialFromError(e){return nt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return nt.credential(e.oauthAccessToken)}catch(e){return null}}}nt.FACEBOOK_SIGN_IN_METHOD="facebook.com",nt.PROVIDER_ID="facebook.com";class it extends et{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return He._fromParams({providerId:it.PROVIDER_ID,signInMethod:it.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return it.credentialFromTaggedObject(e)}static credentialFromError(e){return it.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return it.credential(t,n)}catch(e){return null}}}it.GOOGLE_SIGN_IN_METHOD="google.com",it.PROVIDER_ID="google.com";class st extends et{constructor(){super("github.com")}static credential(e){return He._fromParams({providerId:st.PROVIDER_ID,signInMethod:st.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return st.credentialFromTaggedObject(e)}static credentialFromError(e){return st.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return st.credential(e.oauthAccessToken)}catch(e){return null}}}st.GITHUB_SIGN_IN_METHOD="github.com",st.PROVIDER_ID="github.com";class ot extends Ue{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return $e(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,$e(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,$e(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,pendingToken:o}=t;return n&&r&&o&&n===r?new ot(n,o):null}static _create(e,t){return new ot(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class at extends Ze{constructor(e){O(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return at.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return at.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=ot.fromJSON(e);return O(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return ot._create(n,t)}catch(e){return null}}}class ct extends et{constructor(){super("twitter.com")}static credential(e,t){return He._fromParams({providerId:ct.PROVIDER_ID,signInMethod:ct.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ct.credentialFromTaggedObject(e)}static credentialFromError(e){return ct.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return ct.credential(t,n)}catch(e){return null}}}async function ut(e,t){return z(e,"POST","/v1/accounts:signUp",U(e,t))}ct.TWITTER_SIGN_IN_METHOD="twitter.com",ct.PROVIDER_ID="twitter.com";class lt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const o=await ae._fromIdTokenResponse(e,n,r),c=ht(n);return new lt({user:o,providerId:c,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=ht(n);return new lt({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function ht(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}async function ft(e){var t;const n=Oe(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new lt({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await ut(n,{returnSecureToken:!0}),o=await lt._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(o.user),o}class pt extends r.c{constructor(e,t,n,r){var o;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,pt.prototype),this.customData={appName:e.name,tenantId:null!==(o=e.tenantId)&&void 0!==o?o:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new pt(e,t,n,r)}}function gt(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw pt._fromErrorAndOperation(e,n,t,r);throw n}))}function mt(e){return new Set(e.map((({providerId:e})=>e)).filter((e=>!!e)))}async function _t(e,t){const n=Object(r.w)(e);await vt(!0,n,t);const{providerUserInfo:o}=await async function(e,t){return V(e,"POST","/v1/accounts:update",t)}(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),c=mt(o||[]);return n.providerData=n.providerData.filter((e=>c.has(e.providerId))),c.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function yt(e,t,n=!1){const r=await te(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return lt._forOperation(e,"link",r)}async function vt(e,t,n){await ie(t);const code=!1===e?"provider-already-linked":"no-such-provider";O(mt(t.providerData).has(n)===e,t.auth,code)}async function wt(e,t,n=!1){const{auth:r}=e,o="reauthenticate";try{const c=await te(e,gt(r,o,t,e),n);O(c.idToken,r,"internal-error");const l=ee(c.idToken);O(l,r,"internal-error");const{sub:h}=l;return O(e.uid===h,r,"user-mismatch"),lt._forOperation(e,o,c)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&T(r,"user-mismatch"),e}}async function bt(e,t,n=!1){const r="signIn",o=await gt(e,r,t),c=await lt._fromIdTokenResponse(e,r,o);return n||await e._updateCurrentUser(c.user),c}async function It(e,t){return bt(Oe(e),t)}async function Tt(e,t){const n=Object(r.w)(e);return await vt(!1,n,t.providerId),yt(n,t)}async function Et(e,t){return wt(Object(r.w)(e),t)}async function Ct(e,t){const n=Oe(e),r=await async function(e,t){return z(e,"POST","/v1/accounts:signInWithCustomToken",U(e,t))}(n,{token:t,returnSecureToken:!0}),o=await lt._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(o.user),o}class St{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?kt._fromServerResponse(e,t):"totpInfo"in t?Ot._fromServerResponse(e,t):T(e,"internal-error")}}class kt extends St{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new kt(t)}}class Ot extends St{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Ot(t)}}function Nt(e,t,n){var r;O((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),O(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(O(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(O(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function At(e){const t=Oe(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function Rt(e,t,n){const r=Oe(e),o={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};n&&Nt(r,o,n),await Le(r,o,"getOobCode",Ge)}async function xt(e,t,n){await Ve(Object(r.w)(e),{oobCode:t,newPassword:n}).catch((async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&At(e),t}))}async function Dt(e,t){await async function(e,t){return V(e,"POST","/v1/accounts:update",U(e,t))}(Object(r.w)(e),{oobCode:t})}async function Pt(e,t){const n=Object(r.w)(e),o=await Ve(n,{oobCode:t}),c=o.requestType;switch(O(c,n,"internal-error"),c){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":O(o.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":O(o.mfaInfo,n,"internal-error");default:O(o.email,n,"internal-error")}let l=null;return o.mfaInfo&&(l=St._fromServerResponse(Oe(n),o.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===o.requestType?o.newEmail:o.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===o.requestType?o.email:o.newEmail)||null,multiFactorInfo:l},operation:c}}async function Lt(e,code){const{data:data}=await Pt(Object(r.w)(e),code);return data.email}async function Mt(e,t,n){const r=Oe(e),o=Le(r,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ut),c=await o.catch((t=>{throw"auth/password-does-not-meet-requirements"===t.code&&At(e),t})),l=await lt._fromIdTokenResponse(r,"signIn",c);return await r._updateCurrentUser(l.user),l}function jt(e,t,n){return It(Object(r.w)(e),Xe.credential(t,n)).catch((async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&At(e),t}))}async function Ft(e,t,n){const r=Oe(e),o={requestType:"EMAIL_SIGNIN",email:t,clientType:"CLIENT_TYPE_WEB"};!function(e,t){O(t.handleCodeInApp,r,"argument-error"),t&&Nt(r,e,t)}(o,n),await Le(r,o,"getOobCode",We)}function Ut(e,t){const n=Je.parseLink(t);return"EMAIL_SIGNIN"===(null==n?void 0:n.operation)}async function Vt(e,t,n){const o=Object(r.w)(e),c=Xe.credentialWithLink(t,n||R());return O(c._tenantId===(o.tenantId||null),o,"tenant-id-mismatch"),It(o,c)}async function qt(e,t){const n={identifier:t,continueUri:x()?R():"http://localhost"},{signinMethods:o}=await async function(e,t){return V(e,"POST","/v1/accounts:createAuthUri",U(e,t))}(Object(r.w)(e),n);return o||[]}async function Bt(e,t){const n=Object(r.w)(e),o={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&Nt(n.auth,o,t);const{email:c}=await async function(e,t){return ze(e,t)}(n.auth,o);c!==e.email&&await e.reload()}async function zt(e,t,n){const o=Object(r.w)(e),c={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&Nt(o.auth,c,n);const{email:l}=await async function(e,t){return ze(e,t)}(o.auth,c);l!==e.email&&await e.reload()}async function Gt(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const o=Object(r.w)(e),c={idToken:await o.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},l=await te(o,async function(e,t){return V(e,"POST","/v1/accounts:update",t)}(o.auth,c));o.displayName=l.displayName||null,o.photoURL=l.photoUrl||null;const h=o.providerData.find((({providerId:e})=>"password"===e));h&&(h.displayName=o.displayName,h.photoURL=o.photoURL),await o._updateTokensIfNecessary(l)}function Wt(e,t){return $t(Object(r.w)(e),t,null)}function Kt(e,t){return $t(Object(r.w)(e),null,t)}async function $t(e,t,n){const{auth:r}=e,o={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(o.email=t),n&&(o.password=n);const c=await te(e,async function(e,t){return V(e,"POST","/v1/accounts:update",t)}(r,o));await e._updateTokensIfNecessary(c,!0)}class Ht{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class Qt extends Ht{constructor(e,t,n,r){super(e,t,n),this.username=r}}class Yt extends Ht{constructor(e,t){super(e,"facebook.com",t)}}class Jt extends Qt{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class Xt extends Ht{constructor(e,t){super(e,"google.com",t)}}class Zt extends Qt{constructor(e,t,n){super(e,"twitter.com",t,n)}}function en(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;const{providerId:r}=e,o=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},c=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null==e?void 0:e.idToken)){const r=null===(n=null===(t=ee(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n.sign_in_provider;if(r)return new Ht(c,"anonymous"!==r&&"custom"!==r?r:null)}if(!r)return null;switch(r){case"facebook.com":return new Yt(c,o);case"github.com":return new Jt(c,o);case"google.com":return new Xt(c,o);case"twitter.com":return new Zt(c,o,e.screenName||null);case"custom":case"anonymous":return new Ht(c,null);default:return new Ht(c,r,o)}}(n)}class tn{constructor(e,t,n){this.type=e,this.credential=t,this.user=n}static _fromIdtoken(e,t){return new tn("enroll",e,t)}static _fromMfaPendingCredential(e){return new tn("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return tn._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return tn._fromIdtoken(e.multiFactorSession.idToken)}return null}}class nn{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=Oe(e),r=t.customData._serverResponse,o=(r.mfaInfo||[]).map((e=>St._fromServerResponse(n,e)));O(r.mfaPendingCredential,n,"internal-error");const c=tn._fromMfaPendingCredential(r.mfaPendingCredential);return new nn(c,o,(async e=>{const o=await e._process(n,c);delete r.mfaInfo,delete r.mfaPendingCredential;const l=Object.assign(Object.assign({},r),{idToken:o.idToken,refreshToken:o.refreshToken});switch(t.operationType){case"signIn":const e=await lt._fromIdTokenResponse(n,t.operationType,l);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return O(t.user,n,"internal-error"),lt._forOperation(t.user,t.operationType,l);default:T(n,"internal-error")}}))}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function rn(e,t){var n;const o=Object(r.w)(e),c=t;return O(t.customData.operationType,o,"argument-error"),O(null===(n=c.customData._serverResponse)||void 0===n?void 0:n.mfaPendingCredential,o,"argument-error"),nn._fromError(o,c)}class sn{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload((t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map((t=>St._fromServerResponse(e.auth,t))))}))}static _fromUser(e){return new sn(e)}async getSession(){return tn._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const n=e,r=await this.getSession(),o=await te(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(o),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid,n=await this.user.getIdToken();try{const e=await te(this.user,(r=this.user.auth,o={idToken:n,mfaEnrollmentId:t},V(r,"POST","/v2/accounts/mfaEnrollment:withdraw",U(r,o))));this.enrolledFactors=this.enrolledFactors.filter((({uid:e})=>e!==t)),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(e){throw e}var r,o}}const on=new WeakMap;function an(e){const t=Object(r.w)(e);return on.has(t)||on.set(t,sn._fromUser(t)),on.get(t)}const cn="__sak";class un{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(cn,"1"),this.storage.removeItem(cn),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class ln extends un{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=Object(r.x)();return me(e)||Ie(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Te(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const o=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},c=this.storage.getItem(n);Object(r.C)()&&10===document.documentMode&&c!==e.newValue&&e.newValue!==e.oldValue?setTimeout(o,10):o()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}ln.type="LOCAL";const hn=ln;class dn extends un{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}dn.type="SESSION";const fn=dn;class pn{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new pn(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:data}=t.data,o=this.handlersMap[r];if(!(null==o?void 0:o.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const c=Array.from(o).map((async e=>e(t.origin,data))),l=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(c);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:l})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function gn(e="",t=10){let n="";for(let i=0;i<t;i++)n+=Math.floor(10*Math.random());return e+n}pn.receivers=[];class mn{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,data,t=50){const n="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!n)throw new Error("connection_unavailable");let r,o;return new Promise(((c,l)=>{const h=gn("",20);n.port1.start();const d=setTimeout((()=>{l(new Error("unsupported_event"))}),t);o={messageChannel:n,onMessage(e){const t=e;if(t.data.eventId===h)switch(t.data.status){case"ack":clearTimeout(d),r=setTimeout((()=>{l(new Error("timeout"))}),3e3);break;case"done":clearTimeout(r),c(t.data.response);break;default:clearTimeout(d),clearTimeout(r),l(new Error("invalid_response"))}}},this.handlers.add(o),n.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:data},[n.port2])})).finally((()=>{o&&this.removeMessageHandler(o)}))}}function _n(){return window}function yn(){return void 0!==_n().WorkerGlobalScope&&"function"==typeof _n().importScripts}const vn="firebaseLocalStorageDb",wn="firebaseLocalStorage",bn="fbase_key";class In{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Tn(e,t){return e.transaction([wn],t?"readwrite":"readonly").objectStore(wn)}function En(){const e=indexedDB.open(vn,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(wn,{keyPath:bn})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(wn)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(vn);return new In(e).toPromise()}(),t(await En()))}))}))}async function Cn(e,t,n){const r=Tn(e,!0).put({[bn]:t,value:n});return new In(r).toPromise()}function Sn(e,t){const n=Tn(e,!0).delete(t);return new In(n).toPromise()}class kn{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await En()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return yn()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=pn._getInstance(yn()?self:null),this.receiver._subscribe("keyChanged",(async(e,data)=>({keyProcessed:(await this._poll()).includes(data.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new mn(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await En();return await Cn(e,cn,"1"),await Sn(e,cn),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Cn(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Tn(e,!1).get(t),data=await new In(n).toPromise();return void 0===data?null:data.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Sn(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Tn(e,!1).getAll();return new In(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:o}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(o)&&(this.notifyListeners(r,o),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}kn.type="LOCAL";const On=kn;const Nn=1e12;class An{constructor(e){this.auth=e,this.counter=Nn,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new Rn(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||Nn;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||Nn;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const n=e||Nn;return null===(t=this._widgets.get(n))||void 0===t||t.execute(),""}}class Rn{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"==typeof e?document.getElementById(e):e;O(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout((()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let i=0;i<e;i++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout((()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()}),6e4)}),500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const xn=xe("rcb"),Dn=new P(3e4,6e4);class Pn{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(e=_n().grecaptcha)||void 0===e?void 0:e.render)}load(e,t=""){return O(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)&&H(_n().grecaptcha)?Promise.resolve(_n().grecaptcha):new Promise(((n,o)=>{const c=_n().setTimeout((()=>{o(E(e,"network-request-failed"))}),Dn.get());_n()[xn]=()=>{_n().clearTimeout(c),delete _n()[xn];const r=_n().grecaptcha;if(!r||!H(r))return void o(E(e,"internal-error"));const l=r.render;r.render=(e,t)=>{const n=l(e,t);return this.counter++,n},this.hostLanguage=t,n(r)};Re(`${Ae.recaptchaV2Script}?${Object(r.M)({onload:xn,render:"explicit",hl:t})}`).catch((()=>{clearTimeout(c),o(E(e,"internal-error"))}))}))}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(null===(t=_n().grecaptcha)||void 0===t?void 0:t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Ln{async load(e){return new An(e)}clearedOneInstance(){}}const Mn="recaptcha",jn={theme:"light",type:"image"};class Fn{constructor(e,t,n=Object.assign({},jn)){this.parameters=n,this.type=Mn,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Oe(e),this.isInvisible="invisible"===this.parameters.size,O("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"==typeof t?document.getElementById(t):t;O(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Ln:new Pn,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),n=t.getResponse(e);return n||new Promise((n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)}))}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch((e=>{throw this.renderPromise=null,e}))),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach((e=>{this.container.removeChild(e)}))}validateStartingState(){O(!this.parameters.sitekey,this.auth,"argument-error"),O(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),O("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach((e=>e(t))),"function"==typeof e)e(t);else if("string"==typeof e){const n=_n()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){O(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){O(x()&&!yn(),this.auth,"internal-error"),await function(){let e=null;return new Promise((t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()})).catch((t=>{throw e&&window.removeEventListener("load",e),t}))}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await V(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);O(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return O(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Un{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Ye._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function Vn(e,t,n){const o=Oe(e),c=await zn(o,t,Object(r.w)(n));return new Un(c,(e=>It(o,e)))}async function qn(e,t,n){const o=Object(r.w)(e);await vt(!1,o,"phone");const c=await zn(o.auth,t,Object(r.w)(n));return new Un(c,(e=>Tt(o,e)))}async function Bn(e,t,n){const o=Object(r.w)(e),c=await zn(o.auth,t,Object(r.w)(n));return new Un(c,(e=>Et(o,e)))}async function zn(e,t,n){var r;const o=await n.verify();try{let c;if(O("string"==typeof o,e,"argument-error"),O(n.type===Mn,e,"argument-error"),c="string"==typeof t?{phoneNumber:t}:t,"session"in c){const t=c.session;if("phoneNumber"in c){O("enroll"===t.type,e,"internal-error");const n=await function(e,t){return V(e,"POST","/v2/accounts/mfaEnrollment:start",U(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:c.phoneNumber,recaptchaToken:o}});return n.phoneSessionInfo.sessionInfo}{O("signin"===t.type,e,"internal-error");const n=(null===(r=c.multiFactorHint)||void 0===r?void 0:r.uid)||c.multiFactorUid;O(n,e,"missing-multi-factor-info");const l=await function(e,t){return V(e,"POST","/v2/accounts/mfaSignIn:start",U(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:o}});return l.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return V(e,"POST","/v1/accounts:sendVerificationCode",U(e,t))}(e,{phoneNumber:c.phoneNumber,recaptchaToken:o});return t}}finally{n._reset()}}async function Gn(e,t){await yt(Object(r.w)(e),t)}class Wn{constructor(e){this.providerId=Wn.PROVIDER_ID,this.auth=Oe(e)}verifyPhoneNumber(e,t){return zn(this.auth,e,Object(r.w)(t))}static credential(e,t){return Ye._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Wn.credentialFromTaggedObject(t)}static credentialFromError(e){return Wn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Ye._fromTokenResponse(t,n):null}}function Kn(e,t){return t?ue(t):(O(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Wn.PROVIDER_ID="phone",Wn.PHONE_SIGN_IN_METHOD="phone";class $n extends Ue{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return $e(e,this._buildIdpRequest())}_linkToIdToken(e,t){return $e(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return $e(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Hn(e){return bt(e.auth,new $n(e),e.bypassAuthState)}function Qn(e){const{auth:t,user:n}=e;return O(n,t,"internal-error"),wt(n,new $n(e),e.bypassAuthState)}async function Yn(e){const{auth:t,user:n}=e;return O(n,t,"internal-error"),yt(n,new $n(e),e.bypassAuthState)}class Jn{constructor(e,filter,t,n,r=!1){this.auth=e,this.resolver=t,this.user=n,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(filter)?filter:[filter]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:o,error:c,type:l}=e;if(c)return void this.reject(c);const h={auth:this.auth,requestUri:t,sessionId:n,tenantId:o||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(h))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Hn;case"linkViaPopup":case"linkViaRedirect":return Yn;case"reauthViaPopup":case"reauthViaRedirect":return Qn;default:T(this.auth,"internal-error")}}resolve(e){A(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){A(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Xn=new P(2e3,1e4);async function Zn(e,t,n){const r=Oe(e);S(e,t,Ze);const o=Kn(r,n);return new rr(r,"signInViaPopup",t,o).executeNotNull()}async function er(e,t,n){const o=Object(r.w)(e);S(o.auth,t,Ze);const c=Kn(o.auth,n);return new rr(o.auth,"reauthViaPopup",t,c,o).executeNotNull()}async function nr(e,t,n){const o=Object(r.w)(e);S(o.auth,t,Ze);const c=Kn(o.auth,n);return new rr(o.auth,"linkViaPopup",t,c,o).executeNotNull()}class rr extends Jn{constructor(e,filter,t,n,r){super(e,filter,n,r),this.provider=t,this.authWindow=null,this.pollId=null,rr.currentPopupAction&&rr.currentPopupAction.cancel(),rr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return O(e,this.auth,"internal-error"),e}async onExecution(){A(1===this.filter.length,"Popup operations only handle one event");const e=gn();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(E(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(E(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,rr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(E(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,Xn.get())};e()}}rr.currentPopupAction=null;const ir="pendingRedirect",sr=new Map;class or extends Jn{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=sr.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=lr(t),r=ur(e);if(!await r._isAvailable())return!1;const o="true"===await r._get(n);return await r._remove(n),o}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}sr.set(this.auth._key(),e)}return this.bypassAuthState||sr.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function ar(e,t){return ur(e)._set(lr(t),"true")}function cr(e,t){sr.set(e._key(),t)}function ur(e){return ue(e._redirectPersistence)}function lr(e){return de(ir,e.config.apiKey,e.name)}function dr(e,t,n){return async function(e,t,n){const r=Oe(e);S(e,t,Ze),await r._initializationPromise;const o=Kn(r,n);return await ar(o,r),o._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}function fr(e,t,n){return async function(e,t,n){const o=Object(r.w)(e);S(o.auth,t,Ze),await o.auth._initializationPromise;const c=Kn(o.auth,n);await ar(c,o.auth);const l=await _r(o);return c._openRedirect(o.auth,t,"reauthViaRedirect",l)}(e,t,n)}function pr(e,t,n){return async function(e,t,n){const o=Object(r.w)(e);S(o.auth,t,Ze),await o.auth._initializationPromise;const c=Kn(o.auth,n);await vt(!1,o,t.providerId),await ar(c,o.auth);const l=await _r(o);return c._openRedirect(o.auth,t,"linkViaRedirect",l)}(e,t,n)}async function gr(e,t){return await Oe(e)._initializationPromise,mr(e,t,!1)}async function mr(e,t,n=!1){const r=Oe(e),o=Kn(r,t),c=new or(r,o,n),l=await c.execute();return l&&!n&&(delete l.user._redirectEventId,await r._persistUserIfCurrent(l.user),await r._setRedirectUser(null,t)),l}async function _r(e){const t=gn(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class yr{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return wr(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!wr(e)){const code=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(E(this.auth,code))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(vr(e))}saveEventToCache(e){this.cachedEventUids.add(vr(e)),this.lastProcessedEventTime=Date.now()}}function vr(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function wr({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function Ir(e,t={}){return V(e,"GET","/v1/projects",t)}const Tr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Er=/^https?/;function Cr(e){const t=R(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const o=new URL(e);return""===o.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&o.hostname===r}if(!Er.test(n))return!1;if(Tr.test(e))return r===e;const o=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+o+"|"+o+")$","i").test(r)}const Sr=new P(3e4,6e4);function kr(){const e=_n().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let i=0;i<e.CP.length;i++)e.CP[i]=null}function Or(e){return new Promise(((t,n)=>{var r,o,c;function l(){kr(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{kr(),n(E(e,"network-request-failed"))},timeout:Sr.get()})}if(null===(o=null===(r=_n().gapi)||void 0===r?void 0:r.iframes)||void 0===o?void 0:o.Iframe)t(gapi.iframes.getContext());else{if(!(null===(c=_n().gapi)||void 0===c?void 0:c.load)){const t=xe("iframefcb");return _n()[t]=()=>{gapi.load?l():n(E(e,"network-request-failed"))},Re(`${Ae.gapiScript}?onload=${t}`).catch((e=>n(e)))}l()}})).catch((e=>{throw Nr=null,e}))}let Nr=null;const Ar=new P(5e3,15e3),Rr="__/auth/iframe",xr="emulator/auth/iframe",Dr={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Pr=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Lr(e){const t=e.config;O(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?L(t,xr):`https://${e.config.authDomain}/${Rr}`,c={apiKey:t.apiKey,appName:e.name,v:o.SDK_VERSION},l=Pr.get(e.config.apiHost);l&&(c.eid=l);const h=e._getFrameworks();return h.length&&(c.fw=h.join(",")),`${n}?${Object(r.M)(c).slice(1)}`}async function Mr(e){const t=await function(e){return Nr=Nr||Or(e),Nr}(e),n=_n().gapi;return O(n,e,"internal-error"),t.open({where:document.body,url:Lr(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Dr,dontclear:!0},(iframe=>new Promise((async(t,n)=>{await iframe.restyle({setHideOnLeave:!1});const r=E(e,"network-request-failed"),o=_n().setTimeout((()=>{n(r)}),Ar.get());function c(){_n().clearTimeout(o),t(iframe)}iframe.ping(c).then(c,(()=>{n(r)}))}))))}const jr={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Fr{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Ur(e,t,n,o=500,c=600){const l=Math.max((window.screen.availHeight-c)/2,0).toString(),h=Math.max((window.screen.availWidth-o)/2,0).toString();let d="";const f=Object.assign(Object.assign({},jr),{width:o.toString(),height:c.toString(),top:l,left:h}),m=Object(r.x)().toLowerCase();n&&(d=_e(m)?"_blank":n),ge(m)&&(t=t||"http://localhost",f.scrollbars="yes");const _=Object.entries(f).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=Object(r.x)()){var t;return Ie(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(m)&&"_self"!==d)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",d),new Fr(null);const y=window.open(t||"",d,_);O(y,e,"popup-blocked");try{y.focus()}catch(e){}return new Fr(y)}const Vr="__/auth/handler",qr="emulator/auth/handler",Br=encodeURIComponent("fac");async function zr(e,t,n,c,l,h){O(e.config.authDomain,e,"auth-domain-config-required"),O(e.config.apiKey,e,"invalid-api-key");const d={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:c,v:o.SDK_VERSION,eventId:l};if(t instanceof Ze){t.setDefaultLanguage(e.languageCode),d.providerId=t.providerId||"",Object(r.B)(t.getCustomParameters())||(d.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(h||{}))d[e]=t}if(t instanceof et){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(d.scopes=e.join(","))}e.tenantId&&(d.tid=e.tenantId);const f=d;for(const e of Object.keys(f))void 0===f[e]&&delete f[e];const m=await e._getAppCheckToken(),_=m?`#${Br}=${encodeURIComponent(m)}`:"";return`${function({config:e}){if(!e.emulator)return`https://${e.authDomain}/${Vr}`;return L(e,qr)}(e)}?${Object(r.M)(f).slice(1)}${_}`}const Gr="webStorageSupport";const Wr=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=fn,this._completeRedirectFn=mr,this._overrideRedirectResult=cr}async _openPopup(e,t,n,r){var o;A(null===(o=this.eventManagers[e._key()])||void 0===o?void 0:o.manager,"_initialize() not called before _openPopup()");return Ur(e,await zr(e,t,n,R(),r),gn())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){_n().location.href=e}(await zr(e,t,n,R(),r)),new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(A(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const iframe=await Mr(e),t=new yr(e);return iframe.register("authEvent",(n=>{O(null==n?void 0:n.authEvent,e,"invalid-auth-event");return{status:t.onEvent(n.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:t},this.iframes[e._key()]=iframe,t}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Gr,{type:Gr},(n=>{var r;const o=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[Gr];void 0!==o&&t(!!o),T(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await Ir(e);for(const e of t)try{if(Cr(e))return}catch(e){}T(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Te()||me()||Ie()}};class Kr{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return N("unexpected MultiFactorSessionType")}}}class $r extends Kr{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new $r(e)}_finalizeEnroll(e,t,n){return function(e,t){return V(e,"POST","/v2/accounts/mfaEnrollment:finalize",U(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return V(e,"POST","/v2/accounts/mfaSignIn:finalize",U(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class Hr{constructor(){}static assertion(e){return $r._fromCredential(e)}}Hr.FACTOR_ID="phone";var Qr="@firebase/auth",Yr="1.6.1";class Jr{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){O(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}Object(r.v)("authIdTokenMaxAge");var Xr;function Zr(){return window}Ae={loadJS:e=>new Promise(((t,n)=>{const r=document.createElement("script");var o,c;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=E("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(c=null===(o=document.getElementsByTagName("head"))||void 0===o?void 0:o[0])&&void 0!==c?c:document).appendChild(r)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Xr="Browser",Object(o._registerComponent)(new h.a("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:c,authDomain:l}=n.options;O(c&&!c.includes(":"),"invalid-api-key",{appName:n.name});const h={apiKey:c,authDomain:l,clientPlatform:Xr,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ee(Xr)},d=new ke(n,r,o,h);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(ue);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(d,t),d}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),Object(o._registerComponent)(new h.a("auth-internal",(e=>(e=>new Jr(e))(Oe(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),Object(o.registerVersion)(Qr,Yr,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Xr)),Object(o.registerVersion)(Qr,Yr,"esm2017");async function ei(e,t,n){var r;const{BuildInfo:o}=Zr();A(t.sessionId,"AuthEvent did not contain a session ID");const c=await async function(e){const t=function(e){if(A(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),view=new Uint8Array(t);for(let i=0;i<e.length;i++)view[i]=e.charCodeAt(i);return view}(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(t.sessionId),l={};return Ie()?l.ibi=o.packageName:ve()?l.apn=o.packageName:T(e,"operation-not-supported-in-this-environment"),o.displayName&&(l.appDisplayName=o.displayName),l.sessionId=c,zr(e,n,t.type,void 0,null!==(r=t.eventId)&&void 0!==r?r:void 0,l)}function ti(e){const{cordova:t}=Zr();return new Promise((n=>{t.plugins.browsertab.isAvailable((o=>{let c=null;o?t.plugins.browsertab.openUrl(e):c=t.InAppBrowser.open(e,function(e=Object(r.x)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}()?"_blank":"_system","location=yes"),n(c)}))}))}const ni=20;class ri extends yr{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise((e=>{this.resolveInialized=e}))}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach((t=>t(e))),super.onEvent(e)}async initialized(){await this.initPromise}}async function ii(e){const t=await ai()._get(ci(e));return t&&await ai()._remove(ci(e)),t}function si(e,t){var n,r;const o=function(e){const t=ui(e),link=t.link?decodeURIComponent(t.link):void 0,n=ui(link).link,r=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return ui(r).link||r||n||link||e}(t);if(o.includes("/__/auth/callback")){const t=ui(o),c=t.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(t.firebaseError)):null,code=null===(r=null===(n=null==c?void 0:c.code)||void 0===n?void 0:n.split("auth/"))||void 0===r?void 0:r[1],l=code?E(code):null;return l?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:l,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:o,postBody:null}}return null}function oi(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let i=0;i<ni;i++){const n=Math.floor(62*Math.random());e.push(t.charAt(n))}return e.join("")}function ai(){return ue(hn)}function ci(e){return de("authEvent",e.config.apiKey,e.name)}function ui(e){if(!(null==e?void 0:e.includes("?")))return{};const[t,...n]=e.split("?");return Object(r.N)(n.join("?"))}const hi=class{constructor(){this._redirectPersistence=fn,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=mr,this._overrideRedirectResult=cr}async _initialize(e){const t=e._key();let n=this.eventManagers.get(t);return n||(n=new ri(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){T(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){!function(e){var t,n,r,o,c,l,h,d,f,m;const _=Zr();O("function"==typeof(null===(t=null==_?void 0:_.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),O(void 0!==(null===(n=null==_?void 0:_.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),O("function"==typeof(null===(c=null===(o=null===(r=null==_?void 0:_.cordova)||void 0===r?void 0:r.plugins)||void 0===o?void 0:o.browsertab)||void 0===c?void 0:c.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),O("function"==typeof(null===(d=null===(h=null===(l=null==_?void 0:_.cordova)||void 0===l?void 0:l.plugins)||void 0===h?void 0:h.browsertab)||void 0===d?void 0:d.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),O("function"==typeof(null===(m=null===(f=null==_?void 0:_.cordova)||void 0===f?void 0:f.InAppBrowser)||void 0===m?void 0:m.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);const o=await this._initialize(e);await o.initialized(),o.resetRedirect(),sr.clear(),await this._originValidation(e);const c=function(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:oi(),postBody:null,tenantId:e.tenantId,error:E(e,"no-auth-event")}}(e,n,r);await function(e,t){return ai()._set(ci(e),t)}(e,c);const l=await ei(e,c,t);return async function(e,t,n){const{cordova:r}=Zr();let o=()=>{};try{await new Promise(((c,l)=>{let h=null;function d(){var e;c();const t=null===(e=r.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==n?void 0:n.close)&&n.close()}function f(){h||(h=window.setTimeout((()=>{l(E(e,"redirect-cancelled-by-user"))}),2e3))}function m(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&f()}t.addPassiveListener(d),document.addEventListener("resume",f,!1),ve()&&document.addEventListener("visibilitychange",m,!1),o=()=>{t.removePassiveListener(d),document.removeEventListener("resume",f,!1),document.removeEventListener("visibilitychange",m,!1),h&&window.clearTimeout(h)}}))}finally{o()}}(e,o,await ti(l))}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){const{BuildInfo:t}=Zr(),n={};Ie()?n.iosBundleId=t.packageName:ve()?n.androidPackageName=t.packageName:T(e,"operation-not-supported-in-this-environment"),await Ir(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:n,handleOpenURL:r,BuildInfo:o}=Zr(),c=setTimeout((async()=>{await ii(e),t.onEvent(di())}),500),l=async n=>{clearTimeout(c);const r=await ii(e);let o=null;r&&(null==n?void 0:n.url)&&(o=si(r,n.url)),t.onEvent(o||di())};void 0!==n&&"function"==typeof n.subscribe&&n.subscribe(null,l);const h=r,d=`${o.packageName.toLowerCase()}://`;Zr().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(d)&&l({url:e}),"function"==typeof h)try{h(e)}catch(e){console.error(e)}}}};function di(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:E("no-auth-event")}}function fi(e,t){Oe(e)._logFramework(t)}}}]);