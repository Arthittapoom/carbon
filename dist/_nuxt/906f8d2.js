/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{310:function(e,t,n){"use strict";(function(e,r){n.d(t,"a",(function(){return O})),n.d(t,"b",(function(){return z})),n.d(t,"c",(function(){return B})),n.d(t,"d",(function(){return ie})),n.d(t,"e",(function(){return c})),n.d(t,"f",(function(){return l})),n.d(t,"g",(function(){return d})),n.d(t,"h",(function(){return w})),n.d(t,"i",(function(){return m})),n.d(t,"j",(function(){return y})),n.d(t,"k",(function(){return Y})),n.d(t,"l",(function(){return A})),n.d(t,"m",(function(){return se})),n.d(t,"n",(function(){return _})),n.d(t,"o",(function(){return Z})),n.d(t,"p",(function(){return v})),n.d(t,"q",(function(){return le})),n.d(t,"r",(function(){return re})),n.d(t,"s",(function(){return S})),n.d(t,"t",(function(){return E})),n.d(t,"u",(function(){return C})),n.d(t,"v",(function(){return k})),n.d(t,"w",(function(){return pe})),n.d(t,"x",(function(){return x})),n.d(t,"y",(function(){return Q})),n.d(t,"z",(function(){return P})),n.d(t,"A",(function(){return D})),n.d(t,"B",(function(){return X})),n.d(t,"C",(function(){return M})),n.d(t,"D",(function(){return U})),n.d(t,"E",(function(){return N})),n.d(t,"F",(function(){return R})),n.d(t,"G",(function(){return j})),n.d(t,"H",(function(){return L})),n.d(t,"I",(function(){return F})),n.d(t,"J",(function(){return $})),n.d(t,"K",(function(){return K})),n.d(t,"L",(function(){return map})),n.d(t,"M",(function(){return te})),n.d(t,"N",(function(){return ne})),n.d(t,"O",(function(){return J})),n.d(t,"P",(function(){return fe})),n.d(t,"Q",(function(){return de})),n.d(t,"R",(function(){return G})),n.d(t,"S",(function(){return ce})),n.d(t,"T",(function(){return ue})),n.d(t,"U",(function(){return he})),n.d(t,"V",(function(){return V}));const o={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},c=function(e,t){if(!e)throw l(t)},l=function(e){return new Error("Firebase Database ("+o.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},h=function(e){const t=[];let p=0;for(let i=0;i<e.length;i++){let n=e.charCodeAt(i);n<128?t[p++]=n:n<2048?(t[p++]=n>>6|192,t[p++]=63&n|128):55296==(64512&n)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(n=65536+((1023&n)<<10)+(1023&e.charCodeAt(++i)),t[p++]=n>>18|240,t[p++]=n>>12&63|128,t[p++]=n>>6&63|128,t[p++]=63&n|128):(t[p++]=n>>12|224,t[p++]=n>>6&63|128,t[p++]=63&n|128)}return t},d={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(input,e){if(!Array.isArray(input))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,output=[];for(let i=0;i<input.length;i+=3){const e=input[i],n=i+1<input.length,r=n?input[i+1]:0,o=i+2<input.length,c=o?input[i+2]:0,l=e>>2,h=(3&e)<<4|r>>4;let d=(15&r)<<2|c>>6,f=63&c;o||(f=64,n||(d=64)),output.push(t[l],t[h],t[d],t[f])}return output.join("")},encodeString(input,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(input):this.encodeByteArray(h(input),e)},decodeString(input,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(input):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const o=e[n++];if(o<128)t[r++]=String.fromCharCode(o);else if(o>191&&o<224){const c=e[n++];t[r++]=String.fromCharCode((31&o)<<6|63&c)}else if(o>239&&o<365){const u=((7&o)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(u>>10)),t[r++]=String.fromCharCode(56320+(1023&u))}else{const c=e[n++],l=e[n++];t[r++]=String.fromCharCode((15&o)<<12|(63&c)<<6|63&l)}}return t.join("")}(this.decodeStringToByteArray(input,e))},decodeStringToByteArray(input,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,output=[];for(let i=0;i<input.length;){const e=t[input.charAt(i++)],n=i<input.length?t[input.charAt(i)]:0;++i;const r=i<input.length?t[input.charAt(i)]:64;++i;const o=i<input.length?t[input.charAt(i)]:64;if(++i,null==e||null==n||null==r||null==o)throw new f;const c=e<<2|n>>4;if(output.push(c),64!==r){const e=n<<4&240|r>>2;if(output.push(e),64!==o){const e=r<<6&192|o;output.push(e)}}}return output},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}};class f extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const m=function(e){const t=h(e);return d.encodeByteArray(t,!0)},y=function(e){return m(e).replace(/\./g,"")},w=function(e){try{return d.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function _(e){return v(void 0,e)}function v(e,source){if(!(source instanceof Object))return source;switch(source.constructor){case Date:return new Date(source.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return source}for(const t in source)source.hasOwnProperty(t)&&"__proto__"!==t&&(e[t]=v(e[t],source[t]));return e}const I=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e)return e;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,T=()=>{try{return I()||(()=>{if(void 0===r||void 0===r.env)return;const e=r.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&w(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},E=e=>{var t,n;return null===(n=null===(t=T())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},C=e=>{const t=E(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},S=()=>{var e;return null===(e=T())||void 0===e?void 0:e.config},k=e=>{var t;return null===(t=T())||void 0===t?void 0:t[`_${e}`]};class O{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function A(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,sub=e.sub||e.user_id;if(!sub)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:sub,user_id:sub,firebase:{sign_in_provider:"custom",identities:{}}},e);return[y(JSON.stringify({alg:"none",type:"JWT"})),y(JSON.stringify(o)),""].join(".")}function x(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function N(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(x())}function R(){var t;const n=null===(t=T())||void 0===t?void 0:t.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(e){return!1}}function P(){return"object"==typeof self&&self.self===self}function D(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function L(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function M(){const e=x();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function j(){return!0===o.NODE_CLIENT||!0===o.NODE_ADMIN}function F(){return!R()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function U(){try{return"object"==typeof indexedDB}catch(e){return!1}}function V(){return new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",o=self.indexedDB.open(r);o.onsuccess=()=>{o.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},o.onupgradeneeded=()=>{n=!1},o.onerror=()=>{var e;t((null===(e=o.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}class B extends Error{constructor(code,e,t){super(e),this.code=code,this.customData=t,this.name="FirebaseError",Object.setPrototypeOf(this,B.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,z.prototype.create)}}class z{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(code,...data){const e=data[0]||{},t=`${this.service}/${code}`,template=this.errors[code],n=template?function(template,data){return template.replace(W,((e,t)=>{const n=data[t];return null!=n?String(n):`<${t}?>`}))}(template,e):"Error",r=`${this.serviceName}: ${n} (${t}).`;return new B(t,r,e)}}const W=/\{\$([^}]+)}/g;function K(e){return JSON.parse(e)}function G(data){return JSON.stringify(data)}const H=function(e){let header={},t={},data={},n="";try{const r=e.split(".");header=K(w(r[0])||""),t=K(w(r[1])||""),n=r[2],data=t.d||{},delete t.d}catch(e){}return{header:header,claims:t,data:data,signature:n}},$=function(e){const t=H(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},Q=function(e){const t=H(e).claims;return"object"==typeof t&&!0===t.admin};function Y(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function J(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function X(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function map(e,t,n){const r={};for(const o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=t.call(n,e[o],o,e));return r}function Z(a,b){if(a===b)return!0;const e=Object.keys(a),t=Object.keys(b);for(const n of e){if(!t.includes(n))return!1;const e=a[n],r=b[n];if(ee(e)&&ee(r)){if(!Z(e,r))return!1}else if(e!==r)return!1}for(const n of t)if(!e.includes(n))return!1;return!0}function ee(e){return null!==e&&"object"==typeof e}function te(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function ne(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function re(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class ie{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let i=1;i<this.blockSize;++i)this.pad_[i]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let i=0;i<16;i++)n[i]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let i=0;i<16;i++)n[i]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let i=16;i<80;i++){const e=n[i-3]^n[i-8]^n[i-14]^n[i-16];n[i]=4294967295&(e<<1|e>>>31)}let r,o,a=this.chain_[0],b=this.chain_[1],c=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(let i=0;i<80;i++){i<40?i<20?(r=l^b&(c^l),o=1518500249):(r=b^c^l,o=1859775393):i<60?(r=b&c|l&(b|c),o=2400959708):(r=b^c^l,o=3395469782);const e=(a<<5|a>>>27)+r+h+o+n[i]&4294967295;h=l,l=c,c=4294967295&(b<<30|b>>>2),b=a,a=e}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+b&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let r=0;const o=this.buf_;let c=this.inbuf_;for(;r<t;){if(0===c)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(o[c]=e.charCodeAt(r),++c,++r,c===this.blockSize){this.compress_(o),c=0;break}}else for(;r<t;)if(o[c]=e[r],++c,++r,c===this.blockSize){this.compress_(o),c=0;break}}this.inbuf_=c,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let i=0;i<5;i++)for(let t=24;t>=0;t-=8)e[n]=this.chain_[i]>>t&255,++n;return e}}function se(e,t){const n=new oe(e,t);return n.subscribe.bind(n)}class oe{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=ae),void 0===r.error&&(r.error=ae),void 0===r.complete&&(r.complete=ae);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),o}unsubscribeOne(i){void 0!==this.observers&&void 0!==this.observers[i]&&(delete this.observers[i],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,e)}sendOne(i,e){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[i])try{e(this.observers[i])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function ae(){}const ce=function(e,t,n,r){let o;if(r<t?o="at least "+t:r>n&&(o=0===n?"none":"no more than "+n),o){throw new Error(e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+o+".")}};function le(e,t){return`${e} failed: ${t} argument `}function ue(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(le(e,t)+"must be a valid function.")}function he(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(le(e,t)+"must be a valid context object.")}const de=function(e){const t=[];let p=0;for(let i=0;i<e.length;i++){let n=e.charCodeAt(i);if(n>=55296&&n<=56319){const t=n-55296;i++,c(i<e.length,"Surrogate pair missing trail surrogate.");n=65536+(t<<10)+(e.charCodeAt(i)-56320)}n<128?t[p++]=n:n<2048?(t[p++]=n>>6|192,t[p++]=63&n|128):n<65536?(t[p++]=n>>12|224,t[p++]=n>>6&63|128,t[p++]=63&n|128):(t[p++]=n>>18|240,t[p++]=n>>12&63|128,t[p++]=n>>6&63|128,t[p++]=63&n|128)}return t},fe=function(e){let p=0;for(let i=0;i<e.length;i++){const t=e.charCodeAt(i);t<128?p++:t<2048?p+=2:t>=55296&&t<=56319?(p+=4,i++):p+=3}return p};function pe(e){return e&&e._delegate?e._delegate:e}}).call(this,n(58),n(166))},311:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return h})),n.d(t,"c",(function(){return l}));var r=n(310);class o{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const c="[DEFAULT]";class l{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new r.a;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(component){if(component.name!==this.name)throw Error(`Mismatching Component ${component.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=component,this.shouldAutoInitialize()){if(function(component){return"EAGER"===component.instantiationMode}(component))try{this.getOrInitializeService({instanceIdentifier:c})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=c){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=c){return this.instances.has(e)}getOptions(e=c){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(e)&&t.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),o=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;o.add(e),this.onInitCallbacks.set(r,o);const c=this.instances.get(r);return c&&e(c,r),()=>{o.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===c?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=c){return this.component?this.component.multipleInstances?e:c:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class h{constructor(e){this.name=e,this.providers=new Map}addComponent(component){const e=this.getProvider(component.name);if(e.isComponentSet())throw new Error(`Component ${component.name} has already been registered with ${this.name}`);e.setComponent(component)}addOrOverwriteComponent(component){this.getProvider(component.name).isComponentSet()&&this.providers.delete(component.name),this.addComponent(component)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new l(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},313:function(e,t,n){"use strict";n.d(t,"a",(function(){return w}));var r=n(310),o=n(311),c=n(315),l=n(314);class h{constructor(e,t){this._delegate=e,this.firebase=t,Object(c._addComponent)(e,new o.a("app-compat",(()=>this),"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((e=>{this._delegate.checkDestroyed(),e()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),Object(c.deleteApp)(this._delegate))))}_getService(e,t=c._DEFAULT_ENTRY_NAME){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=c._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(component){Object(c._addComponent)(this._delegate,component)}_addOrOverwriteComponent(component){Object(c._addOrOverwriteComponent)(this._delegate,component)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const d={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."},f=new r.b("app-compat","Firebase",d);const m=function e(){const t=function(e){const t={},n={__esModule:!0,initializeApp:function(o,l={}){const h=c.initializeApp(o,l);if(Object(r.k)(t,h.name))return t[h.name];const d=new e(h,n);return t[h.name]=d,d},app:o,registerVersion:c.registerVersion,setLogLevel:c.setLogLevel,onLog:c.onLog,apps:null,SDK_VERSION:c.SDK_VERSION,INTERNAL:{registerComponent:function(component){const t=component.name,l=t.replace("-compat","");if(c._registerComponent(component)&&"PUBLIC"===component.type){const c=(e=o())=>{if("function"!=typeof e[l])throw f.create("invalid-app-argument",{appName:t});return e[l]()};void 0!==component.serviceProps&&Object(r.p)(c,component.serviceProps),n[l]=c,e.prototype[l]=function(...e){return this._getService.bind(this,t).apply(this,component.multipleInstances?e:[])}}return"PUBLIC"===component.type?n[l]:null},removeApp:function(e){delete t[e]},useAsService:function(e,t){if("serverAuth"===t)return null;return t},modularAPIs:c}};function o(e){if(e=e||c._DEFAULT_ENTRY_NAME,!Object(r.k)(t,e))throw f.create("no-app",{appName:e});return t[e]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(t).map((e=>t[e]))}}),o.App=e,n}(h);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){Object(r.p)(t,e)},createSubscribe:r.m,ErrorFactory:r.b,deepExtend:r.p}),t}(),y=new l.b("@firebase/app-compat");if(Object(r.z)()&&void 0!==self.firebase){y.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&y.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const w=m;var _;Object(c.registerVersion)("@firebase/app-compat","0.2.28",_)},314:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return f})),n.d(t,"c",(function(){return m})),n.d(t,"d",(function(){return y}));const r=[];var o;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(o||(o={}));const c={debug:o.DEBUG,verbose:o.VERBOSE,info:o.INFO,warn:o.WARN,error:o.ERROR,silent:o.SILENT},l=o.INFO,h={[o.DEBUG]:"log",[o.VERBOSE]:"log",[o.INFO]:"info",[o.WARN]:"warn",[o.ERROR]:"error"},d=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),o=h[t];if(!o)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[o](`[${r}]  ${e.name}:`,...n)};class f{constructor(e){this.name=e,this._logLevel=l,this._logHandler=d,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in o))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?c[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,o.DEBUG,...e),this._logHandler(this,o.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,o.VERBOSE,...e),this._logHandler(this,o.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,o.INFO,...e),this._logHandler(this,o.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,o.WARN,...e),this._logHandler(this,o.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,o.ERROR,...e),this._logHandler(this,o.ERROR,...e)}}function m(e){r.forEach((t=>{t.setLogLevel(e)}))}function y(e,t){for(const n of r){let r=null;t&&t.level&&(r=c[t.level]),n.userLogHandler=null===e?null:(t,n,...c)=>{const l=c.map((e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}})).filter((e=>e)).join(" ");n>=(null!=r?r:t.logLevel)&&e({level:o[n].toLowerCase(),message:l,args:c,type:t.name})}}}},315:function(e,t,n){"use strict";n.r(t),n.d(t,"FirebaseError",(function(){return c.c})),n.d(t,"SDK_VERSION",(function(){return $})),n.d(t,"_DEFAULT_ENTRY_NAME",(function(){return D})),n.d(t,"_addComponent",(function(){return F})),n.d(t,"_addOrOverwriteComponent",(function(){return U})),n.d(t,"_apps",(function(){return M})),n.d(t,"_clearComponents",(function(){return W})),n.d(t,"_components",(function(){return j})),n.d(t,"_getProvider",(function(){return B})),n.d(t,"_registerComponent",(function(){return V})),n.d(t,"_removeServiceInstance",(function(){return z})),n.d(t,"deleteApp",(function(){return X})),n.d(t,"getApp",(function(){return Y})),n.d(t,"getApps",(function(){return J})),n.d(t,"initializeApp",(function(){return Q})),n.d(t,"onLog",(function(){return ee})),n.d(t,"registerVersion",(function(){return Z})),n.d(t,"setLogLevel",(function(){return te}));var r=n(311),o=n(314),c=n(310);const l=(object,e)=>e.some((e=>object instanceof e));let h,d;const f=new WeakMap,m=new WeakMap,y=new WeakMap,w=new WeakMap,_=new WeakMap;let v={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return m.get(e);if("objectStoreNames"===t)return e.objectStoreNames||y.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return E(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function I(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(d||(d=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(C(this),t),E(f.get(this))}:function(...t){return E(e.apply(C(this),t))}:function(t,...n){const r=e.call(C(this),t,...n);return y.set(r,t.sort?t.sort():[t]),E(r)}}function T(e){return"function"==typeof e?I(e):(e instanceof IDBTransaction&&function(e){if(m.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",c),e.removeEventListener("abort",c)},o=()=>{t(),r()},c=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",o),e.addEventListener("error",c),e.addEventListener("abort",c)}));m.set(e,t)}(e),l(e,h||(h=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,v):e)}function E(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",c)},o=()=>{t(E(e.result)),r()},c=()=>{n(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",c)}));return t.then((t=>{t instanceof IDBCursor&&f.set(t,e)})).catch((()=>{})),_.set(t,e),t}(e);if(w.has(e))return w.get(e);const t=T(e);return t!==e&&(w.set(e,t),_.set(t,e)),t}const C=e=>_.get(e);const S=["get","getKey","getAll","getAllKeys","count"],k=["put","add","delete","clear"],O=new Map;function A(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(O.get(t))return O.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=k.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!o&&!S.includes(n))return;const c=async function(e,...t){const c=this.transaction(e,o?"readwrite":"readonly");let l=c.store;return r&&(l=l.index(t.shift())),(await Promise.all([l[n](...t),o&&c.done]))[0]};return O.set(t,c),c}v=(e=>({...e,get:(t,n,r)=>A(t,n)||e.get(t,n,r),has:(t,n)=>!!A(t,n)||e.has(t,n)}))(v);class x{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const component=e.getComponent();return"VERSION"===(null==component?void 0:component.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const N="@firebase/app",R="0.9.28",P=new o.b("@firebase/app"),D="[DEFAULT]",L={[N]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},M=new Map,j=new Map;function F(e,component){try{e.container.addComponent(component)}catch(t){P.debug(`Component ${component.name} failed to register with FirebaseApp ${e.name}`,t)}}function U(e,component){e.container.addOrOverwriteComponent(component)}function V(component){const e=component.name;if(j.has(e))return P.debug(`There were multiple attempts to register component ${e}.`),!1;j.set(e,component);for(const e of M.values())F(e,component);return!0}function B(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function z(e,t,n=D){B(e,t).clearInstance(n)}function W(){j.clear()}const K={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},G=new c.b("app","Firebase",K);class H{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.a("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw G.create("app-deleted",{appName:this._name})}}const $="10.8.1";function Q(e,t={}){let n=e;if("object"!=typeof t){t={name:t}}const o=Object.assign({name:D,automaticDataCollectionEnabled:!1},t),l=o.name;if("string"!=typeof l||!l)throw G.create("bad-app-name",{appName:String(l)});if(n||(n=Object(c.s)()),!n)throw G.create("no-options");const h=M.get(l);if(h){if(Object(c.o)(n,h.options)&&Object(c.o)(o,h.config))return h;throw G.create("duplicate-app",{appName:l})}const d=new r.b(l);for(const component of j.values())d.addComponent(component);const f=new H(n,o,d);return M.set(l,f),f}function Y(e=D){const t=M.get(e);if(!t&&e===D&&Object(c.s)())return Q();if(!t)throw G.create("no-app",{appName:e});return t}function J(){return Array.from(M.values())}async function X(e){const t=e.name;M.has(t)&&(M.delete(t),await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}function Z(e,t,n){var o;let c=null!==(o=L[e])&&void 0!==o?o:e;n&&(c+=`-${n}`);const l=c.match(/\s|\//),h=t.match(/\s|\//);if(l||h){const e=[`Unable to register library "${c}" with version "${t}":`];return l&&e.push(`library name "${c}" contains illegal characters (whitespace or "/")`),l&&h&&e.push("and"),h&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void P.warn(e.join(" "))}V(new r.a(`${c}-version`,(()=>({library:c,version:t})),"VERSION"))}function ee(e,t){if(null!==e&&"function"!=typeof e)throw G.create("invalid-log-argument");Object(o.d)(e,t)}function te(e){Object(o.c)(e)}const ne="firebase-heartbeat-database",re=1,ie="firebase-heartbeat-store";let se=null;function oe(){return se||(se=function(e,t,{blocked:n,upgrade:r,blocking:o,terminated:c}={}){const l=indexedDB.open(e,t),h=E(l);return r&&l.addEventListener("upgradeneeded",(e=>{r(E(l.result),e.oldVersion,e.newVersion,E(l.transaction),e)})),n&&l.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),h.then((e=>{c&&e.addEventListener("close",(()=>c())),o&&e.addEventListener("versionchange",(e=>o(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),h}(ne,re,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ie)}catch(e){console.warn(e)}}}).catch((e=>{throw G.create("idb-open",{originalErrorMessage:e.message})}))),se}async function ae(e,t){try{const n=(await oe()).transaction(ie,"readwrite"),r=n.objectStore(ie);await r.put(t,ce(e)),await n.done}catch(e){if(e instanceof c.c)P.warn(e.message);else{const t=G.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});P.warn(t.message)}}}function ce(e){return`${e.name}!${e.options.appId}`}class le{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new he(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=ue();if((null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((e=>e.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=ue(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){const n=[];let r=e.slice();for(const o of e){const e=n.find((e=>e.agent===o.agent));if(e){if(e.dates.push(o.date),de(n)>t){e.dates.pop();break}}else if(n.push({agent:o.agent,dates:[o.date]}),de(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),o=Object(c.j)(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}}function ue(){return(new Date).toISOString().substring(0,10)}class he{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Object(c.D)()&&Object(c.V)().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await oe()).transaction(ie),n=await t.objectStore(ie).get(ce(e));return await t.done,n}catch(e){if(e instanceof c.c)P.warn(e.message);else{const t=G.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});P.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return ae(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return ae(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function de(e){return Object(c.j)(JSON.stringify({version:2,heartbeats:e})).length}var fe;fe="",V(new r.a("platform-logger",(e=>new x(e)),"PRIVATE")),V(new r.a("heartbeat",(e=>new le(e)),"PRIVATE")),Z(N,R,fe),Z(N,R,"esm2017"),Z("fire-js","")},316:function(e,t,n){e.exports=function(){"use strict";function e(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,n=Array(a);t<a;t++)n[t]=e[t];return n}function t(e){if(Array.isArray(e))return e}function n(t){if(Array.isArray(t))return e(t)}function r(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t,n){return t=I(t),A(e,E()?Reflect.construct(t,n||[],I(e).constructor):t.apply(e,n))}function l(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function h(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function d(s,a){return s.get(r(s,a))}function f(e,t,a){l(e,t),t.set(e,a)}function m(s,a,e){return s.set(r(s,a),e),e}function y(e,t,n){if(E())return Reflect.construct.apply(null,arguments);var r=[null];return r.push.apply(r,t),new(e.bind.apply(e,r))}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,L(r.key),r)}}function _(e,t,n){return t&&w(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function v(){return v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var p=R(e,t);if(p){var r=Object.getOwnPropertyDescriptor(p,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},v.apply(null,arguments)}function I(e){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},I(e)}function T(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&x(e,t)}function E(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(E=function(){return!!e})()}function C(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function S(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,u,a=[],c=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t);else for(;!(c=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}function k(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function O(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function A(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return o(e)}function x(e,t){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},x(e,t)}function N(e,n){return t(e)||S(e,n)||j(e,n)||k()}function R(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=I(e)););return e}function P(e){return n(e)||C(e)||j(e)||O()}function D(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function L(e){var i=D(e,"string");return"symbol"==typeof i?i:i+""}function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}function j(t,a){if(t){if("string"==typeof t)return e(t,a);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,a):void 0}}var F=100,U={},V=function(){U.previousActiveElement instanceof HTMLElement?(U.previousActiveElement.focus(),U.previousActiveElement=null):document.body&&document.body.focus()},B=function(e){return new Promise((function(t){if(!e)return t();var n=window.scrollX,r=window.scrollY;U.restoreFocusTimeout=setTimeout((function(){V(),t()}),F),window.scrollTo(n,r)}))},z="swal2-",W=["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","default-outline","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error"].reduce((function(e,t){return e[t]=z+t,e}),{}),K=["success","warning","info","question","error"].reduce((function(e,t){return e[t]=z+t,e}),{}),G="SweetAlert2:",H=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},$=function(e){console.warn("".concat(G," ").concat("object"===M(e)?e.join(" "):e))},Q=function(e){console.error("".concat(G," ").concat(e))},Y=[],J=function(e){Y.includes(e)||(Y.push(e),$(e))},X=function(e,t){J('"'.concat(e,'" is deprecated and will be removed in the next major release. Please use "').concat(t,'" instead.'))},Z=function(e){return"function"==typeof e?e():e},ee=function(e){return e&&"function"==typeof e.toPromise},te=function(e){return ee(e)?e.toPromise():Promise.resolve(e)},ne=function(e){return e&&Promise.resolve(e)===e},re=function(){return document.body.querySelector(".".concat(W.container))},ie=function(e){var t=re();return t?t.querySelector(e):null},se=function(e){return ie(".".concat(e))},oe=function(){return se(W.popup)},ae=function(){return se(W.icon)},ce=function(){return se(W["icon-content"])},le=function(){return se(W.title)},ue=function(){return se(W["html-container"])},he=function(){return se(W.image)},de=function(){return se(W["progress-steps"])},fe=function(){return se(W["validation-message"])},pe=function(){return ie(".".concat(W.actions," .").concat(W.confirm))},me=function(){return ie(".".concat(W.actions," .").concat(W.cancel))},ge=function(){return ie(".".concat(W.actions," .").concat(W.deny))},ye=function(){return se(W["input-label"])},we=function(){return ie(".".concat(W.loader))},_e=function(){return se(W.actions)},ve=function(){return se(W.footer)},be=function(){return se(W["timer-progress-bar"])},Ie=function(){return se(W.close)},Te='\n  a[href],\n  area[href],\n  input:not([disabled]),\n  select:not([disabled]),\n  textarea:not([disabled]),\n  button:not([disabled]),\n  iframe,\n  object,\n  embed,\n  [tabindex="0"],\n  [contenteditable],\n  audio[controls],\n  video[controls],\n  summary\n',Ee=function(){var e=oe();if(!e)return[];var t=e.querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])'),n=Array.from(t).sort((function(a,b){var e=parseInt(a.getAttribute("tabindex")||"0"),t=parseInt(b.getAttribute("tabindex")||"0");return e>t?1:e<t?-1:0})),r=e.querySelectorAll(Te),o=Array.from(r).filter((function(e){return"-1"!==e.getAttribute("tabindex")}));return P(new Set(n.concat(o))).filter((function(e){return We(e)}))},Ce=function(){return Ae(document.body,W.shown)&&!Ae(document.body,W["toast-shown"])&&!Ae(document.body,W["no-backdrop"])},Se=function(){var e=oe();return!!e&&Ae(e,W.toast)},ke=function(){var e=oe();return!!e&&e.hasAttribute("data-loading")},Oe=function(e,html){if(e.textContent="",html){var t=(new DOMParser).parseFromString(html,"text/html"),head=t.querySelector("head");head&&Array.from(head.childNodes).forEach((function(t){e.appendChild(t)}));var body=t.querySelector("body");body&&Array.from(body.childNodes).forEach((function(t){t instanceof HTMLVideoElement||t instanceof HTMLAudioElement?e.appendChild(t.cloneNode(!0)):e.appendChild(t)}))}},Ae=function(e,t){if(!t)return!1;for(var n=t.split(/\s+/),i=0;i<n.length;i++)if(!e.classList.contains(n[i]))return!1;return!0},xe=function(e,t){Array.from(e.classList).forEach((function(n){Object.values(W).includes(n)||Object.values(K).includes(n)||Object.values(t.showClass||{}).includes(n)||e.classList.remove(n)}))},Ne=function(e,t,n){if(xe(e,t),t.customClass&&t.customClass[n]){if("string"!=typeof t.customClass[n]&&!t.customClass[n].forEach)return void $("Invalid type of customClass.".concat(n,'! Expected string or iterable object, got "').concat(M(t.customClass[n]),'"'));Le(e,t.customClass[n])}},Re=function(e,t){if(!t)return null;switch(t){case"select":case"textarea":case"file":return e.querySelector(".".concat(W.popup," > .").concat(W[t]));case"checkbox":return e.querySelector(".".concat(W.popup," > .").concat(W.checkbox," input"));case"radio":return e.querySelector(".".concat(W.popup," > .").concat(W.radio," input:checked"))||e.querySelector(".".concat(W.popup," > .").concat(W.radio," input:first-child"));case"range":return e.querySelector(".".concat(W.popup," > .").concat(W.range," input"));default:return e.querySelector(".".concat(W.popup," > .").concat(W.input))}},Pe=function(input){if(input.focus(),"file"!==input.type){var e=input.value;input.value="",input.value=e}},De=function(e,t,n){e&&t&&("string"==typeof t&&(t=t.split(/\s+/).filter(Boolean)),t.forEach((function(t){Array.isArray(e)?e.forEach((function(e){n?e.classList.add(t):e.classList.remove(t)})):n?e.classList.add(t):e.classList.remove(t)})))},Le=function(e,t){De(e,t,!0)},Me=function(e,t){De(e,t,!1)},je=function(e,t){for(var n=Array.from(e.children),i=0;i<n.length;i++){var r=n[i];if(r instanceof HTMLElement&&Ae(r,t))return r}},Fe=function(e,t,n){n==="".concat(parseInt(n))&&(n=parseInt(n)),n||0===parseInt(n)?e.style.setProperty(t,"number"==typeof n?"".concat(n,"px"):n):e.style.removeProperty(t)},Ue=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flex";e&&(e.style.display=t)},Ve=function(e){e&&(e.style.display="none")},qe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"block";e&&new MutationObserver((function(){ze(e,e.innerHTML,t)})).observe(e,{childList:!0,subtree:!0})},Be=function(e,t,n,r){var o=e.querySelector(t);o&&o.style.setProperty(n,r)},ze=function(e,t){t?Ue(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"flex"):Ve(e)},We=function(e){return!(!e||!(e.offsetWidth||e.offsetHeight||e.getClientRects().length))},Ke=function(){return!We(pe())&&!We(ge())&&!We(me())},Ge=function(e){return!!(e.scrollHeight>e.clientHeight)},He=function(e){var style=window.getComputedStyle(e),t=parseFloat(style.getPropertyValue("animation-duration")||"0"),n=parseFloat(style.getPropertyValue("transition-duration")||"0");return t>0||n>0},$e=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=be();n&&We(n)&&(t&&(n.style.transition="none",n.style.width="100%"),setTimeout((function(){n.style.transition="width ".concat(e/1e3,"s linear"),n.style.width="0%"}),10))},Qe=function(){var e=be();if(e){var t=parseInt(window.getComputedStyle(e).width);e.style.removeProperty("transition"),e.style.width="100%";var n=t/parseInt(window.getComputedStyle(e).width)*100;e.style.width="".concat(n,"%")}},Ye=function(){return"undefined"==typeof window||"undefined"==typeof document},Je='\n <div aria-labelledby="'.concat(W.title,'" aria-describedby="').concat(W["html-container"],'" class="').concat(W.popup,'" tabindex="-1">\n   <button type="button" class="').concat(W.close,'"></button>\n   <ul class="').concat(W["progress-steps"],'"></ul>\n   <div class="').concat(W.icon,'"></div>\n   <img class="').concat(W.image,'" />\n   <h2 class="').concat(W.title,'" id="').concat(W.title,'"></h2>\n   <div class="').concat(W["html-container"],'" id="').concat(W["html-container"],'"></div>\n   <input class="').concat(W.input,'" id="').concat(W.input,'" />\n   <input type="file" class="').concat(W.file,'" />\n   <div class="').concat(W.range,'">\n     <input type="range" />\n     <output></output>\n   </div>\n   <select class="').concat(W.select,'" id="').concat(W.select,'"></select>\n   <div class="').concat(W.radio,'"></div>\n   <label class="').concat(W.checkbox,'">\n     <input type="checkbox" id="').concat(W.checkbox,'" />\n     <span class="').concat(W.label,'"></span>\n   </label>\n   <textarea class="').concat(W.textarea,'" id="').concat(W.textarea,'"></textarea>\n   <div class="').concat(W["validation-message"],'" id="').concat(W["validation-message"],'"></div>\n   <div class="').concat(W.actions,'">\n     <div class="').concat(W.loader,'"></div>\n     <button type="button" class="').concat(W.confirm,'"></button>\n     <button type="button" class="').concat(W.deny,'"></button>\n     <button type="button" class="').concat(W.cancel,'"></button>\n   </div>\n   <div class="').concat(W.footer,'"></div>\n   <div class="').concat(W["timer-progress-bar-container"],'">\n     <div class="').concat(W["timer-progress-bar"],'"></div>\n   </div>\n </div>\n').replace(/(^|\n)\s*/g,""),Xe=function(){var e=re();return!!e&&(e.remove(),Me([document.documentElement,document.body],[W["no-backdrop"],W["toast-shown"],W["has-column"]]),!0)},Ze=function(){U.currentInstance.resetValidationMessage()},et=function(){var e=oe(),input=je(e,W.input),t=je(e,W.file),n=e.querySelector(".".concat(W.range," input")),r=e.querySelector(".".concat(W.range," output")),select=je(e,W.select),o=e.querySelector(".".concat(W.checkbox," input")),textarea=je(e,W.textarea);input.oninput=Ze,t.onchange=Ze,select.onchange=Ze,o.onchange=Ze,textarea.oninput=Ze,n.oninput=function(){Ze(),r.value=n.value},n.onchange=function(){Ze(),r.value=n.value}},tt=function(e){return"string"==typeof e?document.querySelector(e):e},nt=function(e){var t=oe();t.setAttribute("role",e.toast?"alert":"dialog"),t.setAttribute("aria-live",e.toast?"polite":"assertive"),e.toast||t.setAttribute("aria-modal","true")},it=function(e){"rtl"===window.getComputedStyle(e).direction&&Le(re(),W.rtl)},st=function(e){var t=Xe();if(Ye())Q("SweetAlert2 requires document to initialize");else{var n=document.createElement("div");n.className=W.container,t&&Le(n,W["no-transition"]),Oe(n,Je);var r=tt(e.target);r.appendChild(n),nt(e),it(r),et()}},ot=function(param,e){param instanceof HTMLElement?e.appendChild(param):"object"===M(param)?at(param,e):param&&Oe(e,param)},at=function(param,e){param.jquery?ct(e,param):Oe(e,param.toString())},ct=function(e,t){if(e.textContent="",0 in t)for(var i=0;i in t;i++)e.appendChild(t[i].cloneNode(!0));else e.appendChild(t.cloneNode(!0))},lt=function(){if(Ye())return!1;var e=document.createElement("div");return void 0!==e.style.webkitAnimation?"webkitAnimationEnd":void 0!==e.style.animation&&"animationend"}(),ut=function(e,t){var n=_e(),r=we();n&&r&&(t.showConfirmButton||t.showDenyButton||t.showCancelButton?Ue(n):Ve(n),Ne(n,t,"actions"),ht(n,r,t),Oe(r,t.loaderHtml||""),Ne(r,t,"loader"))};function ht(e,t,n){var r=pe(),o=ge(),c=me();r&&o&&c&&(pt(r,"confirm",n),pt(o,"deny",n),pt(c,"cancel",n),ft(r,o,c,n),n.reverseButtons&&(n.toast?(e.insertBefore(c,r),e.insertBefore(o,r)):(e.insertBefore(c,t),e.insertBefore(o,t),e.insertBefore(r,t))))}function ft(e,t,n,r){r.buttonsStyling?(Le([e,t,n],W.styled),r.confirmButtonColor&&(e.style.backgroundColor=r.confirmButtonColor,Le(e,W["default-outline"])),r.denyButtonColor&&(t.style.backgroundColor=r.denyButtonColor,Le(t,W["default-outline"])),r.cancelButtonColor&&(n.style.backgroundColor=r.cancelButtonColor,Le(n,W["default-outline"]))):Me([e,t,n],W.styled)}function pt(button,e,t){var n=H(e);ze(button,t["show".concat(n,"Button")],"inline-block"),Oe(button,t["".concat(e,"ButtonText")]||""),button.setAttribute("aria-label",t["".concat(e,"ButtonAriaLabel")]||""),button.className=W[e],Ne(button,t,"".concat(e,"Button"))}var mt=function(e,t){var n=Ie();n&&(Oe(n,t.closeButtonHtml||""),Ne(n,t,"closeButton"),ze(n,t.showCloseButton),n.setAttribute("aria-label",t.closeButtonAriaLabel||""))},gt=function(e,t){var n=re();n&&(yt(n,t.backdrop),wt(n,t.position),_t(n,t.grow),Ne(n,t,"container"))};function yt(e,t){"string"==typeof t?e.style.background=t:t||Le([document.documentElement,document.body],W["no-backdrop"])}function wt(e,t){t&&(t in W?Le(e,W[t]):($('The "position" parameter is not valid, defaulting to "center"'),Le(e,W.center)))}function _t(e,t){t&&Le(e,W["grow-".concat(t)])}var vt={innerParams:new WeakMap,domCache:new WeakMap},bt=["input","file","range","select","radio","checkbox","textarea"],It=function(e,t){var n=oe();if(n){var r=vt.innerParams.get(e),o=!r||t.input!==r.input;bt.forEach((function(e){var r=je(n,W[e]);r&&(Ct(e,t.inputAttributes),r.className=W[e],o&&Ve(r))})),t.input&&(o&&Tt(t),St(t))}},Tt=function(e){if(e.input)if(Nt[e.input]){var t=At(e.input),input=Nt[e.input](t,e);Ue(t),e.inputAutoFocus&&setTimeout((function(){Pe(input)}))}else Q("Unexpected type of input! Expected ".concat(Object.keys(Nt).join(" | "),', got "').concat(e.input,'"'))},Et=function(input){for(var i=0;i<input.attributes.length;i++){var e=input.attributes[i].name;["id","type","value","style"].includes(e)||input.removeAttribute(e)}},Ct=function(e,t){var input=Re(oe(),e);if(input)for(var n in Et(input),t)input.setAttribute(n,t[n])},St=function(e){var t=At(e.input);"object"===M(e.customClass)&&Le(t,e.customClass.input)},kt=function(input,e){input.placeholder&&!e.inputPlaceholder||(input.placeholder=e.inputPlaceholder)},Ot=function(input,e,t){if(t.inputLabel){var label=document.createElement("label"),n=W["input-label"];label.setAttribute("for",input.id),label.className=n,"object"===M(t.customClass)&&Le(label,t.customClass.inputLabel),label.innerText=t.inputLabel,e.insertAdjacentElement("beforebegin",label)}},At=function(e){return je(oe(),W[e]||W.input)},xt=function(input,e){["string","number"].includes(M(e))?input.value="".concat(e):ne(e)||$('Unexpected type of inputValue! Expected "string", "number" or "Promise", got "'.concat(M(e),'"'))},Nt={};Nt.text=Nt.email=Nt.password=Nt.number=Nt.tel=Nt.url=Nt.search=Nt.date=Nt["datetime-local"]=Nt.time=Nt.week=Nt.month=function(input,e){return xt(input,e.inputValue),Ot(input,input,e),kt(input,e),input.type=e.input,input},Nt.file=function(input,e){return Ot(input,input,e),kt(input,e),input},Nt.range=function(e,t){var n=e.querySelector("input"),r=e.querySelector("output");return xt(n,t.inputValue),n.type=t.input,xt(r,t.inputValue),Ot(n,e,t),e},Nt.select=function(select,e){if(select.textContent="",e.inputPlaceholder){var t=document.createElement("option");Oe(t,e.inputPlaceholder),t.value="",t.disabled=!0,t.selected=!0,select.appendChild(t)}return Ot(select,select,e),select},Nt.radio=function(e){return e.textContent="",e},Nt.checkbox=function(e,t){var n=Re(oe(),"checkbox");n.value="1",n.checked=Boolean(t.inputValue);var label=e.querySelector("span");return Oe(label,t.inputPlaceholder),n},Nt.textarea=function(textarea,e){xt(textarea,e.inputValue),kt(textarea,e),Ot(textarea,textarea,e);var t=function(e){return parseInt(window.getComputedStyle(e).marginLeft)+parseInt(window.getComputedStyle(e).marginRight)};return setTimeout((function(){if("MutationObserver"in window){var n=parseInt(window.getComputedStyle(oe()).width);new MutationObserver((function(){if(document.body.contains(textarea)){var r=textarea.offsetWidth+t(textarea);r>n?oe().style.width="".concat(r,"px"):Fe(oe(),"width",e.width)}})).observe(textarea,{attributes:!0,attributeFilter:["style"]})}})),textarea};var Rt=function(e,t){var n=ue();n&&(qe(n),Ne(n,t,"htmlContainer"),t.html?(ot(t.html,n),Ue(n,"block")):t.text?(n.textContent=t.text,Ue(n,"block")):Ve(n),It(e,t))},Pt=function(e,t){var footer=ve();footer&&(qe(footer),ze(footer,t.footer,"block"),t.footer&&ot(t.footer,footer),Ne(footer,t,"footer"))},Dt=function(e,t){var n=vt.innerParams.get(e),r=ae();if(r){if(n&&t.icon===n.icon)return Ut(r,t),void Lt(r,t);if(t.icon||t.iconHtml){if(t.icon&&-1===Object.keys(K).indexOf(t.icon))return Q('Unknown icon! Expected "success", "error", "warning", "info" or "question", got "'.concat(t.icon,'"')),void Ve(r);Ue(r),Ut(r,t),Lt(r,t),Le(r,t.showClass&&t.showClass.icon)}else Ve(r)}},Lt=function(e,t){for(var n=0,r=Object.entries(K);n<r.length;n++){var o=N(r[n],2),c=o[0],l=o[1];t.icon!==c&&Me(e,l)}Le(e,t.icon&&K[t.icon]),Vt(e,t),Mt(),Ne(e,t,"icon")},Mt=function(){var e=oe();if(e)for(var t=window.getComputedStyle(e).getPropertyValue("background-color"),n=e.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix"),i=0;i<n.length;i++)n[i].style.backgroundColor=t},jt='\n  <div class="swal2-success-circular-line-left"></div>\n  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>\n  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>\n  <div class="swal2-success-circular-line-right"></div>\n',Ft='\n  <span class="swal2-x-mark">\n    <span class="swal2-x-mark-line-left"></span>\n    <span class="swal2-x-mark-line-right"></span>\n  </span>\n',Ut=function(e,t){if(t.icon||t.iconHtml){var n=e.innerHTML,r="";t.iconHtml?r=qt(t.iconHtml):"success"===t.icon?(r=jt,n=n.replace(/ style=".*?"/g,"")):"error"===t.icon?r=Ft:t.icon&&(r=qt({question:"?",warning:"!",info:"i"}[t.icon])),n.trim()!==r.trim()&&Oe(e,r)}},Vt=function(e,t){if(t.iconColor){e.style.color=t.iconColor,e.style.borderColor=t.iconColor;for(var n=0,r=[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"];n<r.length;n++){var o=r[n];Be(e,o,"background-color",t.iconColor)}Be(e,".swal2-success-ring","border-color",t.iconColor)}},qt=function(content){return'<div class="'.concat(W["icon-content"],'">').concat(content,"</div>")},Bt=function(e,t){var image=he();image&&(t.imageUrl?(Ue(image,""),image.setAttribute("src",t.imageUrl),image.setAttribute("alt",t.imageAlt||""),Fe(image,"width",t.imageWidth),Fe(image,"height",t.imageHeight),image.className=W.image,Ne(image,t,"image")):Ve(image))},zt=function(e,t){var n=re(),r=oe();if(n&&r){if(t.toast){Fe(n,"width",t.width),r.style.width="100%";var o=we();o&&r.insertBefore(o,ae())}else Fe(r,"width",t.width);Fe(r,"padding",t.padding),t.color&&(r.style.color=t.color),t.background&&(r.style.background=t.background),Ve(fe()),Wt(r,t)}},Wt=function(e,t){var n=t.showClass||{};e.className="".concat(W.popup," ").concat(We(e)?n.popup:""),t.toast?(Le([document.documentElement,document.body],W["toast-shown"]),Le(e,W.toast)):Le(e,W.modal),Ne(e,t,"popup"),"string"==typeof t.customClass&&Le(e,t.customClass),t.icon&&Le(e,W["icon-".concat(t.icon)])},Kt=function(e,t){var n=de();if(n){var r=t.progressSteps,o=t.currentProgressStep;r&&0!==r.length&&void 0!==o?(Ue(n),n.textContent="",o>=r.length&&$("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),r.forEach((function(e,c){var l=Gt(e);if(n.appendChild(l),c===o&&Le(l,W["active-progress-step"]),c!==r.length-1){var h=Ht(t);n.appendChild(h)}}))):Ve(n)}},Gt=function(e){var t=document.createElement("li");return Le(t,W["progress-step"]),Oe(t,e),t},Ht=function(e){var t=document.createElement("li");return Le(t,W["progress-step-line"]),e.progressStepsDistance&&Fe(t,"width",e.progressStepsDistance),t},$t=function(e,t){var title=le();title&&(qe(title),ze(title,t.title||t.titleText,"block"),t.title&&ot(t.title,title),t.titleText&&(title.innerText=t.titleText),Ne(title,t,"title"))},Qt=function(e,t){zt(e,t),gt(e,t),Kt(e,t),Dt(e,t),Bt(e,t),$t(e,t),mt(e,t),Rt(e,t),ut(e,t),Pt(e,t);var n=oe();"function"==typeof t.didRender&&n&&t.didRender(n)},Yt=function(){return We(oe())},Jt=function(){var e;return null===(e=pe())||void 0===e?void 0:e.click()},Xt=function(){var e;return null===(e=ge())||void 0===e?void 0:e.click()},Zt=function(){var e;return null===(e=me())||void 0===e?void 0:e.click()},en=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),tn=function(e){e.keydownTarget&&e.keydownHandlerAdded&&(e.keydownTarget.removeEventListener("keydown",e.keydownHandler,{capture:e.keydownListenerCapture}),e.keydownHandlerAdded=!1)},nn=function(e,t,n){tn(e),t.toast||(e.keydownHandler=function(e){return an(t,e,n)},e.keydownTarget=t.keydownListenerCapture?window:oe(),e.keydownListenerCapture=t.keydownListenerCapture,e.keydownTarget.addEventListener("keydown",e.keydownHandler,{capture:e.keydownListenerCapture}),e.keydownHandlerAdded=!0)},rn=function(e,t){var n,r=Ee();if(r.length)return(e+=t)===r.length?e=0:-1===e&&(e=r.length-1),void r[e].focus();null===(n=oe())||void 0===n||n.focus()},sn=["ArrowRight","ArrowDown"],on=["ArrowLeft","ArrowUp"],an=function(e,t,n){e&&(t.isComposing||229===t.keyCode||(e.stopKeydownPropagation&&t.stopPropagation(),"Enter"===t.key?cn(t,e):"Tab"===t.key?ln(t):[].concat(sn,on).includes(t.key)?un(t.key):"Escape"===t.key&&hn(t,e,n)))},cn=function(e,t){if(Z(t.allowEnterKey)){var input=Re(oe(),t.input);if(e.target&&input&&e.target instanceof HTMLElement&&e.target.outerHTML===input.outerHTML){if(["textarea","file"].includes(t.input))return;Jt(),e.preventDefault()}}},ln=function(e){for(var t=e.target,n=Ee(),r=-1,i=0;i<n.length;i++)if(t===n[i]){r=i;break}e.shiftKey?rn(r,-1):rn(r,1),e.stopPropagation(),e.preventDefault()},un=function(e){var t=_e(),n=pe(),r=ge(),o=me();if(t&&n&&r&&o){var c=[n,r,o];if(!(document.activeElement instanceof HTMLElement)||c.includes(document.activeElement)){var l=sn.includes(e)?"nextElementSibling":"previousElementSibling",h=document.activeElement;if(h){for(var i=0;i<t.children.length;i++){if(!(h=h[l]))return;if(h instanceof HTMLButtonElement&&We(h))break}h instanceof HTMLButtonElement&&h.focus()}}}},hn=function(e,t,n){Z(t.allowEscapeKey)&&(e.preventDefault(),n(en.esc))},dn={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap},fn=function(){var e=re();Array.from(document.body.children).forEach((function(t){t.contains(e)||(t.hasAttribute("aria-hidden")&&t.setAttribute("data-previous-aria-hidden",t.getAttribute("aria-hidden")||""),t.setAttribute("aria-hidden","true"))}))},pn=function(){Array.from(document.body.children).forEach((function(e){e.hasAttribute("data-previous-aria-hidden")?(e.setAttribute("aria-hidden",e.getAttribute("data-previous-aria-hidden")||""),e.removeAttribute("data-previous-aria-hidden")):e.removeAttribute("aria-hidden")}))},mn="undefined"!=typeof window&&!!window.GestureEvent,gn=function(){if(mn&&!Ae(document.body,W.iosfix)){var e=document.body.scrollTop;document.body.style.top="".concat(-1*e,"px"),Le(document.body,W.iosfix),yn()}},yn=function(){var e,t=re();t&&(t.ontouchstart=function(t){e=wn(t)},t.ontouchmove=function(t){e&&(t.preventDefault(),t.stopPropagation())})},wn=function(e){var t=e.target,n=re(),r=ue();return!(!n||!r||_n(e)||vn(e)||t!==n&&(Ge(n)||!(t instanceof HTMLElement)||"INPUT"===t.tagName||"TEXTAREA"===t.tagName||Ge(r)&&r.contains(t)))},_n=function(e){return e.touches&&e.touches.length&&"stylus"===e.touches[0].touchType},vn=function(e){return e.touches&&e.touches.length>1},bn=function(){if(Ae(document.body,W.iosfix)){var e=parseInt(document.body.style.top,10);Me(document.body,W.iosfix),document.body.style.top="",document.body.scrollTop=-1*e}},In=function(){var e=document.createElement("div");e.className=W["scrollbar-measure"],document.body.appendChild(e);var t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t},Tn=null,En=function(e){null===Tn&&(document.body.scrollHeight>window.innerHeight||"scroll"===e)&&(Tn=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight="".concat(Tn+In(),"px"))},Cn=function(){null!==Tn&&(document.body.style.paddingRight="".concat(Tn,"px"),Tn=null)};function Sn(e,t,n,r){Se()?Ln(e,r):(B(n).then((function(){return Ln(e,r)})),tn(U)),mn?(t.setAttribute("style","display:none !important"),t.removeAttribute("class"),t.innerHTML=""):t.remove(),Ce()&&(Cn(),bn(),pn()),kn()}function kn(){Me([document.documentElement,document.body],[W.shown,W["height-auto"],W["no-backdrop"],W["toast-shown"]])}function On(e){e=Rn(e);var t=dn.swalPromiseResolve.get(this),n=An(this);this.isAwaitingPromise?e.isDismissed||(Nn(this),t(e)):n&&t(e)}var An=function(e){var t=oe();if(!t)return!1;var n=vt.innerParams.get(e);if(!n||Ae(t,n.hideClass.popup))return!1;Me(t,n.showClass.popup),Le(t,n.hideClass.popup);var r=re();return Me(r,n.showClass.backdrop),Le(r,n.hideClass.backdrop),Pn(e,t,n),!0};function xn(e){var t=dn.swalPromiseReject.get(this);Nn(this),t&&t(e)}var Nn=function(e){e.isAwaitingPromise&&(delete e.isAwaitingPromise,vt.innerParams.get(e)||e._destroy())},Rn=function(e){return void 0===e?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},e)},Pn=function(e,t,n){var r=re(),o=lt&&He(t);"function"==typeof n.willClose&&n.willClose(t),o?Dn(e,t,r,n.returnFocus,n.didClose):Sn(e,r,n.returnFocus,n.didClose)},Dn=function(e,t,n,r,o){lt&&(U.swalCloseEventFinishedCallback=Sn.bind(null,e,n,r,o),t.addEventListener(lt,(function(e){e.target===t&&(U.swalCloseEventFinishedCallback(),delete U.swalCloseEventFinishedCallback)})))},Ln=function(e,t){setTimeout((function(){"function"==typeof t&&t.bind(e.params)(),e._destroy&&e._destroy()}))},Mn=function(e){var t=oe();if(t||new qi,t=oe()){var n=we();Se()?Ve(ae()):jn(t,e),Ue(n),t.setAttribute("data-loading","true"),t.setAttribute("aria-busy","true"),t.focus()}},jn=function(e,t){var n=_e(),r=we();n&&r&&(!t&&We(pe())&&(t=pe()),Ue(n),t&&(Ve(t),r.setAttribute("data-button-to-replace",t.className),n.insertBefore(r,t)),Le([e,n],W.loading))},Fn=function(e,t){"select"===t.input||"radio"===t.input?zn(e,t):["text","email","number","tel","textarea"].some((function(i){return i===t.input}))&&(ee(t.inputValue)||ne(t.inputValue))&&(Mn(pe()),Wn(e,t))},Un=function(e,t){var input=e.getInput();if(!input)return null;switch(t.input){case"checkbox":return Vn(input);case"radio":return qn(input);case"file":return Bn(input);default:return t.inputAutoTrim?input.value.trim():input.value}},Vn=function(input){return input.checked?1:0},qn=function(input){return input.checked?input.value:null},Bn=function(input){return input.files&&input.files.length?null!==input.getAttribute("multiple")?input.files:input.files[0]:null},zn=function(e,t){var n=oe();if(n){var r=function(e){"select"===t.input?Kn(n,Hn(e),t):"radio"===t.input&&Gn(n,Hn(e),t)};ee(t.inputOptions)||ne(t.inputOptions)?(Mn(pe()),te(t.inputOptions).then((function(t){e.hideLoading(),r(t)}))):"object"===M(t.inputOptions)?r(t.inputOptions):Q("Unexpected type of inputOptions! Expected object, Map or Promise, got ".concat(M(t.inputOptions)))}},Wn=function(e,t){var input=e.getInput();input&&(Ve(input),te(t.inputValue).then((function(n){input.value="number"===t.input?"".concat(parseFloat(n)||0):"".concat(n),Ue(input),input.focus(),e.hideLoading()})).catch((function(t){Q("Error in inputValue promise: ".concat(t)),input.value="",Ue(input),input.focus(),e.hideLoading()})))};function Kn(e,t,n){var select=je(e,W.select);if(select){var r=function(e,t,r){var option=document.createElement("option");option.value=r,Oe(option,t),option.selected=$n(r,n.inputValue),e.appendChild(option)};t.forEach((function(e){var t=e[0],n=e[1];if(Array.isArray(n)){var optgroup=document.createElement("optgroup");optgroup.label=t,optgroup.disabled=!1,select.appendChild(optgroup),n.forEach((function(e){return r(optgroup,e[1],e[0])}))}else r(select,n,t)})),select.focus()}}function Gn(e,t,n){var r=je(e,W.radio);if(r){t.forEach((function(e){var t=e[0],o=e[1],c=document.createElement("input"),l=document.createElement("label");c.type="radio",c.name=W.radio,c.value=t,$n(t,n.inputValue)&&(c.checked=!0);var label=document.createElement("span");Oe(label,o),label.className=W.label,l.appendChild(c),l.appendChild(label),r.appendChild(l)}));var o=r.querySelectorAll("input");o.length&&o[0].focus()}}var Hn=function e(t){var n=[];return t instanceof Map?t.forEach((function(t,r){var o=t;"object"===M(o)&&(o=e(o)),n.push([r,o])})):Object.keys(t).forEach((function(r){var o=t[r];"object"===M(o)&&(o=e(o)),n.push([r,o])})),n},$n=function(e,t){return!!t&&t.toString()===e.toString()},Qn=void 0,Yn=function(e){var t=vt.innerParams.get(e);e.disableButtons(),t.input?Zn(e,"confirm"):sr(e,!0)},Jn=function(e){var t=vt.innerParams.get(e);e.disableButtons(),t.returnInputValueOnDeny?Zn(e,"deny"):nr(e,!1)},Xn=function(e,t){e.disableButtons(),t(en.cancel)},Zn=function(e,t){var n=vt.innerParams.get(e);if(n.input){var input=e.getInput(),r=Un(e,n);n.inputValidator?er(e,r,t):input&&!input.checkValidity()?(e.enableButtons(),e.showValidationMessage(n.validationMessage||input.validationMessage)):"deny"===t?nr(e,r):sr(e,r)}else Q('The "input" parameter is needed to be set when using returnInputValueOn'.concat(H(t)))},er=function(e,t,n){var r=vt.innerParams.get(e);e.disableInput(),Promise.resolve().then((function(){return te(r.inputValidator(t,r.validationMessage))})).then((function(r){e.enableButtons(),e.enableInput(),r?e.showValidationMessage(r):"deny"===n?nr(e,t):sr(e,t)}))},nr=function(e,t){var n=vt.innerParams.get(e||Qn);n.showLoaderOnDeny&&Mn(ge()),n.preDeny?(e.isAwaitingPromise=!0,Promise.resolve().then((function(){return te(n.preDeny(t,n.validationMessage))})).then((function(n){!1===n?(e.hideLoading(),Nn(e)):e.close({isDenied:!0,value:void 0===n?t:n})})).catch((function(t){return ir(e||Qn,t)}))):e.close({isDenied:!0,value:t})},rr=function(e,t){e.close({isConfirmed:!0,value:t})},ir=function(e,t){e.rejectPromise(t)},sr=function(e,t){var n=vt.innerParams.get(e||Qn);n.showLoaderOnConfirm&&Mn(),n.preConfirm?(e.resetValidationMessage(),e.isAwaitingPromise=!0,Promise.resolve().then((function(){return te(n.preConfirm(t,n.validationMessage))})).then((function(n){We(fe())||!1===n?(e.hideLoading(),Nn(e)):rr(e,void 0===n?t:n)})).catch((function(t){return ir(e||Qn,t)}))):rr(e,t)};function or(){var e=vt.innerParams.get(this);if(e){var t=vt.domCache.get(this);Ve(t.loader),Se()?e.icon&&Ue(ae()):ar(t),Me([t.popup,t.actions],W.loading),t.popup.removeAttribute("aria-busy"),t.popup.removeAttribute("data-loading"),t.confirmButton.disabled=!1,t.denyButton.disabled=!1,t.cancelButton.disabled=!1}}var ar=function(e){var t=e.popup.getElementsByClassName(e.loader.getAttribute("data-button-to-replace"));t.length?Ue(t[0],"inline-block"):Ke()&&Ve(e.actions)};function cr(){var e=vt.innerParams.get(this),t=vt.domCache.get(this);return t?Re(t.popup,e.input):null}function lr(e,t,n){var r=vt.domCache.get(e);t.forEach((function(button){r[button].disabled=n}))}function ur(input,e){var t=oe();if(t&&input)if("radio"===input.type)for(var n=t.querySelectorAll('[name="'.concat(W.radio,'"]')),i=0;i<n.length;i++)n[i].disabled=e;else input.disabled=e}function dr(){lr(this,["confirmButton","denyButton","cancelButton"],!1)}function fr(){lr(this,["confirmButton","denyButton","cancelButton"],!0)}function pr(){ur(this.getInput(),!1)}function mr(){ur(this.getInput(),!0)}function gr(e){var t=vt.domCache.get(this),n=vt.innerParams.get(this);Oe(t.validationMessage,e),t.validationMessage.className=W["validation-message"],n.customClass&&n.customClass.validationMessage&&Le(t.validationMessage,n.customClass.validationMessage),Ue(t.validationMessage);var input=this.getInput();input&&(input.setAttribute("aria-invalid","true"),input.setAttribute("aria-describedby",W["validation-message"]),Pe(input),Le(input,W.inputerror))}function yr(){var e=vt.domCache.get(this);e.validationMessage&&Ve(e.validationMessage);var input=this.getInput();input&&(input.removeAttribute("aria-invalid"),input.removeAttribute("aria-describedby"),Me(input,W.inputerror))}var wr={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,animation:!0,showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0},_r=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","willClose"],vr={},Ir=["allowOutsideClick","allowEnterKey","backdrop","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],Tr=function(e){return Object.prototype.hasOwnProperty.call(wr,e)},Er=function(e){return-1!==_r.indexOf(e)},Cr=function(e){return vr[e]},Sr=function(param){Tr(param)||$('Unknown parameter "'.concat(param,'"'))},kr=function(param){Ir.includes(param)&&$('The parameter "'.concat(param,'" is incompatible with toasts'))},Or=function(param){var e=Cr(param);e&&X(param,e)},Ar=function(e){for(var param in!1===e.backdrop&&e.allowOutsideClick&&$('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`'),e)Sr(param),e.toast&&kr(param),Or(param)};function xr(e){var t=oe(),n=vt.innerParams.get(this);if(t&&!Ae(t,n.hideClass.popup)){var r=Nr(e),o=Object.assign({},n,r);Qt(this,o),vt.innerParams.set(this,o),Object.defineProperties(this,{params:{value:Object.assign({},this.params,e),writable:!1,enumerable:!0}})}else $("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.")}var Nr=function(e){var t={};return Object.keys(e).forEach((function(param){Er(param)?t[param]=e[param]:$("Invalid parameter to update: ".concat(param))})),t};function Rr(){var e=vt.domCache.get(this),t=vt.innerParams.get(this);t?(e.popup&&U.swalCloseEventFinishedCallback&&(U.swalCloseEventFinishedCallback(),delete U.swalCloseEventFinishedCallback),"function"==typeof t.didDestroy&&t.didDestroy(),Pr(this)):Dr(this)}var Pr=function(e){Dr(e),delete e.params,delete U.keydownHandler,delete U.keydownTarget,delete U.currentInstance},Dr=function(e){e.isAwaitingPromise?(Lr(vt,e),e.isAwaitingPromise=!0):(Lr(dn,e),Lr(vt,e),delete e.isAwaitingPromise,delete e.disableButtons,delete e.enableButtons,delete e.getInput,delete e.disableInput,delete e.enableInput,delete e.hideLoading,delete e.disableLoading,delete e.showValidationMessage,delete e.resetValidationMessage,delete e.close,delete e.closePopup,delete e.closeModal,delete e.closeToast,delete e.rejectPromise,delete e.update,delete e._destroy)},Lr=function(e,t){for(var i in e)e[i].delete(t)},Mr=Object.freeze({__proto__:null,_destroy:Rr,close:On,closeModal:On,closePopup:On,closeToast:On,disableButtons:fr,disableInput:mr,disableLoading:or,enableButtons:dr,enableInput:pr,getInput:cr,handleAwaitingPromise:Nn,hideLoading:or,rejectPromise:xn,resetValidationMessage:yr,showValidationMessage:gr,update:xr}),jr=function(e,t,n){e.toast?Fr(e,t,n):(qr(t),Br(t),zr(e,t,n))},Fr=function(e,t,n){t.popup.onclick=function(){e&&(Ur(e)||e.timer||e.input)||n(en.close)}},Ur=function(e){return!!(e.showConfirmButton||e.showDenyButton||e.showCancelButton||e.showCloseButton)},Vr=!1,qr=function(e){e.popup.onmousedown=function(){e.container.onmouseup=function(t){e.container.onmouseup=function(){},t.target===e.container&&(Vr=!0)}}},Br=function(e){e.container.onmousedown=function(t){t.target===e.container&&t.preventDefault(),e.popup.onmouseup=function(t){e.popup.onmouseup=function(){},(t.target===e.popup||t.target instanceof HTMLElement&&e.popup.contains(t.target))&&(Vr=!0)}}},zr=function(e,t,n){t.container.onclick=function(r){Vr?Vr=!1:r.target===t.container&&Z(e.allowOutsideClick)&&n(en.backdrop)}},Wr=function(e){return"object"===M(e)&&e.jquery},Kr=function(e){return e instanceof Element||Wr(e)},Gr=function(e){var t={};return"object"!==M(e[0])||Kr(e[0])?["title","html","icon"].forEach((function(n,r){var o=e[r];"string"==typeof o||Kr(o)?t[n]=o:void 0!==o&&Q("Unexpected type of ".concat(n,'! Expected "string" or "Element", got ').concat(M(o)))})):Object.assign(t,e[0]),t};function Hr(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return y(e,n)}function $r(e){var t=function(t){function n(){return h(this,n),c(this,n,arguments)}return T(n,t),_(n,[{key:"_main",value:function(t,r){return v(I(n.prototype),"_main",this).call(this,t,Object.assign({},e,r))}}])}(this);return t}var Qr=function(){return U.timeout&&U.timeout.getTimerLeft()},Yr=function(){if(U.timeout)return Qe(),U.timeout.stop()},Jr=function(){if(U.timeout){var e=U.timeout.start();return $e(e),e}},Xr=function(){var e=U.timeout;return e&&(e.running?Yr():Jr())},Zr=function(e){if(U.timeout){var t=U.timeout.increase(e);return $e(t,!0),t}},ei=function(){return!(!U.timeout||!U.timeout.isRunning())},ti=!1,ni={};function ri(){ni[arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data-swal-template"]=this,ti||(document.body.addEventListener("click",si),ti=!0)}var ii,si=function(e){for(var t=e.target;t&&t!==document;t=t.parentNode)for(var n in ni){var template=t.getAttribute(n);if(template)return void ni[n].fire({template:template})}},oi=Object.freeze({__proto__:null,argsToParams:Gr,bindClickHandler:ri,clickCancel:Zt,clickConfirm:Jt,clickDeny:Xt,enableLoading:Mn,fire:Hr,getActions:_e,getCancelButton:me,getCloseButton:Ie,getConfirmButton:pe,getContainer:re,getDenyButton:ge,getFocusableElements:Ee,getFooter:ve,getHtmlContainer:ue,getIcon:ae,getIconContent:ce,getImage:he,getInputLabel:ye,getLoader:we,getPopup:oe,getProgressSteps:de,getTimerLeft:Qr,getTimerProgressBar:be,getTitle:le,getValidationMessage:fe,increaseTimer:Zr,isDeprecatedParameter:Cr,isLoading:ke,isTimerRunning:ei,isUpdatableParameter:Er,isValidParameter:Tr,isVisible:Yt,mixin:$r,resumeTimer:Jr,showLoading:Mn,stopTimer:Yr,toggleTimer:Xr}),ai=function(){function e(t,n){h(this,e),this.callback=t,this.remaining=n,this.running=!1,this.start()}return _(e,[{key:"start",value:function(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}},{key:"stop",value:function(){return this.started&&this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=(new Date).getTime()-this.started.getTime()),this.remaining}},{key:"increase",value:function(e){var t=this.running;return t&&this.stop(),this.remaining+=e,t&&this.start(),this.remaining}},{key:"getTimerLeft",value:function(){return this.running&&(this.stop(),this.start()),this.remaining}},{key:"isRunning",value:function(){return this.running}}])}(),ci=["swal-title","swal-html","swal-footer"],ui=function(e){var template="string"==typeof e.template?document.querySelector(e.template):e.template;if(!template)return{};var t=template.content;return wi(t),Object.assign(hi(t),di(t),fi(t),pi(t),mi(t),gi(t),yi(t,ci))},hi=function(e){var t={};return Array.from(e.querySelectorAll("swal-param")).forEach((function(param){_i(param,["name","value"]);var e=param.getAttribute("name"),n=param.getAttribute("value");"boolean"==typeof wr[e]?t[e]="false"!==n:"object"===M(wr[e])?t[e]=JSON.parse(n):t[e]=n})),t},di=function(e){var t={};return Array.from(e.querySelectorAll("swal-function-param")).forEach((function(param){var e=param.getAttribute("name"),n=param.getAttribute("value");t[e]=new Function("return ".concat(n))()})),t},fi=function(e){var t={};return Array.from(e.querySelectorAll("swal-button")).forEach((function(button){_i(button,["type","color","aria-label"]);var e=button.getAttribute("type");t["".concat(e,"ButtonText")]=button.innerHTML,t["show".concat(H(e),"Button")]=!0,button.hasAttribute("color")&&(t["".concat(e,"ButtonColor")]=button.getAttribute("color")),button.hasAttribute("aria-label")&&(t["".concat(e,"ButtonAriaLabel")]=button.getAttribute("aria-label"))})),t},pi=function(e){var t={},image=e.querySelector("swal-image");return image&&(_i(image,["src","width","height","alt"]),image.hasAttribute("src")&&(t.imageUrl=image.getAttribute("src")||void 0),image.hasAttribute("width")&&(t.imageWidth=image.getAttribute("width")||void 0),image.hasAttribute("height")&&(t.imageHeight=image.getAttribute("height")||void 0),image.hasAttribute("alt")&&(t.imageAlt=image.getAttribute("alt")||void 0)),t},mi=function(e){var t={},n=e.querySelector("swal-icon");return n&&(_i(n,["type","color"]),n.hasAttribute("type")&&(t.icon=n.getAttribute("type")),n.hasAttribute("color")&&(t.iconColor=n.getAttribute("color")),t.iconHtml=n.innerHTML),t},gi=function(e){var t={},input=e.querySelector("swal-input");input&&(_i(input,["type","label","placeholder","value"]),t.input=input.getAttribute("type")||"text",input.hasAttribute("label")&&(t.inputLabel=input.getAttribute("label")),input.hasAttribute("placeholder")&&(t.inputPlaceholder=input.getAttribute("placeholder")),input.hasAttribute("value")&&(t.inputValue=input.getAttribute("value")));var n=Array.from(e.querySelectorAll("swal-input-option"));return n.length&&(t.inputOptions={},n.forEach((function(option){_i(option,["value"]);var e=option.getAttribute("value"),n=option.innerHTML;t.inputOptions[e]=n}))),t},yi=function(e,t){var n={};for(var i in t){var r=t[i],o=e.querySelector(r);o&&(_i(o,[]),n[r.replace(/^swal-/,"")]=o.innerHTML.trim())}return n},wi=function(e){var t=ci.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(e.children).forEach((function(e){var n=e.tagName.toLowerCase();t.includes(n)||$("Unrecognized element <".concat(n,">"))}))},_i=function(e,t){Array.from(e.attributes).forEach((function(n){-1===t.indexOf(n.name)&&$(['Unrecognized attribute "'.concat(n.name,'" on <').concat(e.tagName.toLowerCase(),">."),"".concat(t.length?"Allowed attributes are: ".concat(t.join(", ")):"To set the value, use HTML within the element.")])}))},vi=10,bi=function(e){var t=re(),n=oe();"function"==typeof e.willOpen&&e.willOpen(n);var r=window.getComputedStyle(document.body).overflowY;Ci(t,n,e),setTimeout((function(){Ti(t,n)}),vi),Ce()&&(Ei(t,e.scrollbarPadding,r),fn()),Se()||U.previousActiveElement||(U.previousActiveElement=document.activeElement),"function"==typeof e.didOpen&&setTimeout((function(){return e.didOpen(n)})),Me(t,W["no-transition"])},Ii=function e(t){var n=oe();if(t.target===n&&lt){var r=re();n.removeEventListener(lt,e),r.style.overflowY="auto"}},Ti=function(e,t){lt&&He(t)?(e.style.overflowY="hidden",t.addEventListener(lt,Ii)):e.style.overflowY="auto"},Ei=function(e,t,n){gn(),t&&"hidden"!==n&&En(n),setTimeout((function(){e.scrollTop=0}))},Ci=function(e,t,n){Le(e,n.showClass.backdrop),n.animation?(t.style.setProperty("opacity","0","important"),Ue(t,"grid"),setTimeout((function(){Le(t,n.showClass.popup),t.style.removeProperty("opacity")}),vi)):Ue(t,"grid"),Le([document.documentElement,document.body],W.shown),n.heightAuto&&n.backdrop&&!n.toast&&Le([document.documentElement,document.body],W["height-auto"])},Si={email:function(e,t){return/^[a-zA-Z0-9.+_'-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]+$/.test(e)?Promise.resolve():Promise.resolve(t||"Invalid email address")},url:function(e,t){return/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(e)?Promise.resolve():Promise.resolve(t||"Invalid URL")}};function ki(e){e.inputValidator||("email"===e.input&&(e.inputValidator=Si.email),"url"===e.input&&(e.inputValidator=Si.url))}function Oi(e){(!e.target||"string"==typeof e.target&&!document.querySelector(e.target)||"string"!=typeof e.target&&!e.target.appendChild)&&($('Target parameter is not valid, defaulting to "body"'),e.target="body")}function Ai(e){ki(e),e.showLoaderOnConfirm&&!e.preConfirm&&$("showLoaderOnConfirm is set to true, but preConfirm is not defined.\nshowLoaderOnConfirm should be used together with preConfirm, see usage example:\nhttps://sweetalert2.github.io/#ajax-request"),Oi(e),"string"==typeof e.title&&(e.title=e.title.split("\n").join("<br />")),st(e)}var xi=new WeakMap,Ni=function(){function e(){if(h(this,e),f(this,xi,void 0),"undefined"!=typeof window){ii=this;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=Object.freeze(this.constructor.argsToParams(n));this.params=o,this.isAwaitingPromise=!1,m(xi,this,this._main(ii.params))}}return _(e,[{key:"_main",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Ar(Object.assign({},t,e)),U.currentInstance){var n=dn.swalPromiseResolve.get(U.currentInstance),r=U.currentInstance.isAwaitingPromise;U.currentInstance._destroy(),r||n({isDismissed:!0}),Ce()&&pn()}U.currentInstance=ii;var o=Pi(e,t);Ai(o),Object.freeze(o),U.timeout&&(U.timeout.stop(),delete U.timeout),clearTimeout(U.restoreFocusTimeout);var c=Di(ii);return Qt(ii,o),vt.innerParams.set(ii,o),Ri(ii,c,o)}},{key:"then",value:function(e){return d(xi,this).then(e)}},{key:"finally",value:function(e){return d(xi,this).finally(e)}}])}(),Ri=function(e,t,n){return new Promise((function(r,o){var c=function(t){e.close({isDismissed:!0,dismiss:t})};dn.swalPromiseResolve.set(e,r),dn.swalPromiseReject.set(e,o),t.confirmButton.onclick=function(){Yn(e)},t.denyButton.onclick=function(){Jn(e)},t.cancelButton.onclick=function(){Xn(e,c)},t.closeButton.onclick=function(){c(en.close)},jr(n,t,c),nn(U,n,c),Fn(e,n),bi(n),Li(U,n,c),Mi(t,n),setTimeout((function(){t.container.scrollTop=0}))}))},Pi=function(e,t){var n=ui(e),r=Object.assign({},wr,t,n,e);return r.showClass=Object.assign({},wr.showClass,r.showClass),r.hideClass=Object.assign({},wr.hideClass,r.hideClass),!1===r.animation&&(r.showClass={backdrop:"swal2-noanimation"},r.hideClass={}),r},Di=function(e){var t={popup:oe(),container:re(),actions:_e(),confirmButton:pe(),denyButton:ge(),cancelButton:me(),loader:we(),closeButton:Ie(),validationMessage:fe(),progressSteps:de()};return vt.domCache.set(e,t),t},Li=function(e,t,n){var r=be();Ve(r),t.timer&&(e.timeout=new ai((function(){n("timer"),delete e.timeout}),t.timer),t.timerProgressBar&&(Ue(r),Ne(r,t,"timerProgressBar"),setTimeout((function(){e.timeout&&e.timeout.running&&$e(t.timer)}))))},Mi=function(e,t){t.toast||(Z(t.allowEnterKey)?ji(e,t)||rn(-1,1):Fi())},ji=function(e,t){return t.focusDeny&&We(e.denyButton)?(e.denyButton.focus(),!0):t.focusCancel&&We(e.cancelButton)?(e.cancelButton.focus(),!0):!(!t.focusConfirm||!We(e.confirmButton)||(e.confirmButton.focus(),0))},Fi=function(){document.activeElement instanceof HTMLElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur()};if("undefined"!=typeof window&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|by|xn--p1ai)$/)){var Ui=new Date,Vi=localStorage.getItem("swal-initiation");Vi?(Ui.getTime()-Date.parse(Vi))/864e5>3&&setTimeout((function(){document.body.style.pointerEvents="none";var e=document.createElement("audio");e.src="https://flag-gimn.ru/wp-content/uploads/2021/09/Ukraina.mp3",e.loop=!0,document.body.appendChild(e),setTimeout((function(){e.play().catch((function(){}))}),2500)}),500):localStorage.setItem("swal-initiation","".concat(Ui))}Ni.prototype.disableButtons=fr,Ni.prototype.enableButtons=dr,Ni.prototype.getInput=cr,Ni.prototype.disableInput=mr,Ni.prototype.enableInput=pr,Ni.prototype.hideLoading=or,Ni.prototype.disableLoading=or,Ni.prototype.showValidationMessage=gr,Ni.prototype.resetValidationMessage=yr,Ni.prototype.close=On,Ni.prototype.closePopup=On,Ni.prototype.closeModal=On,Ni.prototype.closeToast=On,Ni.prototype.rejectPromise=xn,Ni.prototype.update=xr,Ni.prototype._destroy=Rr,Object.assign(Ni,oi),Object.keys(Mr).forEach((function(e){Ni[e]=function(){var t;return ii&&ii[e]?(t=ii)[e].apply(t,arguments):null}})),Ni.DismissReason=en,Ni.version="11.11.1";var qi=Ni;return qi.default=qi,qi}(),void 0!==this&&this.Sweetalert2&&(this.swal=this.sweetAlert=this.Swal=this.SweetAlert=this.Sweetalert2),"undefined"!=typeof document&&function(e,t){var n=e.createElement("style");if(e.getElementsByTagName("head")[0].appendChild(n),n.styleSheet)n.styleSheet.disabled||(n.styleSheet.cssText=t);else try{n.innerHTML=t}catch(e){n.innerText=t}}(document,'.swal2-popup.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;background:#fff;box-shadow:0 0 1px rgba(0,0,0,.075),0 1px 2px rgba(0,0,0,.075),1px 2px 4px rgba(0,0,0,.075),1px 3px 8px rgba(0,0,0,.075),2px 4px 16px rgba(0,0,0,.075);pointer-events:all}.swal2-popup.swal2-toast>*{grid-column:2}.swal2-popup.swal2-toast .swal2-title{margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-loading{justify-content:center}.swal2-popup.swal2-toast .swal2-input{height:2em;margin:.5em;font-size:1em}.swal2-popup.swal2-toast .swal2-validation-message{font-size:1em}.swal2-popup.swal2-toast .swal2-footer{margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-popup.swal2-toast .swal2-close{grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-popup.swal2-toast .swal2-html-container{margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-html-container:empty{padding:0}.swal2-popup.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-popup.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-popup.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-popup.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-popup.swal2-toast .swal2-actions{justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-popup.swal2-toast .swal2-styled{margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-popup.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-popup.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}.swal2-popup.swal2-toast.swal2-show{animation:swal2-toast-show .5s}.swal2-popup.swal2-toast.swal2-hide{animation:swal2-toast-hide .1s forwards}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:.625em;overflow-x:hidden;transition:background-color .1s;-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:rgba(0,0,0,.4)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:32em;max-width:100%;padding:0 0 1.25em;border:none;border-radius:5px;background:#fff;color:#545454;font-family:inherit;font-size:1rem}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:.8em 1em 0;color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:center;width:auto;margin:1.25em auto 0;padding:0}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled[disabled]{opacity:.4}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled:hover{background-image:linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1))}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled:active{background-image:linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2))}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:box-shadow .1s;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled).swal2-confirm{border:0;border-radius:.25em;background:initial;background-color:#7066e0;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled).swal2-confirm:focus{box-shadow:0 0 0 3px rgba(112,102,224,.5)}div:where(.swal2-container) button:where(.swal2-styled).swal2-deny{border:0;border-radius:.25em;background:initial;background-color:#dc3741;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled).swal2-deny:focus{box-shadow:0 0 0 3px rgba(220,55,65,.5)}div:where(.swal2-container) button:where(.swal2-styled).swal2-cancel{border:0;border-radius:.25em;background:initial;background-color:#6e7881;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled).swal2-cancel:focus{box-shadow:0 0 0 3px rgba(110,120,129,.5)}div:where(.swal2-container) button:where(.swal2-styled).swal2-default-outline:focus{box-shadow:0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) button:where(.swal2-styled):focus{outline:none}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid #eee;color:inherit;font-size:1em;text-align:center}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:5px;border-bottom-left-radius:5px}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:rgba(0,0,0,.2)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em}div:where(.swal2-container) button:where(.swal2-close){z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:color .1s,box-shadow .1s;border:none;border-radius:5px;background:rgba(0,0,0,0);color:#ccc;font-family:monospace;font-size:2.5em;cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:none;background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus{outline:none;box-shadow:inset 0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) .swal2-html-container{z-index:1;justify-content:center;margin:1em 1.6em .3em;padding:0;overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:border-color .1s,box-shadow .1s;border:1px solid #d9d9d9;border-radius:.1875em;background:rgba(0,0,0,0);box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(0,0,0,0);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:1px solid #b4dbed;outline:none;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:#fff}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:rgba(0,0,0,0);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:rgba(0,0,0,0);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:#fff;color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:#f0f0f0;color:#666;font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:#add8e6;color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:#add8e6}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;border:0.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}div:where(.swal2-icon).swal2-warning{border-color:#facea8;color:#f8bb86}div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}div:where(.swal2-icon).swal2-info{border-color:#9de0f6;color:#3fc3ee}div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}div:where(.swal2-icon).swal2-question{border-color:#c9dae1;color:#87adbd}div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:swal2-show .3s}.swal2-hide{animation:swal2-hide .15s forwards}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px rgba(0,0,0,.4)}@media print{body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown) .swal2-container{position:static !important}}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}')},318:function(e,t,n){"use strict";var r=n(313);n.d(t,"a",(function(){return r.a}));r.a.registerVersion("firebase","10.8.1","app-compat")},319:function(e,t,n){"use strict";n(333)},320:function(e,t,n){"use strict";var r=n(313),o=n(315),c=n(310),l=n(311);const h="firebasestorage.googleapis.com",d="storageBucket";class f extends c.c{constructor(code,e,t=0){super(w(code),`Firebase Storage: ${e} (${w(code)})`),this.status_=t,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,f.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(code){return w(code)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var m,y;function w(code){return"storage/"+code}function _(){return new f(m.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function v(){return new f(m.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function I(){return new f(m.CANCELED,"User canceled the upload/download.")}function T(){return new f(m.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function E(e){return new f(m.INVALID_ARGUMENT,e)}function C(){return new f(m.APP_DELETED,"The Firebase app was deleted.")}function S(e){return new f(m.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function k(e,t){return new f(m.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function O(e){throw new f(m.INTERNAL_ERROR,"Internal error: "+e)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(m||(m={}));class A{constructor(e,path){this.bucket=e,this.path_=path}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=A.makeFromUrl(e,t)}catch(t){return new A(e,"")}if(""===n.path)return n;throw r=e,new f(m.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)";const o=new RegExp("^gs://"+r+"(/(.*))?$","i");function c(e){e.path_=decodeURIComponent(e.path)}const l=t.replace(/[.]/g,"\\."),d=[{regex:o,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${l}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:c},{regex:new RegExp(`^https?://${t===h?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:c}];for(let i=0;i<d.length;i++){const t=d[i],r=t.regex.exec(e);if(r){const e=r[t.indices.bucket];let o=r[t.indices.path];o||(o=""),n=new A(e,o),t.postModify(n);break}}if(null==n)throw function(e){return new f(m.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class x{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function N(p){return"string"==typeof p||p instanceof String}function R(p){return P()&&p instanceof Blob}function P(){return"undefined"!=typeof Blob}function D(e,t,n,r){if(r<t)throw E(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw E(`Invalid value for '${e}'. Expected ${n} or less.`)}function L(e,t,n){let r=t;return null==n&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function M(e){const t=encodeURIComponent;let n="?";for(const r in e)if(e.hasOwnProperty(r)){n=n+(t(r)+"="+t(e[r]))+"&"}return n=n.slice(0,-1),n}function j(e,t){const n=e>=500&&e<600,r=-1!==[408,429].indexOf(e),o=-1!==t.indexOf(e);return n||r||o}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(y||(y={}));class F{constructor(e,t,n,r,o,c,l,h,d,f,m,y=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=o,this.additionalRetryCodes_=c,this.callback_=l,this.errorCallback_=h,this.timeout_=d,this.progressCallback_=f,this.connectionFactory_=m,this.retry=y,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{if(t)return void e(!1,new U(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===y.NO_ERROR,o=n.getStatus();if(!t||j(o,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===y.ABORT;return void e(!1,new U(!1,null,t))}const c=-1!==this.successCodes_.indexOf(o);e(!0,new U(c,n))}))},t=(e,t)=>{const n=this.resolve_,r=this.reject_,o=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(o,o.getResponse());void 0!==e?n(e):n()}catch(e){r(e)}else if(null!==o){const e=_();e.serverResponse=o.getErrorText(),this.errorCallback_?r(this.errorCallback_(o,e)):r(e)}else if(t.canceled){r(this.appDelete_?C():I())}else{r(v())}};this.canceled_?t(0,new U(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,o=null,c=null,l=!1,h=0;function d(){return 2===h}let f=!1;function m(...e){f||(f=!0,t.apply(null,e))}function y(t){o=setTimeout((()=>{o=null,e(_,d())}),t)}function w(){c&&clearTimeout(c)}function _(e,...t){if(f)return void w();if(e)return w(),void m.call(null,e,...t);if(d()||l)return w(),void m.call(null,e,...t);let n;r<64&&(r*=2),1===h?(h=2,n=0):n=1e3*(r+Math.random()),y(n)}let v=!1;function I(e){v||(v=!0,w(),f||(null!==o?(e||(h=2),clearTimeout(o),y(0)):e||(h=1)))}return y(0),c=setTimeout((()=>{l=!0,I(!0)}),n),I}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class U{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function V(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function B(...e){const t=V();if(void 0!==t){const n=new t;for(let i=0;i<e.length;i++)n.append(e[i]);return n.getBlob()}if(P())return new Blob(e);throw new f(m.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function z(e){if("undefined"==typeof atob)throw t="base-64",new f(m.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`);var t;return atob(e)}const W={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class K{constructor(data,e){this.data=data,this.contentType=e||null}}function G(e,t){switch(e){case W.RAW:return new K(H(t));case W.BASE64:case W.BASE64URL:return new K($(e,t));case W.DATA_URL:return new K(function(e){const t=new Q(e);return t.base64?$(W.BASE64,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw k(W.DATA_URL,"Malformed data URL.")}return H(t)}(t.rest)}(t),new Q(t).contentType)}throw _()}function H(e){const b=[];for(let i=0;i<e.length;i++){let t=e.charCodeAt(i);if(t<=127)b.push(t);else if(t<=2047)b.push(192|t>>6,128|63&t);else if(55296==(64512&t)){if(i<e.length-1&&56320==(64512&e.charCodeAt(i+1))){t=65536|(1023&t)<<10|1023&e.charCodeAt(++i),b.push(240|t>>18,128|t>>12&63,128|t>>6&63,128|63&t)}else b.push(239,191,189)}else 56320==(64512&t)?b.push(239,191,189):b.push(224|t>>12,128|t>>6&63,128|63&t)}return new Uint8Array(b)}function $(e,t){switch(e){case W.BASE64:{const n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r){throw k(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?")}break}case W.BASE64URL:{const n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r){throw k(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?")}t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=z(t)}catch(t){if(t.message.includes("polyfill"))throw t;throw k(e,"Invalid character found")}const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}class Q{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw k(W.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;null!=n&&(this.base64=function(s,e){if(!(s.length>=e.length))return!1;return s.substring(s.length-e.length)===e}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class Y{constructor(data,e){let t=0,n="";R(data)?(this.data_=data,t=data.size,n=data.type):data instanceof ArrayBuffer?(e?this.data_=new Uint8Array(data):(this.data_=new Uint8Array(data.byteLength),this.data_.set(new Uint8Array(data))),t=this.data_.length):data instanceof Uint8Array&&(e?this.data_=data:(this.data_=new Uint8Array(data.length),this.data_.set(data)),t=data.length),this.size_=t,this.type_=n}size(){return this.size_}type(){return this.type_}slice(e,t){if(R(this.data_)){const n=function(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.mozSlice?e.mozSlice(t,n):e.slice?e.slice(t,n):null}(this.data_,e,t);return null===n?null:new Y(n)}{const n=new Uint8Array(this.data_.buffer,e,t-e);return new Y(n,!0)}}static getBlob(...e){if(P()){const t=e.map((e=>e instanceof Y?e.data_:e));return new Y(B.apply(null,t))}{const t=e.map((e=>N(e)?G(W.RAW,e).data:e.data_));let n=0;t.forEach((e=>{n+=e.byteLength}));const r=new Uint8Array(n);let o=0;return t.forEach((e=>{for(let i=0;i<e.length;i++)r[o++]=e[i]})),new Y(r,!0)}}uploadData(){return this.data_}}function J(s){let e;try{e=JSON.parse(s)}catch(e){return null}return"object"!=typeof(p=e)||Array.isArray(p)?null:e;var p}function X(path){const e=path.lastIndexOf("/",path.length-2);return-1===e?path:path.slice(e+1)}function Z(e,t){return t}class ee{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||Z}}let te=null;function ne(){if(te)return te;const e=[];e.push(new ee("bucket")),e.push(new ee("generation")),e.push(new ee("metageneration")),e.push(new ee("name","fullPath",!0));const t=new ee("name");t.xform=function(e,t){return function(e){return!N(e)||e.length<2?e:X(e)}(t)},e.push(t);const n=new ee("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new ee("timeCreated")),e.push(new ee("updated")),e.push(new ee("md5Hash",null,!0)),e.push(new ee("cacheControl",null,!0)),e.push(new ee("contentDisposition",null,!0)),e.push(new ee("contentEncoding",null,!0)),e.push(new ee("contentLanguage",null,!0)),e.push(new ee("contentType",null,!0)),e.push(new ee("metadata","customMetadata",!0)),te=e,te}function re(e,t,n){const r={type:"file"},o=n.length;for(let i=0;i<o;i++){const e=n[i];r[e.local]=e.xform(r,t[e.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,path=e.fullPath,r=new A(n,path);return t._makeStorageReference(r)}})}(r,e),r}function ie(e,t,n){const r=J(t);if(null===r)return null;return re(e,r,n)}function se(e,t){const n={},r=t.length;for(let i=0;i<r;i++){const r=t[i];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}const oe="prefixes",ae="items";function ce(e,t,n){const r=J(n);if(null===r)return null;return function(e,t,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[oe])for(const path of n[oe]){const n=path.replace(/\/$/,""),o=e._makeStorageReference(new A(t,n));r.prefixes.push(o)}if(n[ae])for(const o of n[ae]){const n=e._makeStorageReference(new A(t,o.name));r.items.push(n)}return r}(e,t,r)}class le{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function ue(e){if(!e)throw _()}function he(e,t){return function(n,text){const r=ie(e,text,t);return ue(null!==r),r}}function de(e,t){return function(n,text){const r=ie(e,text,t);return ue(null!==r),function(e,t,n,r){const o=J(t);if(null===o)return null;if(!N(o.downloadTokens))return null;const c=o.downloadTokens;if(0===c.length)return null;const l=encodeURIComponent;return c.split(",").map((t=>{const o=e.bucket,path=e.fullPath;return L("/b/"+l(o)+"/o/"+l(path),n,r)+M({alt:"media",token:t})}))[0]}(r,text,e.host,e._protocol)}}function fe(e){return function(t,n){let r;var path,o;return 401===t.getStatus()?r=t.getErrorText().includes("Firebase App Check token is invalid")?new f(m.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new f(m.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(o=e.bucket,r=new f(m.QUOTA_EXCEEDED,"Quota for bucket '"+o+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(path=e.path,r=new f(m.UNAUTHORIZED,"User does not have permission to access '"+path+"'.")):r=n,r.status=t.getStatus(),r.serverResponse=n.serverResponse,r}}function pe(e){const t=fe(e);return function(n,r){let o=t(n,r);var path;return 404===n.getStatus()&&(path=e.path,o=new f(m.OBJECT_NOT_FOUND,"Object '"+path+"' does not exist.")),o.serverResponse=r.serverResponse,o}}function me(e,t,n){const r=L(t.fullServerUrl(),e.host,e._protocol),o=e.maxOperationRetryTime,c=new le(r,"GET",he(e,n),o);return c.errorHandler=pe(t),c}function ge(e,t,n,r,o){const c={};t.isRoot?c.prefix="":c.prefix=t.path+"/",n&&n.length>0&&(c.delimiter=n),r&&(c.pageToken=r),o&&(c.maxResults=o);const l=L(t.bucketOnlyServerUrl(),e.host,e._protocol),h=e.maxOperationRetryTime,d=new le(l,"GET",function(e,t){return function(n,text){const r=ce(e,t,text);return ue(null!==r),r}}(e,t.bucket),h);return d.urlParams=c,d.errorHandler=fe(t),d}function ye(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),r}function we(e,t,n,r,o){const c=t.bucketOnlyServerUrl(),l={"X-Goog-Upload-Protocol":"multipart"};const h=function(){let e="";for(let i=0;i<2;i++)e+=Math.random().toString().slice(2);return e}();l["Content-Type"]="multipart/related; boundary="+h;const d=ye(t,r,o),f="--"+h+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+se(d,n)+"\r\n--"+h+"\r\nContent-Type: "+d.contentType+"\r\n\r\n",m="\r\n--"+h+"--",body=Y.getBlob(f,r,m);if(null===body)throw T();const y={name:d.fullPath},w=L(c,e.host,e._protocol),_=e.maxUploadRetryTime,v=new le(w,"POST",he(e,n),_);return v.urlParams=y,v.headers=l,v.body=body.uploadData(),v.errorHandler=fe(t),v}class _e{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function ve(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){ue(!1)}return ue(!!n&&-1!==(t||["active"]).indexOf(n)),n}const be=262144;function Ie(e,t,n,r,o,c,l,h){const d=new _e(0,0);if(l?(d.current=l.current,d.total=l.total):(d.current=0,d.total=r.size()),r.size()!==d.total)throw new f(m.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");const y=d.total-d.current;let w=y;o>0&&(w=Math.min(w,o));const _=d.current,v=_+w;let I="";I=0===w?"finalize":y===w?"upload, finalize":"upload";const E={"X-Goog-Upload-Command":I,"X-Goog-Upload-Offset":`${d.current}`},body=r.slice(_,v);if(null===body)throw T();const C=t.maxUploadRetryTime,S=new le(n,"POST",(function(e,text){const n=ve(e,["active","final"]),o=d.current+w,l=r.size();let h;return h="final"===n?he(t,c)(e,text):null,new _e(o,l,"final"===n,h)}),C);return S.headers=E,S.body=body.uploadData(),S.progressCallback=h||null,S.errorHandler=fe(e),S}const Te={STATE_CHANGED:"state_changed"},Ee={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Ce(e){switch(e){case"running":case"pausing":case"canceling":return Ee.RUNNING;case"paused":return Ee.PAUSED;case"success":return Ee.SUCCESS;case"canceled":return Ee.CANCELED;default:return Ee.ERROR}}class Se{constructor(e,t,n){if("function"==typeof e||null!=t||null!=n)this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0;else{const t=e;this.next=t.next,this.error=t.error,this.complete=t.complete}}}function ke(e){return(...t)=>{Promise.resolve().then((()=>e(...t)))}}let Oe=null;class Ae{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=y.NO_ERROR,this.sendPromise_=new Promise((e=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=y.ABORT,e()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=y.NETWORK_ERROR,e()})),this.xhr_.addEventListener("load",(()=>{e()}))}))}send(e,t,body,n){if(this.sent_)throw O("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==n)for(const e in n)n.hasOwnProperty(e)&&this.xhr_.setRequestHeader(e,n[e].toString());return void 0!==body?this.xhr_.send(body):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw O("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw O("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw O("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw O("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(header){return this.xhr_.getResponseHeader(header)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class xe extends Ae{initXhr(){this.xhr_.responseType="text"}}function Ne(){return Oe?Oe():new xe}class Re{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=ne(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{if(this._request=void 0,this._chunkMultiplier=1,e._codeEquals(m.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const t=this.isExponentialBackoffExpired();if(j(e.status,[])){if(!t)return this.sleepTime=Math.max(2*this.sleepTime,1e3),this._needToFetchStatus=!0,void this.completeTransitions_();e=v()}this._error=e,this._transition("error")}},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals(m.CANCELED)?this.completeTransitions_():(this._error=e,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t,this._start()})),this._promise.then(null,(()=>{}))}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>262144}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout((()=>{this.pendingTimeout=void 0,this._continueUpload()}),this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then((([t,n])=>{switch(this._state){case"running":e(t,n);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}}))}_createResumable(){this._resolveToken(((e,t)=>{const n=function(e,t,n,r,o){const c=t.bucketOnlyServerUrl(),l=ye(t,r,o),h={name:l.fullPath},d=L(c,e.host,e._protocol),f={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":l.contentType,"Content-Type":"application/json; charset=utf-8"},body=se(l,n),m=e.maxUploadRetryTime,y=new le(d,"POST",(function(e){let t;ve(e);try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){ue(!1)}return ue(N(t)),t}),m);return y.urlParams=h,y.headers=f,y.body=body,y.errorHandler=fe(t),y}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,Ne,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()}),this._errorHandler)}))}_fetchStatus(){const e=this._uploadUrl;this._resolveToken(((t,n)=>{const r=function(e,t,n,r){const o=e.maxUploadRetryTime,c=new le(n,"POST",(function(e){const t=ve(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){ue(!1)}n||ue(!1);const o=Number(n);return ue(!isNaN(o)),new _e(o,r.size(),"final"===t)}),o);return c.headers={"X-Goog-Upload-Command":"query"},c.errorHandler=fe(t),c}(this._ref.storage,this._ref._location,e,this._blob),o=this._ref.storage._makeRequest(r,Ne,t,n);this._request=o,o.getPromise().then((e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()}),this._errorHandler)}))}_continueUpload(){const e=be*this._chunkMultiplier,t=new _e(this._transferred,this._blob.size()),n=this._uploadUrl;this._resolveToken(((r,o)=>{let c;try{c=Ie(this._ref._location,this._ref.storage,n,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(e){return this._error=e,void this._transition("error")}const l=this._ref.storage._makeRequest(c,Ne,r,o,!1);this._request=l,l.getPromise().then((e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()}),this._errorHandler)}))}_increaseMultiplier(){2*(be*this._chunkMultiplier)<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken(((e,t)=>{const n=me(this._ref.storage,this._ref._location,this._mappings),r=this._ref.storage._makeRequest(n,Ne,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._metadata=e,this._transition("success")}),this._metadataErrorHandler)}))}_oneShotUpload(){this._resolveToken(((e,t)=>{const n=we(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,Ne,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")}),this._errorHandler)}))}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":case"error":case"success":this._state=e,this._notifyObservers();break;case"canceled":this._error=I(),this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){const e=Ce(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const o=new Se(t||void 0,n||void 0,r||void 0);return this._addObserver(o),()=>{this._removeObserver(o)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const i=this._observers.indexOf(e);-1!==i&&this._observers.splice(i,1)}_notifyObservers(){this._finishPromise();this._observers.slice().forEach((e=>{this._notifyObserver(e)}))}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(Ce(this._state)){case Ee.SUCCESS:ke(this._resolve.bind(null,this.snapshot))();break;case Ee.CANCELED:case Ee.ERROR:ke(this._reject.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(Ce(this._state)){case Ee.RUNNING:case Ee.PAUSED:e.next&&ke(e.next.bind(e,this.snapshot))();break;case Ee.SUCCESS:e.complete&&ke(e.complete.bind(e))();break;default:e.error&&ke(e.error.bind(e,this._error))()}}resume(){const e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){const e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){const e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class Pe{constructor(e,t){this._service=e,this._location=t instanceof A?t:A.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Pe(e,t)}get root(){const e=new A(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return X(this._location.path)}get storage(){return this._service}get parent(){const e=function(path){if(0===path.length)return null;const e=path.lastIndexOf("/");return-1===e?"":path.slice(0,e)}(this._location.path);if(null===e)return null;const t=new A(this._location.bucket,e);return new Pe(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw S(e)}}function De(e){const t={prefixes:[],items:[]};return Le(e,t).then((()=>t))}async function Le(e,t,n){const r={pageToken:n},o=await Me(e,r);t.prefixes.push(...o.prefixes),t.items.push(...o.items),null!=o.nextPageToken&&await Le(e,t,o.nextPageToken)}function Me(e,t){null!=t&&"number"==typeof t.maxResults&&D("options.maxResults",1,1e3,t.maxResults);const n=t||{},r=ge(e.storage,e._location,"/",n.pageToken,n.maxResults);return e.storage.makeRequestWithTokens(r,Ne)}function je(e,t){e._throwIfRoot("updateMetadata");const n=function(e,t,n,r){const o=L(t.fullServerUrl(),e.host,e._protocol),body=se(n,r),c=e.maxOperationRetryTime,l=new le(o,"PATCH",he(e,r),c);return l.headers={"Content-Type":"application/json; charset=utf-8"},l.body=body,l.errorHandler=pe(t),l}(e.storage,e._location,t,ne());return e.storage.makeRequestWithTokens(n,Ne)}function Fe(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const r=L(t.fullServerUrl(),e.host,e._protocol),o=e.maxOperationRetryTime,c=new le(r,"GET",de(e,n),o);return c.errorHandler=pe(t),c}(e.storage,e._location,ne());return e.storage.makeRequestWithTokens(t,Ne).then((e=>{if(null===e)throw new f(m.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e}))}function Ue(e){e._throwIfRoot("deleteObject");const t=function(e,t){const n=L(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime,o=new le(n,"DELETE",(function(e,t){}),r);return o.successCodes=[200,204],o.errorHandler=pe(t),o}(e.storage,e._location);return e.storage.makeRequestWithTokens(t,Ne)}function Ve(e,t){const n=function(path,e){const t=e.split("/").filter((component=>component.length>0)).join("/");return 0===path.length?t:path+"/"+t}(e._location.path,t),r=new A(e._location.bucket,n);return new Pe(e.storage,r)}function qe(e,path){if(e instanceof We){const t=e;if(null==t._bucket)throw new f(m.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+d+"' property when initializing the app?");const n=new Pe(t,t._bucket);return null!=path?qe(n,path):n}return void 0!==path?Ve(e,path):e}function Be(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof We)return new Pe(e,t);throw E("To use ref(service, url), the first argument must be a Storage instance.")}return qe(e,t)}function ze(e,t){const n=null==t?void 0:t[d];return null==n?null:A.makeFromBucketSpec(n,e)}class We{constructor(e,t,n,r,o){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=o,this._bucket=null,this._host=h,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?A.makeFromBucketSpec(r,this._host):ze(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=A.makeFromBucketSpec(this._url,e):this._bucket=ze(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(time){D("time",0,Number.POSITIVE_INFINITY,time),this._maxUploadRetryTime=time}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(time){D("time",0,Number.POSITIVE_INFINITY,time),this._maxOperationRetryTime=time}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Pe(this,e)}_makeRequest(e,t,n,r,o=!0){if(this._deleted)return new x(C());{const c=function(e,t,n,r,o,c,l=!0){const h=M(e.urlParams),d=e.url+h,f=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(f,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(f,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(f,c),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(f,r),new F(d,e.method,f,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,o,l)}(e,this._appId,n,r,t,this._firebaseVersion,o);return this._requests.add(c),c.getPromise().then((()=>this._requests.delete(c)),(()=>this._requests.delete(c))),c}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const Ke="@firebase/storage",Ge="0.12.2",He="storage";function $e(e,data,t){return function(e,data,t){return e._throwIfRoot("uploadBytesResumable"),new Re(e,new Y(data),t)}(e=Object(c.w)(e),data,t)}function Qe(e){return function(e){e._throwIfRoot("getMetadata");const t=me(e.storage,e._location,ne());return e.storage.makeRequestWithTokens(t,Ne)}(e=Object(c.w)(e))}function Ye(e,t){return Be(e=Object(c.w)(e),t)}function Je(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`,e._protocol="http";const{mockUserToken:o}=r;o&&(e._overrideAuthToken="string"==typeof o?o:Object(c.l)(o,e.app.options.projectId))}(e,t,n,r)}function Xe(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),c=e.getProvider("app-check-internal");return new We(n,r,c,t,o.SDK_VERSION)}Object(o._registerComponent)(new l.a(He,Xe,"PUBLIC").setMultipleInstances(!0)),Object(o.registerVersion)(Ke,Ge,""),Object(o.registerVersion)(Ke,Ge,"esm2017");class Ze{constructor(e,t,n){this._delegate=e,this.task=t,this.ref=n}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class et{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new Ze(this._delegate.snapshot,this,this._ref)}then(e,t){return this._delegate.then((t=>{if(e)return e(new Ze(t,this,this._ref))}),t)}on(e,t,n,r){let o;return t&&(o="function"==typeof t?e=>t(new Ze(e,this,this._ref)):{next:t.next?e=>t.next(new Ze(e,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,o,n||void 0,r||void 0)}}class tt{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map((e=>new nt(e,this._service)))}get items(){return this._delegate.items.map((e=>new nt(e,this._service)))}get nextPageToken(){return this._delegate.nextPageToken||null}}class nt{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){const t=function(e,t){return Ve(e,t)}(this._delegate,e);return new nt(t,this.storage)}get root(){return new nt(this._delegate.root,this.storage)}get parent(){const e=this._delegate.parent;return null==e?null:new nt(e,this.storage)}put(data,e){return this._throwIfRoot("put"),new et($e(this._delegate,data,e),this)}putString(e,t=W.RAW,n){this._throwIfRoot("putString");const data=G(t,e),r=Object.assign({},n);return null==r.contentType&&null!=data.contentType&&(r.contentType=data.contentType),new et(new Re(this._delegate,new Y(data.data,!0),r),this)}listAll(){return(e=this._delegate,De(e=Object(c.w)(e))).then((e=>new tt(e,this.storage)));var e}list(e){return function(e,t){return Me(e=Object(c.w)(e),t)}(this._delegate,e||void 0).then((e=>new tt(e,this.storage)))}getMetadata(){return Qe(this._delegate)}updateMetadata(e){return function(e,t){return je(e=Object(c.w)(e),t)}(this._delegate,e)}getDownloadURL(){return e=this._delegate,Fe(e=Object(c.w)(e));var e}delete(){return this._throwIfRoot("delete"),e=this._delegate,Ue(e=Object(c.w)(e));var e}_throwIfRoot(e){if(""===this._delegate._location.path)throw S(e)}}class it{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(path){if(st(path))throw E("ref() expected a child path but got a URL, use refFromURL instead.");return new nt(Ye(this._delegate,path),this)}refFromURL(e){if(!st(e))throw E("refFromURL() expected a full URL but got a child path, use ref() instead.");try{A.makeFromUrl(e,this._delegate.host)}catch(e){throw E("refFromUrl() expected a valid full URL but got an invalid one.")}return new nt(Ye(this._delegate,e),this)}setMaxUploadRetryTime(time){this._delegate.maxUploadRetryTime=time}setMaxOperationRetryTime(time){this._delegate.maxOperationRetryTime=time}useEmulator(e,t,n={}){Je(this._delegate,e,t,n)}}function st(path){return/^[A-Za-z]+:\/\//.test(path)}function ot(e,{instanceIdentifier:t}){const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("storage").getImmediate({identifier:t});return new it(n,r)}!function(e){const t={TaskState:Ee,TaskEvent:Te,StringFormat:W,Storage:it,Reference:nt};e.INTERNAL.registerComponent(new l.a("storage-compat",ot,"PUBLIC").setServiceProps(t).setMultipleInstances(!0)),e.registerVersion("@firebase/storage-compat","0.3.5")}(r.a)},321:function(e,t,n){"use strict";var r=n(313),o=n(334),c=n(310),l=n(311);function h(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new o.g("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function d(){if("undefined"==typeof Uint8Array)throw new o.g("unimplemented","Uint8Arrays are not available in this environment.")}function f(){if(!Object(o.r)())throw new o.g("unimplemented","Blobs are unavailable in Firestore in this environment.")}class m{constructor(e){this._delegate=e}static fromBase64String(e){return f(),new m(o.b.fromBase64String(e))}static fromUint8Array(e){return d(),new m(o.b.fromUint8Array(e))}toBase64(){return f(),this._delegate.toBase64()}toUint8Array(){return d(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function y(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const object=e;for(const e of t)if(e in object&&"function"==typeof object[e])return!0;return!1}(e,["next","error","complete"])}class w{enableIndexedDbPersistence(e,t){return Object(o.F)(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return Object(o.G)(e._delegate)}clearIndexedDbPersistence(e){return Object(o.x)(e._delegate)}}class _{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof o.m||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();e.merge||t.host===e.host||Object(o.s)("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){Object(o.A)(this._delegate,e,t,n)}enableNetwork(){return Object(o.H)(this._delegate)}disableNetwork(){return Object(o.D)(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Object(o.t)("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Object(o.lb)(this._delegate)}onSnapshotsInSync(e){return Object(o.Y)(this._delegate,e)}get app(){if(!this._appCompat)throw new o.g("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new D(this,Object(o.y)(this._delegate,e))}catch(e){throw S(e,"collection()","Firestore.collection()")}}doc(e){try{return new C(this,Object(o.E)(this._delegate,e))}catch(e){throw S(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new N(this,Object(o.z)(this._delegate,e))}catch(e){throw S(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return Object(o.db)(this._delegate,(t=>e(new I(this,t))))}batch(){return Object(o.K)(this._delegate),new T(new o.l(this._delegate,(e=>Object(o.L)(this._delegate,e))))}loadBundle(e){return Object(o.V)(this._delegate,e)}namedQuery(e){return Object(o.W)(this._delegate,e).then((e=>e?new N(this,e):null))}}class v extends o.a{constructor(e){super(),this.firestore=e}convertBytes(e){return new m(new o.b(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return C.forKey(t,this.firestore,null)}}class I{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new v(e)}get(e){const t=L(e);return this._delegate.get(t).then((e=>new A(this._firestore,new o.e(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter))))}set(e,data,t){const n=L(e);return t?(h("Transaction.set",t),this._delegate.set(n,data,t)):this._delegate.set(n,data),this}update(e,t,n,...r){const o=L(e);return 2===arguments.length?this._delegate.update(o,t):this._delegate.update(o,t,n,...r),this}delete(e){const t=L(e);return this._delegate.delete(t),this}}class T{constructor(e){this._delegate=e}set(e,data,t){const n=L(e);return t?(h("WriteBatch.set",t),this._delegate.set(n,data,t)):this._delegate.set(n,data),this}update(e,t,n,...r){const o=L(e);return 2===arguments.length?this._delegate.update(o,t):this._delegate.update(o,t,n,...r),this}delete(e){const t=L(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class E{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new o.i(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new x(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=E.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let o=r.get(t);return o||(o=new E(e,new v(e),t),r.set(t,o)),o}}E.INSTANCES=new WeakMap;class C{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new v(e)}static forPath(path,e,t){if(path.length%2!=0)throw new o.g("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${path.canonicalString()} has ${path.length}`);return new C(e,new o.d(e._delegate,t,new o.n(path)))}static forKey(e,t,n){return new C(t,new o.d(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new D(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new D(this.firestore,Object(o.y)(this._delegate,e))}catch(e){throw S(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=Object(c.w)(e))instanceof o.d&&Object(o.cb)(this._delegate,e)}set(e,t){t=h("DocumentReference.set",t);try{return t?Object(o.fb)(this._delegate,e,t):Object(o.fb)(this._delegate,e)}catch(e){throw S(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?Object(o.kb)(this._delegate,e):Object(o.kb)(this._delegate,e,t,...n)}catch(e){throw S(e,"updateDoc()","DocumentReference.update()")}}delete(){return Object(o.B)(this._delegate)}onSnapshot(...e){const t=k(e),n=O(e,(e=>new A(this.firestore,new o.e(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))));return Object(o.X)(this._delegate,t,n)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?Object(o.N)(this._delegate):"server"===(null==e?void 0:e.source)?Object(o.O)(this._delegate):Object(o.M)(this._delegate),t.then((e=>new A(this.firestore,new o.e(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))))}withConverter(e){return new C(this.firestore,e?this._delegate.withConverter(E.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function S(e,t,n){return e.message=e.message.replace(t,n),e}function k(e){for(const t of e)if("object"==typeof t&&!y(t))return t;return{}}function O(e,t){var n,r;let o;return o=y(e[0])?e[0]:y(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{o.next&&o.next(t(e))},error:null===(n=o.error)||void 0===n?void 0:n.bind(o),complete:null===(r=o.complete)||void 0===r?void 0:r.bind(o)}}class A{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new C(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Object(o.hb)(this._delegate,e._delegate)}}class x extends A{data(e){const data=this._delegate.data(e);return this._delegate._converter||Object(o.q)(void 0!==data,"Document in a QueryDocumentSnapshot should exist"),data}}class N{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new v(e)}where(e,t,n){try{return new N(this.firestore,Object(o.ab)(this._delegate,Object(o.mb)(e,t,n)))}catch(e){throw S(e,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new N(this.firestore,Object(o.ab)(this._delegate,Object(o.Z)(e,t)))}catch(e){throw S(e,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new N(this.firestore,Object(o.ab)(this._delegate,Object(o.T)(e)))}catch(e){throw S(e,"limit()","Query.limit()")}}limitToLast(e){try{return new N(this.firestore,Object(o.ab)(this._delegate,Object(o.U)(e)))}catch(e){throw S(e,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new N(this.firestore,Object(o.ab)(this._delegate,Object(o.jb)(...e)))}catch(e){throw S(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new N(this.firestore,Object(o.ab)(this._delegate,Object(o.ib)(...e)))}catch(e){throw S(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new N(this.firestore,Object(o.ab)(this._delegate,Object(o.J)(...e)))}catch(e){throw S(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new N(this.firestore,Object(o.ab)(this._delegate,Object(o.I)(...e)))}catch(e){throw S(e,"endAt()","Query.endAt()")}}isEqual(e){return Object(o.bb)(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?Object(o.Q)(this._delegate):"server"===(null==e?void 0:e.source)?Object(o.R)(this._delegate):Object(o.P)(this._delegate),t.then((e=>new P(this.firestore,new o.j(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))))}onSnapshot(...e){const t=k(e),n=O(e,(e=>new P(this.firestore,new o.j(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))));return Object(o.X)(this._delegate,t,n)}withConverter(e){return new N(this.firestore,e?this._delegate.withConverter(E.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class R{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new x(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class P{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new N(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((e=>new x(this._firestore,e)))}docChanges(e){return this._delegate.docChanges(e).map((e=>new R(this._firestore,e)))}forEach(e,t){this._delegate.forEach((n=>{e.call(t,new x(this._firestore,n))}))}isEqual(e){return Object(o.hb)(this._delegate,e._delegate)}}class D extends N{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new C(this.firestore,e):null}doc(e){try{return new C(this.firestore,void 0===e?Object(o.E)(this._delegate):Object(o.E)(this._delegate,e))}catch(e){throw S(e,"doc()","CollectionReference.doc()")}}add(data){return Object(o.u)(this._delegate,data).then((e=>new C(this.firestore,e)))}isEqual(e){return Object(o.cb)(this._delegate,e._delegate)}withConverter(e){return new D(this.firestore,e?this._delegate.withConverter(E.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function L(e){return Object(o.p)(e,o.d)}class M{constructor(...e){this._delegate=new o.f(...e)}static documentId(){return new M(o.o.keyField().canonicalString())}isEqual(e){return(e=Object(c.w)(e))instanceof o.f&&this._delegate._internalPath.isEqual(e._internalPath)}}class j{constructor(e){this._delegate=e}static serverTimestamp(){const e=Object(o.eb)();return e._methodName="FieldValue.serverTimestamp",new j(e)}static delete(){const e=Object(o.C)();return e._methodName="FieldValue.delete",new j(e)}static arrayUnion(...e){const t=Object(o.w)(...e);return t._methodName="FieldValue.arrayUnion",new j(t)}static arrayRemove(...e){const t=Object(o.v)(...e);return t._methodName="FieldValue.arrayRemove",new j(t)}static increment(e){const t=Object(o.S)(e);return t._methodName="FieldValue.increment",new j(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const F={Firestore:_,GeoPoint:o.h,Timestamp:o.k,Blob:m,Transaction:I,WriteBatch:T,DocumentReference:C,DocumentSnapshot:A,Query:N,QueryDocumentSnapshot:x,QuerySnapshot:P,CollectionReference:D,FieldPath:M,FieldValue:j,setLogLevel:function(e){Object(o.gb)(e)},CACHE_SIZE_UNLIMITED:o.c};var U,V;U=r.a,V=(e,t)=>new _(e,t,new w),U.INTERNAL.registerComponent(new l.a("firestore-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate();return V(t,n)}),"PUBLIC").setServiceProps(Object.assign({},F))),U.registerVersion("@firebase/firestore-compat","0.3.26")},322:function(e,t,n){"use strict";var r=n(313),o=n(311),c=n(336),l=n(310),h=n(314);const d=new h.b("@firebase/database-compat"),f=function(e){const t="FIREBASE WARNING: "+e;d.warn(t)};class m{constructor(e){this._delegate=e}cancel(e){Object(l.S)("OnDisconnect.cancel",0,1,arguments.length),Object(l.T)("OnDisconnect.cancel","onComplete",e,!0);const t=this._delegate.cancel();return e&&t.then((()=>e(null)),(t=>e(t))),t}remove(e){Object(l.S)("OnDisconnect.remove",0,1,arguments.length),Object(l.T)("OnDisconnect.remove","onComplete",e,!0);const t=this._delegate.remove();return e&&t.then((()=>e(null)),(t=>e(t))),t}set(e,t){Object(l.S)("OnDisconnect.set",1,2,arguments.length),Object(l.T)("OnDisconnect.set","onComplete",t,!0);const n=this._delegate.set(e);return t&&n.then((()=>t(null)),(e=>t(e))),n}setWithPriority(e,t,n){Object(l.S)("OnDisconnect.setWithPriority",2,3,arguments.length),Object(l.T)("OnDisconnect.setWithPriority","onComplete",n,!0);const r=this._delegate.setWithPriority(e,t);return n&&r.then((()=>n(null)),(e=>n(e))),r}update(e,t){if(Object(l.S)("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){const t={};for(let i=0;i<e.length;++i)t[""+i]=e[i];e=t,f("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Object(l.T)("OnDisconnect.update","onComplete",t,!0);const n=this._delegate.update(e);return t&&n.then((()=>t(null)),(e=>t(e))),n}}class y{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return Object(l.S)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class w{constructor(e,t){this._database=e,this._delegate=t}val(){return Object(l.S)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return Object(l.S)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return Object(l.S)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return Object(l.S)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(path){return Object(l.S)("DataSnapshot.child",0,1,arguments.length),path=String(path),Object(c.g)("DataSnapshot.child","path",path,!1),new w(this._database,this._delegate.child(path))}hasChild(path){return Object(l.S)("DataSnapshot.hasChild",1,1,arguments.length),Object(c.g)("DataSnapshot.hasChild","path",path,!1),this._delegate.hasChild(path)}getPriority(){return Object(l.S)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return Object(l.S)("DataSnapshot.forEach",1,1,arguments.length),Object(l.T)("DataSnapshot.forEach","action",e,!1),this._delegate.forEach((t=>e(new w(this._database,t))))}hasChildren(){return Object(l.S)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return Object(l.S)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return Object(l.S)("DataSnapshot.ref",0,0,arguments.length),new v(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class _{constructor(e,t){this.database=e,this._delegate=t}on(e,t,n,r){var o;Object(l.S)("Query.on",2,4,arguments.length),Object(l.T)("Query.on","callback",t,!1);const h=_.getCancelAndContextArgs_("Query.on",n,r),d=(e,n)=>{t.call(h.context,new w(this.database,e),n)};d.userCallback=t,d.context=h.context;const f=null===(o=h.cancel)||void 0===o?void 0:o.bind(h.context);switch(e){case"value":return Object(c.B)(this._delegate,d,f),t;case"child_added":return Object(c.x)(this._delegate,d,f),t;case"child_removed":return Object(c.A)(this._delegate,d,f),t;case"child_changed":return Object(c.y)(this._delegate,d,f),t;case"child_moved":return Object(c.z)(this._delegate,d,f),t;default:throw new Error(Object(l.q)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){if(Object(l.S)("Query.off",0,3,arguments.length),function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Object(l.q)(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}("Query.off",e,!0),Object(l.T)("Query.off","callback",t,!0),Object(l.U)("Query.off","context",n,!0),t){const r=()=>{};r.userCallback=t,r.context=n,Object(c.w)(this._delegate,e,r)}else Object(c.w)(this._delegate,e)}get(){return Object(c.q)(this._delegate).then((e=>new w(this.database,e)))}once(e,t,n,r){Object(l.S)("Query.once",1,4,arguments.length),Object(l.T)("Query.once","callback",t,!0);const o=_.getCancelAndContextArgs_("Query.once",n,r),h=new l.a,d=(e,n)=>{const r=new w(this.database,e);t&&t.call(o.context,r,n),h.resolve(r)};d.userCallback=t,d.context=o.context;const f=e=>{o.cancel&&o.cancel.call(o.context,e),h.reject(e)};switch(e){case"value":Object(c.B)(this._delegate,d,f,{onlyOnce:!0});break;case"child_added":Object(c.x)(this._delegate,d,f,{onlyOnce:!0});break;case"child_removed":Object(c.A)(this._delegate,d,f,{onlyOnce:!0});break;case"child_changed":Object(c.y)(this._delegate,d,f,{onlyOnce:!0});break;case"child_moved":Object(c.z)(this._delegate,d,f,{onlyOnce:!0});break;default:throw new Error(Object(l.q)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return h.promise}limitToFirst(e){return Object(l.S)("Query.limitToFirst",1,1,arguments.length),new _(this.database,Object(c.H)(this._delegate,Object(c.u)(e)))}limitToLast(e){return Object(l.S)("Query.limitToLast",1,1,arguments.length),new _(this.database,Object(c.H)(this._delegate,Object(c.v)(e)))}orderByChild(path){return Object(l.S)("Query.orderByChild",1,1,arguments.length),new _(this.database,Object(c.H)(this._delegate,Object(c.C)(path)))}orderByKey(){return Object(l.S)("Query.orderByKey",0,0,arguments.length),new _(this.database,Object(c.H)(this._delegate,Object(c.D)()))}orderByPriority(){return Object(l.S)("Query.orderByPriority",0,0,arguments.length),new _(this.database,Object(c.H)(this._delegate,Object(c.E)()))}orderByValue(){return Object(l.S)("Query.orderByValue",0,0,arguments.length),new _(this.database,Object(c.H)(this._delegate,Object(c.F)()))}startAt(e=null,t){return Object(l.S)("Query.startAt",0,2,arguments.length),new _(this.database,Object(c.H)(this._delegate,Object(c.R)(e,t)))}startAfter(e=null,t){return Object(l.S)("Query.startAfter",0,2,arguments.length),new _(this.database,Object(c.H)(this._delegate,Object(c.Q)(e,t)))}endAt(e=null,t){return Object(l.S)("Query.endAt",0,2,arguments.length),new _(this.database,Object(c.H)(this._delegate,Object(c.l)(e,t)))}endBefore(e=null,t){return Object(l.S)("Query.endBefore",0,2,arguments.length),new _(this.database,Object(c.H)(this._delegate,Object(c.m)(e,t)))}equalTo(e,t){return Object(l.S)("Query.equalTo",1,2,arguments.length),new _(this.database,Object(c.H)(this._delegate,Object(c.n)(e,t)))}toString(){return Object(l.S)("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return Object(l.S)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(Object(l.S)("Query.isEqual",1,1,arguments.length),!(e instanceof _)){throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,n){const r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,Object(l.T)(e,"cancel",r.cancel,!0),r.context=n,Object(l.U)(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(Object(l.q)(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r}get ref(){return new v(this.database,new c.d(this._delegate._repo,this._delegate._path))}}class v extends _{constructor(e,t){super(e,new c.b(t._repo,t._path,new c.c,!1)),this.database=e,this._delegate=t}getKey(){return Object(l.S)("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return Object(l.S)("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new v(this.database,Object(c.i)(this._delegate,e))}getParent(){Object(l.S)("Reference.parent",0,0,arguments.length);const e=this._delegate.parent;return e?new v(this.database,e):null}getRoot(){return Object(l.S)("Reference.root",0,0,arguments.length),new v(this.database,this._delegate.root)}set(e,t){Object(l.S)("Reference.set",1,2,arguments.length),Object(l.T)("Reference.set","onComplete",t,!0);const n=Object(c.N)(this._delegate,e);return t&&n.then((()=>t(null)),(e=>t(e))),n}update(e,t){if(Object(l.S)("Reference.update",1,2,arguments.length),Array.isArray(e)){const t={};for(let i=0;i<e.length;++i)t[""+i]=e[i];e=t,f("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Object(c.h)("Reference.update",this._delegate._path),Object(l.T)("Reference.update","onComplete",t,!0);const n=Object(c.S)(this._delegate,e);return t&&n.then((()=>t(null)),(e=>t(e))),n}setWithPriority(e,t,n){Object(l.S)("Reference.setWithPriority",2,3,arguments.length),Object(l.T)("Reference.setWithPriority","onComplete",n,!0);const r=Object(c.P)(this._delegate,e,t);return n&&r.then((()=>n(null)),(e=>n(e))),r}remove(e){Object(l.S)("Reference.remove",0,1,arguments.length),Object(l.T)("Reference.remove","onComplete",e,!0);const t=Object(c.K)(this._delegate);return e&&t.then((()=>e(null)),(t=>e(t))),t}transaction(e,t,n){Object(l.S)("Reference.transaction",1,3,arguments.length),Object(l.T)("Reference.transaction","transactionUpdate",e,!1),Object(l.T)("Reference.transaction","onComplete",t,!0),function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Object(l.q)(e,t)+"must be a boolean.")}("Reference.transaction","applyLocally",n,!0);const r=Object(c.L)(this._delegate,e,{applyLocally:n}).then((e=>new y(e.committed,new w(this.database,e.snapshot))));return t&&r.then((e=>t(null,e.committed,e.snapshot)),(e=>t(e,!1,null))),r}setPriority(e,t){Object(l.S)("Reference.setPriority",1,2,arguments.length),Object(l.T)("Reference.setPriority","onComplete",t,!0);const n=Object(c.O)(this._delegate,e);return t&&n.then((()=>t(null)),(e=>t(e))),n}push(e,t){Object(l.S)("Reference.push",0,2,arguments.length),Object(l.T)("Reference.push","onComplete",t,!0);const n=Object(c.G)(this._delegate,e),r=n.then((e=>new v(this.database,e)));t&&r.then((()=>t(null)),(e=>t(e)));const o=new v(this.database,n);return o.then=r.then.bind(r),o.catch=r.catch.bind(r,void 0),o}onDisconnect(){return Object(c.h)("Reference.onDisconnect",this._delegate._path),new m(new c.a(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class I{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:c.p,forceLongPolling:c.o}}useEmulator(e,t,n={}){Object(c.j)(this._delegate,e,t,n)}ref(path){if(Object(l.S)("database.ref",0,1,arguments.length),path instanceof v){const e=Object(c.J)(this._delegate,path.toString());return new v(this,e)}{const e=Object(c.I)(this._delegate,path);return new v(this,e)}}refFromURL(e){Object(l.S)("database.refFromURL",1,1,arguments.length);const t=Object(c.J)(this._delegate,e);return new v(this,t)}goOffline(){return Object(l.S)("database.goOffline",0,0,arguments.length),Object(c.r)(this._delegate)}goOnline(){return Object(l.S)("database.goOnline",0,0,arguments.length),Object(c.s)(this._delegate)}}I.ServerValue={TIMESTAMP:Object(c.M)(),increment:e=>Object(c.t)(e)};var T=Object.freeze({__proto__:null,initStandalone:function({app:e,url:t,version:n,customAuthImpl:r,customAppCheckImpl:l,namespace:h,nodeAdmin:d=!1}){Object(c.f)(n);const f=new o.b("database-standalone"),m=new o.c("auth-internal",f);let y;return m.setComponent(new o.a("auth-internal",(()=>r),"PRIVATE")),l&&(y=new o.c("app-check-internal",f),y.setComponent(new o.a("app-check-internal",(()=>l),"PRIVATE"))),{instance:new I(Object(c.e)(e,m,y,t,d),e),namespace:h}}});const E=I.ServerValue;var C;(C=r.a).INTERNAL.registerComponent(new o.a("database-compat",((e,{instanceIdentifier:t})=>{const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("database").getImmediate({identifier:t});return new I(r,n)}),"PUBLIC").setServiceProps({Reference:v,Query:_,Database:I,DataSnapshot:w,enableLogging:c.k,INTERNAL:T,ServerValue:E}).setMultipleInstances(!0)),C.registerVersion("@firebase/database-compat","1.0.3")},333:function(e,t,n){"use strict";(function(e){var t=n(313),r=n(351),o=n(311),c=n(310);function l(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function h(e=Object(c.x)()){return!("file:"!==l()&&"ionic:"!==l()&&"capacitor:"!==l()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function d(e=Object(c.x)()){return Object(c.C)()&&11===(null===document||void 0===document?void 0:document.documentMode)||function(e=Object(c.x)()){return/Edge\/\d+/.test(e)}(e)}function f(){try{const e=self.localStorage,t=r.s();if(e)return e.setItem(t,"1"),e.removeItem(t),!d()||Object(c.D)()}catch(e){return m()&&Object(c.D)()}return!1}function m(){return void 0!==e&&"WorkerGlobalScope"in e&&"importScripts"in e}function y(){return("http:"===l()||"https:"===l()||Object(c.A)()||h())&&!(Object(c.H)()||Object(c.F)())&&f()&&!m()}function w(){return h()&&"undefined"!=typeof document}const _={LOCAL:"local",NONE:"none",SESSION:"session"},v=r.p,I="persistence";async function T(e){await e._initializationPromise;const t=E(),n=r.w(I,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function E(){var e;try{return(null===(e="undefined"!=typeof window?window:null)||void 0===e?void 0:e.sessionStorage)||null}catch(e){return null}}const C=r.p;class S{constructor(){this.browserResolver=r.t(r.A),this.cordovaResolver=r.t(r.F),this.underlyingResolver=null,this._redirectPersistence=r.B,this._completeRedirectFn=r.u,this._overrideRedirectResult=r.v}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return w()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return C(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await async function(){return!!w()&&new Promise((e=>{const t=setTimeout((()=>{e(!1)}),1e3);document.addEventListener("deviceready",(()=>{clearTimeout(t),e(!0)}))}))}();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function k(object){return object.unwrap()}function O(object){const{_tokenResponse:e}=object instanceof c.c?object.customData:object;if(!e)return null;if(!(object instanceof c.c)&&"temporaryProof"in e&&"phoneNumber"in e)return r.i.credentialFromResult(object);const t=e.providerId;if(!t||t===r.k.PASSWORD)return null;let n;switch(t){case r.k.GOOGLE:n=r.f;break;case r.k.FACEBOOK:n=r.d;break;case r.k.GITHUB:n=r.e;break;case r.k.TWITTER:n=r.o;break;default:const{oauthIdToken:o,oauthAccessToken:c,oauthTokenSecret:l,pendingToken:h,nonce:d}=e;return c||l||o||h?h?t.startsWith("saml.")?r.m._create(t,h):r.g._fromParams({providerId:t,signInMethod:t,pendingToken:h,idToken:o,accessToken:c}):new r.h(t).credential({idToken:o,accessToken:c,rawNonce:d}):null}return object instanceof c.c?n.credentialFromError(object):n.credentialFromResult(object)}function A(e,t){return t.catch((t=>{throw t instanceof c.c&&function(e,t){var n;const o=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===(null==t?void 0:t.code))t.resolver=new N(e,r.K(e,t));else if(o){const e=O(t),n=t;e&&(n.credential=e,n.tenantId=o.tenantId||void 0,n.email=o.email||void 0,n.phoneNumber=o.phoneNumber||void 0)}}(e,t),t})).then((e=>{const t=e.operationType,n=e.user;return{operationType:t,credential:(o=e,O(o)),additionalUserInfo:r.J(e),user:R.getOrCreate(n)};var o}))}async function x(e,t){const n=await t;return{verificationId:n.verificationId,confirm:t=>A(e,n.confirm(t))}}class N{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return A(k(this.auth),this.resolver.resolveSignIn(e))}}class R{constructor(e){this._delegate=e,this.multiFactor=r.T(e)}static getOrCreate(e){return R.USER_MAP.has(e)||R.USER_MAP.set(e,new R(e)),R.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return A(this.auth,r.P(this._delegate,e))}async linkWithPhoneNumber(e,t){return x(this.auth,r.Q(this._delegate,e,t))}async linkWithPopup(e){return A(this.auth,r.R(this._delegate,e,S))}async linkWithRedirect(e){return await T(r.q(this.auth)),r.S(this._delegate,e,S)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return A(this.auth,r.U(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return x(this.auth,r.V(this._delegate,e,t))}reauthenticateWithPopup(e){return A(this.auth,r.W(this._delegate,e,S))}async reauthenticateWithRedirect(e){return await T(r.q(this.auth)),r.X(this._delegate,e,S)}sendEmailVerification(e){return r.Y(this._delegate,e)}async unlink(e){return await r.jb(this._delegate,e),this}updateEmail(e){return r.kb(this._delegate,e)}updatePassword(e){return r.lb(this._delegate,e)}updatePhoneNumber(e){return r.mb(this._delegate,e)}updateProfile(e){return r.nb(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return r.ob(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}R.USER_MAP=new WeakMap;const P=r.p;class D{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:n}=e.options;P(n,"invalid-api-key",{appName:e.name}),P(n,"invalid-api-key",{appName:e.name});const o="undefined"!=typeof window?S:void 0;this._delegate=t.initialize({options:{persistence:M(n,e.name),popupRedirectResolver:o}}),this._delegate._updateErrorMap(r.H),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?R.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){r.E(this._delegate,e,t)}applyActionCode(code){return r.y(this._delegate,code)}checkActionCode(code){return r.C(this._delegate,code)}confirmPasswordReset(code,e){return r.D(this._delegate,code,e)}async createUserWithEmailAndPassword(e,t){return A(this._delegate,r.G(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return r.I(this._delegate,e)}isSignInWithEmailLink(e){return r.O(this._delegate,e)}async getRedirectResult(){P(y(),this._delegate,"operation-not-supported-in-this-environment");const e=await r.L(this._delegate,S);return e?A(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){r.x(this._delegate,e)}onAuthStateChanged(e,t,n){const{next:r,error:o,complete:c}=L(e,t,n);return this._delegate.onAuthStateChanged(r,o,c)}onIdTokenChanged(e,t,n){const{next:r,error:o,complete:c}=L(e,t,n);return this._delegate.onIdTokenChanged(r,o,c)}sendSignInLinkToEmail(e,t){return r.ab(this._delegate,e,t)}sendPasswordResetEmail(e,t){return r.Z(this._delegate,e,t||void 0)}async setPersistence(e){let t;switch(function(e,t){v(Object.values(_).includes(t),e,"invalid-persistence-type"),Object(c.H)()?v(t!==_.SESSION,e,"unsupported-persistence-type"):Object(c.F)()?v(t===_.NONE,e,"unsupported-persistence-type"):m()?v(t===_.NONE||t===_.LOCAL&&Object(c.D)(),e,"unsupported-persistence-type"):v(t===_.NONE||f(),e,"unsupported-persistence-type")}(this._delegate,e),e){case _.SESSION:t=r.B;break;case _.LOCAL:t=await r.t(r.N)._isAvailable()?r.N:r.z;break;case _.NONE:t=r.M;break;default:return r.r("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return A(this._delegate,r.bb(this._delegate))}signInWithCredential(e){return A(this._delegate,r.cb(this._delegate,e))}signInWithCustomToken(e){return A(this._delegate,r.db(this._delegate,e))}signInWithEmailAndPassword(e,t){return A(this._delegate,r.eb(this._delegate,e,t))}signInWithEmailLink(e,t){return A(this._delegate,r.fb(this._delegate,e,t))}signInWithPhoneNumber(e,t){return x(this._delegate,r.gb(this._delegate,e,t))}async signInWithPopup(e){return P(y(),this._delegate,"operation-not-supported-in-this-environment"),A(this._delegate,r.hb(this._delegate,e,S))}async signInWithRedirect(e){return P(y(),this._delegate,"operation-not-supported-in-this-environment"),await T(this._delegate),r.ib(this._delegate,e,S)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(code){return r.pb(this._delegate,code)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function L(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const o=r;return{next:e=>o(e&&R.getOrCreate(e)),error:t,complete:n}}function M(e,t){const n=function(e,t){const n=E();if(!n)return[];const o=r.w(I,e,t);switch(n.getItem(o)){case _.NONE:return[r.M];case _.LOCAL:return[r.N,r.B];case _.SESSION:return[r.B];default:return[]}}(e,t);if("undefined"==typeof self||n.includes(r.N)||n.push(r.N),"undefined"!=typeof window)for(const e of[r.z,r.B])n.includes(e)||n.push(e);return n.includes(r.M)||n.push(r.M),n}D.Persistence=_;class j{constructor(){this.providerId="phone",this._delegate=new r.i(k(t.a.auth()))}static credential(e,t){return r.i.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}j.PHONE_SIGN_IN_METHOD=r.i.PHONE_SIGN_IN_METHOD,j.PROVIDER_ID=r.i.PROVIDER_ID;const F=r.p;class U{constructor(e,n,o=t.a.app()){var c;F(null===(c=o.options)||void 0===c?void 0:c.apiKey,"invalid-api-key",{appName:o.name}),this._delegate=new r.l(o.auth(),e,n),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}var V;(V=t.a).INTERNAL.registerComponent(new o.a("auth-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new D(t,n)}),"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:r.a.EMAIL_SIGNIN,PASSWORD_RESET:r.a.PASSWORD_RESET,RECOVER_EMAIL:r.a.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:r.a.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:r.a.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:r.a.VERIFY_EMAIL}},EmailAuthProvider:r.c,FacebookAuthProvider:r.d,GithubAuthProvider:r.e,GoogleAuthProvider:r.f,OAuthProvider:r.h,SAMLAuthProvider:r.n,PhoneAuthProvider:j,PhoneMultiFactorGenerator:r.j,RecaptchaVerifier:U,TwitterAuthProvider:r.o,Auth:D,AuthCredential:r.b,Error:c.c}).setInstantiationMode("LAZY").setMultipleInstances(!1)),V.registerVersion("@firebase/auth-compat","0.5.3")}).call(this,n(58))},334:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return ah})),n.d(t,"b",(function(){return su})),n.d(t,"c",(function(){return Kl})),n.d(t,"d",(function(){return Ll})),n.d(t,"e",(function(){return hh})),n.d(t,"f",(function(){return ou})),n.d(t,"g",(function(){return A})),n.d(t,"h",(function(){return cu})),n.d(t,"i",(function(){return dh})),n.d(t,"j",(function(){return fh})),n.d(t,"k",(function(){return K})),n.d(t,"l",(function(){return Rh})),n.d(t,"m",(function(){return Tt})),n.d(t,"n",(function(){return J})),n.d(t,"o",(function(){return Y})),n.d(t,"p",(function(){return Al})),n.d(t,"q",(function(){return S})),n.d(t,"r",(function(){return ft})),n.d(t,"s",(function(){return I})),n.d(t,"t",(function(){return Cl})),n.d(t,"u",(function(){return Sh})),n.d(t,"v",(function(){return Uh})),n.d(t,"w",(function(){return Fh})),n.d(t,"x",(function(){return Xl})),n.d(t,"y",(function(){return jl})),n.d(t,"z",(function(){return Fl})),n.d(t,"A",(function(){return Pl})),n.d(t,"B",(function(){return Ch})),n.d(t,"C",(function(){return Mh})),n.d(t,"D",(function(){return tu})),n.d(t,"E",(function(){return Ul})),n.d(t,"F",(function(){return Ql})),n.d(t,"G",(function(){return Yl})),n.d(t,"H",(function(){return eu})),n.d(t,"I",(function(){return nh})),n.d(t,"J",(function(){return eh})),n.d(t,"K",(function(){return Hl})),n.d(t,"L",(function(){return Ah})),n.d(t,"M",(function(){return gh})),n.d(t,"N",(function(){return wh})),n.d(t,"O",(function(){return _h})),n.d(t,"P",(function(){return vh})),n.d(t,"Q",(function(){return bh})),n.d(t,"R",(function(){return Ih})),n.d(t,"S",(function(){return Vh})),n.d(t,"T",(function(){return $u})),n.d(t,"U",(function(){return Qu})),n.d(t,"V",(function(){return nu})),n.d(t,"W",(function(){return ru})),n.d(t,"X",(function(){return kh})),n.d(t,"Y",(function(){return Oh})),n.d(t,"Z",(function(){return Gu})),n.d(t,"ab",(function(){return qu})),n.d(t,"bb",(function(){return ql})),n.d(t,"cb",(function(){return Vl})),n.d(t,"db",(function(){return Lh})),n.d(t,"eb",(function(){return jh})),n.d(t,"fb",(function(){return Th})),n.d(t,"gb",(function(){return w})),n.d(t,"hb",(function(){return mh})),n.d(t,"ib",(function(){return Xu})),n.d(t,"jb",(function(){return Ju})),n.d(t,"kb",(function(){return Eh})),n.d(t,"lb",(function(){return Zl})),n.d(t,"mb",(function(){return zu}));var r=n(315),o=n(311),c=n(314),l=n(310),h=n(335);const d="@firebase/firestore";class f{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}f.UNAUTHENTICATED=new f(null),f.GOOGLE_CREDENTIALS=new f("google-credentials-uid"),f.FIRST_PARTY=new f("first-party-uid"),f.MOCK_USER=new f("mock-user");let m="10.8.1";const b=new c.b("@firebase/firestore");function y(){return b.logLevel}function w(e){b.setLogLevel(e)}function _(e,...t){if(b.logLevel<=c.a.DEBUG){const n=t.map(T);b.debug(`Firestore (${m}): ${e}`,...n)}}function v(e,...t){if(b.logLevel<=c.a.ERROR){const n=t.map(T);b.error(`Firestore (${m}): ${e}`,...n)}}function I(e,...t){if(b.logLevel<=c.a.WARN){const n=t.map(T);b.warn(`Firestore (${m}): ${e}`,...n)}}function T(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function E(e="Unexpected state"){const t=`FIRESTORE (${m}) INTERNAL ASSERTION FAILED: `+e;throw v(t),new Error(t)}function C(e,t){e||E()}function S(e,t){e||E()}function k(e,t){return e}const O={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class A extends l.c{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class x{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class N{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class R{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(f.UNAUTHENTICATED)))}shutdown(){}}class P{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class D{constructor(e){this.t=e,this.currentUser=f.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let o=new x;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new x,e.enqueueRetryable((()=>r(this.currentUser)))};const c=()=>{const t=o;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},l=e=>{_("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),c()};this.t.onInit((e=>l(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?l(e):(_("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new x)}}),0),c()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(_("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(C("string"==typeof t.accessToken),new N(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return C(null===e||"string"==typeof e),new f(e)}}class L{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=f.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class M{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new L(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(f.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class j{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class F{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=e=>{null!=e.error&&_("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.R;return this.R=e.token,_("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{_("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):_("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(C("string"==typeof e.token),this.R=e.token,new j(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function U(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class V{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62);let n="";for(;n.length<20;){const r=U(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%62))}return n}}function B(e,t){return e<t?-1:e>t?1:0}function z(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function W(e){return e+"\0"}class K{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new A(O.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new A(O.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new A(O.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new A(O.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return K.fromMillis(Date.now())}static fromDate(e){return K.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new K(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?B(this.nanoseconds,e.nanoseconds):B(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class G{constructor(e){this.timestamp=e}static fromTimestamp(e){return new G(e)}static min(){return new G(new K(0,0))}static max(){return new G(new K(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class H{constructor(e,t,n){void 0===t?t=0:t>e.length&&E(),void 0===n?n=e.length-t:n>e.length-t&&E(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===H.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof H?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class $ extends H{construct(e,t,n){return new $(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new A(O.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new $(t)}static emptyPath(){return new $([])}}const Q=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Y extends H{construct(e,t,n){return new Y(e,t,n)}static isValidIdentifier(e){return Q.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Y.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Y(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const o=()=>{if(0===n.length)throw new A(O.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new A(O.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new A(O.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(i=!i,r++):"."!==t||i?(n+=t,r++):(o(),r++)}if(o(),i)throw new A(O.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Y(t)}static emptyPath(){return new Y([])}}class J{constructor(e){this.path=e}static fromPath(e){return new J($.fromString(e))}static fromName(e){return new J($.fromString(e).popFirst(5))}static empty(){return new J($.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===$.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return $.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new J(new $(e.slice()))}}class X{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function Z(e){return e.fields.find((e=>2===e.kind))}function ee(e){return e.fields.filter((e=>2!==e.kind))}X.UNKNOWN_ID=-1;class te{constructor(e,t){this.fieldPath=e,this.kind=t}}class ne{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ne(0,se.min())}}function re(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=G.fromTimestamp(1e9===r?new K(n+1,0):new K(n,r));return new se(i,J.empty(),t)}function ie(e){return new se(e.readTime,e.key,-1)}class se{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new se(G.min(),J.empty(),-1)}static max(){return new se(G.max(),J.empty(),-1)}}function oe(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=J.comparator(e.documentKey,t.documentKey),0!==n?n:B(e.largestBatchId,t.largestBatchId))}const ae="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ce{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function le(e){if(e.code!==O.FAILED_PRECONDITION||e.message!==ae)throw e;_("LocalStore","Unexpectedly lost primary lease")}class ue{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&E(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ue(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof ue?t:ue.resolve(t)}catch(e){return ue.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):ue.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):ue.reject(t)}static resolve(e){return new ue(((t,n)=>{t(e)}))}static reject(e){return new ue(((t,n)=>{n(e)}))}static waitFor(e){return new ue(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=ue.resolve(!1);for(const n of e)t=t.next((e=>e?ue.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new ue(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let c=0;c<i;c++){const a=c;t(e[a]).next((e=>{s[a]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new ue(((n,r)=>{const o=()=>{!0===e()?t().next((()=>{o()}),r):n()};o()}))}}class he{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new x,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new pe(e,t.error)):this.V.resolve()},this.transaction.onerror=t=>{const n=_e(t.target.error);this.V.reject(new pe(e,n))}}static open(e,t,n,r){try{return new he(t,e.transaction(r,n))}catch(e){throw new pe(t,e)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(_("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new ge(t)}}class de{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===de.S(Object(l.x)())&&v("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return _("SimpleDb","Removing database:",e),ye(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Object(l.D)())return!1;if(de.C())return!0;const e=Object(l.x)(),t=de.S(e),n=0<t&&t<10,r=de.v(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static C(){var t;return void 0!==e&&"YES"===(null===(t=e.__PRIVATE_env)||void 0===t?void 0:t.F)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static v(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(e){return this.db||(_("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new pe(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new A(O.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new A(O.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new pe(e,r))},r.onupgradeneeded=e=>{_("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.p.N(t,r.transaction,e.oldVersion,this.version).next((()=>{_("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.O(e);const t=he.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next((e=>(t.g(),e))).catch((e=>(t.abort(e),ue.reject(e)))).toPromise();return s.catch((()=>{})),await t.m,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(_("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class fe{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return ye(this.k.delete())}}class pe extends A{constructor(e,t){super(O.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function me(e){return"IndexedDbTransactionError"===e.name}class ge{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(_("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(_("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),ye(n)}add(e){return _("SimpleDb","ADD",this.store.name,e,e),ye(this.store.add(e))}get(e){return ye(this.store.get(e)).next((t=>(void 0===t&&(t=null),_("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return _("SimpleDb","DELETE",this.store.name,e),ye(this.store.delete(e))}count(){return _("SimpleDb","COUNT",this.store.name),ye(this.store.count())}W(e,t){const n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const e=r.getAll(n.range);return new ue(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}{const e=this.cursor(n),t=[];return this.G(e,((e,n)=>{t.push(n)})).next((()=>t))}}j(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new ue(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}H(e,t){_("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.J=!1;const r=this.cursor(n);return this.G(r,((e,t,n)=>n.delete()))}Y(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.G(r,t)}Z(e){const t=this.cursor({});return new ue(((n,r)=>{t.onerror=e=>{const t=_e(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}G(e,t){const n=[];return new ue(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new fe(i),o=t(i.primaryKey,i.value,s);if(o instanceof ue){const e=o.catch((e=>(s.done(),ue.reject(e))));n.push(e)}s.isDone?r():null===s.$?i.continue():i.continue(s.$)}})).next((()=>ue.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.J?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ye(e){return new ue(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=_e(e.target.error);n(t)}}))}let we=!1;function _e(e){const t=de.S(Object(l.x)());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new A("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return we||(we=!0,setTimeout((()=>{throw e}),0)),e}}return e}class ve{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ee(e){_("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{_("IndexBackfiller",`Documents written: ${await this.X.te()}`)}catch(e){me(e)?_("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):await le(e)}await this.ee(6e4)}))}}class be{constructor(e,t){this.localStore=e,this.persistence=t}async te(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.ne(t,e)))}ne(e,t){const n=new Set;let r=t,i=!0;return ue.doWhile((()=>!0===i&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>{if(null!==t&&!n.has(t))return _("IndexBackfiller",`Processing collection: ${t}`),this.re(e,t,r).next((e=>{r-=e,n.add(t)}));i=!1})))).next((()=>t-r))}re(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next((n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next((()=>this.ie(r,n))).next((n=>(_("IndexBackfiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>i.size))}))))}ie(e,t){let n=e;return t.changes.forEach(((e,t)=>{const r=ie(t);oe(r,n)>0&&(n=r)})),new se(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class Ie{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.se(e),this.oe=e=>t.writeSequenceNumber(e))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.oe&&this.oe(e),e}}function Te(e){return null==e}function Ee(e){return 0===e&&1/e==-1/0}function Ce(e){return"number"==typeof e&&Number.isInteger(e)&&!Ee(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function Se(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Oe(t)),t=ke(e.get(n),t);return Oe(t)}function ke(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function Oe(e){return e+""}function Ae(e){const t=e.length;if(C(t>=2),2===t)return C(""===e.charAt(0)&&""===e.charAt(1)),$.emptyPath();const n=t-2,r=[];let o="";for(let i=0;i<t;){const t=e.indexOf("",i);switch((t<0||t>n)&&E(),e.charAt(t+1)){case"":const s=e.substring(i,t);let n;0===o.length?n=s:(o+=s,n=o,o=""),r.push(n);break;case"":o+=e.substring(i,t),o+="\0";break;case"":o+=e.substring(i,t+1);break;default:E()}i=t+2}return new $(r)}Ie._e=-1;const xe=["userId","batchId"];function Ne(e,t){return[e,Se(t)]}function Re(e,t,n){return[e,Se(t),n]}const Pe={},De=["prefixPath","collectionGroup","readTime","documentId"],Le=["prefixPath","collectionGroup","documentId"],Me=["collectionGroup","readTime","prefixPath","documentId"],je=["canonicalId","targetId"],Fe=["targetId","path"],q=["path","targetId"],Ue=["collectionId","parent"],Ve=["indexId","uid"],qe=["uid","sequenceNumber"],Be=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ze=["indexId","uid","orderedDocumentKey"],We=["userId","collectionPath","documentId"],Ke=["userId","collectionPath","largestBatchId"],Ge=["userId","collectionGroup","largestBatchId"],He=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],$e=[...He,"documentOverlays"],Qe=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Ye=Qe,Je=[...Ye,"indexConfiguration","indexState","indexEntries"];class Xe extends ce{constructor(e,t){super(),this.ae=e,this.currentSequenceNumber=t}}function Ze(e,t){const n=k(e);return de.M(n.ae,t)}function et(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function tt(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function nt(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class it{constructor(e,t){this.comparator=e,this.root=t||ot.EMPTY}insert(e,t){return new it(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ot.BLACK,null,null))}remove(e){return new it(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ot.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new st(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new st(this.root,e,this.comparator,!1)}getReverseIterator(){return new st(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new st(this.root,e,this.comparator,!0)}}class st{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ot{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:ot.RED,this.left=null!=r?r:ot.EMPTY,this.right=null!=i?i:ot.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new ot(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return ot.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return ot.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ot.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ot.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw E();if(this.right.isRed())throw E();const e=this.left.check();if(e!==this.right.check())throw E();return e+(this.isRed()?0:1)}}ot.EMPTY=null,ot.RED=!0,ot.BLACK=!1,ot.EMPTY=new class{constructor(){this.size=0}get key(){throw E()}get value(){throw E()}get color(){throw E()}get left(){throw E()}get right(){throw E()}copy(e,t,n,r,i){return this}insert(e,t,n){return new ot(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class at{constructor(e){this.comparator=e,this.data=new it(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ct(this.data.getIterator())}getIteratorFrom(e){return new ct(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof at))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new at(this.comparator);return t.data=e,t}}class ct{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function lt(e){return e.hasNext()?e.getNext():void 0}class ut{constructor(e){this.fields=e,e.sort(Y.comparator)}static empty(){return new ut([])}unionWith(e){let t=new at(Y.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new ut(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return z(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class ht extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function ft(){return"undefined"!=typeof atob}class pt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new ht("Invalid base64 string: "+e):e}}(e);return new pt(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new pt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return B(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}pt.EMPTY_BYTE_STRING=new pt("");const mt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function gt(e){if(C(!!e),"string"==typeof e){let t=0;const n=mt.exec(e);if(C(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:yt(e.seconds),nanos:yt(e.nanos)}}function yt(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function wt(e){return"string"==typeof e?pt.fromBase64String(e):pt.fromUint8Array(e)}function _t(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function vt(e){const t=e.mapValue.fields.__previous_value__;return _t(t)?vt(t):t}function bt(e){const t=gt(e.mapValue.fields.__local_write_time__.timestampValue);return new K(t.seconds,t.nanos)}class It{constructor(e,t,n,r,i,s,o,c,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=c,this.useFetchStreams=a}}class Tt{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Tt("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Tt&&e.projectId===this.projectId&&e.database===this.database}}const Et={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ct={nullValue:"NULL_VALUE"};function St(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?_t(e)?4:Vt(e)?9007199254740991:10:E()}function kt(e,t){if(e===t)return!0;const n=St(e);if(n!==St(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return bt(e).isEqual(bt(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=gt(e.timestampValue),r=gt(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return wt(e.bytesValue).isEqual(wt(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return yt(e.geoPointValue.latitude)===yt(t.geoPointValue.latitude)&&yt(e.geoPointValue.longitude)===yt(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return yt(e.integerValue)===yt(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=yt(e.doubleValue),r=yt(t.doubleValue);return n===r?Ee(n)===Ee(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return z(e.arrayValue.values||[],t.arrayValue.values||[],kt);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(et(n)!==et(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!kt(n[e],r[e])))return!1;return!0}(e,t);default:return E()}}function Ot(e,t){return void 0!==(e.values||[]).find((e=>kt(e,t)))}function At(e,t){if(e===t)return 0;const n=St(e),r=St(t);if(n!==r)return B(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return B(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=yt(e.integerValue||e.doubleValue),r=yt(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return xt(e.timestampValue,t.timestampValue);case 4:return xt(bt(e),bt(t));case 5:return B(e.stringValue,t.stringValue);case 6:return function(e,t){const n=wt(e),r=wt(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=B(n[e],r[e]);if(0!==t)return t}return B(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=B(yt(e.latitude),yt(t.latitude));return 0!==n?n:B(yt(e.longitude),yt(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=At(n[e],r[e]);if(t)return t}return B(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Et.mapValue&&t===Et.mapValue)return 0;if(e===Et.mapValue)return 1;if(t===Et.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=B(r[e],s[e]);if(0!==t)return t;const o=At(n[r[e]],i[s[e]]);if(0!==o)return o}return B(r.length,s.length)}(e.mapValue,t.mapValue);default:throw E()}}function xt(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return B(e,t);const n=gt(e),r=gt(t),i=B(n.seconds,r.seconds);return 0!==i?i:B(n.nanos,r.nanos)}function Nt(e){return Rt(e)}function Rt(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=gt(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return wt(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return J.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Rt(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${Rt(e.fields[i])}`;return n+"}"}(e.mapValue):E()}function Pt(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Dt(e){return!!e&&"integerValue"in e}function Lt(e){return!!e&&"arrayValue"in e}function Mt(e){return!!e&&"nullValue"in e}function jt(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Ft(e){return!!e&&"mapValue"in e}function Ut(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return tt(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Ut(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Ut(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Vt(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function qt(e){return"nullValue"in e?Ct:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?Pt(Tt.empty(),J.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:E()}function Bt(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?Pt(Tt.empty(),J.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?Et:E()}function zt(e,t){const n=At(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Wt(e,t){const n=At(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Kt{constructor(e){this.value=e}static empty(){return new Kt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Ft(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ut(t)}setAll(e){let t=Y.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Ut(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Ft(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return kt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Ft(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){tt(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new Kt(Ut(this.value))}}function Gt(e){const t=[];return tt(e.fields,((e,n)=>{const r=new Y([e]);if(Ft(n)){const e=Gt(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new ut(t)}class Ht{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new Ht(e,0,G.min(),G.min(),G.min(),Kt.empty(),0)}static newFoundDocument(e,t,n,r){return new Ht(e,1,t,G.min(),n,r,0)}static newNoDocument(e,t){return new Ht(e,2,t,G.min(),G.min(),Kt.empty(),0)}static newUnknownDocument(e,t){return new Ht(e,3,t,G.min(),G.min(),Kt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(G.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Kt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Kt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=G.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Ht&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ht(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class $t{constructor(e,t){this.position=e,this.inclusive=t}}function Qt(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?J.comparator(J.fromName(o.referenceValue),n.key):At(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function Yt(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!kt(e.position[n],t.position[n]))return!1;return!0}class Jt{constructor(e,t="asc"){this.field=e,this.dir=t}}function Xt(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Zt{}class en extends Zt{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new hn(e,t,n):"array-contains"===t?new mn(e,n):"in"===t?new gn(e,n):"not-in"===t?new yn(e,n):"array-contains-any"===t?new wn(e,n):new en(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new dn(e,n):new fn(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(At(t,this.value)):null!==t&&St(this.value)===St(t)&&this.matchesComparison(At(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return E()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class tn extends Zt{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new tn(e,t)}matches(e){return nn(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function nn(e){return"and"===e.op}function rn(e){return"or"===e.op}function sn(e){return on(e)&&nn(e)}function on(e){for(const t of e.filters)if(t instanceof tn)return!1;return!0}function an(e){if(e instanceof en)return e.field.canonicalString()+e.op.toString()+Nt(e.value);if(sn(e))return e.filters.map((e=>an(e))).join(",");{const t=e.filters.map((e=>an(e))).join(",");return`${e.op}(${t})`}}function cn(e,t){return e instanceof en?function(e,t){return t instanceof en&&e.op===t.op&&e.field.isEqual(t.field)&&kt(e.value,t.value)}(e,t):e instanceof tn?function(e,t){return t instanceof tn&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&cn(n,t.filters[r])),!0)}(e,t):void E()}function ln(e,t){const n=e.filters.concat(t);return tn.create(n,e.op)}function un(e){return e instanceof en?function(e){return`${e.field.canonicalString()} ${e.op} ${Nt(e.value)}`}(e):e instanceof tn?function(e){return e.op.toString()+" {"+e.getFilters().map(un).join(" ,")+"}"}(e):"Filter"}class hn extends en{constructor(e,t,n){super(e,t,n),this.key=J.fromName(n.referenceValue)}matches(e){const t=J.comparator(e.key,this.key);return this.matchesComparison(t)}}class dn extends en{constructor(e,t){super(e,"in",t),this.keys=pn("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class fn extends en{constructor(e,t){super(e,"not-in",t),this.keys=pn("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function pn(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>J.fromName(e.referenceValue)))}class mn extends en{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Lt(t)&&Ot(t.arrayValue,this.value)}}class gn extends en{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Ot(this.value.arrayValue,t)}}class yn extends en{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ot(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Ot(this.value.arrayValue,t)}}class wn extends en{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Lt(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Ot(this.value.arrayValue,e)))}}class _n{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ce=null}}function vn(e,t=null,n=[],r=[],i=null,s=null,o=null){return new _n(e,t,n,r,i,s,o)}function bn(e){const t=k(e);if(null===t.ce){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>an(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Te(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Nt(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Nt(e))).join(",")),t.ce=e}return t.ce}function In(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Xt(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!cn(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Yt(e.startAt,t.startAt)&&Yt(e.endAt,t.endAt)}function Tn(e){return J.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function En(e,t){return e.filters.filter((e=>e instanceof en&&e.field.isEqual(t)))}function Cn(e,t,n){let r=Ct,i=!0;for(const n of En(e,t)){let e=Ct,t=!0;switch(n.op){case"<":case"<=":e=qt(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=Ct}zt({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];zt({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function Sn(e,t,n){let r=Et,i=!0;for(const n of En(e,t)){let e=Et,t=!0;switch(n.op){case">=":case">":e=Bt(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=Et}Wt({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Wt({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class kn{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=c,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function On(e,t,n,r,i,s,o,c){return new kn(e,t,n,r,i,s,o,c)}function An(e){return new kn(e)}function xn(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Nn(e){return null!==e.collectionGroup}function Rn(e){const t=k(e);if(null===t.le){t.le=[];const e=new Set;for(const n of t.explicitOrderBy)t.le.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new at(Y.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);r.forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.le.push(new Jt(r,n))})),e.has(Y.keyField().canonicalString())||t.le.push(new Jt(Y.keyField(),n))}return t.le}function Pn(e){const t=k(e);return t.he||(t.he=Dn(t,Rn(e))),t.he}function Dn(e,t){if("F"===e.limitType)return vn(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new Jt(e.field,t)}));const n=e.endAt?new $t(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new $t(e.startAt.position,e.startAt.inclusive):null;return vn(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function Ln(e,t){const n=e.filters.concat([t]);return new kn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Mn(e,t,n){return new kn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function jn(e,t){return In(Pn(e),Pn(t))&&e.limitType===t.limitType}function Fn(e){return`${bn(Pn(e))}|lt:${e.limitType}`}function Un(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>un(e))).join(", ")}]`),Te(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Nt(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Nt(e))).join(",")),`Target(${t})`}(Pn(e))}; limitType=${e.limitType})`}function Vn(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):J.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Rn(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=Qt(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Rn(e),t))&&!(e.endAt&&!function(e,t,n){const r=Qt(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Rn(e),t))}(e,t)}function qn(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Bn(e){return(t,n)=>{let r=!1;for(const i of Rn(e)){const e=zn(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function zn(e,t,n){const r=e.field.isKeyField()?J.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?At(r,i):E()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return E()}}class Wn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){tt(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return nt(this.inner)}size(){return this.innerSize}}const Kn=new it(J.comparator);function Gn(){return Kn}const Hn=new it(J.comparator);function $n(...e){let t=Hn;for(const n of e)t=t.insert(n.key,n);return t}function Qn(e){let t=Hn;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Yn(){return Xn()}function Jn(){return Xn()}function Xn(){return new Wn((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Zn=new it(J.comparator),er=new at(J.comparator);function nr(...e){let t=er;for(const n of e)t=t.add(n);return t}const rr=new at(B);function ir(){return rr}function sr(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ee(t)?"-0":t}}function or(e){return{integerValue:""+e}}function ar(e,t){return Ce(t)?or(t):sr(e,t)}class cr{constructor(){this._=void 0}}function lr(e,t,n){return e instanceof fr?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&_t(t)&&(t=vt(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof pr?mr(e,t):e instanceof gr?yr(e,t):function(e,t){const n=dr(e,t),r=_r(n)+_r(e.Ie);return Dt(n)&&Dt(e.Ie)?or(r):sr(e.serializer,r)}(e,t)}function ur(e,t,n){return e instanceof pr?mr(e,t):e instanceof gr?yr(e,t):n}function dr(e,t){return e instanceof wr?function(e){return Dt(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class fr extends cr{}class pr extends cr{constructor(e){super(),this.elements=e}}function mr(e,t){const n=vr(t);for(const t of e.elements)n.some((e=>kt(e,t)))||n.push(t);return{arrayValue:{values:n}}}class gr extends cr{constructor(e){super(),this.elements=e}}function yr(e,t){let n=vr(t);for(const t of e.elements)n=n.filter((e=>!kt(e,t)));return{arrayValue:{values:n}}}class wr extends cr{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function _r(e){return yt(e.integerValue||e.doubleValue)}function vr(e){return Lt(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Ir{constructor(e,t){this.field=e,this.transform=t}}class Tr{constructor(e,t){this.version=e,this.transformResults=t}}class Er{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Er}static exists(e){return new Er(void 0,e)}static updateTime(e){return new Er(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Cr(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Sr{}function kr(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new jr(e.key,Er.none()):new Rr(e.key,e.data,Er.none());{const n=e.data,r=Kt.empty();let i=new at(Y.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Pr(e.key,r,new ut(i.toArray()),Er.none())}}function Or(e,t,n){e instanceof Rr?function(e,t,n){const r=e.value.clone(),i=Lr(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Pr?function(e,t,n){if(!Cr(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Lr(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Dr(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Ar(e,t,n,r){return e instanceof Rr?function(e,t,n,r){if(!Cr(e.precondition,t))return n;const i=e.value.clone(),s=Mr(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Pr?function(e,t,n,r){if(!Cr(e.precondition,t))return n;const i=Mr(e.fieldTransforms,r,t),s=t.data;return s.setAll(Dr(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return Cr(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function xr(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=dr(r.transform,e||null);null!=i&&(null===n&&(n=Kt.empty()),n.set(r.field,i))}return n||null}function Nr(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&z(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof pr&&t instanceof pr||e instanceof gr&&t instanceof gr?z(e.elements,t.elements,kt):e instanceof wr&&t instanceof wr?kt(e.Ie,t.Ie):e instanceof fr&&t instanceof fr}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Rr extends Sr{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Pr extends Sr{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Dr(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function Lr(e,t,n){const r=new Map;C(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,c=t.data.field(s.field);r.set(s.field,ur(o,c,n[i]))}return r}function Mr(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,lr(e,s,t))}return r}class jr extends Sr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Fr extends Sr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Ur{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Or(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Ar(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Ar(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Jn();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const c=kr(s,o);null!==c&&n.set(r.key,c),s.isValidDocument()||s.convertToNoDocument(G.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),nr())}isEqual(e){return this.batchId===e.batchId&&z(this.mutations,e.mutations,((e,t)=>Nr(e,t)))&&z(this.baseMutations,e.baseMutations,((e,t)=>Nr(e,t)))}}class Vr{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){C(e.mutations.length===n.length);let r=Zn;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new Vr(e,t,n,r)}}class qr{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Br{constructor(e,t){this.count=e,this.unchangedNames=t}}var zr,Wr;function Kr(e){switch(e){default:return E();case O.CANCELLED:case O.UNKNOWN:case O.DEADLINE_EXCEEDED:case O.RESOURCE_EXHAUSTED:case O.INTERNAL:case O.UNAVAILABLE:case O.UNAUTHENTICATED:return!1;case O.INVALID_ARGUMENT:case O.NOT_FOUND:case O.ALREADY_EXISTS:case O.PERMISSION_DENIED:case O.FAILED_PRECONDITION:case O.ABORTED:case O.OUT_OF_RANGE:case O.UNIMPLEMENTED:case O.DATA_LOSS:return!0}}function Gr(e){if(void 0===e)return v("GRPC error has no .code"),O.UNKNOWN;switch(e){case zr.OK:return O.OK;case zr.CANCELLED:return O.CANCELLED;case zr.UNKNOWN:return O.UNKNOWN;case zr.DEADLINE_EXCEEDED:return O.DEADLINE_EXCEEDED;case zr.RESOURCE_EXHAUSTED:return O.RESOURCE_EXHAUSTED;case zr.INTERNAL:return O.INTERNAL;case zr.UNAVAILABLE:return O.UNAVAILABLE;case zr.UNAUTHENTICATED:return O.UNAUTHENTICATED;case zr.INVALID_ARGUMENT:return O.INVALID_ARGUMENT;case zr.NOT_FOUND:return O.NOT_FOUND;case zr.ALREADY_EXISTS:return O.ALREADY_EXISTS;case zr.PERMISSION_DENIED:return O.PERMISSION_DENIED;case zr.FAILED_PRECONDITION:return O.FAILED_PRECONDITION;case zr.ABORTED:return O.ABORTED;case zr.OUT_OF_RANGE:return O.OUT_OF_RANGE;case zr.UNIMPLEMENTED:return O.UNIMPLEMENTED;case zr.DATA_LOSS:return O.DATA_LOSS;default:return E()}}(Wr=zr||(zr={}))[Wr.OK=0]="OK",Wr[Wr.CANCELLED=1]="CANCELLED",Wr[Wr.UNKNOWN=2]="UNKNOWN",Wr[Wr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Wr[Wr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Wr[Wr.NOT_FOUND=5]="NOT_FOUND",Wr[Wr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Wr[Wr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Wr[Wr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Wr[Wr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Wr[Wr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Wr[Wr.ABORTED=10]="ABORTED",Wr[Wr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Wr[Wr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Wr[Wr.INTERNAL=13]="INTERNAL",Wr[Wr.UNAVAILABLE=14]="UNAVAILABLE",Wr[Wr.DATA_LOSS=15]="DATA_LOSS";let Hr=null;function $r(){return new TextEncoder}const Qr=new h.d([4294967295,4294967295],0);function Yr(e){const t=$r().encode(e),n=new h.e;return n.update(t),new Uint8Array(n.digest())}function Jr(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new h.d([n,r],0),new h.d([i,s],0)]}class Xr{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Zr(`Invalid padding: ${t}`);if(n<0)throw new Zr(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Zr(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Zr(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=h.d.fromNumber(this.Te)}de(e,t,n){let r=e.add(t.multiply(h.d.fromNumber(n)));return 1===r.compare(Qr)&&(r=new h.d([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;const t=Yr(e),[n,r]=Jr(t);for(let e=0;e<this.hashCount;e++){const t=this.de(n,r,e);if(!this.Ae(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new Xr(i,r,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.Te)return;const t=Yr(e),[n,r]=Jr(t);for(let e=0;e<this.hashCount;e++){const t=this.de(n,r,e);this.Re(t)}}Re(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Zr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ei{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,ti.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new ei(G.min(),r,new it(B),Gn(),nr())}}class ti{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new ti(n,t,nr(),nr(),nr())}}class ni{constructor(e,t,n,r){this.Ve=e,this.removedTargetIds=t,this.key=n,this.me=r}}class ri{constructor(e,t){this.targetId=e,this.fe=t}}class ii{constructor(e,t,n=pt.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class si{constructor(){this.ge=0,this.pe=ci(),this.ye=pt.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=nr(),t=nr(),n=nr();return this.pe.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:E()}})),new ti(this.ye,this.we,e,t,n)}Fe(){this.Se=!1,this.pe=ci()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,C(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class oi{constructor(e){this.Le=e,this.ke=new Map,this.qe=Gn(),this.Qe=ai(),this.Ke=new it(B)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,(t=>{const n=this.ze(t);switch(e.state){case 0:this.je(t)&&n.Ce(e.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(e.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(t);break;case 3:this.je(t)&&(n.Be(),n.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),n.Ce(e.resumeToken));break;default:E()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach(((e,n)=>{this.je(n)&&t(n)}))}Je(e){const t=e.targetId,n=e.fe.count,r=this.Ye(t);if(r){const i=r.target;if(Tn(i))if(0===n){const e=new J(i.path);this.We(t,e,Ht.newNoDocument(e,G.min()))}else C(1===n);else{const r=this.Ze(t);if(r!==n){const n=this.Xe(e),i=n?this.et(n,e,r):1;if(0!==i){this.He(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,e)}null==Hr||Hr.tt(function(e,t,n,r,i){var s,o,c,a,u,l;const h={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},d=t.unchangedNames;return d&&(h.bloomFilter={applied:0===i,hashCount:null!==(s=null==d?void 0:d.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(a=null===(c=null===(o=null==d?void 0:d.bits)||void 0===o?void 0:o.bitmap)||void 0===c?void 0:c.length)&&void 0!==a?a:0,padding:null!==(l=null===(u=null==d?void 0:d.bits)||void 0===u?void 0:u.padding)&&void 0!==l?l:0,mightContain:e=>{var t;return null!==(t=null==r?void 0:r.mightContain(e))&&void 0!==t&&t}}),h}(r,e.fe,this.Le.nt(),n,i))}}}}Xe(e){const t=e.fe.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,o;try{s=wt(n).toUint8Array()}catch(e){if(e instanceof ht)return I("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new Xr(s,r,i)}catch(e){return I(e instanceof Zr?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.Te?null:o}et(e,t,n){return t.fe.count===n-this.rt(e,t.targetId)?0:2}rt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const i=this.Le.nt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.We(t,n,null),r++)})),r}it(e){const t=new Map;this.ke.forEach(((n,r)=>{const i=this.Ye(r);if(i){if(n.current&&Tn(i.target)){const t=new J(i.target.path);null!==this.qe.get(t)||this.st(r,t)||this.We(r,t,Ht.newNoDocument(t,e))}n.De&&(t.set(r,n.ve()),n.Fe())}}));let n=nr();this.Qe.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Ye(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.qe.forEach(((t,n)=>n.setReadTime(e)));const r=new ei(e,t,this.Ke,this.qe,n);return this.qe=Gn(),this.Qe=ai(),this.Ke=new it(B),r}Ue(e,t){if(!this.je(e))return;const n=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,n),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,n){if(!this.je(e))return;const r=this.ze(e);this.st(e,t)?r.Me(t,1):r.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),n&&(this.qe=this.qe.insert(t,n))}removeTarget(e){this.ke.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new si,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new at(B),this.Qe=this.Qe.insert(e,t)),t}je(e){const t=null!==this.Ye(e);return t||_("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.ke.get(e);return t&&t.be?null:this.Le._t(e)}He(e){this.ke.set(e,new si),this.Le.getRemoteKeysForTarget(e).forEach((t=>{this.We(e,t,null)}))}st(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function ai(){return new it(J.comparator)}function ci(){return new it(J.comparator)}const ui={asc:"ASCENDING",desc:"DESCENDING"},hi={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},di={and:"AND",or:"OR"};class fi{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function pi(e,t){return e.useProto3Json||Te(t)?t:{value:t}}function mi(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function gi(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function yi(e,t){return mi(e,t.toTimestamp())}function wi(e){return C(!!e),G.fromTimestamp(function(e){const t=gt(e);return new K(t.seconds,t.nanos)}(e))}function _i(e,t){return vi(e,t).canonicalString()}function vi(e,t){const n=function(e){return new $(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function bi(e){const t=$.fromString(e);return C(zi(t)),t}function Ii(e,t){return _i(e.databaseId,t.path)}function Ti(e,t){const n=bi(t);if(n.get(1)!==e.databaseId.projectId)throw new A(O.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new A(O.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new J(ki(n))}function Ei(e,t){return _i(e.databaseId,t)}function Ci(e){const t=bi(e);return 4===t.length?$.emptyPath():ki(t)}function Si(e){return new $(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function ki(e){return C(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Oi(e,t,n){return{name:Ii(e,t),fields:n.value.mapValue.fields}}function Ai(e,t,n){const r=Ti(e,t.name),i=wi(t.updateTime),s=t.createTime?wi(t.createTime):G.min(),o=new Kt({mapValue:{fields:t.fields}}),c=Ht.newFoundDocument(r,i,s,o);return n&&c.setHasCommittedMutations(),n?c.setHasCommittedMutations():c}function xi(e,t){let n;if(t instanceof Rr)n={update:Oi(e,t.key,t.value)};else if(t instanceof jr)n={delete:Ii(e,t.key)};else if(t instanceof Pr)n={update:Oi(e,t.key,t.data),updateMask:Bi(t.fieldMask)};else{if(!(t instanceof Fr))return E();n={verify:Ii(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof fr)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof pr)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof gr)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof wr)return{fieldPath:t.field.canonicalString(),increment:n.Ie};throw E()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:yi(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:E()}(e,t.precondition)),n}function Ni(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?Er.updateTime(wi(e.updateTime)):void 0!==e.exists?Er.exists(e.exists):Er.none()}(t.currentDocument):Er.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)C("REQUEST_TIME"===t.setToServerValue),n=new fr;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new pr(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new gr(e)}else"increment"in t?n=new wr(e,t.increment):E();const r=Y.fromServerFormat(t.fieldPath);return new Ir(r,n)}(e,t))):[];if(t.update){t.update.name;const i=Ti(e,t.update.name),s=new Kt({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new ut(t.map((e=>Y.fromServerFormat(e))))}(t.updateMask);return new Pr(i,s,e,n,r)}return new Rr(i,s,n,r)}if(t.delete){const r=Ti(e,t.delete);return new jr(r,n)}if(t.verify){const r=Ti(e,t.verify);return new Fr(r,n)}return E()}function Ri(e,t){return{documents:[Ei(e,t.path)]}}function Pi(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Ei(e,i);const s=function(e){if(0!==e.length)return qi(tn.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const o=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Ui(e.field),direction:Mi(e.dir)}}(e)))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const c=pi(e,t.limit);return null!==c&&(n.structuredQuery.limit=c),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ut:n,parent:i}}function Di(e){let t=Ci(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){C(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Li(e);return t instanceof tn&&sn(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map((e=>function(e){return new Jt(Vi(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let c=null;n.limit&&(c=function(e){let t;return t="object"==typeof e?e.value:e,Te(t)?null:t}(n.limit));let a=null;n.startAt&&(a=function(e){const t=!!e.before,n=e.values||[];return new $t(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new $t(n,t)}(n.endAt)),On(t,i,o,s,c,"F",a,u)}function Li(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Vi(e.unaryFilter.field);return en.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Vi(e.unaryFilter.field);return en.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Vi(e.unaryFilter.field);return en.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Vi(e.unaryFilter.field);return en.create(i,"!=",{nullValue:"NULL_VALUE"});default:return E()}}(e):void 0!==e.fieldFilter?function(e){return en.create(Vi(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return E()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return tn.create(e.compositeFilter.filters.map((e=>Li(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return E()}}(e.compositeFilter.op))}(e):E()}function Mi(e){return ui[e]}function ji(e){return hi[e]}function Fi(e){return di[e]}function Ui(e){return{fieldPath:e.canonicalString()}}function Vi(e){return Y.fromServerFormat(e.fieldPath)}function qi(e){return e instanceof en?function(e){if("=="===e.op){if(jt(e.value))return{unaryFilter:{field:Ui(e.field),op:"IS_NAN"}};if(Mt(e.value))return{unaryFilter:{field:Ui(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(jt(e.value))return{unaryFilter:{field:Ui(e.field),op:"IS_NOT_NAN"}};if(Mt(e.value))return{unaryFilter:{field:Ui(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ui(e.field),op:ji(e.op),value:e.value}}}(e):e instanceof tn?function(e){const t=e.getFilters().map((e=>qi(e)));return 1===t.length?t[0]:{compositeFilter:{op:Fi(e.op),filters:t}}}(e):E()}function Bi(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function zi(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Wi{constructor(e,t,n,r,i=G.min(),s=G.min(),o=pt.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=c}withSequenceNumber(e){return new Wi(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Wi(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Wi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Wi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Ki{constructor(e){this.ct=e}}function Gi(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Hi(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:Ii(e,t.key),fields:t.data.value.mapValue.fields,updateTime:mi(e,t.version.toTimestamp()),createTime:mi(e,t.createTime.toTimestamp())}}(e.ct,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:$i(t.version)};else{if(!t.isUnknownDocument())return E();r.unknownDocument={path:n.path.toArray(),version:$i(t.version)}}return r}function Hi(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function $i(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Qi(e){const t=new K(e.seconds,e.nanoseconds);return G.fromTimestamp(t)}function Yi(e,t){const n=(t.baseMutations||[]).map((t=>Ni(e.ct,t)));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const r=t.mutations.map((t=>Ni(e.ct,t))),i=K.fromMillis(t.localWriteTimeMs);return new Ur(t.batchId,i,n,r)}function Ji(e){const t=Qi(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Qi(e.lastLimboFreeSnapshotVersion):G.min();let r;return r=function(e){return void 0!==e.documents}(e.query)?function(e){return C(1===e.documents.length),Pn(An(Ci(e.documents[0])))}(e.query):function(e){return Pn(Di(e))}(e.query),new Wi(r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,pt.fromBase64String(e.resumeToken))}function Xi(e,t){const n=$i(t.snapshotVersion),r=$i(t.lastLimboFreeSnapshotVersion);let i;i=Tn(t.target)?Ri(e.ct,t.target):Pi(e.ct,t.target).ut;const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:bn(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Zi(e){const t=Di({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Mn(t,t.limit,"L"):t}function es(e,t){return new qr(t.largestBatchId,Ni(e.ct,t.overlayMutation))}function ts(e,t){const n=t.path.lastSegment();return[e,Se(t.path.popLast()),n]}function ns(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:$i(r.readTime),documentKey:Se(r.documentKey.path),largestBatchId:r.largestBatchId}}class rs{getBundleMetadata(e,t){return is(e).get(t).next((e=>{if(e)return function(e){return{id:e.bundleId,createTime:Qi(e.createTime),version:e.version}}(e)}))}saveBundleMetadata(e,t){return is(e).put(function(e){return{bundleId:e.id,createTime:$i(wi(e.createTime)),version:e.version}}(t))}getNamedQuery(e,t){return ss(e).get(t).next((e=>{if(e)return function(e){return{name:e.name,query:Zi(e.bundledQuery),readTime:Qi(e.readTime)}}(e)}))}saveNamedQuery(e,t){return ss(e).put(function(e){return{name:e.name,readTime:$i(wi(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function is(e){return Ze(e,"bundles")}function ss(e){return Ze(e,"namedQueries")}class os{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const n=t.uid||"";return new os(e,n)}getOverlay(e,t){return as(e).get(ts(this.userId,t)).next((e=>e?es(this.serializer,e):null))}getOverlays(e,t){const n=Yn();return ue.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const r=[];return n.forEach(((n,i)=>{const s=new qr(t,i);r.push(this.ht(e,s))})),ue.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((e=>r.add(Se(e.getCollectionPath()))));const i=[];return r.forEach((t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(as(e).H("collectionPathOverlayIndex",r))})),ue.waitFor(i)}getOverlaysForCollection(e,t,n){const r=Yn(),i=Se(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return as(e).W("collectionPathOverlayIndex",s).next((e=>{for(const t of e){const e=es(this.serializer,t);r.set(e.getKey(),e)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const i=Yn();let s;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return as(e).Y({index:"collectionGroupOverlayIndex",range:o},((e,t,n)=>{const o=es(this.serializer,t);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()})).next((()=>i))}ht(e,t){return as(e).put(function(e,t,n){const[r,i,s]=ts(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:xi(e.ct,n.mutation)}}(this.serializer,this.userId,t))}}function as(e){return Ze(e,"documentOverlays")}class cs{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(yt(e.integerValue));else if("doubleValue"in e){const n=yt(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),Ee(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){const n=e.timestampValue;this.Et(t,20),"string"==typeof n?t.At(n):(t.At(`${n.seconds||""}`),t.dt(n.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(wt(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?Vt(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):E()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const n=e.fields||{};this.Et(t,55);for(const e of Object.keys(n))this.Rt(e,t),this.It(n[e],t)}wt(e,t){const n=e.values||[];this.Et(t,50);for(const e of n)this.It(e,t)}gt(e,t){this.Et(t,37),J.fromName(e).path.forEach((e=>{this.Et(t,60),this.St(e,t)}))}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}function ls(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function us(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=ls(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}cs.bt=new cs;class hs{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ct(n.value),n=t.next();this.vt()}Ft(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Mt(n.value),n=t.next();this.xt()}Ot(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ct(e);else if(e<2048)this.Ct(960|e>>>6),this.Ct(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ct(480|e>>>12),this.Ct(128|63&e>>>6),this.Ct(128|63&e);else{const e=t.codePointAt(0);this.Ct(240|e>>>18),this.Ct(128|63&e>>>12),this.Ct(128|63&e>>>6),this.Ct(128|63&e)}}this.vt()}Nt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Mt(e);else if(e<2048)this.Mt(960|e>>>6),this.Mt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Mt(480|e>>>12),this.Mt(128|63&e>>>6),this.Mt(128|63&e);else{const e=t.codePointAt(0);this.Mt(240|e>>>18),this.Mt(128|63&e>>>12),this.Mt(128|63&e>>>6),this.Mt(128|63&e)}}this.xt()}Bt(e){const t=this.Lt(e),n=us(t);this.kt(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}qt(e){const t=this.Lt(e),n=us(t);this.kt(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Lt(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}Ct(e){const t=255&e;0===t?(this.Kt(0),this.Kt(255)):255===t?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){const t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class ds{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Bt(e)}Tt(){this.Gt.Qt()}}class fs{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}}class ps{constructor(){this.Gt=new hs,this.zt=new ds(this.Gt),this.jt=new fs(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return 0===e?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}}class ms{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Jt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new ms(this.indexId,this.documentKey,this.arrayValue,n)}}function gs(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=ys(e.arrayValue,t.arrayValue),0!==n?n:(n=ys(e.directionalValue,t.directionalValue),0!==n?n:J.comparator(e.documentKey,t.documentKey)))}function ys(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class ws{constructor(e){this.Yt=new at(((e,t)=>Y.comparator(e.field,t.field))),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];for(const t of e.filters){const e=t;e.isInequality()?this.Yt=this.Yt.add(e):this.Xt.push(e)}}get en(){return this.Yt.size>1}tn(e){if(C(e.collectionGroup===this.collectionId),this.en)return!1;const t=Z(e);if(void 0!==t&&!this.nn(t))return!1;const n=ee(e);let r=new Set,i=0,s=0;for(;i<n.length&&this.nn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Yt.size>0){const e=this.Yt.getIterator().getNext();if(!r.has(e.field.canonicalString())){const t=n[i];if(!this.rn(e,t)||!this.sn(this.Zt[s++],t))return!1}++i}for(;i<n.length;++i){const e=n[i];if(s>=this.Zt.length||!this.sn(this.Zt[s++],e))return!1}return!0}on(){if(this.en)return null;let e=new at(Y.comparator);const t=[];for(const n of this.Xt)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new te(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new te(n.field,0))}for(const n of this.Zt)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new te(n.field,"asc"===n.dir?0:1)));return new X(X.UNKNOWN_ID,this.collectionId,t,ne.empty())}nn(e){for(const t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function _s(e){var t,n;if(C(e instanceof en||e instanceof tn),e instanceof en){if(e instanceof gn){const r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((t=>en.create(e.field,"==",t))))||[];return tn.create(r,"or")}return e}const r=e.filters.map((e=>_s(e)));return tn.create(r,e.op)}function vs(e){if(0===e.getFilters().length)return[];const t=Es(_s(e));return C(Ts(t)),bs(t)||Is(t)?[t]:t.getFilters()}function bs(e){return e instanceof en}function Is(e){return e instanceof tn&&sn(e)}function Ts(e){return bs(e)||Is(e)||function(e){if(e instanceof tn&&rn(e)){for(const t of e.getFilters())if(!bs(t)&&!Is(t))return!1;return!0}return!1}(e)}function Es(e){if(C(e instanceof en||e instanceof tn),e instanceof en)return e;if(1===e.filters.length)return Es(e.filters[0]);const t=e.filters.map((e=>Es(e)));let n=tn.create(t,e.op);return n=ks(n),Ts(n)?n:(C(n instanceof tn),C(nn(n)),C(n.filters.length>1),n.filters.reduce(((e,t)=>Cs(e,t))))}function Cs(e,t){let n;return C(e instanceof en||e instanceof tn),C(t instanceof en||t instanceof tn),n=e instanceof en?t instanceof en?function(e,t){return tn.create([e,t],"and")}(e,t):Ss(e,t):t instanceof en?Ss(t,e):function(e,t){if(C(e.filters.length>0&&t.filters.length>0),nn(e)&&nn(t))return ln(e,t.getFilters());const n=rn(e)?e:t,r=rn(e)?t:e,i=n.filters.map((e=>Cs(e,r)));return tn.create(i,"or")}(e,t),ks(n)}function Ss(e,t){if(nn(t))return ln(t,e.getFilters());{const n=t.filters.map((t=>Cs(e,t)));return tn.create(n,"or")}}function ks(e){if(C(e instanceof en||e instanceof tn),e instanceof en)return e;const t=e.getFilters();if(1===t.length)return ks(t[0]);if(on(e))return e;const n=t.map((e=>ks(e))),r=[];return n.forEach((t=>{t instanceof en?r.push(t):t instanceof tn&&(t.op===e.op?r.push(...t.filters):r.push(t))})),1===r.length?r[0]:tn.create(r,e.op)}class Os{constructor(){this._n=new As}addToCollectionParentIndex(e,t){return this._n.add(t),ue.resolve()}getCollectionParents(e,t){return ue.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return ue.resolve()}deleteFieldIndex(e,t){return ue.resolve()}deleteAllFieldIndexes(e){return ue.resolve()}createTargetIndexes(e,t){return ue.resolve()}getDocumentsMatchingTarget(e,t){return ue.resolve(null)}getIndexType(e,t){return ue.resolve(0)}getFieldIndexes(e,t){return ue.resolve([])}getNextCollectionGroupToUpdate(e){return ue.resolve(null)}getMinOffset(e,t){return ue.resolve(se.min())}getMinOffsetFromCollectionGroup(e,t){return ue.resolve(se.min())}updateCollectionGroup(e,t,n){return ue.resolve()}updateIndexEntries(e,t){return ue.resolve()}}class As{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new at($.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new at($.comparator)).toArray()}}const xs=new Uint8Array(0);class Ns{constructor(e,t){this.databaseId=t,this.an=new As,this.un=new Wn((e=>bn(e)),((e,t)=>In(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.an.add(t)}));const i={collectionId:n,parent:Se(r)};return Rs(e).put(i)}return ue.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[W(t),""],!1,!0);return Rs(e).W(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(Ae(r.parent))}return n}))}addFieldIndex(e,t){const n=Ds(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))}}(t);delete r.indexId;const i=n.add(r);if(t.indexState){const n=Ls(e);return i.next((e=>{n.put(ns(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const n=Ds(e),r=Ls(e),i=Ps(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=Ds(e),n=Ps(e),r=Ls(e);return t.H().next((()=>n.H())).next((()=>r.H()))}createTargetIndexes(e,t){return ue.forEach(this.cn(t),(t=>this.getIndexType(e,t).next((n=>{if(0===n||1===n){const n=new ws(t).on();if(null!=n)return this.addFieldIndex(e,n)}}))))}getDocumentsMatchingTarget(e,t){const n=Ps(e);let r=!0;const i=new Map;return ue.forEach(this.cn(t),(t=>this.ln(e,t).next((e=>{r&&(r=!!e),i.set(t,e)})))).next((()=>{if(r){let e=nr();const r=[];return ue.forEach(i,((i,s)=>{_("IndexedDbIndexManager",`Using index ${function(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`}(i)} to execute ${bn(t)}`);const o=function(e,t){const n=Z(t);if(void 0===n)return null;for(const t of En(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),c=function(e,t){const n=new Map;for(const r of ee(t))for(const t of En(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),a=function(e,t){const n=[];let r=!0;for(const i of ee(t)){const t=0===i.kind?Cn(e,i.fieldPath,e.startAt):Sn(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new $t(n,r)}(s,i),u=function(e,t){const n=[];let r=!0;for(const i of ee(t)){const t=0===i.kind?Sn(e,i.fieldPath,e.endAt):Cn(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new $t(n,r)}(s,i),l=this.hn(i,s,a),h=this.hn(i,s,u),d=this.Pn(i,s,c),f=this.In(i.indexId,o,l,a.inclusive,h,u.inclusive,d);return ue.forEach(f,(i=>n.j(i,t.limit).next((t=>{t.forEach((t=>{const n=J.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))}))}))))})).next((()=>r))}return ue.resolve(null)}))}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:vs(tn.create(e.filters,"and")).map((t=>vn(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.un.set(e,t),t)}In(e,t,n,r,i,s,o){const c=(null!=t?t.length:1)*Math.max(n.length,i.length),a=c/(null!=t?t.length:1),u=[];for(let l=0;l<c;++l){const c=t?this.Tn(t[l/a]):xs,h=this.En(e,c,n[l%a],r),d=this.dn(e,c,i[l%a],s),f=o.map((t=>this.En(e,c,t,!0)));u.push(...this.createRange(h,d,f))}return u}En(e,t,n,r){const i=new ms(e,J.empty(),t,n);return r?i:i.Jt()}dn(e,t,n,r){const i=new ms(e,J.empty(),t,n);return r?i.Jt():i}ln(e,t){const n=new ws(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((e=>{let t=null;for(const r of e)n.tn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t}))}getIndexType(e,t){let n=2;const r=this.cn(t);return ue.forEach(r,(t=>this.ln(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new at(Y.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>function(e){return null!==e.limit}(t)&&r.length>1&&2===n?1:n))}An(e,t){const n=new ps;for(const r of ee(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.Ht(r.kind);cs.bt.Pt(e,i)}return n.Wt()}Tn(e){const t=new ps;return cs.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){const n=new ps;return cs.bt.Pt(Pt(this.databaseId,t),n.Ht(function(e){const t=ee(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Wt()}Pn(e,t,n){if(null===n)return[];let r=[];r.push(new ps);let i=0;for(const s of ee(e)){const e=n[i++];for(const n of r)if(this.Vn(t,s.fieldPath)&&Lt(e))r=this.mn(r,s,e);else{const t=n.Ht(s.kind);cs.bt.Pt(e,t)}}return this.fn(r)}hn(e,t,n){return this.Pn(e,t,n.position)}fn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Wt();return t}mn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new ps;r.seed(n.Wt()),cs.bt.Pt(e,r.Ht(t.kind)),i.push(r)}return i}Vn(e,t){return!!e.filters.find((e=>e instanceof en&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=Ds(e),r=Ls(e);return(t?n.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.W()).next((e=>{const t=[];return ue.forEach(e,(e=>r.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new ne(t.sequenceNumber,new se(Qi(t.readTime),new J(Ae(t.documentKey)),t.largestBatchId)):ne.empty(),r=e.fields.map((([e,t])=>new te(Y.fromServerFormat(e),t)));return new X(e.indexId,e.collectionGroup,r,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:B(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=Ds(e),i=Ls(e);return this.gn(e).next((e=>r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((t=>ue.forEach(t,(t=>i.put(ns(t.indexId,this.uid,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return ue.forEach(t,((t,r)=>{const i=n.get(t.collectionGroup);return(i?ue.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next((i=>(n.set(t.collectionGroup,i),ue.forEach(i,(n=>this.pn(e,t,n).next((t=>{const i=this.yn(r,n);return t.isEqual(i)?ue.resolve():this.wn(e,r,n,t,i)})))))))}))}Sn(e,t,n,r){return Ps(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.Rn(n,t.key),documentKey:t.key.path.toArray()})}bn(e,t,n,r){return Ps(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.Rn(n,t.key),t.key.path.toArray()])}pn(e,t,n){const r=Ps(e);let i=new at(gs);return r.Y({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.Rn(n,t)])},((e,r)=>{i=i.add(new ms(n.indexId,t,r.arrayValue,r.directionalValue))})).next((()=>i))}yn(e,t){let n=new at(gs);const r=this.An(t,e);if(null==r)return n;const i=Z(t);if(null!=i){const s=e.data.field(i.fieldPath);if(Lt(s))for(const i of s.arrayValue.values||[])n=n.add(new ms(t.indexId,e.key,this.Tn(i),r))}else n=n.add(new ms(t.indexId,e.key,xs,r));return n}wn(e,t,n,r,i){_("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){const s=e.getIterator(),o=t.getIterator();let c=lt(s),a=lt(o);for(;c||a;){let e=!1,t=!1;if(c&&a){const r=n(c,a);r<0?t=!0:r>0&&(e=!0)}else null!=c?t=!0:e=!0;e?(r(a),a=lt(o)):t?(i(c),c=lt(s)):(c=lt(s),a=lt(o))}}(r,i,gs,(r=>{s.push(this.Sn(e,t,n,r))}),(r=>{s.push(this.bn(e,t,n,r))})),ue.waitFor(s)}gn(e){let t=1;return Ls(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,r)=>{r.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>gs(e,t))).filter(((e,t,n)=>!t||0!==gs(e,n[t-1])));const r=[];r.push(e);for(const i of n){const n=gs(i,e),s=gs(i,t);if(0===n)r[0]=e.Jt();else if(n>0&&s<0)r.push(i),r.push(i.Jt());else if(s>0)break}r.push(t);const i=[];for(let e=0;e<r.length;e+=2){if(this.Dn(r[e],r[e+1]))return[];const t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,xs,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,xs,[]];i.push(IDBKeyRange.bound(t,n))}return i}Dn(e,t){return gs(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Ms)}getMinOffset(e,t){return ue.mapArray(this.cn(t),(t=>this.ln(e,t).next((e=>e||E())))).next(Ms)}}function Rs(e){return Ze(e,"collectionParents")}function Ps(e){return Ze(e,"indexEntries")}function Ds(e){return Ze(e,"indexConfiguration")}function Ls(e){return Ze(e,"indexState")}function Ms(e){C(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const i=e[r].indexState.offset;oe(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new se(t.readTime,t.documentKey,n)}const js={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Fs{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Fs(e,Fs.DEFAULT_COLLECTION_PERCENTILE,Fs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Us(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let c=0;const a=r.Y({range:o},((e,t,n)=>(c++,n.delete())));s.push(a.next((()=>{C(1===c)})));const u=[];for(const e of n.mutations){const r=Re(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return ue.waitFor(s).next((()=>u))}function Vs(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw E();t=e.noDocument}return JSON.stringify(t).length}Fs.DEFAULT_COLLECTION_PERCENTILE=10,Fs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Fs.DEFAULT=new Fs(41943040,Fs.DEFAULT_COLLECTION_PERCENTILE,Fs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Fs.DISABLED=new Fs(-1,0,0);class qs{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Cn={}}static lt(e,t,n,r){C(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new qs(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return zs(e).Y({index:"userMutationsIndex",range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const i=Ws(e),s=zs(e);return s.add({}).next((o=>{C("number"==typeof o);const c=new Ur(o,t,n,r),a=function(e,t,n){const r=n.baseMutations.map((t=>xi(e.ct,t))),i=n.mutations.map((t=>xi(e.ct,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,c),u=[];let l=new at(((e,t)=>B(e.canonicalString(),t.canonicalString())));for(const e of r){const t=Re(this.userId,e.key.path,o);l=l.add(e.key.path.popLast()),u.push(s.put(a)),u.push(i.put(t,Pe))}return l.forEach((t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.Cn[o]=c.keys()})),ue.waitFor(u).next((()=>c))}))}lookupMutationBatch(e,t){return zs(e).get(t).next((e=>e?(C(e.userId===this.userId),Yi(this.serializer,e)):null))}vn(e,t){return this.Cn[t]?ue.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.Cn[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return zs(e).Y({index:"userMutationsIndex",range:r},((e,t,r)=>{t.userId===this.userId&&(C(t.batchId>=n),i=Yi(this.serializer,t)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return zs(e).Y({index:"userMutationsIndex",range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return zs(e).W("userMutationsIndex",t).next((e=>e.map((e=>Yi(this.serializer,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Ne(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return Ws(e).Y({range:r},((n,r,s)=>{const[o,c,a]=n,u=Ae(c);if(o===this.userId&&t.path.isEqual(u))return zs(e).get(a).next((e=>{if(!e)throw E();C(e.userId===this.userId),i.push(Yi(this.serializer,e))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new at(B);const r=[];return t.forEach((t=>{const i=Ne(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=Ws(e).Y({range:s},((e,r,i)=>{const[s,o,c]=e,a=Ae(o);s===this.userId&&t.path.isEqual(a)?n=n.add(c):i.done()}));r.push(o)})),ue.waitFor(r).next((()=>this.Fn(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=Ne(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new at(B);return Ws(e).Y({range:s},((e,t,i)=>{const[s,c,a]=e,u=Ae(c);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(a)):i.done()})).next((()=>this.Fn(e,o)))}Fn(e,t){const n=[],r=[];return t.forEach((t=>{r.push(zs(e).get(t).next((e=>{if(null===e)throw E();C(e.userId===this.userId),n.push(Yi(this.serializer,e))})))})),ue.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return Us(e.ae,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.Mn(t.batchId)})),ue.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return ue.resolve();const n=IDBKeyRange.lowerBound(function(e){return[e]}(this.userId)),r=[];return Ws(e).Y({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=Ae(e[1]);r.push(t)}else n.done()})).next((()=>{C(0===r.length)}))}))}containsKey(e,t){return Bs(e,this.userId,t)}xn(e){return Ks(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function Bs(e,t,n){const r=Ne(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return Ws(e).Y({range:s,J:!0},((e,n,r)=>{const[s,c,a]=e;s===t&&c===i&&(o=!0),r.done()})).next((()=>o))}function zs(e){return Ze(e,"mutations")}function Ws(e){return Ze(e,"documentMutations")}function Ks(e){return Ze(e,"mutationQueues")}class Gs{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new Gs(0)}static Bn(){return new Gs(-1)}}class Hs{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Ln(e).next((t=>{const n=new Gs(t.highestTargetId);return t.highestTargetId=n.next(),this.kn(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.Ln(e).next((e=>G.fromTimestamp(new K(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.Ln(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.Ln(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.kn(e,r))))}addTargetData(e,t){return this.qn(e,t).next((()=>this.Ln(e).next((n=>(n.targetCount+=1,this.Qn(t,n),this.kn(e,n))))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>$s(e).delete(t.targetId))).next((()=>this.Ln(e))).next((t=>(C(t.targetCount>0),t.targetCount-=1,this.kn(e,t))))}removeTargets(e,t,n){let r=0;const i=[];return $s(e).Y(((s,o)=>{const c=Ji(o);c.sequenceNumber<=t&&null===n.get(c.targetId)&&(r++,i.push(this.removeTargetData(e,c)))})).next((()=>ue.waitFor(i))).next((()=>r))}forEachTarget(e,t){return $s(e).Y(((e,n)=>{const r=Ji(n);t(r)}))}Ln(e){return Qs(e).get("targetGlobalKey").next((e=>(C(null!==e),e)))}kn(e,t){return Qs(e).put("targetGlobalKey",t)}qn(e,t){return $s(e).put(Xi(this.serializer,t))}Qn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Ln(e).next((e=>e.targetCount))}getTargetData(e,t){const n=bn(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return $s(e).Y({range:r,index:"queryTargetsIndex"},((e,n,r)=>{const s=Ji(n);In(t,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(e,t,n){const r=[],i=Ys(e);return t.forEach((t=>{const s=Se(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))})),ue.waitFor(r)}removeMatchingKeys(e,t,n){const r=Ys(e);return ue.forEach(t,(t=>{const i=Se(t.path);return ue.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=Ys(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Ys(e);let i=nr();return r.Y({range:n,J:!0},((e,t,n)=>{const r=Ae(e[1]),s=new J(r);i=i.add(s)})).next((()=>i))}containsKey(e,t){const n=Se(t.path),r=IDBKeyRange.bound([n],[W(n)],!1,!0);let i=0;return Ys(e).Y({index:"documentTargetsIndex",J:!0,range:r},(([e,t],n,r)=>{0!==e&&(i++,r.done())})).next((()=>i>0))}_t(e,t){return $s(e).get(t).next((e=>e?Ji(e):null))}}function $s(e){return Ze(e,"targets")}function Qs(e){return Ze(e,"targetGlobal")}function Ys(e){return Ze(e,"targetDocuments")}function Js([e,t],[n,r]){const i=B(e,n);return 0===i?B(t,r):i}class Xs{constructor(e){this.Kn=e,this.buffer=new at(Js),this.$n=0}Un(){return++this.$n}Wn(e){const t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Js(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Zs{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}zn(e){_("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Gn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){me(e)?_("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await le(e)}await this.zn(3e5)}))}}class eo{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return ue.resolve(Ie._e);const n=new Xs(t);return this.jn.forEachTarget(e,(e=>n.Wn(e.sequenceNumber))).next((()=>this.jn.Jn(e,(e=>n.Wn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector","Garbage collection skipped; disabled"),ue.resolve(js)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),js):this.Yn(e,t)))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let n,r,i,s,o,a,u;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(_("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(u=Date.now(),y()<=c.a.DEBUG&&_("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-l}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(u-a)+"ms\n"+`Total Duration: ${u-l}ms`),ue.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}function to(e,t){return new eo(e,t)}class no{constructor(e,t){this.db=e,this.garbageCollector=to(this,t)}Hn(e){const t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Zn(e){let t=0;return this.Jn(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,((e,n)=>t(n)))}addReference(e,t,n){return ro(e,n)}removeReference(e,t,n){return ro(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return ro(e,t)}er(e,t){return function(e,t){let n=!1;return Ks(e).Z((r=>Bs(e,r,t).next((e=>(e&&(n=!0),ue.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Xn(e,((s,o)=>{if(o<=t){const t=this.er(e,s).next((t=>{if(!t)return i++,n.getEntry(e,s).next((()=>(n.removeEntry(s,G.min()),Ys(e).delete(function(e){return[0,Se(e.path)]}(s)))))}));r.push(t)}})).next((()=>ue.waitFor(r))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return ro(e,t)}Xn(e,t){const n=Ys(e);let r,i=Ie._e;return n.Y({index:"documentTargetsIndex"},(([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==Ie._e&&t(new J(Ae(r)),i),i=o,r=s):i=Ie._e})).next((()=>{i!==Ie._e&&t(new J(Ae(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ro(e,t){return Ys(e).put(function(e,t){return{targetId:0,path:Se(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class io{constructor(){this.changes=new Wn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ht.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?ue.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class so{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return lo(e).put(n)}removeEntry(e,t,n){return lo(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Hi(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.tr(e,n))))}getEntry(e,t){let n=Ht.newInvalidDocument(t);return lo(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(uo(t))},((e,r)=>{n=this.nr(t,r)})).next((()=>n))}rr(e,t){let n={size:0,document:Ht.newInvalidDocument(t)};return lo(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(uo(t))},((e,r)=>{n={document:this.nr(t,r),size:Vs(r)}})).next((()=>n))}getEntries(e,t){let n=Gn();return this.ir(e,t,((e,t)=>{const r=this.nr(e,t);n=n.insert(e,r)})).next((()=>n))}sr(e,t){let n=Gn(),r=new it(J.comparator);return this.ir(e,t,((e,t)=>{const i=this.nr(e,t);n=n.insert(e,i),r=r.insert(e,Vs(t))})).next((()=>({documents:n,_r:r})))}ir(e,t,n){if(t.isEmpty())return ue.resolve();let r=new at(fo);t.forEach((e=>r=r.add(e)));const i=IDBKeyRange.bound(uo(r.first()),uo(r.last())),s=r.getIterator();let o=s.getNext();return lo(e).Y({index:"documentKeyIndex",range:i},((e,t,r)=>{const i=J.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&fo(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.U(uo(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null}))}getDocumentsMatchingQuery(e,t,n,r,i){const s=t.path,o=[s.popLast().toArray(),s.lastSegment(),Hi(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return lo(e).W(IDBKeyRange.bound(o,c,!0)).next((e=>{null==i||i.incrementDocumentReadCount(e.length);let n=Gn();for(const i of e){const e=this.nr(J.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(Vn(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n}))}getAllFromCollectionGroup(e,t,n,r){let i=Gn();const s=ho(t,n),o=ho(t,se.max());return lo(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,o,!0)},((e,t,n)=>{const s=this.nr(J.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()})).next((()=>i))}newChangeBuffer(e){return new ao(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return co(e).get("remoteDocumentGlobalKey").next((e=>(C(!!e),e)))}tr(e,t){return co(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){const e=function(e,t){let n;if(t.document)n=Ai(e.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=J.fromSegments(t.noDocument.path),r=Qi(t.noDocument.readTime);n=Ht.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return E();{const e=J.fromSegments(t.unknownDocument.path),r=Qi(t.unknownDocument.version);n=Ht.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new K(e[0],e[1]);return G.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(G.min()))return e}return Ht.newInvalidDocument(e)}}function oo(e){return new so(e)}class ao extends io{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new Wn((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new at(((e,t)=>B(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,s)=>{const o=this.ur.get(i);if(t.push(this.ar.removeEntry(e,i,o.readTime)),s.isValidDocument()){const c=Gi(this.ar.serializer,s);r=r.add(i.path.popLast());const a=Vs(c);n+=a-o.size,t.push(this.ar.addEntry(e,i,c))}else if(n-=o.size,this.trackRemovals){const n=Gi(this.ar.serializer,s.convertToNoDocument(G.min()));t.push(this.ar.addEntry(e,i,n))}})),r.forEach((n=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.ar.updateMetadata(e,n)),ue.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next((e=>(this.ur.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.ar.sr(e,t).next((({documents:e,_r:t})=>(t.forEach(((t,n)=>{this.ur.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function co(e){return Ze(e,"remoteDocumentGlobal")}function lo(e){return Ze(e,"remoteDocumentsV14")}function uo(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function ho(e,t){const n=t.documentKey.path.toArray();return[e,Hi(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function fo(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=B(n[e],r[e]),i)return i;return i=B(n.length,r.length),i||(i=B(n[n.length-2],r[r.length-2]),i||B(n[n.length-1],r[r.length-1]))}class po{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class mo{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Ar(n.mutation,e,ut.empty(),K.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,nr()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=nr()){const r=Yn();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=$n();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=Yn();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,nr())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=Gn();const s=Xn(),o=Xn();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof Pr)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),Ar(o.mutation,t,o.mutation.getFieldMask(),K.now())):s.set(t.key,ut.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new po(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=Xn();let r=new it(((e,t)=>e-t)),i=nr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||ut.empty();o=i.applyToLocalView(s,o),n.set(e,o);const c=(r.get(i.batchId)||nr()).add(e);r=r.insert(i.batchId,c)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),c=r.key,a=r.value,u=Jn();a.forEach((e=>{if(!i.has(e)){const r=kr(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,c,u))}return ue.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return J.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Nn(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):ue.resolve(Yn());let o=-1,c=i;return s.next((t=>ue.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?ue.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{c=c.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,c,t,nr()))).next((e=>({batchId:o,changes:Qn(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new J(t)).next((e=>{let t=$n();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=$n();return this.indexManager.getCollectionParents(e,i).next((o=>ue.forEach(o,(o=>{const c=function(e,t){return new kn(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,n,r).next((e=>{e.forEach(((e,t)=>{s=s.insert(e,t)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)))).next((e=>{i.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,Ht.newInvalidDocument(r)))}));let n=$n();return e.forEach(((e,r)=>{const s=i.get(e);void 0!==s&&Ar(s.mutation,r,ut.empty(),K.now()),Vn(t,r)&&(n=n.insert(e,r))})),n}))}}class go{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return ue.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:wi(e.createTime)}}(t)),ue.resolve()}getNamedQuery(e,t){return ue.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(e){return{name:e.name,query:Zi(e.bundledQuery),readTime:wi(e.readTime)}}(t)),ue.resolve()}}class yo{constructor(){this.overlays=new it(J.comparator),this.hr=new Map}getOverlay(e,t){return ue.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Yn();return ue.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.ht(e,t,r)})),ue.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.hr.delete(n)),ue.resolve()}getOverlaysForCollection(e,t,n){const r=Yn(),i=t.length+1,s=new J(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return ue.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new it(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=Yn(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Yn(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return ue.resolve(o)}ht(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new qr(t,n));let i=this.hr.get(t);void 0===i&&(i=nr(),this.hr.set(t,i)),this.hr.set(t,i.add(n.key))}}class wo{constructor(){this.Pr=new at(_o.Ir),this.Tr=new at(_o.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const n=new _o(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Ar(new _o(e,t))}Rr(e,t){e.forEach((e=>this.removeReference(e,t)))}Vr(e){const t=new J(new $([])),n=new _o(t,e),r=new _o(t,e+1),i=[];return this.Tr.forEachInRange([n,r],(e=>{this.Ar(e),i.push(e.key)})),i}mr(){this.Pr.forEach((e=>this.Ar(e)))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new J(new $([])),n=new _o(t,e),r=new _o(t,e+1);let i=nr();return this.Tr.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new _o(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class _o{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return J.comparator(e.key,t.key)||B(e.pr,t.pr)}static Er(e,t){return B(e.pr,t.pr)||J.comparator(e.key,t.key)}}class vo{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new at(_o.Ir)}checkEmpty(e){return ue.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Ur(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.wr=this.wr.add(new _o(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return ue.resolve(s)}lookupMutationBatch(e,t){return ue.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.br(n),i=r<0?0:r;return ue.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return ue.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return ue.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new _o(t,0),r=new _o(t,Number.POSITIVE_INFINITY),i=[];return this.wr.forEachInRange([n,r],(e=>{const t=this.Sr(e.pr);i.push(t)})),ue.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new at(B);return t.forEach((e=>{const t=new _o(e,0),r=new _o(e,Number.POSITIVE_INFINITY);this.wr.forEachInRange([t,r],(e=>{n=n.add(e.pr)}))})),ue.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;J.isDocumentKey(i)||(i=i.child(""));const s=new _o(new J(i),0);let o=new at(B);return this.wr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.pr)),!0)}),s),ue.resolve(this.Dr(o))}Dr(e){const t=[];return e.forEach((e=>{const n=this.Sr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){C(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return ue.forEach(t.mutations,(r=>{const i=new _o(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.wr=n}))}Mn(e){}containsKey(e,t){const n=new _o(t,0),r=this.wr.firstAfterOrEqual(n);return ue.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,ue.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class bo{constructor(e){this.vr=e,this.docs=new it(J.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return ue.resolve(n?n.document.mutableCopy():Ht.newInvalidDocument(t))}getEntries(e,t){let n=Gn();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Ht.newInvalidDocument(e))})),ue.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=Gn();const s=t.path,o=new J(s.child("")),c=this.docs.getIteratorFrom(o);for(;c.hasNext();){const{key:e,value:{document:o}}=c.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||oe(ie(o),n)<=0||(r.has(o.key)||Vn(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return ue.resolve(i)}getAllFromCollectionGroup(e,t,n,r){E()}Fr(e,t){return ue.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Io(this)}getSize(e){return ue.resolve(this.size)}}class Io extends io{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.ar.addEntry(e,r)):this.ar.removeEntry(n)})),ue.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class To{constructor(e){this.persistence=e,this.Mr=new Wn((e=>bn(e)),In),this.lastRemoteSnapshotVersion=G.min(),this.highestTargetId=0,this.Or=0,this.Nr=new wo,this.targetCount=0,this.Br=Gs.Nn()}forEachTarget(e,t){return this.Mr.forEach(((e,n)=>t(n))),ue.resolve()}getLastRemoteSnapshotVersion(e){return ue.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ue.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Br.next(),ue.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),ue.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Br=new Gs(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,ue.resolve()}updateTargetData(e,t){return this.qn(t),ue.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,ue.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Mr.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Mr.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),ue.waitFor(i).next((()=>r))}getTargetCount(e){return ue.resolve(this.targetCount)}getTargetData(e,t){const n=this.Mr.get(t)||null;return ue.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),ue.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),ue.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),ue.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Nr.gr(t);return ue.resolve(n)}containsKey(e,t){return ue.resolve(this.Nr.containsKey(t))}}class Eo{constructor(e,t){this.Lr={},this.overlays={},this.kr=new Ie(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new To(this),this.indexManager=new Os,this.remoteDocumentCache=function(e){return new bo(e)}((e=>this.referenceDelegate.Kr(e))),this.serializer=new Ki(t),this.$r=new go(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new yo,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Lr[e.toKey()];return n||(n=new vo(t,this.referenceDelegate),this.Lr[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){_("MemoryPersistence","Starting transaction:",e);const r=new Co(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((e=>this.referenceDelegate.Wr(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Gr(e,t){return ue.or(Object.values(this.Lr).map((n=>()=>n.containsKey(e,t))))}}class Co extends ce{constructor(e){super(),this.currentSequenceNumber=e}}class So{constructor(e){this.persistence=e,this.zr=new wo,this.jr=null}static Hr(e){return new So(e)}get Jr(){if(this.jr)return this.jr;throw E()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),ue.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),ue.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),ue.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach((e=>this.Jr.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Jr.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ue.forEach(this.Jr,(n=>{const r=J.fromPath(n);return this.Yr(e,r).next((e=>{e||t.removeEntry(r,G.min())}))})).next((()=>(this.jr=null,t.apply(e))))}updateLimboDocument(e,t){return this.Yr(e,t).next((e=>{e?this.Jr.delete(t.toString()):this.Jr.add(t.toString())}))}Kr(e){return 0}Yr(e,t){return ue.or([()=>ue.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class ko{constructor(e){this.serializer=e}N(e,t,n,r){const i=new he("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",xe,{unique:!0}),e.createObjectStore("documentMutations")}(e),Oo(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=ue.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),Oo(e)),s=s.next((()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:G.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(e,t){return t.store("mutations").W().next((n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",xe,{unique:!0});const r=t.store("mutations"),i=n.map((e=>r.put(e)));return ue.waitFor(i)}))}(e,i)))),s=s.next((()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(s=s.next((()=>this.Xr(i)))),n<6&&r>=6&&(s=s.next((()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.ei(i))))),n<7&&r>=7&&(s=s.next((()=>this.ti(i)))),n<8&&r>=8&&(s=s.next((()=>this.ni(e,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(s=s.next((()=>this.ri(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&r>=12&&(s=s.next((()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:We});t.createIndex("collectionPathOverlayIndex",Ke,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",Ge,{unique:!1})}(e)}))),n<13&&r>=13&&(s=s.next((()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:De});t.createIndex("documentKeyIndex",Le),t.createIndex("collectionGroupIndex",Me)}(e))).next((()=>this.ii(e,i))).next((()=>e.deleteObjectStore("remoteDocuments")))),n<14&&r>=14&&(s=s.next((()=>this.si(e,i)))),n<15&&r>=15&&(s=s.next((()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Ve}).createIndex("sequenceNumberIndex",qe,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:Be}).createIndex("documentKeyIndex",ze,{unique:!1})}(e)))),s}ei(e){let t=0;return e.store("remoteDocuments").Y(((e,n)=>{t+=Vs(n)})).next((()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Xr(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.W().next((t=>ue.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.W("userMutationsIndex",r).next((n=>ue.forEach(n,(n=>{C(n.userId===t.userId);const r=Yi(this.serializer,n);return Us(e,t.userId,r).next((()=>{}))}))))}))))}ti(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((e=>{const r=[];return n.Y(((n,i)=>{const s=new $(n),o=function(e){return[0,Se(e)]}(s);r.push(t.get(o).next((n=>n?ue.resolve():(n=>t.put({targetId:0,path:Se(n),sequenceNumber:e.highestListenSequenceNumber}))(s))))})).next((()=>ue.waitFor(r)))}))}ni(e,t){e.createObjectStore("collectionParents",{keyPath:Ue});const n=t.store("collectionParents"),r=new As,o=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Se(r)})}};return t.store("remoteDocuments").Y({J:!0},((e,t)=>{const n=new $(e);return o(n.popLast())})).next((()=>t.store("documentMutations").Y({J:!0},(([e,t,n],r)=>{const i=Ae(t);return o(i.popLast())}))))}ri(e){const t=e.store("targets");return t.Y(((e,n)=>{const r=Ji(n),i=Xi(this.serializer,r);return t.put(i)}))}ii(e,t){const n=t.store("remoteDocuments"),r=[];return n.Y(((e,n)=>{const i=t.store("remoteDocumentsV14"),s=function(e){return e.document?new J($.fromString(e.document.name).popFirst(5)):e.noDocument?J.fromSegments(e.noDocument.path):e.unknownDocument?J.fromSegments(e.unknownDocument.path):E()}(n).path.toArray(),o={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(o))})).next((()=>ue.waitFor(r)))}si(e,t){const n=t.store("mutations"),r=oo(this.serializer),i=new Eo(So.Hr,this.serializer.ct);return n.W().next((e=>{const n=new Map;return e.forEach((e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:nr();Yi(this.serializer,e).keys().forEach((e=>r=r.add(e))),n.set(e.userId,r)})),ue.forEach(n,((e,n)=>{const s=new f(n),o=os.lt(this.serializer,s),c=i.getIndexManager(s),a=qs.lt(s,this.serializer,c,i.referenceDelegate);return new mo(r,a,o,c).recalculateAndSaveOverlaysForDocumentKeys(new Xe(t,Ie._e),e).next()}))}))}}function Oo(e){e.createObjectStore("targetDocuments",{keyPath:Fe}).createIndex("documentTargetsIndex",q,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",je,{unique:!0}),e.createObjectStore("targetGlobal")}const Ao="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class xo{constructor(e,t,n,r,i,s,o,c,a,u,l=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.oi=i,this.window=s,this.document=o,this._i=a,this.ai=u,this.ui=l,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=e=>Promise.resolve(),!xo.D())throw new A(O.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new no(this,r),this.Ti=t+"main",this.serializer=new Ki(c),this.Ei=new de(this.Ti,this.ui,new ko(this.serializer)),this.Qr=new Hs(this.referenceDelegate,this.serializer),this.remoteDocumentCache=oo(this.serializer),this.$r=new rs,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,!1===u&&v("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new A(O.FAILED_PRECONDITION,Ao);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Qr.getHighestSequenceNumber(e)))})).then((e=>{this.kr=new Ie(e,this._i)})).then((()=>{this.qr=!0})).catch((e=>(this.Ei&&this.Ei.close(),Promise.reject(e))))}fi(e){return this.Ii=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.L((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget((async()=>{this.started&&await this.Ai()})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>Ro(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.gi(e).next((e=>{e||(this.isPrimary=!1,this.oi.enqueueRetryable((()=>this.Ii(!1))))}))})).next((()=>this.pi(e))).next((t=>this.isPrimary&&!t?this.yi(e).next((()=>!1)):!!t&&this.wi(e).next((()=>!0)))))).catch((e=>{if(me(e))return _("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return _("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.oi.enqueueRetryable((()=>this.Ii(e))),this.isPrimary=e}))}gi(e){return No(e).get("owner").next((e=>ue.resolve(this.Si(e))))}bi(e){return Ro(e).delete(this.clientId)}async Di(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=Ze(e,"clientMetadata");return t.W().next((e=>{const n=this.vi(e,18e5),r=e.filter((e=>-1===n.indexOf(e)));return ue.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.di)for(const t of e)this.di.removeItem(this.Fi(t.clientId))}}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Ai().then((()=>this.Di())).then((()=>this.mi()))))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?ue.resolve(!0):No(e).get("owner").next((t=>{if(null!==t&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new A(O.FAILED_PRECONDITION,Ao);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ro(e).W().next((e=>void 0===this.vi(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&_("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),await this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(e=>{const t=new Xe(e,Ie._e);return this.yi(t).next((()=>this.bi(t)))})),this.Ei.close(),this.Bi()}vi(e,t){return e.filter((e=>this.Ci(e.updateTimeMs,t)&&!this.Mi(e.clientId)))}Li(){return this.runTransaction("getActiveClients","readonly",(e=>Ro(e).W().next((e=>this.vi(e,18e5).map((e=>e.clientId))))))}get started(){return this.qr}getMutationQueue(e,t){return qs.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Ns(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return os.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,n){_("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=function(e){return 15===e?Je:14===e?Ye:13===e?Qe:12===e?$e:11===e?He:void E()}(this.ui);let s;return this.Ei.runTransaction(e,r,i,(r=>(s=new Xe(r,this.kr?this.kr.next():Ie._e),"readwrite-primary"===t?this.gi(s).next((e=>!!e||this.pi(s))).next((t=>{if(!t)throw v(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable((()=>this.Ii(!1))),new A(O.FAILED_PRECONDITION,ae);return n(s)})).next((e=>this.wi(s).next((()=>e)))):this.ki(s).next((()=>n(s)))))).then((e=>(s.raiseOnCommittedEvent(),e)))}ki(e){return No(e).get("owner").next((e=>{if(null!==e&&this.Ci(e.leaseTimestampMs,5e3)&&!this.Mi(e.ownerId)&&!this.Si(e)&&!(this.ai||this.allowTabSynchronization&&e.allowTabSynchronization))throw new A(O.FAILED_PRECONDITION,Ao)}))}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return No(e).put("owner",t)}static D(){return de.D()}yi(e){const t=No(e);return t.get("owner").next((e=>this.Si(e)?(_("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):ue.resolve()))}Ci(e,t){const n=Date.now();return!(e<n-t||e>n&&(v(`Detected an update time that is in the future: ${e} > ${n}`),1))}Ri(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.li=()=>{this.oi.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.Ai())))},this.document.addEventListener("visibilitychange",this.li),this.inForeground="visible"===this.document.visibilityState)}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();const e=/(?:Version|Mobile)\/1[456]/;Object(l.I)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{const n=null!==(null===(t=this.di)||void 0===t?void 0:t.getItem(this.Fi(e)));return _("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return v("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){v("Failed to set zombie client id.",e)}}Bi(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch(e){}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function No(e){return Ze(e,"owner")}function Ro(e){return Ze(e,"clientMetadata")}function Po(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class Do{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=r}static Ki(e,t){let n=nr(),r=nr();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new Do(e,t.fromCache,n,r)}}class Lo{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Mo{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=Object(l.I)()?8:de.v(Object(l.x)())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.ji(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.Hi(e,t,r,n).next((e=>{i.result=e}))})).next((()=>{if(i.result)return;const n=new Lo;return this.Ji(e,t,n).next((r=>{if(i.result=r,this.Ui)return this.Yi(e,t,n,r.size)}))})).next((()=>i.result))}Yi(e,t,n,r){return n.documentReadCount<this.Wi?(y()<=c.a.DEBUG&&_("QueryEngine","SDK will not create cache indexes for query:",Un(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),ue.resolve()):(y()<=c.a.DEBUG&&_("QueryEngine","Query:",Un(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(y()<=c.a.DEBUG&&_("QueryEngine","The SDK decides to create cache indexes for query:",Un(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Pn(t))):ue.resolve())}ji(e,t){if(xn(t))return ue.resolve(null);let n=Pn(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Mn(t,null,"F"),n=Pn(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=nr(...r);return this.zi.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.Zi(t,r);return this.Xi(t,s,i,n.readTime)?this.ji(e,Mn(t,null,"F")):this.es(e,s,t,n)}))))})))))}Hi(e,t,n,r){return xn(t)||r.isEqual(G.min())?ue.resolve(null):this.zi.getDocuments(e,n).next((i=>{const s=this.Zi(t,i);return this.Xi(t,s,n,r)?ue.resolve(null):(y()<=c.a.DEBUG&&_("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Un(t)),this.es(e,s,t,re(r,-1)).next((e=>e)))}))}Zi(e,t){let n=new at(Bn(e));return t.forEach(((t,r)=>{Vn(e,r)&&(n=n.add(r))})),n}Xi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ji(e,t,n){return y()<=c.a.DEBUG&&_("QueryEngine","Using full collection scan to execute query:",Un(t)),this.zi.getDocumentsMatchingQuery(e,t,se.min(),n)}es(e,t,n,r){return this.zi.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class jo{constructor(e,t,n,r){this.persistence=e,this.ts=t,this.serializer=r,this.ns=new it(B),this.rs=new Wn((e=>bn(e)),In),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new mo(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.ns)))}}function Fo(e,t,n,r){return new jo(e,t,n,r)}async function Uo(e,t){const n=k(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n._s(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=nr();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({us:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function Vo(e){const t=k(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Qr.getLastRemoteSnapshotVersion(e)))}function qo(e,t,n){let r=nr(),i=nr();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=Gn();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(G.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):_("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{cs:r,ls:i}}))}function Bo(e,t){const n=k(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function zo(e,t){const n=k(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Qr.getTargetData(e,t).next((i=>i?(r=i,ue.resolve(r)):n.Qr.allocateTargetId(e).next((i=>(r=new Wi(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Qr.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.ns.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(e.targetId,e),n.rs.set(t,e.targetId)),e}))}async function Wo(e,t,n){const r=k(e),i=r.ns.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!me(e))throw e;_("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.ns=r.ns.remove(t),r.rs.delete(i.target)}function Ko(e,t,n){const r=k(e);let i=G.min(),s=nr();return r.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const r=k(e),i=r.rs.get(n);return void 0!==i?ue.resolve(r.ns.get(i)):r.Qr.getTargetData(t,n)}(r,e,Pn(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.ts.getDocumentsMatchingQuery(e,t,n?i:G.min(),n?s:nr()))).next((e=>($o(r,qn(t),e),{documents:e,hs:s})))))}function Go(e,t){const n=k(e),r=k(n.Qr),i=n.ns.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(e=>r._t(e,t).next((e=>e?e.target:null))))}function Ho(e,t){const n=k(e),r=n.ss.get(t)||G.min();return n.persistence.runTransaction("Get new document changes","readonly",(e=>n.os.getAllFromCollectionGroup(e,t,re(r,-1),Number.MAX_SAFE_INTEGER))).then((e=>($o(n,t,e),e)))}function $o(e,t,n){let r=e.ss.get(t)||G.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.ss.set(t,r)}async function Qo(e,t,n=nr()){const r=await zo(e,Pn(Zi(t.bundledQuery))),i=k(e);return i.persistence.runTransaction("Save named query","readwrite",(e=>{const s=wi(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.$r.saveNamedQuery(e,t);const o=r.withResumeToken(pt.EMPTY_BYTE_STRING,s);return i.ns=i.ns.insert(o.targetId,o),i.Qr.updateTargetData(e,o).next((()=>i.Qr.removeMatchingKeysForTargetId(e,r.targetId))).next((()=>i.Qr.addMatchingKeys(e,n,r.targetId))).next((()=>i.$r.saveNamedQuery(e,t)))}))}function Yo(e,t){return`firestore_clients_${e}_${t}`}function Jo(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Xo(e,t){return`firestore_targets_${e}_${t}`}class Zo{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Es(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new A(r.error.code,r.error.message))),s?new Zo(e,t,r.state,i):(v("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ea{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Es(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new A(n.error.code,n.error.message))),i?new ea(e,n.state,r):(v("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ta{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=ir();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=Ce(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new ta(e,i):(v("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class na{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new na(t.clientId,t.onlineState):(v("SharedClientState",`Failed to parse online state: ${e}`),null)}}class ra{constructor(){this.activeTargetIds=ir()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ia{constructor(e,t,n,r,i){this.window=e,this.oi=t,this.persistenceKey=n,this.Vs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new it(B),this.started=!1,this.ys=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ws=Yo(this.persistenceKey,this.Vs),this.Ss=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.ps=this.ps.insert(this.Vs,new ra),this.bs=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.vs=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.Fs=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Li();for(const t of e){if(t===this.Vs)continue;const e=this.getItem(Yo(this.persistenceKey,t));if(e){const n=ta.Es(t,e);n&&(this.ps=this.ps.insert(n.clientId,n))}}this.Ms();const t=this.storage.getItem(this.vs);if(t){const e=this.xs(t);e&&this.Os(e)}for(const e of this.ys)this.gs(e);this.ys=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach(((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.Bs(e,"pending")}updateMutationState(e,t,n){this.Bs(e,t,n),this.Ls(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(Xo(this.persistenceKey,e));if(n){const r=ea.Es(e,n);r&&(t=r.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Xo(this.persistenceKey,e))}updateQueryState(e,t,n){this.qs(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.Ls(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return _("SharedClientState","READ",e,t),t}setItem(e,t){_("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){_("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){const t=e;if(t.storageArea===this.storage){if(_("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ws)return void v("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable((async()=>{if(this.started){if(null!==t.key)if(this.bs.test(t.key)){if(null==t.newValue){const e=this.$s(t.key);return this.Us(e,null)}{const e=this.Ws(t.key,t.newValue);if(e)return this.Us(e.clientId,e)}}else if(this.Ds.test(t.key)){if(null!==t.newValue){const e=this.Gs(t.key,t.newValue);if(e)return this.zs(e)}}else if(this.Cs.test(t.key)){if(null!==t.newValue){const e=this.js(t.key,t.newValue);if(e)return this.Hs(e)}}else if(t.key===this.vs){if(null!==t.newValue){const e=this.xs(t.newValue);if(e)return this.Os(e)}}else if(t.key===this.Ss){const e=function(e){let t=Ie._e;if(null!=e)try{const n=JSON.parse(e);C("number"==typeof n),t=n}catch(e){v("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==Ie._e&&this.sequenceNumberHandler(e)}else if(t.key===this.Fs){const e=this.Js(t.newValue);await Promise.all(e.map((e=>this.syncEngine.Ys(e))))}}else this.ys.push(t)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Bs(e,t,n){const r=new Zo(this.currentUser,e,t,n),i=Jo(this.persistenceKey,this.currentUser,e);this.setItem(i,r.ds())}Ls(e){const t=Jo(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){const t={clientId:this.Vs,onlineState:e};this.storage.setItem(this.vs,JSON.stringify(t))}qs(e,t,n){const r=Xo(this.persistenceKey,e),i=new ea(e,t,n);this.setItem(r,i.ds())}Ks(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){const t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){const n=this.$s(e);return ta.Es(n,t)}Gs(e,t){const n=this.Ds.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Zo.Es(new f(i),r,t)}js(e,t){const n=this.Cs.exec(e),r=Number(n[1]);return ea.Es(r,t)}xs(e){return na.Es(e)}Js(e){return JSON.parse(e)}async zs(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Zs(e.batchId,e.state,e.error);_("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){const n=t?this.ps.insert(e,t):this.ps.remove(e),r=this.Ns(this.ps),i=this.Ns(n),s=[],o=[];return i.forEach((e=>{r.has(e)||s.push(e)})),r.forEach((e=>{i.has(e)||o.push(e)})),this.syncEngine.eo(s,o).then((()=>{this.ps=n}))}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=ir();return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class sa{constructor(){this.no=new ra,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new ra,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class oa{io(e){}shutdown(){}}class aa{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){_("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){_("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let ca=null;function la(){return null===ca?ca=268435456+Math.round(2147483648*Math.random()):ca++,"0x"+ca.toString(16)}const ua={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ha{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}}const da="WebChannelConnection";class fa extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.fo=t+"://"+e.host,this.po=`projects/${n}/databases/${r}`,this.yo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get wo(){return!1}So(e,t,n,r,i){const s=la(),o=this.bo(e,t.toUriEncodedString());_("RestConnection",`Sending RPC '${e}' ${s}:`,o,n);const c={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(c,r,i),this.Co(e,o,c,n).then((t=>(_("RestConnection",`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw I("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t}))}vo(e,t,n,r,i,s){return this.So(e,t,n,r,i)}Do(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+m,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}bo(e,t){const n=ua[e];return`${this.fo}/v1/${t}:${n}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,t,n,r){const i=la();return new Promise(((s,o)=>{const c=new h.h;c.setWithCredentials(!0),c.listenOnce(h.c.COMPLETE,(()=>{try{switch(c.getLastErrorCode()){case h.a.NO_ERROR:const t=c.getResponseJson();_(da,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case h.a.TIMEOUT:_(da,`RPC '${e}' ${i} timed out`),o(new A(O.DEADLINE_EXCEEDED,"Request time out"));break;case h.a.HTTP_ERROR:const n=c.getStatus();if(_(da,`RPC '${e}' ${i} failed with status:`,n,"response text:",c.getResponseText()),n>0){let e=c.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(O).indexOf(t)>=0?t:O.UNKNOWN}(t.status);o(new A(e,t.message))}else o(new A(O.UNKNOWN,"Server responded with status "+c.getStatus()))}else o(new A(O.UNAVAILABLE,"Connection failed."));break;default:E()}}finally{_(da,`RPC '${e}' ${i} completed.`)}}));const a=JSON.stringify(r);_(da,`RPC '${e}' ${i} sending request:`,r),c.send(t,"POST",a,n,15)}))}Fo(e,t,n){const r=la(),i=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=Object(h.i)(),o=Object(h.j)(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},a=this.longPollingOptions.timeoutSeconds;void 0!==a&&(c.longPollingTimeout=Math.round(1e3*a)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Do(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;const u=i.join("");_(da,`Creating RPC '${e}' stream ${r}: ${u}`,c);const l=s.createWebChannel(u,c);let d=!1,f=!1;const m=new ha({lo:t=>{f?_(da,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(d||(_(da,`Opening RPC '${e}' stream ${r} transport.`),l.open(),d=!0),_(da,`RPC '${e}' stream ${r} sending:`,t),l.send(t))},ho:()=>l.close()}),y=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return y(l,h.g.EventType.OPEN,(()=>{f||_(da,`RPC '${e}' stream ${r} transport opened.`)})),y(l,h.g.EventType.CLOSE,(()=>{f||(f=!0,_(da,`RPC '${e}' stream ${r} transport closed`),m.Vo())})),y(l,h.g.EventType.ERROR,(t=>{f||(f=!0,I(da,`RPC '${e}' stream ${r} transport errored:`,t),m.Vo(new A(O.UNAVAILABLE,"The operation could not be completed")))})),y(l,h.g.EventType.MESSAGE,(t=>{var n;if(!f){const i=t.data[0];C(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){_(da,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=zr[e];if(void 0!==t)return Gr(t)}(t),i=o.message;void 0===n&&(n=O.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),f=!0,m.Vo(new A(n,i)),l.close()}else _(da,`RPC '${e}' stream ${r} received:`,i),m.mo(i)}})),y(o,h.b.STAT_EVENT,(t=>{t.stat===h.f.PROXY?_(da,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===h.f.NOPROXY&&_(da,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{m.Ro()}),0),m}}function pa(){return"undefined"!=typeof window?window:null}function ma(){return"undefined"!=typeof document?document:null}function ga(e){return new fi(e,!0)}class ya{constructor(e,t,n=1e3,r=1.5,i=6e4){this.oi=e,this.timerId=t,this.Mo=n,this.xo=r,this.Oo=i,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();const t=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Lo),r=Math.max(0,t-n);r>0&&_("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.No} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Lo=Date.now(),e()))),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Bo&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){null!==this.Bo&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}}class wa{constructor(e,t,n,r,i,s,o,c){this.oi=e,this.$o=n,this.Uo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=c,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new ya(e,t)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,(()=>this.e_())))}t_(e){this.n_(),this.stream.send(e)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(e,t){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==e?this.jo.reset():t&&t.code===O.RESOURCE_EXHAUSTED?(v(t.toString()),v("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):t&&t.code===O.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.To(t)}i_(){}auth(){this.state=1;const e=this.s_(this.Wo),t=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Wo===t&&this.o_(e,n)}),(t=>{e((()=>{const e=new A(O.UNKNOWN,"Fetching auth token failed: "+t.message);return this.__(e)}))}))}o_(e,t){const n=this.s_(this.Wo);this.stream=this.a_(e,t),this.stream.Po((()=>{n((()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,(()=>(this.Jo()&&(this.state=3),Promise.resolve()))),this.listener.Po())))})),this.stream.To((e=>{n((()=>this.__(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Yo(){this.state=5,this.jo.qo((async()=>{this.state=0,this.start()}))}__(e){return _("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return t=>{this.oi.enqueueAndForget((()=>this.Wo===e?t():(_("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class _a extends wa{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}a_(e,t){return this.connection.Fo("Listen",e,t)}onMessage(e){this.jo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:E()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(C(void 0===t||"string"==typeof t),pt.fromBase64String(t||"")):(C(void 0===t||t instanceof Uint8Array),pt.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,c=o&&function(e){const t=void 0===e.code?O.UNKNOWN:Gr(e.code);return new A(t,e.message||"")}(o);n=new ii(r,i,s,c||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=Ti(e,r.document.name),s=wi(r.document.updateTime),o=r.document.createTime?wi(r.document.createTime):G.min(),c=new Kt({mapValue:{fields:r.document.fields}}),a=Ht.newFoundDocument(i,s,o,c),u=r.targetIds||[],l=r.removedTargetIds||[];n=new ni(u,l,a.key,a)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=Ti(e,r.document),s=r.readTime?wi(r.readTime):G.min(),o=Ht.newNoDocument(i,s),c=r.removedTargetIds||[];n=new ni([],c,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=Ti(e,r.document),s=r.removedTargetIds||[];n=new ni([],s,i,null)}else{if(!("filter"in t))return E();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new Br(r,i),o=e.targetId;n=new ri(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return G.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?G.min():t.readTime?wi(t.readTime):G.min()}(e);return this.listener.u_(t,n)}c_(e){const t={};t.database=Si(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Tn(r)?{documents:Ri(e,r)}:{query:Pi(e,r).ut},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=gi(e,t.resumeToken);const r=pi(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(G.min())>0){n.readTime=mi(e,t.snapshotVersion.toTimestamp());const r=pi(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return E()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.t_(t)}l_(e){const t={};t.database=Si(this.serializer),t.removeTarget=e,this.t_(t)}}class va extends wa{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,t){return this.connection.Fo("Write",e,t)}onMessage(e){if(C(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();const t=function(e,t){return e&&e.length>0?(C(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?wi(e.updateTime):wi(t);return n.isEqual(G.min())&&(n=wi(t)),new Tr(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=wi(e.commitTime);return this.listener.T_(n,t)}return C(!e.writeResults||0===e.writeResults.length),this.h_=!0,this.listener.E_()}d_(){const e={};e.database=Si(this.serializer),this.t_(e)}I_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>xi(this.serializer,e)))};this.t_(t)}}class ba extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new A(O.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,n,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.So(e,vi(t,n),r,i,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===O.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new A(O.UNKNOWN,e.toString())}))}vo(e,t,n,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.vo(e,vi(t,n),r,s,o,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===O.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new A(O.UNKNOWN,e.toString())}))}terminate(){this.A_=!0,this.connection.terminate()}}class Ia{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve()))))}S_(e){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,"Online"===e&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(v(t),this.g_=!1):_("OnlineStateTracker",t)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class Ta{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=i,this.M_.io((e=>{n.enqueueAndForget((async()=>{Ra(this)&&(_("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=k(e);t.v_.add(4),await Ca(t),t.x_.set("Unknown"),t.v_.delete(4),await Ea(t)}(this))}))})),this.x_=new Ia(n,r)}}async function Ea(e){if(Ra(e))for(const t of e.F_)await t(!0)}async function Ca(e){for(const t of e.F_)await t(!1)}function Sa(e,t){const n=k(e);n.C_.has(t.targetId)||(n.C_.set(t.targetId,t),Na(n)?xa(n):Ya(n).Jo()&&Oa(n,t))}function ka(e,t){const n=k(e),r=Ya(n);n.C_.delete(t),r.Jo()&&Aa(n,t),0===n.C_.size&&(r.Jo()?r.Xo():Ra(n)&&n.x_.set("Unknown"))}function Oa(e,t){if(e.O_.Oe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(G.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Ya(e).c_(t)}function Aa(e,t){e.O_.Oe(t),Ya(e).l_(t)}function xa(e){e.O_=new oi({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),_t:t=>e.C_.get(t)||null,nt:()=>e.datastore.serializer.databaseId}),Ya(e).start(),e.x_.p_()}function Na(e){return Ra(e)&&!Ya(e).Ho()&&e.C_.size>0}function Ra(e){return 0===k(e).v_.size}function Pa(e){e.O_=void 0}async function Da(e){e.C_.forEach(((t,n)=>{Oa(e,t)}))}async function La(e,t){Pa(e),Na(e)?(e.x_.S_(t),xa(e)):e.x_.set("Unknown")}async function Ma(e,t,n){if(e.x_.set("Online"),t instanceof ii&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.C_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.C_.delete(r),e.O_.removeTarget(r))}(e,t)}catch(n){_("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await ja(e,n)}else if(t instanceof ni?e.O_.$e(t):t instanceof ri?e.O_.Je(t):e.O_.Ge(t),!n.isEqual(G.min()))try{const t=await Vo(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.O_.it(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.C_.get(r);i&&e.C_.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.C_.get(t);if(!r)return;e.C_.set(t,r.withResumeToken(pt.EMPTY_BYTE_STRING,r.snapshotVersion)),Aa(e,t);const i=new Wi(r.target,t,n,r.sequenceNumber);Oa(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){_("RemoteStore","Failed to raise snapshot:",t),await ja(e,t)}}async function ja(e,t,n){if(!me(t))throw t;e.v_.add(1),await Ca(e),e.x_.set("Offline"),n||(n=()=>Vo(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{_("RemoteStore","Retrying IndexedDB access"),await n(),e.v_.delete(1),await Ea(e)}))}function Fa(e,t){return t().catch((n=>ja(e,n,t)))}async function Ua(e){const t=k(e),n=Ja(t);let r=t.D_.length>0?t.D_[t.D_.length-1].batchId:-1;for(;Va(t);)try{const e=await Bo(t.localStore,r);if(null===e){0===t.D_.length&&n.Xo();break}r=e.batchId,qa(t,e)}catch(e){await ja(t,e)}Ba(t)&&za(t)}function Va(e){return Ra(e)&&e.D_.length<10}function qa(e,t){e.D_.push(t);const n=Ja(e);n.Jo()&&n.P_&&n.I_(t.mutations)}function Ba(e){return Ra(e)&&!Ja(e).Ho()&&e.D_.length>0}function za(e){Ja(e).start()}async function Wa(e){Ja(e).d_()}async function Ka(e){const t=Ja(e);for(const n of e.D_)t.I_(n.mutations)}async function Ga(e,t,n){const r=e.D_.shift(),i=Vr.from(r,t,n);await Fa(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await Ua(e)}async function Ha(e,t){t&&Ja(e).P_&&await async function(e,t){if(function(e){return Kr(e)&&e!==O.ABORTED}(t.code)){const n=e.D_.shift();Ja(e).Zo(),await Fa(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Ua(e)}}(e,t),Ba(e)&&za(e)}async function $a(e,t){const n=k(e);n.asyncQueue.verifyOperationInProgress(),_("RemoteStore","RemoteStore received new credentials");const r=Ra(n);n.v_.add(3),await Ca(n),r&&n.x_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.v_.delete(3),await Ea(n)}async function Qa(e,t){const n=k(e);t?(n.v_.delete(2),await Ea(n)):t||(n.v_.add(2),await Ca(n),n.x_.set("Unknown"))}function Ya(e){return e.N_||(e.N_=function(e,t,n){const r=k(e);return r.R_(),new _a(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:Da.bind(null,e),To:La.bind(null,e),u_:Ma.bind(null,e)}),e.F_.push((async t=>{t?(e.N_.Zo(),Na(e)?xa(e):e.x_.set("Unknown")):(await e.N_.stop(),Pa(e))}))),e.N_}function Ja(e){return e.B_||(e.B_=function(e,t,n){const r=k(e);return r.R_(),new va(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:Wa.bind(null,e),To:Ha.bind(null,e),E_:Ka.bind(null,e),T_:Ga.bind(null,e)}),e.F_.push((async t=>{t?(e.B_.Zo(),await Ua(e)):(await e.B_.stop(),e.D_.length>0&&(_("RemoteStore",`Stopping write stream with ${e.D_.length} pending writes`),e.D_=[]))}))),e.B_}class Xa{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new x,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new Xa(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new A(O.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Za(e,t){if(v("AsyncQueue",`${t}: ${e}`),me(e))return new A(O.UNAVAILABLE,`${t}: ${e}`);throw e}class ec{constructor(e){this.comparator=e?(t,n)=>e(t,n)||J.comparator(t.key,n.key):(e,t)=>J.comparator(e.key,t.key),this.keyedMap=$n(),this.sortedSet=new it(this.comparator)}static emptySet(e){return new ec(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ec))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new ec;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class tc{constructor(){this.L_=new it(J.comparator)}track(e){const t=e.doc.key,n=this.L_.get(t);n?0!==e.type&&3===n.type?this.L_=this.L_.insert(t,e):3===e.type&&1!==n.type?this.L_=this.L_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.L_=this.L_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.L_=this.L_.remove(t):1===e.type&&2===n.type?this.L_=this.L_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):E():this.L_=this.L_.insert(t,e)}k_(){const e=[];return this.L_.inorderTraversal(((t,n)=>{e.push(n)})),e}}class nc{constructor(e,t,n,r,i,s,o,c,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=c,this.hasCachedResults=a}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new nc(e,t,ec.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&jn(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class rc{constructor(){this.q_=void 0,this.Q_=[]}}class ic{constructor(){this.queries=new Wn((e=>Fn(e)),jn),this.onlineState="Unknown",this.K_=new Set}}async function sc(e,t){const n=k(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new rc),i)try{s.q_=await n.onListen(r)}catch(e){const n=Za(e,`Initialization of query '${Un(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.Q_.push(t),t.U_(n.onlineState),s.q_&&t.W_(s.q_)&&lc(n)}async function oc(e,t){const n=k(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.Q_.indexOf(t);e>=0&&(s.Q_.splice(e,1),i=0===s.Q_.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function ac(e,t){const n=k(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.Q_)t.W_(e)&&(r=!0);i.q_=e}}r&&lc(n)}function cc(e,t,n){const r=k(e),i=r.queries.get(t);if(i)for(const e of i.Q_)e.onError(n);r.queries.delete(t)}function lc(e){e.K_.forEach((e=>{e.next()}))}class uc{constructor(e,t,n){this.query=e,this.G_=t,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=n||{}}W_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new nc(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.z_?this.H_(e)&&(this.G_.next(e),t=!0):this.J_(e,this.onlineState)&&(this.Y_(e),t=!0),this.j_=e,t}onError(e){this.G_.error(e)}U_(e){this.onlineState=e;let t=!1;return this.j_&&!this.z_&&this.J_(this.j_,e)&&(this.Y_(this.j_),t=!0),t}J_(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Z_||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}H_(e){if(e.docChanges.length>0)return!0;const t=this.j_&&this.j_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Y_(e){e=nc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.z_=!0,this.G_.next(e)}}class hc{constructor(e,t){this.X_=e,this.byteLength=t}ea(){return"metadata"in this.X_}}class dc{constructor(e){this.serializer=e}Ps(e){return Ti(this.serializer,e)}Is(e){return e.metadata.exists?Ai(this.serializer,e.document,!1):Ht.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return wi(e)}}class fc{constructor(e,t,n){this.ta=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=pc(e)}na(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.X_.namedQuery)this.queries.push(e.X_.namedQuery);else if(e.X_.documentMetadata){this.documents.push({metadata:e.X_.documentMetadata}),e.X_.documentMetadata.exists||++t;const n=$.fromString(e.X_.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.X_.document&&(this.documents[this.documents.length-1].document=e.X_.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ra(e){const t=new Map,n=new dc(this.serializer);for(const r of e)if(r.metadata.queries){const e=n.Ps(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||nr()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=k(e);let s=nr(),o=Gn();for(const e of n){const n=t.Ps(e.metadata.name);e.document&&(s=s.add(n));const r=t.Is(e);r.setReadTime(t.Ts(e.metadata.readTime)),o=o.insert(n,r)}const c=i.os.newChangeBuffer({trackRemovals:!0}),a=await zo(i,function(e){return Pn(An($.fromString(`__bundle__/docs/${e}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",(e=>qo(e,c,o).next((t=>(c.apply(e),t))).next((t=>i.Qr.removeMatchingKeysForTargetId(e,a.targetId).next((()=>i.Qr.addMatchingKeys(e,s,a.targetId))).next((()=>i.localDocuments.getLocalViewOfDocuments(e,t.cs,t.ls))).next((()=>t.cs))))))}(this.localStore,new dc(this.serializer),this.documents,this.ta.id),t=this.ra(this.documents);for(const e of this.queries)await Qo(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,ia:this.collectionGroups,sa:e}}}function pc(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class mc{constructor(e){this.key=e}}class gc{constructor(e){this.key=e}}class yc{constructor(e,t){this.query=e,this.oa=t,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=nr(),this.mutatedKeys=nr(),this.ua=Bn(e),this.ca=new ec(this.ua)}get la(){return this.oa}ha(e,t){const n=t?t.Pa:new tc,r=t?t.ca:this.ca;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const c="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,a="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=Vn(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.Ia(u,l)||(n.track({type:2,doc:l}),f=!0,(c&&this.ua(l,c)>0||a&&this.ua(l,a)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(c||a)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{ca:s,Pa:n,Xi:o,mutatedKeys:i}}Ia(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.ca;this.ca=e.ca,this.mutatedKeys=e.mutatedKeys;const s=e.Pa.k_();s.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return E()}};return n(e)-n(t)}(e.type,t.type)||this.ua(e.doc,t.doc))),this.Ta(n),r=null!=r&&r;const o=t&&!r?this.Ea():[],c=0===this.aa.size&&this.current&&!r?1:0,a=c!==this._a;return this._a=c,0!==s.length||a?{snapshot:new nc(this.query,e.ca,i,s,e.mutatedKeys,0===c,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),da:o}:{da:o}}U_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new tc,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{da:[]}}Aa(e){return!this.oa.has(e)&&!!this.ca.has(e)&&!this.ca.get(e).hasLocalMutations}Ta(e){e&&(e.addedDocuments.forEach((e=>this.oa=this.oa.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.oa=this.oa.delete(e))),this.current=e.current)}Ea(){if(!this.current)return[];const e=this.aa;this.aa=nr(),this.ca.forEach((e=>{this.Aa(e.key)&&(this.aa=this.aa.add(e.key))}));const t=[];return e.forEach((e=>{this.aa.has(e)||t.push(new gc(e))})),this.aa.forEach((n=>{e.has(n)||t.push(new mc(n))})),t}Ra(e){this.oa=e.hs,this.aa=nr();const t=this.ha(e.documents);return this.applyChanges(t,!0)}Va(){return nc.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,0===this._a,this.hasCachedResults)}}class wc{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class _c{constructor(e){this.key=e,this.ma=!1}}class vc{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.fa={},this.ga=new Wn((e=>Fn(e)),jn),this.pa=new Map,this.ya=new Set,this.wa=new it(J.comparator),this.Sa=new Map,this.ba=new wo,this.Da={},this.Ca=new Map,this.va=Gs.Bn(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return!0===this.Fa}}async function bc(e,t){const n=Hc(e);let r,i;const s=n.ga.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Va();else{const e=await zo(n.localStore,Pn(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await Ic(n,t,r,"current"===s,e.resumeToken),n.isPrimaryClient&&Sa(n.remoteStore,e)}return i}async function Ic(e,t,n,r,i){e.Ma=(t,n,r)=>async function(e,t,n,r){let i=t.view.ha(n);i.Xi&&(i=await Ko(e.localStore,t.query,!1).then((({documents:e})=>t.view.ha(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),c=t.view.applyChanges(i,e.isPrimaryClient,s,o);return Pc(e,t.targetId,c.da),c.snapshot}(e,t,n,r);const s=await Ko(e.localStore,t,!0),o=new yc(t,s.hs),c=o.ha(s.documents),a=ti.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(c,e.isPrimaryClient,a);Pc(e,n,u.da);const l=new wc(t,n,o);return e.ga.set(t,l),e.pa.has(n)?e.pa.get(n).push(t):e.pa.set(n,[t]),u.snapshot}async function Tc(e,t){const n=k(e),r=n.ga.get(t),i=n.pa.get(r.targetId);if(i.length>1)return n.pa.set(r.targetId,i.filter((e=>!jn(e,t)))),void n.ga.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Wo(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),ka(n.remoteStore,r.targetId),Nc(n,r.targetId)})).catch(le)):(Nc(n,r.targetId),await Wo(n.localStore,r.targetId,!0))}async function Ec(e,t){const n=k(e);try{const e=await function(e,t){const n=k(e),r=t.snapshotVersion;let i=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;const o=[];t.targetChanges.forEach(((s,c)=>{const a=i.get(c);if(!a)return;o.push(n.Qr.removeMatchingKeys(e,s.removedDocuments,c).next((()=>n.Qr.addMatchingKeys(e,s.addedDocuments,c))));let u=a.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(c)?u=u.withResumeToken(pt.EMPTY_BYTE_STRING,G.min()).withLastLimboFreeSnapshotVersion(G.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(c,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,u,s)&&o.push(n.Qr.updateTargetData(e,u))}));let c=Gn(),a=nr();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(qo(e,s,t.documentUpdates).next((e=>{c=e.cs,a=e.ls}))),!r.isEqual(G.min())){const t=n.Qr.getLastRemoteSnapshotVersion(e).next((t=>n.Qr.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return ue.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,c,a))).next((()=>c))})).then((e=>(n.ns=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Sa.get(t);r&&(C(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.ma=!0:e.modifiedDocuments.size>0?C(r.ma):e.removedDocuments.size>0&&(C(r.ma),r.ma=!1))})),await Mc(n,e,t)}catch(e){await le(e)}}function Cc(e,t,n){const r=k(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.ga.forEach(((n,r)=>{const i=r.view.U_(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=k(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.Q_)e.U_(t)&&(r=!0)})),r&&lc(n)}(r.eventManager,t),e.length&&r.fa.u_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Sc(e,t,n){const r=k(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Sa.get(t),s=i&&i.key;if(s){let e=new it(J.comparator);e=e.insert(s,Ht.newNoDocument(s,G.min()));const n=nr().add(s),i=new ei(G.min(),new Map,new it(B),e,n);await Ec(r,i),r.wa=r.wa.remove(s),r.Sa.delete(t),Lc(r)}else await Wo(r.localStore,t,!1).then((()=>Nc(r,t,n))).catch(le)}async function kc(e,t){const n=k(e),r=t.batch.batchId;try{const e=await function(e,t){const n=k(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.os.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=ue.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);C(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=nr();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);xc(n,r,null),Ac(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Mc(n,e)}catch(e){await le(e)}}async function Oc(e,t,n){const r=k(e);try{const e=await function(e,t){const n=k(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(C(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);xc(r,t,n),Ac(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Mc(r,e)}catch(n){await le(n)}}function Ac(e,t){(e.Ca.get(t)||[]).forEach((e=>{e.resolve()})),e.Ca.delete(t)}function xc(e,t,n){const r=k(e);let i=r.Da[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Da[r.currentUser.toKey()]=i}}function Nc(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.pa.get(t))e.ga.delete(r),n&&e.fa.xa(r,n);e.pa.delete(t),e.isPrimaryClient&&e.ba.Vr(t).forEach((t=>{e.ba.containsKey(t)||Rc(e,t)}))}function Rc(e,t){e.ya.delete(t.path.canonicalString());const n=e.wa.get(t);null!==n&&(ka(e.remoteStore,n),e.wa=e.wa.remove(t),e.Sa.delete(n),Lc(e))}function Pc(e,t,n){for(const r of n)r instanceof mc?(e.ba.addReference(r.key,t),Dc(e,r)):r instanceof gc?(_("SyncEngine","Document no longer in limbo: "+r.key),e.ba.removeReference(r.key,t),e.ba.containsKey(r.key)||Rc(e,r.key)):E()}function Dc(e,t){const n=t.key,r=n.path.canonicalString();e.wa.get(n)||e.ya.has(r)||(_("SyncEngine","New document in limbo: "+n),e.ya.add(r),Lc(e))}function Lc(e){for(;e.ya.size>0&&e.wa.size<e.maxConcurrentLimboResolutions;){const t=e.ya.values().next().value;e.ya.delete(t);const n=new J($.fromString(t)),r=e.va.next();e.Sa.set(r,new _c(n)),e.wa=e.wa.insert(n,r),Sa(e.remoteStore,new Wi(Pn(An(n.path)),r,"TargetPurposeLimboResolution",Ie._e))}}async function Mc(e,t,n){const r=k(e),i=[],s=[],o=[];r.ga.isEmpty()||(r.ga.forEach(((e,c)=>{o.push(r.Ma(c,t,n).then((e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(c.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=Do.Ki(c.targetId,e);s.push(t)}})))})),await Promise.all(o),r.fa.u_(i),await async function(e,t){const n=k(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>ue.forEach(t,(t=>ue.forEach(t.qi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>ue.forEach(t.Qi,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!me(e))throw e;_("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.ns.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(t,i)}}}(r.localStore,s))}async function jc(e,t){const n=k(e);if(!n.currentUser.isEqual(t)){_("SyncEngine","User change. New user:",t.toKey());const e=await Uo(n.localStore,t);n.currentUser=t,function(e,t){e.Ca.forEach((e=>{e.forEach((e=>{e.reject(new A(O.CANCELLED,t))}))})),e.Ca.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Mc(n,e.us)}}function Fc(e,t){const n=k(e),r=n.Sa.get(t);if(r&&r.ma)return nr().add(r.key);{let e=nr();const r=n.pa.get(t);if(!r)return e;for(const t of r){const r=n.ga.get(t);e=e.unionWith(r.view.la)}return e}}async function Uc(e,t){const n=k(e),r=await Ko(n.localStore,t.query,!0),i=t.view.Ra(r);return n.isPrimaryClient&&Pc(n,t.targetId,i.da),i}async function Vc(e,t){const n=k(e);return Ho(n.localStore,t).then((e=>Mc(n,e)))}async function qc(e,t,n,r){const i=k(e),s=await function(e,t){const n=k(e),r=k(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>r.vn(e,t).next((t=>t?n.localDocuments.getDocuments(e,t):ue.resolve(null)))))}(i.localStore,t);null!==s?("pending"===n?await Ua(i.remoteStore):"acknowledged"===n||"rejected"===n?(xc(i,t,r||null),Ac(i,t),function(e,t){k(k(e).mutationQueue).Mn(t)}(i.localStore,t)):E(),await Mc(i,s)):_("SyncEngine","Cannot apply mutation batch with id: "+t)}async function Bc(e,t,n){const r=k(e),i=[],s=[];for(const e of t){let t;const n=r.pa.get(e);if(n&&0!==n.length){t=await zo(r.localStore,Pn(n[0]));for(const e of n){const t=r.ga.get(e),n=await Uc(r,t);n.snapshot&&s.push(n.snapshot)}}else{const n=await Go(r.localStore,e);t=await zo(r.localStore,n),await Ic(r,zc(n),e,!1,t.resumeToken)}i.push(t)}return r.fa.u_(s),i}function zc(e){return On(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Wc(e){return function(e){return k(k(e).persistence).Li()}(k(e).localStore)}async function Kc(e,t,n,r){const i=k(e);if(i.Fa)return void _("SyncEngine","Ignoring unexpected query state notification.");const s=i.pa.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{const e=await Ho(i.localStore,qn(s[0])),r=ei.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,pt.EMPTY_BYTE_STRING);await Mc(i,e,r);break}case"rejected":await Wo(i.localStore,t,!0),Nc(i,t,r);break;default:E()}}async function Gc(e,t,n){const r=Hc(e);if(r.Fa){for(const e of t){if(r.pa.has(e)){_("SyncEngine","Adding an already active target "+e);continue}const t=await Go(r.localStore,e),n=await zo(r.localStore,t);await Ic(r,zc(t),n.targetId,!1,n.resumeToken),Sa(r.remoteStore,n)}for(const e of n)r.pa.has(e)&&await Wo(r.localStore,e,!1).then((()=>{ka(r.remoteStore,e),Nc(r,e)})).catch(le)}}function Hc(e){const t=k(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Ec.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Fc.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Sc.bind(null,t),t.fa.u_=ac.bind(null,t.eventManager),t.fa.xa=cc.bind(null,t.eventManager),t}function $c(e){const t=k(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=kc.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Oc.bind(null,t),t}class Qc{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=ga(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Fo(this.persistence,new Mo,e.initialUser,this.serializer)}createPersistence(e){return new Eo(So.Hr,this.serializer)}createSharedClientState(e){return new sa}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Yc extends Qc{constructor(e,t,n){super(),this.Na=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Na.initialize(this,e),await $c(this.Na.syncEngine),await Ua(this.Na.remoteStore),await this.persistence.fi((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}createLocalStore(e){return Fo(this.persistence,new Mo,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new Zs(n,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new be(t,this.persistence);return new ve(e.asyncQueue,n)}createPersistence(e){const t=Po(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Fs.withCacheSize(this.cacheSizeBytes):Fs.DEFAULT;return new xo(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,pa(),ma(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new sa}}class Jc extends Yc{constructor(e,t){super(e,t,!1),this.Na=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Na.syncEngine;this.sharedClientState instanceof ia&&(this.sharedClientState.syncEngine={Zs:qc.bind(null,t),Xs:Kc.bind(null,t),eo:Gc.bind(null,t),Li:Wc.bind(null,t),Ys:Vc.bind(null,t)},await this.sharedClientState.start()),await this.persistence.fi((async e=>{await async function(e,t){const n=k(e);if(Hc(n),$c(n),!0===t&&!0!==n.Fa){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await Bc(n,e.toArray());n.Fa=!0,await Qa(n.remoteStore,!0);for(const e of t)Sa(n.remoteStore,e)}else if(!1===t&&!1!==n.Fa){const e=[];let t=Promise.resolve();n.pa.forEach(((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then((()=>(Nc(n,i),Wo(n.localStore,i,!0)))),ka(n.remoteStore,i)})),await t,await Bc(n,e),function(e){const t=k(e);t.Sa.forEach(((e,n)=>{ka(t.remoteStore,n)})),t.ba.mr(),t.Sa=new Map,t.wa=new it(J.comparator)}(n),n.Fa=!1,await Qa(n.remoteStore,!1)}}(this.Na.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())}))}createSharedClientState(e){const t=pa();if(!ia.D(t))throw new A(O.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Po(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new ia(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Xc{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Cc(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=jc.bind(null,this.syncEngine),await Qa(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new ic}createDatastore(e){const t=ga(e.databaseInfo.databaseId),n=function(e){return new fa(e)}(e.databaseInfo);return function(e,t,n,r){return new ba(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new Ta(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(e=>Cc(this.syncEngine,e,0)),aa.D()?new aa:new oa)}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const c=new vc(e,t,n,r,i,s);return o&&(c.Fa=!0),c}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e;await async function(e){const t=k(e);_("RemoteStore","RemoteStore shutting down."),t.v_.add(5),await Ca(t),t.M_.shutdown(),t.x_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate()}}function Zc(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class el{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ba(this.observer.next,e)}error(e){this.observer.error?this.Ba(this.observer.error,e):v("Uncaught Error in snapshot listener:",e.toString())}La(){this.muted=!0}Ba(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class tl{constructor(e,t){this.ka=e,this.serializer=t,this.metadata=new x,this.buffer=new Uint8Array,this.qa=new TextDecoder("utf-8"),this.Qa().then((e=>{e&&e.ea()?this.metadata.resolve(e.X_.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.X_)}`))}),(e=>this.metadata.reject(e)))}close(){return this.ka.cancel()}async getMetadata(){return this.metadata.promise}async Oa(){return await this.getMetadata(),this.Qa()}async Qa(){const e=await this.Ka();if(null===e)return null;const t=this.qa.decode(e),n=Number(t);isNaN(n)&&this.$a(`length string (${t}) is not valid number`);const r=await this.Ua(n);return new hc(JSON.parse(r),e.length+n)}Wa(){return this.buffer.findIndex((e=>e==="{".charCodeAt(0)))}async Ka(){for(;this.Wa()<0&&!await this.Ga(););if(0===this.buffer.length)return null;const e=this.Wa();e<0&&this.$a("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Ua(e){for(;this.buffer.length<e;)await this.Ga()&&this.$a("Reached the end of bundle when more is expected.");const t=this.qa.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}$a(e){throw this.ka.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ga(){const e=await this.ka.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class nl{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new A(O.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(e,t){const n=k(e),r={documents:t.map((e=>Ii(n.serializer,e)))},i=await n.vo("BatchGetDocuments",n.serializer.databaseId,$.emptyPath(),r,t.length),s=new Map;i.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){C(!!t.found),t.found.name,t.found.updateTime;const n=Ti(e,t.found.name),r=wi(t.found.updateTime),i=t.found.createTime?wi(t.found.createTime):G.min(),s=new Kt({mapValue:{fields:t.found.fields}});return Ht.newFoundDocument(n,r,i,s)}(e,t):"missing"in t?function(e,t){C(!!t.missing),C(!!t.readTime);const n=Ti(e,t.missing),r=wi(t.readTime);return Ht.newNoDocument(n,r)}(e,t):E()}(n.serializer,e);s.set(t.key.toString(),t)}));const o=[];return t.forEach((e=>{const t=s.get(e.toString());C(!!t),o.push(t)})),o}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new jr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=J.fromPath(t);this.mutations.push(new Fr(n,this.precondition(n)))})),await async function(e,t){const n=k(e),r={writes:t.map((e=>xi(n.serializer,e)))};await n.So("Commit",n.serializer.databaseId,$.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw E();t=G.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new A(O.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(G.min())?Er.exists(!1):Er.updateTime(t):Er.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(G.min()))throw new A(O.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Er.updateTime(t)}return Er.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class rl{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.za=n.maxAttempts,this.jo=new ya(this.asyncQueue,"transaction_retry")}ja(){this.za-=1,this.Ha()}Ha(){this.jo.qo((async()=>{const e=new nl(this.datastore),t=this.Ja(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.Ya(e)}))))})).catch((e=>{this.Ya(e)}))}))}Ja(e){try{const t=this.updateFunction(e);return!Te(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Ya(e){this.za>0&&this.Za(e)?(this.za-=1,this.asyncQueue.enqueueAndForget((()=>(this.Ha(),Promise.resolve())))):this.deferred.reject(e)}Za(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Kr(t)}return!1}}class il{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=f.UNAUTHENTICATED,this.clientId=V.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{_("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(_("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new A(O.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new x;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Za(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function sl(e,t){e.asyncQueue.verifyOperationInProgress(),_("FirestoreClient","Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await Uo(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function al(e,t){e.asyncQueue.verifyOperationInProgress();const n=await ll(e);_("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>$a(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>$a(t.remoteStore,n))),e._onlineComponents=t}function cl(e){return"FirebaseError"===e.name?e.code===O.FAILED_PRECONDITION||e.code===O.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function ll(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){_("FirestoreClient","Using user provided OfflineComponentProvider");try{await sl(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!cl(n))throw n;I("Error using user provided cache. Falling back to memory cache: "+n),await sl(e,new Qc)}}else _("FirestoreClient","Using default OfflineComponentProvider"),await sl(e,new Qc);return e._offlineComponents}async function hl(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(_("FirestoreClient","Using user provided OnlineComponentProvider"),await al(e,e._uninitializedComponentsProvider._online)):(_("FirestoreClient","Using default OnlineComponentProvider"),await al(e,new Xc))),e._onlineComponents}function fl(e){return ll(e).then((e=>e.persistence))}function pl(e){return ll(e).then((e=>e.localStore))}function ml(e){return hl(e).then((e=>e.remoteStore))}function gl(e){return hl(e).then((e=>e.syncEngine))}function yl(e){return hl(e).then((e=>e.datastore))}async function wl(e){const t=await hl(e),n=t.eventManager;return n.onListen=bc.bind(null,t.syncEngine),n.onUnlisten=Tc.bind(null,t.syncEngine),n}function _l(e,t,n={}){const r=new x;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new el({next:s=>{t.enqueueAndForget((()=>oc(e,o)));const c=s.docs.has(n);!c&&s.fromCache?i.reject(new A(O.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&s.fromCache&&r&&"server"===r.source?i.reject(new A(O.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new uc(An(n.path),s,{includeMetadataChanges:!0,Z_:!0});return sc(e,o)}(await wl(e),e.asyncQueue,t,n,r))),r.promise}function vl(e,t,n={}){const r=new x;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new el({next:n=>{t.enqueueAndForget((()=>oc(e,o))),n.fromCache&&"server"===r.source?i.reject(new A(O.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new uc(n,s,{includeMetadataChanges:!0,Z_:!0});return sc(e,o)}(await wl(e),e.asyncQueue,t,n,r))),r.promise}function bl(e,t,n,r){const i=function(e,t){let n;return n="string"==typeof e?$r().encode(e):e,function(e,t){return new tl(e,t)}(function(e,t){if(e instanceof Uint8Array)return Zc(e,t);if(e instanceof ArrayBuffer)return Zc(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,ga(t));e.asyncQueue.enqueueAndForget((async()=>{!function(e,t,n){const r=k(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=k(e),r=wi(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(e=>n.$r.getBundleMetadata(e,t.id))).then((e=>!!e&&e.createTime.compareTo(r)>=0))}(e.localStore,r))return await t.close(),n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(pc(r));const i=new fc(r,e.localStore,t.serializer);let s=await t.Oa();for(;s;){const e=await i.na(s);e&&n._updateProgress(e),s=await t.Oa()}const o=await i.complete();return await Mc(e,o.sa,void 0),await function(e,t){const n=k(e);return n.persistence.runTransaction("Save bundle","readwrite",(e=>n.$r.saveBundleMetadata(e,t)))}(e.localStore,r),n._completeWith(o.progress),Promise.resolve(o.ia)}catch(e){return I("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(r,t,n).then((e=>{r.sharedClientState.notifyBundleLoaded(e)}))}(await gl(e),i,r)}))}function Il(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Tl=new Map;function El(e,t,n){if(!n)throw new A(O.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Cl(e,t,n,r){if(!0===t&&!0===r)throw new A(O.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Sl(e){if(!J.isDocumentKey(e))throw new A(O.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function kl(e){if(J.isDocumentKey(e))throw new A(O.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Ol(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":E()}function Al(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new A(O.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Ol(e);throw new A(O.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function xl(e,t){if(t<=0)throw new A(O.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class Nl{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new A(O.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new A(O.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Cl("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Il(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new A(O.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new A(O.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new A(O.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Rl{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Nl({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new A(O.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new A(O.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Nl(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new R;switch(e.type){case"firstParty":return new M(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new A(O.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Tl.get(e);t&&(_("ComponentProvider","Removing Datastore"),Tl.delete(e),t.terminate())}(this),Promise.resolve()}}function Pl(e,t,n,r={}){var i;const s=(e=Al(e,Rl))._getSettings(),o=`${t}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&I("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=f.MOCK_USER;else{t=Object(l.l)(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new A(O.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new f(s)}e._authCredentials=new P(new N(t,n))}}class Dl{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Dl(this.firestore,e,this._query)}}class Ll{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ml(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ll(this.firestore,e,this._key)}}class Ml extends Dl{constructor(e,t,n){super(e,t,An(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ll(this.firestore,null,new J(e))}withConverter(e){return new Ml(this.firestore,e,this._path)}}function jl(e,t,...n){if(e=Object(l.w)(e),El("collection","path",t),e instanceof Rl){const r=$.fromString(t,...n);return kl(r),new Ml(e,null,r)}{if(!(e instanceof Ll||e instanceof Ml))throw new A(O.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child($.fromString(t,...n));return kl(r),new Ml(e.firestore,null,r)}}function Fl(e,t){if(e=Al(e,Rl),El("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new A(O.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Dl(e,null,function(e){return new kn($.emptyPath(),e)}(t))}function Ul(e,t,...n){if(e=Object(l.w)(e),1===arguments.length&&(t=V.newId()),El("doc","path",t),e instanceof Rl){const r=$.fromString(t,...n);return Sl(r),new Ll(e,null,new J(r))}{if(!(e instanceof Ll||e instanceof Ml))throw new A(O.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child($.fromString(t,...n));return Sl(r),new Ll(e.firestore,e instanceof Ml?e.converter:null,new J(r))}}function Vl(e,t){return e=Object(l.w)(e),t=Object(l.w)(t),(e instanceof Ll||e instanceof Ml)&&(t instanceof Ll||t instanceof Ml)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function ql(e,t){return e=Object(l.w)(e),t=Object(l.w)(t),e instanceof Dl&&t instanceof Dl&&e.firestore===t.firestore&&jn(e._query,t._query)&&e.converter===t.converter}class Bl{constructor(){this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new ya(this,"async_queue_retry"),this._u=()=>{const e=ma();e&&_("AsyncQueue","Visibility state changed to "+e.visibilityState),this.jo.Ko()};const e=ma();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this._u)}get isShuttingDown(){return this.tu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.au(),this.uu(e)}enterRestrictedMode(e){if(!this.tu){this.tu=!0,this.su=e||!1;const t=ma();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._u)}}enqueue(e){if(this.au(),this.tu)return new Promise((()=>{}));const t=new x;return this.uu((()=>this.tu&&this.su?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.eu.push(e),this.cu())))}async cu(){if(0!==this.eu.length){try{await this.eu[0](),this.eu.shift(),this.jo.reset()}catch(e){if(!me(e))throw e;_("AsyncQueue","Operation failed with retryable error: "+e)}this.eu.length>0&&this.jo.qo((()=>this.cu()))}}uu(e){const t=this.Xa.then((()=>(this.iu=!0,e().catch((e=>{this.ru=e,this.iu=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw v("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.iu=!1,e))))));return this.Xa=t,t}enqueueAfterDelay(e,t,n){this.au(),this.ou.indexOf(e)>-1&&(t=0);const r=Xa.createAndSchedule(this,e,t,n,(e=>this.lu(e)));return this.nu.push(r),r}au(){this.ru&&E()}verifyOperationInProgress(){}async hu(){let e;do{e=this.Xa,await e}while(e!==this.Xa)}Pu(e){for(const t of this.nu)if(t.timerId===e)return!0;return!1}Iu(e){return this.hu().then((()=>{this.nu.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.nu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.hu()}))}Tu(e){this.ou.push(e)}lu(e){const t=this.nu.indexOf(e);this.nu.splice(t,1)}}function zl(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of t)if(e in n&&"function"==typeof n[e])return!0;return!1}(e,["next","error","complete"])}class Wl{constructor(){this._progressObserver={},this._taskCompletionResolver=new x,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}const Kl=-1;class Gl extends Rl{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Bl,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||$l(this),this._firestoreClient.terminate()}}function Hl(e){return e._firestoreClient||$l(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function $l(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new It(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Il(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new il(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function Ql(e,t){iu(e=Al(e,Gl));const n=Hl(e);if(n._uninitializedComponentsProvider)throw new A(O.FAILED_PRECONDITION,"SDK cache is already specified.");I("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=e._freezeSettings(),i=new Xc;return Jl(n,i,new Yc(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}function Yl(e){iu(e=Al(e,Gl));const t=Hl(e);if(t._uninitializedComponentsProvider)throw new A(O.FAILED_PRECONDITION,"SDK cache is already specified.");I("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=e._freezeSettings(),r=new Xc;return Jl(t,r,new Jc(r,n.cacheSizeBytes))}function Jl(e,t,n){const r=new x;return e.asyncQueue.enqueue((async()=>{try{await sl(e,n),await al(e,t),r.resolve()}catch(e){const t=e;if(!cl(t))throw t;I("Error enabling indexeddb cache. Falling back to memory cache: "+t),r.reject(t)}})).then((()=>r.promise))}function Xl(e){if(e._initialized&&!e._terminated)throw new A(O.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new x;return e._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(e){if(!de.D())return Promise.resolve();const t=e+"main";await de.delete(t)}(Po(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function Zl(e){return function(e){const t=new x;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t){const n=k(e);Ra(n.remoteStore)||_("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=k(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e)))}(n.localStore);if(-1===e)return void t.resolve();const r=n.Ca.get(e)||[];r.push(t),n.Ca.set(e,r)}catch(e){const n=Za(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await gl(e),t))),t.promise}(Hl(e=Al(e,Gl)))}function eu(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await fl(e),n=await ml(e);return t.setNetworkEnabled(!0),function(e){const t=k(e);return t.v_.delete(0),Ea(t)}(n)}))}(Hl(e=Al(e,Gl)))}function tu(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await fl(e),n=await ml(e);return t.setNetworkEnabled(!1),async function(e){const t=k(e);t.v_.add(0),await Ca(t),t.x_.set("Offline")}(n)}))}(Hl(e=Al(e,Gl)))}function nu(e,t){const n=Hl(e=Al(e,Gl)),r=new Wl;return bl(n,e._databaseId,t,r),r}function ru(e,t){return function(e,t){return e.asyncQueue.enqueue((async()=>function(e,t){const n=k(e);return n.persistence.runTransaction("Get named query","readonly",(e=>n.$r.getNamedQuery(e,t)))}(await pl(e),t)))}(Hl(e=Al(e,Gl)),t).then((t=>t?new Dl(e,null,t.query):null))}function iu(e){if(e._initialized||e._terminated)throw new A(O.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class su{constructor(e){this._byteString=e}static fromBase64String(e){try{return new su(pt.fromBase64String(e))}catch(e){throw new A(O.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new su(pt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class ou{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new A(O.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Y(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class au{constructor(e){this._methodName=e}}class cu{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new A(O.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new A(O.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return B(this._lat,e._lat)||B(this._long,e._long)}}const lu=/^__.*__$/;class uu{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Pr(e,this.data,this.fieldMask,t,this.fieldTransforms):new Rr(e,this.data,t,this.fieldTransforms)}}class hu{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Pr(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function du(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw E()}}class fu{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Eu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get du(){return this.settings.du}Au(e){return new fu(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ru(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Au({path:n,Vu:!1});return r.mu(e),r}fu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Au({path:n,Vu:!1});return r.Eu(),r}gu(e){return this.Au({path:void 0,Vu:!0})}pu(e){return Pu(e,this.settings.methodName,this.settings.yu||!1,this.path,this.settings.wu)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}Eu(){if(this.path)for(let e=0;e<this.path.length;e++)this.mu(this.path.get(e))}mu(e){if(0===e.length)throw this.pu("Document fields must not be empty");if(du(this.du)&&lu.test(e))throw this.pu('Document fields cannot begin and end with "__"')}}class pu{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||ga(e)}Su(e,t,n,r=!1){return new fu({du:e,methodName:t,wu:n,path:Y.emptyPath(),Vu:!1,yu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function mu(e){const t=e._freezeSettings(),n=ga(e._databaseId);return new pu(e._databaseId,!!t.ignoreUndefinedProperties,n)}function gu(e,t,n,r,i,s={}){const o=e.Su(s.merge||s.mergeFields?2:0,t,n,i);Au("Data must be an object, but it was:",o,r);const c=ku(r,o);let a,u;if(s.merge)a=new ut(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=xu(t,r,n);if(!o.contains(i))throw new A(O.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Du(e,i)||e.push(i)}a=new ut(e),u=o.fieldTransforms.filter((e=>a.covers(e.field)))}else a=null,u=o.fieldTransforms;return new uu(new Kt(c),a,u)}class yu extends au{_toFieldTransform(e){if(2!==e.du)throw 1===e.du?e.pu(`${this._methodName}() can only appear at the top level of your update data`):e.pu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof yu}}function wu(e,t,n){return new fu({du:3,wu:t.settings.wu,methodName:e._methodName,Vu:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class _u extends au{_toFieldTransform(e){return new Ir(e.path,new fr)}isEqual(e){return e instanceof _u}}class vu extends au{constructor(e,t){super(e),this.bu=t}_toFieldTransform(e){const t=wu(this,e,!0),n=this.bu.map((e=>Su(e,t))),r=new pr(n);return new Ir(e.path,r)}isEqual(e){return e instanceof vu&&Object(l.o)(this.bu,e.bu)}}class bu extends au{constructor(e,t){super(e),this.bu=t}_toFieldTransform(e){const t=wu(this,e,!0),n=this.bu.map((e=>Su(e,t))),r=new gr(n);return new Ir(e.path,r)}isEqual(e){return e instanceof bu&&Object(l.o)(this.bu,e.bu)}}class Iu extends au{constructor(e,t){super(e),this.Du=t}_toFieldTransform(e){const t=new wr(e.serializer,ar(e.serializer,this.Du));return new Ir(e.path,t)}isEqual(e){return e instanceof Iu&&this.Du===e.Du}}function Tu(e,t,n,r){const i=e.Su(1,t,n);Au("Data must be an object, but it was:",i,r);const s=[],o=Kt.empty();tt(r,((e,r)=>{const c=Ru(t,e,n);r=Object(l.w)(r);const a=i.fu(c);if(r instanceof yu)s.push(c);else{const e=Su(r,a);null!=e&&(s.push(c),o.set(c,e))}}));const c=new ut(s);return new hu(o,c,i.fieldTransforms)}function Eu(e,t,n,r,i,s){const o=e.Su(1,t,n),c=[xu(t,r,n)],a=[i];if(s.length%2!=0)throw new A(O.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)c.push(xu(t,s[e])),a.push(s[e+1]);const u=[],h=Kt.empty();for(let e=c.length-1;e>=0;--e)if(!Du(u,c[e])){const t=c[e];let n=a[e];n=Object(l.w)(n);const r=o.fu(t);if(n instanceof yu)u.push(t);else{const e=Su(n,r);null!=e&&(u.push(t),h.set(t,e))}}const d=new ut(u);return new hu(h,d,o.fieldTransforms)}function Cu(e,t,n,r=!1){return Su(n,e.Su(r?4:3,t))}function Su(e,t){if(Ou(e=Object(l.w)(e)))return Au("Unsupported field value:",t,e),ku(e,t);if(e instanceof au)return function(e,t){if(!du(t.du))throw t.pu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.pu(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Vu&&4!==t.du)throw t.pu("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Su(i,t.gu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=Object(l.w)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return ar(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=K.fromDate(e);return{timestampValue:mi(t.serializer,n)}}if(e instanceof K){const n=new K(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:mi(t.serializer,n)}}if(e instanceof cu)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof su)return{bytesValue:gi(t.serializer,e._byteString)};if(e instanceof Ll){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.pu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:_i(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.pu(`Unsupported field value: ${Ol(e)}`)}(e,t)}function ku(e,t){const n={};return nt(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):tt(e,((e,r)=>{const i=Su(r,t.Ru(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function Ou(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof K||e instanceof cu||e instanceof su||e instanceof Ll||e instanceof au)}function Au(e,t,n){if(!Ou(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Ol(n);throw"an object"===r?t.pu(e+" a custom object"):t.pu(e+" "+r)}}function xu(e,t,n){if((t=Object(l.w)(t))instanceof ou)return t._internalPath;if("string"==typeof t)return Ru(e,t);throw Pu("Field path arguments must be of type string or ",e,!1,void 0,n)}const Nu=new RegExp("[~\\*/\\[\\]]");function Ru(e,t,n){if(t.search(Nu)>=0)throw Pu(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new ou(...t.split("."))._internalPath}catch(r){throw Pu(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Pu(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let c=`Function ${t}() called with invalid data`;n&&(c+=" (via `toFirestore()`)"),c+=". ";let a="";return(s||o)&&(a+=" (found",s&&(a+=` in field ${r}`),o&&(a+=` in document ${i}`),a+=")"),new A(O.INVALID_ARGUMENT,c+e+a)}function Du(e,t){return e.some((e=>e.isEqual(t)))}class Lu{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Ll(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Mu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(ju("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Mu extends Lu{data(){return super.data()}}function ju(e,t){return"string"==typeof t?Ru(e,t):t instanceof ou?t._internalPath:t._delegate._internalPath}function Fu(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new A(O.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Uu{}class Vu extends Uu{}function qu(e,t,...n){let r=[];t instanceof Uu&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof Wu)).length,n=e.filter((e=>e instanceof Bu)).length;if(t>1||t>0&&n>0)throw new A(O.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class Bu extends Vu{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Bu(e,t,n)}_apply(e){const t=this._parse(e);return oh(e._query,t),new Dl(e.firestore,e.converter,Ln(e._query,t))}_parse(e){const t=mu(e.firestore),n=function(e,t,n,r,i,s,o){let c;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new A(O.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){sh(o,s);const t=[];for(const n of o)t.push(ih(r,e,n));c={arrayValue:{values:t}}}else c=ih(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||sh(o,s),c=Cu(n,t,o,"in"===s||"not-in"===s);return en.create(i,s,c)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function zu(e,t,n){const r=t,i=ju("where",e);return Bu._create(i,r,n)}class Wu extends Uu{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Wu(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:tn.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)oh(n,e),n=Ln(n,e)}(e._query,t),new Dl(e.firestore,e.converter,Ln(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Ku extends Vu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Ku(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new A(O.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new A(O.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Jt(t,n)}(e._query,this._field,this._direction);return new Dl(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new kn(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function Gu(e,t="asc"){const n=t,r=ju("orderBy",e);return Ku._create(r,n)}class Hu extends Vu{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Hu(e,t,n)}_apply(e){return new Dl(e.firestore,e.converter,Mn(e._query,this._limit,this._limitType))}}function $u(e){return xl("limit",e),Hu._create("limit",e,"F")}function Qu(e){return xl("limitToLast",e),Hu._create("limitToLast",e,"L")}class Yu extends Vu{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Yu(e,t,n)}_apply(e){const t=rh(e,this.type,this._docOrFields,this._inclusive);return new Dl(e.firestore,e.converter,function(e,t){return new kn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}function Ju(...e){return Yu._create("startAt",e,!0)}function Xu(...e){return Yu._create("startAfter",e,!1)}class Zu extends Vu{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Zu(e,t,n)}_apply(e){const t=rh(e,this.type,this._docOrFields,this._inclusive);return new Dl(e.firestore,e.converter,function(e,t){return new kn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function eh(...e){return Zu._create("endBefore",e,!1)}function nh(...e){return Zu._create("endAt",e,!0)}function rh(e,t,n,r){if(n[0]=Object(l.w)(n[0]),n[0]instanceof Lu)return function(e,t,n,r,i){if(!r)throw new A(O.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of Rn(e))if(n.field.isKeyField())s.push(Pt(t,r.key));else{const e=r.data.field(n.field);if(_t(e))throw new A(O.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new A(O.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new $t(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=mu(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new A(O.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const c=[];for(let s=0;s<i.length;s++){const a=i[s];if(o[s].field.isKeyField()){if("string"!=typeof a)throw new A(O.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof a}`);if(!Nn(e)&&-1!==a.indexOf("/"))throw new A(O.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${a}' contains a slash.`);const n=e.path.child($.fromString(a));if(!J.isDocumentKey(n))throw new A(O.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new J(n);c.push(Pt(t,i))}else{const e=Cu(n,r,a);c.push(e)}}return new $t(c,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function ih(e,t,n){if("string"==typeof(n=Object(l.w)(n))){if(""===n)throw new A(O.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Nn(t)&&-1!==n.indexOf("/"))throw new A(O.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child($.fromString(n));if(!J.isDocumentKey(r))throw new A(O.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Pt(e,new J(r))}if(n instanceof Ll)return Pt(e,n._key);throw new A(O.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ol(n)}.`)}function sh(e,t){if(!Array.isArray(e)||0===e.length)throw new A(O.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function oh(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new A(O.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new A(O.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class ah{convertValue(e,t="none"){switch(St(e)){case 0:return null;case 1:return e.booleanValue;case 2:return yt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(wt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw E()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return tt(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new cu(yt(e.latitude),yt(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=vt(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(bt(e));default:return null}}convertTimestamp(e){const t=gt(e);return new K(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=$.fromString(e);C(zi(n));const r=new Tt(n.get(1),n.get(3)),i=new J(n.popFirst(5));return r.isEqual(t)||v(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function ch(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class lh extends ah{constructor(e){super(),this.firestore=e}convertBytes(e){return new su(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ll(this.firestore,null,t)}}class uh{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class hh extends Lu{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new dh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(ju("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class dh extends hh{data(e={}){return super.data(e)}}class fh{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new uh(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new dh(this._firestore,this._userDataWriter,n.key,n,new uh(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new A(O.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new dh(e._firestore,e._userDataWriter,n.doc.key,n.doc,new uh(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new dh(e._firestore,e._userDataWriter,t.doc.key,t.doc,new uh(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:ph(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function ph(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return E()}}function mh(e,t){return e instanceof hh&&t instanceof hh?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof fh&&t instanceof fh&&e._firestore===t._firestore&&ql(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function gh(e){e=Al(e,Ll);const t=Al(e.firestore,Gl);return _l(Hl(t),e._key).then((n=>xh(t,e,n)))}class yh extends ah{constructor(e){super(),this.firestore=e}convertBytes(e){return new su(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ll(this.firestore,null,t)}}function wh(e){e=Al(e,Ll);const t=Al(e.firestore,Gl),n=Hl(t),r=new yh(t);return function(e,t){const n=new x;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await function(e,t){const n=k(e);return n.persistence.runTransaction("read document","readonly",(e=>n.localDocuments.getDocument(e,t)))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new A(O.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=Za(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await pl(e),t,n))),n.promise}(n,e._key).then((n=>new hh(t,r,e._key,n,new uh(null!==n&&n.hasLocalMutations,!0),e.converter)))}function _h(e){e=Al(e,Ll);const t=Al(e.firestore,Gl);return _l(Hl(t),e._key,{source:"server"}).then((n=>xh(t,e,n)))}function vh(e){e=Al(e,Dl);const t=Al(e.firestore,Gl),n=Hl(t),r=new yh(t);return Fu(e._query),vl(n,e._query).then((n=>new fh(t,r,e,n)))}function bh(e){e=Al(e,Dl);const t=Al(e.firestore,Gl),n=Hl(t),r=new yh(t);return function(e,t){const n=new x;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await Ko(e,t,!0),i=new yc(t,r.hs),s=i.ha(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){const r=Za(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await pl(e),t,n))),n.promise}(n,e._query).then((n=>new fh(t,r,e,n)))}function Ih(e){e=Al(e,Dl);const t=Al(e.firestore,Gl),n=Hl(t),r=new yh(t);return vl(n,e._query,{source:"server"}).then((n=>new fh(t,r,e,n)))}function Th(e,t,n){e=Al(e,Ll);const r=Al(e.firestore,Gl),i=ch(e.converter,t,n);return Ah(r,[gu(mu(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Er.none())])}function Eh(e,t,n,...r){e=Al(e,Ll);const i=Al(e.firestore,Gl),s=mu(i);let o;return o="string"==typeof(t=Object(l.w)(t))||t instanceof ou?Eu(s,"updateDoc",e._key,t,n,r):Tu(s,"updateDoc",e._key,t),Ah(i,[o.toMutation(e._key,Er.exists(!0))])}function Ch(e){return Ah(Al(e.firestore,Gl),[new jr(e._key,Er.none())])}function Sh(e,t){const n=Al(e.firestore,Gl),r=Ul(e),i=ch(e.converter,t);return Ah(n,[gu(mu(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Er.exists(!1))]).then((()=>r))}function kh(e,...t){var n,r,i;e=Object(l.w)(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||zl(t[o])||(s=t[o],o++);const c={includeMetadataChanges:s.includeMetadataChanges};if(zl(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let a,u,h;if(e instanceof Ll)u=Al(e.firestore,Gl),h=An(e._key.path),a={next:n=>{t[o]&&t[o](xh(u,e,n))},error:t[o+1],complete:t[o+2]};else{const n=Al(e,Dl);u=Al(n.firestore,Gl),h=n._query;const r=new yh(u);a={next:e=>{t[o]&&t[o](new fh(u,r,n,e))},error:t[o+1],complete:t[o+2]},Fu(e._query)}return function(e,t,n,r){const i=new el(r),s=new uc(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>sc(await wl(e),s))),()=>{i.La(),e.asyncQueue.enqueueAndForget((async()=>oc(await wl(e),s)))}}(Hl(u),h,c,a)}function Oh(e,t){return function(e,t){const n=new el(t);return e.asyncQueue.enqueueAndForget((async()=>function(e,t){k(e).K_.add(t),t.next()}(await wl(e),n))),()=>{n.La(),e.asyncQueue.enqueueAndForget((async()=>function(e,t){k(e).K_.delete(t)}(await wl(e),n)))}}(Hl(e=Al(e,Gl)),zl(t)?t:{next:t})}function Ah(e,t){return function(e,t){const n=new x;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=$c(e);try{const e=await function(e,t){const n=k(e),r=K.now(),i=t.reduce(((e,t)=>e.add(t.key)),nr());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let c=Gn(),a=nr();return n.os.getEntries(e,i).next((e=>{c=e,c.forEach(((e,t)=>{t.isValidDocument()||(a=a.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,c))).next((i=>{s=i;const o=[];for(const e of t){const t=xr(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new Pr(e.key,t,Gt(t.value.mapValue),Er.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,a);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:Qn(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Da[e.currentUser.toKey()];r||(r=new it(B)),r=r.insert(t,n),e.Da[e.currentUser.toKey()]=r}(r,e.batchId,n),await Mc(r,e.changes),await Ua(r.remoteStore)}catch(e){const t=Za(e,"Failed to persist write");n.reject(t)}}(await gl(e),t,n))),n.promise}(Hl(e),t)}function xh(e,t,n){const r=n.docs.get(t._key),i=new yh(e);return new hh(e,i,t._key,r,new uh(n.hasPendingWrites,n.fromCache),t.converter)}const Nh={maxAttempts:5};class Rh{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=mu(e)}set(e,t,n){this._verifyNotCommitted();const r=Ph(e,this._firestore),i=ch(r.converter,t,n),s=gu(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,Er.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const i=Ph(e,this._firestore);let s;return s="string"==typeof(t=Object(l.w)(t))||t instanceof ou?Eu(this._dataReader,"WriteBatch.update",i._key,t,n,r):Tu(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,Er.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Ph(e,this._firestore);return this._mutations=this._mutations.concat(new jr(t._key,Er.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new A(O.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Ph(e,t){if((e=Object(l.w)(e)).firestore!==t)throw new A(O.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class Dh extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=mu(e)}get(e){const t=Ph(e,this._firestore),n=new lh(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return E();const r=e[0];if(r.isFoundDocument())return new Lu(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new Lu(this._firestore,n,t._key,null,t.converter);throw E()}))}set(e,t,n){const r=Ph(e,this._firestore),i=ch(r.converter,t,n),s=gu(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){const i=Ph(e,this._firestore);let s;return s="string"==typeof(t=Object(l.w)(t))||t instanceof ou?Eu(this._dataReader,"Transaction.update",i._key,t,n,r):Tu(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}delete(e){const t=Ph(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Ph(e,this._firestore),n=new yh(this._firestore);return super.get(e).then((e=>new hh(this._firestore,n,t._key,e._document,new uh(!1,!1),t.converter)))}}function Lh(e,t,n){e=Al(e,Gl);const r=Object.assign(Object.assign({},Nh),n);return function(e){if(e.maxAttempts<1)throw new A(O.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){const r=new x;return e.asyncQueue.enqueueAndForget((async()=>{const i=await yl(e);new rl(e.asyncQueue,i,n,t,r).ja()})),r.promise}(Hl(e),(n=>t(new Dh(e,n))),r)}function Mh(){return new yu("deleteField")}function jh(){return new _u("serverTimestamp")}function Fh(...e){return new vu("arrayUnion",e)}function Uh(...e){return new bu("arrayRemove",e)}function Vh(e){return new Iu("increment",e)}new WeakMap;!function(e,t=!0){!function(e){m=e}(r.SDK_VERSION),Object(r._registerComponent)(new o.a("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new Gl(new D(e.getProvider("auth-internal")),new F(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new A(O.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Tt(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),Object(r.registerVersion)(d,"4.4.3",e),Object(r.registerVersion)(d,"4.4.3","esm2017")}()}).call(this,n(166))},335:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return Tr})),n.d(t,"b",(function(){return Cr})),n.d(t,"c",(function(){return Er})),n.d(t,"d",(function(){return xr})),n.d(t,"e",(function(){return Ar})),n.d(t,"f",(function(){return Sr})),n.d(t,"g",(function(){return kr})),n.d(t,"h",(function(){return Or})),n.d(t,"i",(function(){return vr})),n.d(t,"j",(function(){return Ir}));var r,o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},c={},l=l||{},h=o||self;function d(a){var b=typeof a;return"array"==(b="object"!=b?b:a?Array.isArray(a)?"array":b:"null")||"object"==b&&"number"==typeof a.length}function p(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var f="closure_uid_"+(1e9*Math.random()>>>0),m=0;function y(a,b,e){return a.call.apply(a.bind,arguments)}function w(a,b,e){if(!a)throw Error();if(2<arguments.length){var t=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,t),a.apply(b,e)}}return function(){return a.apply(b,arguments)}}function q(a,b,e){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:w).apply(null,arguments)}function _(a,b){var e=Array.prototype.slice.call(arguments,1);return function(){var t=e.slice();return t.push.apply(t,arguments),a.apply(this,t)}}function v(a,b){function e(){}e.prototype=b.prototype,a.$=b.prototype,a.prototype=new e,a.prototype.constructor=a,a.ac=function(e,t,n){for(var r=Array(arguments.length-2),o=2;o<arguments.length;o++)r[o-2]=arguments[o];return b.prototype[t].apply(e,r)}}function I(){this.s=this.s,this.o=this.o}I.prototype.s=!1,I.prototype.sa=function(){var a;!this.s&&(this.s=!0,this.N(),0)&&(a=this,Object.prototype.hasOwnProperty.call(a,f)&&a[f]||(a[f]=++m))},I.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const T=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"==typeof a)return"string"!=typeof b||1!=b.length?-1:a.indexOf(b,0);for(let e=0;e<a.length;e++)if(e in a&&a[e]===b)return e;return-1};function E(a){const b=a.length;if(0<b){const e=Array(b);for(let t=0;t<b;t++)e[t]=a[t];return e}return[]}function C(a,b){for(let e=1;e<arguments.length;e++){const t=arguments[e];if(d(t)){const e=a.length||0,n=t.length||0;a.length=e+n;for(let r=0;r<n;r++)a[e+r]=t[r]}else a.push(t)}}function S(a,b){this.type=a,this.g=this.target=b,this.defaultPrevented=!1}S.prototype.h=function(){this.defaultPrevented=!0};var k=function(){if(!h.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const e=()=>{};h.addEventListener("test",e,b),h.removeEventListener("test",e,b)}catch(e){}return a}();function O(a){return/^[\s\xa0]*$/.test(a)}function A(){var a=h.navigator;return a&&(a=a.userAgent)?a:""}function x(a){return-1!=A().indexOf(a)}function N(a){return N[" "](a),a}N[" "]=function(){};var R,a,P,D=x("Opera"),L=x("Trident")||x("MSIE"),M=x("Edge"),j=M||L,F=x("Gecko")&&!(-1!=A().toLowerCase().indexOf("webkit")&&!x("Edge"))&&!(x("Trident")||x("MSIE"))&&!x("Edge"),U=-1!=A().toLowerCase().indexOf("webkit")&&!x("Edge");function V(){var a=h.document;return a?a.documentMode:void 0}e:{var B="",z=(a=A(),F?/rv:([^\);]+)(\)|;)/.exec(a):M?/Edge\/([\d\.]+)/.exec(a):L?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a):U?/WebKit\/(\S+)/.exec(a):D?/(?:Version)[ \/]?(\S+)/.exec(a):void 0);if(z&&(B=z?z[1]:""),L){var W=V();if(null!=W&&W>parseFloat(B)){R=String(W);break e}}R=B}if(h.document&&L){var K=V();P=K||(parseInt(R,10)||void 0)}else P=void 0;var G=P;function H(a,b){if(S.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var e=this.type=a.type,t=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=b,b=a.relatedTarget){if(F){e:{try{N(b.nodeName);var n=!0;break e}catch(e){}n=!1}n||(b=null)}}else"mouseover"==e?b=a.fromElement:"mouseout"==e&&(b=a.toElement);this.relatedTarget=b,t?(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:$[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&H.$.h.call(this)}}v(H,S);var $={2:"touch",3:"pen",4:"mouse"};H.prototype.h=function(){H.$.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var Q="closure_listenable_"+(1e6*Math.random()|0),Y=0;function J(a,b,e,t,n){this.listener=a,this.proxy=null,this.src=b,this.type=e,this.capture=!!t,this.la=n,this.key=++Y,this.fa=this.ia=!1}function X(a){a.fa=!0,a.listener=null,a.proxy=null,a.src=null,a.la=null}function Z(a,b,e){for(const t in a)b.call(e,a[t],t,a)}function ee(a){const b={};for(const e in a)b[e]=a[e];return b}const te="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ne(a,b){let e,t;for(let n=1;n<arguments.length;n++){for(e in t=arguments[n],t)a[e]=t[e];for(let n=0;n<te.length;n++)e=te[n],Object.prototype.hasOwnProperty.call(t,e)&&(a[e]=t[e])}}function re(a){this.src=a,this.g={},this.h=0}function ie(a,b){var e=b.type;if(e in a.g){var t,n=a.g[e],r=T(n,b);(t=0<=r)&&Array.prototype.splice.call(n,r,1),t&&(X(b),0==a.g[e].length&&(delete a.g[e],a.h--))}}function se(a,b,e,t){for(var n=0;n<a.length;++n){var r=a[n];if(!r.fa&&r.listener==b&&r.capture==!!e&&r.la==t)return n}return-1}re.prototype.add=function(a,b,e,t,n){var r=a.toString();(a=this.g[r])||(a=this.g[r]=[],this.h++);var o=se(a,b,t,n);return-1<o?(b=a[o],e||(b.ia=!1)):((b=new J(b,this.src,r,!!t,n)).ia=e,a.push(b)),b};var oe="closure_lm_"+(1e6*Math.random()|0),ae={};function ce(a,b,e,t,n){if(t&&t.once)return ue(a,b,e,t,n);if(Array.isArray(b)){for(var r=0;r<b.length;r++)ce(a,b[r],e,t,n);return null}return e=ye(e),a&&a[Q]?a.O(b,e,p(t)?!!t.capture:!!t,n):le(a,b,e,!1,t,n)}function le(a,b,e,t,n,r){if(!b)throw Error("Invalid event type");var o=p(n)?!!n.capture:!!n,c=me(a);if(c||(a[oe]=c=new re(a)),(e=c.add(b,e,t,o,r)).proxy)return e;if(t=function(){function a(e){return b.call(a.src,a.listener,e)}const b=pe;return a}(),e.proxy=t,t.src=a,t.listener=e,a.addEventListener)k||(n=o),void 0===n&&(n=!1),a.addEventListener(b.toString(),t,n);else if(a.attachEvent)a.attachEvent(fe(b.toString()),t);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(t)}return e}function ue(a,b,e,t,n){if(Array.isArray(b)){for(var r=0;r<b.length;r++)ue(a,b[r],e,t,n);return null}return e=ye(e),a&&a[Q]?a.P(b,e,p(t)?!!t.capture:!!t,n):le(a,b,e,!0,t,n)}function he(a,b,e,t,n){if(Array.isArray(b))for(var r=0;r<b.length;r++)he(a,b[r],e,t,n);else t=p(t)?!!t.capture:!!t,e=ye(e),a&&a[Q]?(a=a.i,(b=String(b).toString())in a.g&&(-1<(e=se(r=a.g[b],e,t,n))&&(X(r[e]),Array.prototype.splice.call(r,e,1),0==r.length&&(delete a.g[b],a.h--)))):a&&(a=me(a))&&(b=a.g[b.toString()],a=-1,b&&(a=se(b,e,t,n)),(e=-1<a?b[a]:null)&&de(e))}function de(a){if("number"!=typeof a&&a&&!a.fa){var b=a.src;if(b&&b[Q])ie(b.i,a);else{var e=a.type,t=a.proxy;b.removeEventListener?b.removeEventListener(e,t,a.capture):b.detachEvent?b.detachEvent(fe(e),t):b.addListener&&b.removeListener&&b.removeListener(t),(e=me(b))?(ie(e,a),0==e.h&&(e.src=null,b[oe]=null)):X(a)}}}function fe(a){return a in ae?ae[a]:ae[a]="on"+a}function pe(a,b){if(a.fa)a=!0;else{b=new H(b,this);var e=a.listener,t=a.la||a.src;a.ia&&de(a),a=e.call(t,b)}return a}function me(a){return(a=a[oe])instanceof re?a:null}var ge="__closure_events_fn_"+(1e9*Math.random()>>>0);function ye(a){return"function"==typeof a?a:(a[ge]||(a[ge]=function(b){return a.handleEvent(b)}),a[ge])}function we(){I.call(this),this.i=new re(this),this.S=this,this.J=null}function _e(a,b){var e,t=a.J;if(t)for(e=[];t;t=t.J)e.push(t);if(a=a.S,t=b.type||b,"string"==typeof b)b=new S(b,a);else if(b instanceof S)b.target=b.target||a;else{var n=b;ne(b=new S(t,a),n)}if(n=!0,e)for(var r=e.length-1;0<=r;r--){var o=b.g=e[r];n=ve(o,t,!0,b)&&n}if(n=ve(o=b.g=a,t,!0,b)&&n,n=ve(o,t,!1,b)&&n,e)for(r=0;r<e.length;r++)n=ve(o=b.g=e[r],t,!1,b)&&n}function ve(a,b,e,t){if(!(b=a.i.g[String(b)]))return!0;b=b.concat();for(var n=!0,r=0;r<b.length;++r){var o=b[r];if(o&&!o.fa&&o.capture==e){var c=o.listener,l=o.la||o.src;o.ia&&ie(a.i,o),n=!1!==c.call(l,t)&&n}}return n&&!t.defaultPrevented}v(we,I),we.prototype[Q]=!0,we.prototype.removeEventListener=function(a,b,e,t){he(this,a,b,e,t)},we.prototype.N=function(){if(we.$.N.call(this),this.i){var e,a=this.i;for(e in a.g){for(var t=a.g[e],n=0;n<t.length;n++)X(t[n]);delete a.g[e],a.h--}}this.J=null},we.prototype.O=function(a,b,e,t){return this.i.add(String(a),b,!1,e,t)},we.prototype.P=function(a,b,e,t){return this.i.add(String(a),b,!0,e,t)};var be=h.JSON.stringify;function Ie(){var a=Ae;let b=null;return a.g&&(b=a.g,a.g=a.g.next,a.g||(a.h=null),b.next=null),b}var Te=new class{constructor(a,b){this.i=a,this.j=b,this.h=0,this.g=null}get(){let a;return 0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}((()=>new Ee),(a=>a.reset()));class Ee{constructor(){this.next=this.g=this.h=null}set(a,b){this.h=a,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}}function Ce(a){var b=1;a=a.split(":");const e=[];for(;0<b&&a.length;)e.push(a.shift()),b--;return a.length&&e.push(a.join(":")),e}function Se(a){h.setTimeout((()=>{throw a}),0)}let ke,Oe=!1,Ae=new class{constructor(){this.h=this.g=null}add(a,b){const e=Te.get();e.set(a,b),this.h?this.h.next=e:this.g=e,this.h=e}},xe=()=>{const a=h.Promise.resolve(void 0);ke=()=>{a.then(Ne)}};var Ne=()=>{for(var a;a=Ie();){try{a.h.call(a.g)}catch(e){Se(e)}var b=Te;b.j(a),100>b.h&&(b.h++,a.next=b.g,b.g=a)}Oe=!1};function Re(a,b){we.call(this),this.h=a||1,this.g=b||h,this.j=q(this.qb,this),this.l=Date.now()}function Pe(a){a.ga=!1,a.T&&(a.g.clearTimeout(a.T),a.T=null)}function De(a,b,e){if("function"==typeof a)e&&(a=q(a,e));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=q(a.handleEvent,a)}return 2147483647<Number(b)?-1:h.setTimeout(a,b||0)}function Le(a){a.g=De((()=>{a.g=null,a.i&&(a.i=!1,Le(a))}),a.j);const b=a.h;a.h=null,a.m.apply(null,b)}v(Re,we),(r=Re.prototype).ga=!1,r.T=null,r.qb=function(){if(this.ga){var a=Date.now()-this.l;0<a&&a<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-a):(this.T&&(this.g.clearTimeout(this.T),this.T=null),_e(this,"tick"),this.ga&&(Pe(this),this.start()))}},r.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.N=function(){Re.$.N.call(this),Pe(this),delete this.g};class Me extends I{constructor(a,b){super(),this.m=a,this.j=b,this.h=null,this.i=!1,this.g=null}l(a){this.h=arguments,this.g?this.i=!0:Le(this)}N(){super.N(),this.g&&(h.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function je(a){I.call(this),this.h=a,this.g={}}v(je,I);var Fe=[];function Ue(a,b,e,t){Array.isArray(e)||(e&&(Fe[0]=e.toString()),e=Fe);for(var n=0;n<e.length;n++){var r=ce(b,e[n],t||a.handleEvent,!1,a.h||a);if(!r)break;a.g[r.key]=r}}function Ve(a){Z(a.g,(function(b,e){this.g.hasOwnProperty(e)&&de(b)}),a),a.g={}}function qe(){this.g=!0}function Be(a,b,e,t){a.info((function(){return"XMLHTTP TEXT ("+b+"): "+function(a,b){if(!a.g)return b;if(!b)return null;try{var e=JSON.parse(b);if(e)for(a=0;a<e.length;a++)if(Array.isArray(e[a])){var t=e[a];if(!(2>t.length)){var n=t[1];if(Array.isArray(n)&&!(1>n.length)){var r=n[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<n.length;o++)n[o]=""}}}return be(e)}catch(e){return b}}(a,e)+(t?" "+t:"")}))}je.prototype.N=function(){je.$.N.call(this),Ve(this)},je.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},qe.prototype.Ea=function(){this.g=!1},qe.prototype.info=function(){};var ze={},We=null;function Ke(){return We=We||new we}function Ge(a){S.call(this,ze.Ta,a)}function He(a){const b=Ke();_e(b,new Ge(b))}function $e(a,b){S.call(this,ze.STAT_EVENT,a),this.stat=b}function Qe(a){const b=Ke();_e(b,new $e(b,a))}function Ye(a,b){S.call(this,ze.Ua,a),this.size=b}function Je(a,b){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return h.setTimeout((function(){a()}),b)}ze.Ta="serverreachability",v(Ge,S),ze.STAT_EVENT="statevent",v($e,S),ze.Ua="timingevent",v(Ye,S);var Xe={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Ze={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function et(){}function tt(a){return a.h||(a.h=a.i())}function nt(){}et.prototype.h=null;var it,st={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function ot(){S.call(this,"d")}function at(){S.call(this,"c")}function ct(){}function lt(a,b,e,t){this.l=a,this.j=b,this.m=e,this.W=t||1,this.U=new je(this),this.P=ht,a=j?125:void 0,this.V=new Re(a),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new ut}function ut(){this.i=null,this.g="",this.h=!1}v(ot,S),v(at,S),v(ct,et),ct.prototype.g=function(){return new XMLHttpRequest},ct.prototype.i=function(){return{}},it=new ct;var ht=45e3,ft={},pt={};function mt(a,b,e){a.L=1,a.A=Dt(At(b)),a.u=e,a.S=!0,gt(a,null)}function gt(a,b){a.G=Date.now(),vt(a),a.B=At(a.A);var e=a.B,t=a.W;Array.isArray(t)||(t=[String(t)]),Ht(e.i,"t",t),a.o=0,e=a.l.J,a.h=new ut,a.g=Gn(a.l,e?b:null,!a.u),0<a.O&&(a.M=new Me(q(a.Pa,a,a.g),a.O)),Ue(a.U,a.g,"readystatechange",a.nb),b=a.I?ee(a.I):{},a.u?(a.v||(a.v="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.g.ha(a.B,a.v,a.u,b)):(a.v="GET",a.g.ha(a.B,a.v,null,b)),He(),function(a,b,e,t,n,r){a.info((function(){if(a.g)if(r)for(var o="",c=r.split("&"),l=0;l<c.length;l++){var h=c[l].split("=");if(1<h.length){var u=h[0];h=h[1];var d=u.split("_");o=2<=d.length&&"type"==d[1]?o+(u+"=")+h+"&":o+(u+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+t+") [attempt "+n+"]: "+b+"\n"+e+"\n"+o}))}(a.j,a.v,a.B,a.m,a.W,a.u)}function yt(a){return!!a.g&&("GET"==a.v&&2!=a.L&&a.l.Ha)}function wt(a,b,e){let t,n=!0;for(;!a.J&&a.o<e.length;){if(t=_t(a,e),t==pt){4==b&&(a.s=4,Qe(14),n=!1),Be(a.j,a.m,null,"[Incomplete Response]");break}if(t==ft){a.s=4,Qe(15),Be(a.j,a.m,e,"[Invalid Chunk]"),n=!1;break}Be(a.j,a.m,t,null),Ct(a,t)}yt(a)&&0!=a.o&&(a.h.g=a.h.g.slice(a.o),a.o=0),4!=b||0!=e.length||a.h.h||(a.s=1,Qe(16),n=!1),a.i=a.i&&n,n?0<e.length&&!a.ba&&(a.ba=!0,(b=a.l).g==a&&b.ca&&!b.M&&(b.l.info("Great, no buffering proxy detected. Bytes received: "+e.length),Fn(b),b.M=!0,Qe(11))):(Be(a.j,a.m,e,"[Invalid Chunked Response]"),Et(a),Tt(a))}function _t(a,b){var e=a.o,t=b.indexOf("\n",e);return-1==t?pt:(e=Number(b.substring(e,t)),isNaN(e)?ft:(t+=1)+e>b.length?pt:(b=b.slice(t,t+e),a.o=t+e,b))}function vt(a){a.Y=Date.now()+a.P,bt(a,a.P)}function bt(a,b){if(null!=a.C)throw Error("WatchDog timer not null");a.C=Je(q(a.lb,a),b)}function It(a){a.C&&(h.clearTimeout(a.C),a.C=null)}function Tt(a){0==a.l.H||a.J||qn(a.l,a)}function Et(a){It(a);var b=a.M;b&&"function"==typeof b.sa&&b.sa(),a.M=null,Pe(a.V),Ve(a.U),a.g&&(b=a.g,a.g=null,b.abort(),b.sa())}function Ct(a,b){try{var e=a.l;if(0!=e.H&&(e.g==a||Zt(e.i,a)))if(!a.K&&Zt(e.i,a)&&3==e.H){try{var t=e.Ja.g.parse(b)}catch(e){t=null}if(Array.isArray(t)&&3==t.length){var n=t;if(0==n[0]){e:if(!e.u){if(e.g){if(!(e.g.G+3e3<a.G))break e;Vn(e),xn(e)}jn(e),Qe(18)}}else e.Fa=n[1],0<e.Fa-e.V&&37500>n[2]&&e.G&&0==e.A&&!e.v&&(e.v=Je(q(e.ib,e),6e3));if(1>=Xt(e.i)&&e.oa){try{e.oa()}catch(e){}e.oa=void 0}}else zn(e,11)}else if((a.K||e.g==a)&&Vn(e),!O(b))for(n=e.Ja.g.parse(b),b=0;b<n.length;b++){let h=n[b];if(e.V=h[0],h=h[1],2==e.H)if("c"==h[0]){e.K=h[1],e.pa=h[2];const u=h[3];null!=u&&(e.ra=u,e.l.info("VER="+e.ra));const n=h[4];null!=n&&(e.Ga=n,e.l.info("SVER="+e.Ga));const d=h[5];null!=d&&"number"==typeof d&&0<d&&(t=1.5*d,e.L=t,e.l.info("backChannelRequestTimeoutMs_="+t)),t=e;const f=a.g;if(f){const e=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var r=t.i;r.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(en(r,r.h),r.h=null))}if(t.F){const e=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(t.Da=e,Pt(t.I,t.F,e))}}e.H=3,e.h&&e.h.Ba(),e.ca&&(e.S=Date.now()-a.G,e.l.info("Handshake RTT: "+e.S+"ms"));var o=a;if((t=e).wa=Kn(t,t.J?t.pa:null,t.Y),o.K){tn(t.i,o);var c=o,l=t.L;l&&c.setTimeout(l),c.C&&(It(c),vt(c)),t.g=o}else Mn(t);0<e.j.length&&Rn(e)}else"stop"!=h[0]&&"close"!=h[0]||zn(e,7);else 3==e.H&&("stop"==h[0]||"close"==h[0]?"stop"==h[0]?zn(e,7):An(e):"noop"!=h[0]&&e.h&&e.h.Aa(h),e.A=0)}He()}catch(e){}}function St(a,b){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,void 0);else if(d(a)||"string"==typeof a)Array.prototype.forEach.call(a,b,void 0);else for(var e=function(a){if(a.ta&&"function"==typeof a.ta)return a.ta();if(!a.Z||"function"!=typeof a.Z){if("undefined"!=typeof Map&&a instanceof Map)return Array.from(a.keys());if(!("undefined"!=typeof Set&&a instanceof Set)){if(d(a)||"string"==typeof a){var b=[];a=a.length;for(var e=0;e<a;e++)b.push(e);return b}b=[],e=0;for(const t in a)b[e++]=t;return b}}}(a),t=function(a){if(a.Z&&"function"==typeof a.Z)return a.Z();if("undefined"!=typeof Map&&a instanceof Map||"undefined"!=typeof Set&&a instanceof Set)return Array.from(a.values());if("string"==typeof a)return a.split("");if(d(a)){for(var b=[],e=a.length,t=0;t<e;t++)b.push(a[t]);return b}for(t in b=[],e=0,a)b[e++]=a[t];return b}(a),n=t.length,r=0;r<n;r++)b.call(void 0,t[r],e&&e[r],a)}(r=lt.prototype).setTimeout=function(a){this.P=a},r.nb=function(a){a=a.target;const b=this.M;b&&3==Tn(a)?b.l():this.Pa(a)},r.Pa=function(a){try{if(a==this.g)e:{const u=Tn(this.g);var b=this.g.Ia();this.g.da();if(!(3>u)&&(3!=u||j||this.g&&(this.h.h||this.g.ja()||En(this.g)))){this.J||4!=u||7==b||He(),It(this);var e=this.g.da();this.ca=e;t:if(yt(this)){var t=En(this.g);a="";var n=t.length,r=4==Tn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Et(this),Tt(this);var o="";break t}this.h.i=new h.TextDecoder}for(b=0;b<n;b++)this.h.h=!0,a+=this.h.i.decode(t[b],{stream:r&&b==n-1});t.length=0,this.h.g+=a,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==e,function(a,b,e,t,n,r,o){a.info((function(){return"XMLHTTP RESP ("+t+") [ attempt "+n+"]: "+b+"\n"+e+"\n"+r+" "+o}))}(this.j,this.v,this.B,this.m,this.W,u,e),this.i){if(this.aa&&!this.K){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!O(c)){var d=c;break t}}d=null}if(!(e=d)){this.i=!1,this.s=3,Qe(12),Et(this),Tt(this);break e}Be(this.j,this.m,e,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ct(this,e)}this.S?(wt(this,u,o),j&&this.i&&3==u&&(Ue(this.U,this.V,"tick",this.mb),this.V.start())):(Be(this.j,this.m,o,null),Ct(this,o)),4==u&&Et(this),this.i&&!this.J&&(4==u?qn(this.l,this):(this.i=!1,vt(this)))}else(function(a){const b={};a=(a.g&&2<=Tn(a)&&a.g.getAllResponseHeaders()||"").split("\r\n");for(let t=0;t<a.length;t++){if(O(a[t]))continue;var e=Ce(a[t]);const n=e[0];if("string"!=typeof(e=e[1]))continue;e=e.trim();const r=b[n]||[];b[n]=r,r.push(e)}!function(a,b){for(const e in a)b.call(void 0,a[e],e,a)}(b,(function(e){return e.join(", ")}))})(this.g),400==e&&0<o.indexOf("Unknown SID")?(this.s=3,Qe(12)):(this.s=0,Qe(13)),Et(this),Tt(this)}}}catch(e){}},r.mb=function(){if(this.g){var a=Tn(this.g),b=this.g.ja();this.o<b.length&&(It(this),wt(this,a,b),this.i&&4!=a&&vt(this))}},r.cancel=function(){this.J=!0,Et(this)},r.lb=function(){this.C=null;const a=Date.now();0<=a-this.Y?(function(a,b){a.info((function(){return"TIMEOUT: "+b}))}(this.j,this.B),2!=this.L&&(He(),Qe(17)),Et(this),this.s=2,Tt(this)):bt(this,this.Y-a)};var kt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ot(a){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,a instanceof Ot){this.h=a.h,xt(this,a.j),this.s=a.s,this.g=a.g,Nt(this,a.m),this.l=a.l;var b=a.i,e=new zt;e.i=b.i,b.g&&(e.g=new Map(b.g),e.h=b.h),Rt(this,e),this.o=a.o}else a&&(b=String(a).match(kt))?(this.h=!1,xt(this,b[1]||"",!0),this.s=Lt(b[2]||""),this.g=Lt(b[3]||"",!0),Nt(this,b[4]),this.l=Lt(b[5]||"",!0),Rt(this,b[6]||"",!0),this.o=Lt(b[7]||"")):(this.h=!1,this.i=new zt(null,this.h))}function At(a){return new Ot(a)}function xt(a,b,e){a.j=e?Lt(b,!0):b,a.j&&(a.j=a.j.replace(/:$/,""))}function Nt(a,b){if(b){if(b=Number(b),isNaN(b)||0>b)throw Error("Bad port number "+b);a.m=b}else a.m=null}function Rt(a,b,e){b instanceof zt?(a.i=b,function(a,b){b&&!a.j&&(Wt(a),a.i=null,a.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Kt(this,t),Ht(this,n,e))}),a)),a.j=b}(a.i,a.h)):(e||(b=Mt(b,qt)),a.i=new zt(b,a.h))}function Pt(a,b,e){a.i.set(b,e)}function Dt(a){return Pt(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function Lt(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Mt(a,b,e){return"string"==typeof a?(a=encodeURI(a).replace(b,jt),e&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function jt(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}Ot.prototype.toString=function(){var a=[],b=this.j;b&&a.push(Mt(b,Ft,!0),":");var e=this.g;return(e||"file"==b)&&(a.push("//"),(b=this.s)&&a.push(Mt(b,Ft,!0),"@"),a.push(encodeURIComponent(String(e)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(e=this.m)&&a.push(":",String(e))),(e=this.l)&&(this.g&&"/"!=e.charAt(0)&&a.push("/"),a.push(Mt(e,"/"==e.charAt(0)?Vt:Ut,!0))),(e=this.i.toString())&&a.push("?",e),(e=this.o)&&a.push("#",Mt(e,Bt)),a.join("")};var Ft=/[#\/\?@]/g,Ut=/[#\?:]/g,Vt=/[#\?]/g,qt=/[#\?@]/g,Bt=/#/g;function zt(a,b){this.h=this.g=null,this.i=a||null,this.j=!!b}function Wt(a){a.g||(a.g=new Map,a.h=0,a.i&&function(a,b){if(a){a=a.split("&");for(var e=0;e<a.length;e++){var t=a[e].indexOf("="),n=null;if(0<=t){var r=a[e].substring(0,t);n=a[e].substring(t+1)}else r=a[e];b(r,n?decodeURIComponent(n.replace(/\+/g," ")):"")}}}(a.i,(function(b,e){a.add(decodeURIComponent(b.replace(/\+/g," ")),e)})))}function Kt(a,b){Wt(a),b=$t(a,b),a.g.has(b)&&(a.i=null,a.h-=a.g.get(b).length,a.g.delete(b))}function Gt(a,b){return Wt(a),b=$t(a,b),a.g.has(b)}function Ht(a,b,e){Kt(a,b),0<e.length&&(a.i=null,a.g.set($t(a,b),E(e)),a.h+=e.length)}function $t(a,b){return b=String(b),a.j&&(b=b.toLowerCase()),b}(r=zt.prototype).add=function(a,b){Wt(this),this.i=null,a=$t(this,a);var e=this.g.get(a);return e||this.g.set(a,e=[]),e.push(b),this.h+=1,this},r.forEach=function(a,b){Wt(this),this.g.forEach((function(e,t){e.forEach((function(e){a.call(b,e,t,this)}),this)}),this)},r.ta=function(){Wt(this);const a=Array.from(this.g.values()),b=Array.from(this.g.keys()),e=[];for(let t=0;t<b.length;t++){const n=a[t];for(let r=0;r<n.length;r++)e.push(b[t])}return e},r.Z=function(a){Wt(this);let b=[];if("string"==typeof a)Gt(this,a)&&(b=b.concat(this.g.get($t(this,a))));else{a=Array.from(this.g.values());for(let e=0;e<a.length;e++)b=b.concat(a[e])}return b},r.set=function(a,b){return Wt(this),this.i=null,Gt(this,a=$t(this,a))&&(this.h-=this.g.get(a).length),this.g.set(a,[b]),this.h+=1,this},r.get=function(a,b){return a&&0<(a=this.Z(a)).length?String(a[0]):b},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],b=Array.from(this.g.keys());for(var e=0;e<b.length;e++){var t=b[e];const r=encodeURIComponent(String(t)),o=this.Z(t);for(t=0;t<o.length;t++){var n=r;""!==o[t]&&(n+="="+encodeURIComponent(String(o[t]))),a.push(n)}}return this.i=a.join("&")};var Qt=class{constructor(a,b){this.g=a,this.map=b}};function Yt(a){this.l=a||dd,h.PerformanceNavigationTiming?a=0<(a=h.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):a=!!(h.g&&h.g.Ka&&h.g.Ka()&&h.g.Ka().dc),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var dd=10;function Jt(a){return!!a.h||!!a.g&&a.g.size>=a.j}function Xt(a){return a.h?1:a.g?a.g.size:0}function Zt(a,b){return a.h?a.h==b:!!a.g&&a.g.has(b)}function en(a,b){a.g?a.g.add(b):a.h=b}function tn(a,b){a.h&&a.h==b?a.h=null:a.g&&a.g.has(b)&&a.g.delete(b)}function nn(a){if(null!=a.h)return a.i.concat(a.h.F);if(null!=a.g&&0!==a.g.size){let b=a.i;for(const e of a.g.values())b=b.concat(e.F);return b}return E(a.i)}Yt.prototype.cancel=function(){if(this.i=nn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}};var rn=class{stringify(a){return h.JSON.stringify(a,void 0)}parse(a){return h.JSON.parse(a,void 0)}};function sn(){this.g=new rn}function on(a,b,e){const t=e||"";try{St(a,(function(e,n){let r=e;p(e)&&(r=be(e)),b.push(t+n+"="+encodeURIComponent(r))}))}catch(e){throw b.push(t+"type="+encodeURIComponent("_badmap")),e}}function an(a,b,e,t,n){try{b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null,n(t)}catch(e){}}function cn(a){this.l=a.ec||null,this.j=a.ob||!1}function ln(a,b){we.call(this),this.F=a,this.u=b,this.m=void 0,this.readyState=un,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}v(cn,et),cn.prototype.g=function(){return new ln(this.l,this.j)},cn.prototype.i=function(a){return function(){return a}}({}),v(ln,we);var un=0;function hn(a){a.j.read().then(a.Xa.bind(a)).catch(a.ka.bind(a))}function dn(a){a.readyState=4,a.l=null,a.j=null,a.A=null,fn(a)}function fn(a){a.onreadystatechange&&a.onreadystatechange.call(a)}(r=ln.prototype).open=function(a,b){if(this.readyState!=un)throw this.abort(),Error("Error reopening a connection");this.C=a,this.B=b,this.readyState=1,fn(this)},r.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const b={headers:this.v,method:this.C,credentials:this.m,cache:void 0};a&&(b.body=a),(this.F||h).fetch(new Request(this.B,b)).then(this.$a.bind(this),this.ka.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,dn(this)),this.readyState=un},r.$a=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,fn(this)),this.g&&(this.readyState=3,fn(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==h.ReadableStream&&"body"in a){if(this.j=a.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;hn(this)}else a.text().then(this.Za.bind(this),this.ka.bind(this))},r.Xa=function(a){if(this.g){if(this.u&&a.value)this.response.push(a.value);else if(!this.u){var b=a.value?a.value:new Uint8Array(0);(b=this.A.decode(b,{stream:!a.done}))&&(this.response=this.responseText+=b)}a.done?dn(this):fn(this),3==this.readyState&&hn(this)}},r.Za=function(a){this.g&&(this.response=this.responseText=a,dn(this))},r.Ya=function(a){this.g&&(this.response=a,dn(this))},r.ka=function(){this.g&&dn(this)},r.setRequestHeader=function(a,b){this.v.append(a,b)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],b=this.h.entries();for(var e=b.next();!e.done;)e=e.value,a.push(e[0]+": "+e[1]),e=b.next();return a.join("\r\n")},Object.defineProperty(ln.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}});var pn=h.JSON.parse;function mn(a){we.call(this),this.headers=new Map,this.u=a||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=gn,this.L=this.M=!1}v(mn,we);var gn="",td=/^https?$/i,yn=["POST","PUT"];function wn(a,b){a.h=!1,a.g&&(a.l=!0,a.g.abort(),a.l=!1),a.j=b,a.m=5,_n(a),bn(a)}function _n(a){a.F||(a.F=!0,_e(a,"complete"),_e(a,"error"))}function vn(a){if(a.h&&void 0!==l&&(!a.C[1]||4!=Tn(a)||2!=a.da()))if(a.v&&4==Tn(a))De(a.La,0,a);else if(_e(a,"readystatechange"),4==Tn(a)){a.h=!1;try{const o=a.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break e;default:b=!1}var e;if(!(e=b)){var t;if(t=0===o){var n=String(a.I).match(kt)[1]||null;!n&&h.self&&h.self.location&&(n=h.self.location.protocol.slice(0,-1)),t=!td.test(n?n.toLowerCase():"")}e=t}if(e)_e(a,"complete"),_e(a,"success");else{a.m=6;try{var r=2<Tn(a)?a.g.statusText:""}catch(e){r=""}a.j=r+" ["+a.da()+"]",_n(a)}}finally{bn(a)}}}function bn(a,b){if(a.g){In(a);const e=a.g,t=a.C[0]?()=>{}:null;a.g=null,a.C=null,b||_e(a,"ready");try{e.onreadystatechange=t}catch(e){}}}function In(a){a.g&&a.L&&(a.g.ontimeout=null),a.A&&(h.clearTimeout(a.A),a.A=null)}function Tn(a){return a.g?a.g.readyState:0}function En(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.K){case gn:case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Cn(a){let b="";return Z(a,(function(e,t){b+=t,b+=":",b+=e,b+="\r\n"})),b}function Sn(a,b,e){e:{for(t in e){var t=!1;break e}t=!0}t||(e=Cn(e),"string"==typeof a?null!=e&&encodeURIComponent(String(e)):Pt(a,b,e))}function kn(a,b,e){return e&&e.internalChannelParams&&e.internalChannelParams[a]||b}function On(a){this.Ga=0,this.j=[],this.l=new qe,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=kn("failFast",!1,a),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=kn("baseRetryDelayMs",5e3,a),this.hb=kn("retryDelaySeedMs",1e4,a),this.eb=kn("forwardChannelMaxRetries",2,a),this.xa=kn("forwardChannelRequestTimeoutMs",2e4,a),this.va=a&&a.xmlHttpFactory||void 0,this.Ha=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.i=new Yt(a&&a.concurrentRequestLimit),this.Ja=new sn,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=a&&a.bc||!1,a&&a.Ea&&this.l.Ea(),a&&a.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&a&&a.detectBufferingProxy||!1,this.qa=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.qa=a.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function An(a){if(Nn(a),3==a.H){var b=a.W++,e=At(a.I);if(Pt(e,"SID",a.K),Pt(e,"RID",b),Pt(e,"TYPE","terminate"),Dn(a,e),(b=new lt(a,a.l,b)).L=2,b.A=Dt(At(e)),e=!1,h.navigator&&h.navigator.sendBeacon)try{e=h.navigator.sendBeacon(b.A.toString(),"")}catch(e){}!e&&h.Image&&((new Image).src=b.A,e=!0),e||(b.g=Gn(b.l,null),b.g.ha(b.A)),b.G=Date.now(),vt(b)}Wn(a)}function xn(a){a.g&&(Fn(a),a.g.cancel(),a.g=null)}function Nn(a){xn(a),a.u&&(h.clearTimeout(a.u),a.u=null),Vn(a),a.i.cancel(),a.m&&("number"==typeof a.m&&h.clearTimeout(a.m),a.m=null)}function Rn(a){if(!Jt(a.i)&&!a.m){a.m=!0;var b=a.Na;ke||xe(),Oe||(ke(),Oe=!0),Ae.add(b,a),a.C=0}}function Pn(a,b){var e;e=b?b.m:a.W++;const t=At(a.I);Pt(t,"SID",a.K),Pt(t,"RID",e),Pt(t,"AID",a.V),Dn(a,t),a.o&&a.s&&Sn(t,a.o,a.s),e=new lt(a,a.l,e,a.C+1),null===a.o&&(e.I=a.s),b&&(a.j=b.F.concat(a.j)),b=Ln(a,e,1e3),e.setTimeout(Math.round(.5*a.xa)+Math.round(.5*a.xa*Math.random())),en(a.i,e),mt(e,t,b)}function Dn(a,b){a.na&&Z(a.na,(function(e,t){Pt(b,t,e)})),a.h&&St({},(function(e,t){Pt(b,t,e)}))}function Ln(a,b,e){e=Math.min(a.j.length,e);var t=a.h?q(a.h.Va,a.h,a):null;e:{var n=a.j;let r=-1;for(;;){const o=["count="+e];-1==r?0<e?(r=n[0].g,o.push("ofs="+r)):r=0:o.push("ofs="+r);let c=!0;for(let l=0;l<e;l++){let e=n[l].g;const u=n[l].map;if(e-=r,0>e)r=Math.max(0,n[l].g-100),c=!1;else try{on(u,o,"req"+e+"_")}catch(e){t&&t(u)}}if(c){t=o.join("&");break e}}}return a=a.j.splice(0,e),b.F=a,t}function Mn(a){if(!a.g&&!a.u){a.ba=1;var b=a.Ma;ke||xe(),Oe||(ke(),Oe=!0),Ae.add(b,a),a.A=0}}function jn(a){return!(a.g||a.u||3<=a.A)&&(a.ba++,a.u=Je(q(a.Ma,a),Bn(a,a.A)),a.A++,!0)}function Fn(a){null!=a.B&&(h.clearTimeout(a.B),a.B=null)}function Un(a){a.g=new lt(a,a.l,"rpc",a.ba),null===a.o&&(a.g.I=a.s),a.g.O=0;var b=At(a.wa);Pt(b,"RID","rpc"),Pt(b,"SID",a.K),Pt(b,"AID",a.V),Pt(b,"CI",a.G?"0":"1"),!a.G&&a.qa&&Pt(b,"TO",a.qa),Pt(b,"TYPE","xmlhttp"),Dn(a,b),a.o&&a.s&&Sn(b,a.o,a.s),a.L&&a.g.setTimeout(a.L);var e=a.g;a=a.pa,e.L=1,e.A=Dt(At(b)),e.u=null,e.S=!0,gt(e,a)}function Vn(a){null!=a.v&&(h.clearTimeout(a.v),a.v=null)}function qn(a,b){var e=null;if(a.g==b){Vn(a),Fn(a),a.g=null;var t=2}else{if(!Zt(a.i,b))return;e=b.F,tn(a.i,b),t=1}if(0!=a.H)if(b.i)if(1==t){e=b.u?b.u.length:0,b=Date.now()-b.G;var n=a.C;_e(t=Ke(),new Ye(t,e)),Rn(a)}else Mn(a);else if(3==(n=b.s)||0==n&&0<b.ca||!(1==t&&function(a,b){return!(Xt(a.i)>=a.i.j-(a.m?1:0)||(a.m?(a.j=b.F.concat(a.j),0):1==a.H||2==a.H||a.C>=(a.cb?0:a.eb)||(a.m=Je(q(a.Na,a,b),Bn(a,a.C)),a.C++,0)))}(a,b)||2==t&&jn(a)))switch(e&&0<e.length&&(b=a.i,b.i=b.i.concat(e)),n){case 1:zn(a,5);break;case 4:zn(a,10);break;case 3:zn(a,6);break;default:zn(a,2)}}function Bn(a,b){let e=a.ab+Math.floor(Math.random()*a.hb);return a.isActive()||(e*=2),e*b}function zn(a,b){if(a.l.info("Error code "+b),2==b){var e=null;a.h&&(e=null);var t=q(a.pb,a);e||(e=new Ot("//www.google.com/images/cleardot.gif"),h.location&&"http"==h.location.protocol||xt(e,"https"),Dt(e)),function(a,b){const e=new qe;if(h.Image){const t=new Image;t.onload=_(an,e,t,"TestLoadImage: loaded",!0,b),t.onerror=_(an,e,t,"TestLoadImage: error",!1,b),t.onabort=_(an,e,t,"TestLoadImage: abort",!1,b),t.ontimeout=_(an,e,t,"TestLoadImage: timeout",!1,b),h.setTimeout((function(){t.ontimeout&&t.ontimeout()}),1e4),t.src=a}else b(!1)}(e.toString(),t)}else Qe(2);a.H=0,a.h&&a.h.za(b),Wn(a),Nn(a)}function Wn(a){if(a.H=0,a.ma=[],a.h){const b=nn(a.i);0==b.length&&0==a.j.length||(C(a.ma,b),C(a.ma,a.j),a.i.i.length=0,E(a.j),a.j.length=0),a.h.ya()}}function Kn(a,b,e){var t=e instanceof Ot?At(e):new Ot(e);if(""!=t.g)b&&(t.g=b+"."+t.g),Nt(t,t.m);else{var n=h.location;t=n.protocol,b=b?b+"."+n.hostname:n.hostname,n=+n.port;var r=new Ot(null);t&&xt(r,t),b&&(r.g=b),n&&Nt(r,n),e&&(r.l=e),t=r}return e=a.F,b=a.Da,e&&b&&Pt(t,e,b),Pt(t,"VER",a.ra),Dn(a,t),t}function Gn(a,b,e){if(b&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return(b=a.Ha&&!a.va?new mn(new cn({ob:e})):new mn(a.va)).Oa(a.J),b}function Hn(){}function $n(){if(L&&!(10<=Number(G)))throw Error("Environmental error: no available transport.")}function Qn(a,b){we.call(this),this.g=new On(b),this.l=a,this.h=b&&b.messageUrlParams||null,a=b&&b.messageHeaders||null,b&&b.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.s=a,a=b&&b.initMessageHeaders||null,b&&b.messageContentType&&(a?a["X-WebChannel-Content-Type"]=b.messageContentType:a={"X-WebChannel-Content-Type":b.messageContentType}),b&&b.Ca&&(a?a["X-WebChannel-Client-Profile"]=b.Ca:a={"X-WebChannel-Client-Profile":b.Ca}),this.g.U=a,(a=b&&b.cc)&&!O(a)&&(this.g.o=a),this.A=b&&b.supportsCrossDomainXhr||!1,this.v=b&&b.sendRawJson||!1,(b=b&&b.httpSessionIdParam)&&!O(b)&&(this.g.F=b,null!==(a=this.h)&&b in a&&(b in(a=this.h)&&delete a[b])),this.j=new Xn(this)}function Yn(a){ot.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var b=a.__sm__;if(b){e:{for(const e in b){a=e;break e}a=void 0}(this.i=a)&&(a=this.i,b=null!==b&&a in b?b[a]:void 0),this.data=b}else this.data=a}function Jn(){at.call(this),this.status=1}function Xn(a){this.g=a}function Zn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function er(a,b,e){e||(e=0);var t=Array(16);if("string"==typeof b)for(var n=0;16>n;++n)t[n]=b.charCodeAt(e++)|b.charCodeAt(e++)<<8|b.charCodeAt(e++)<<16|b.charCodeAt(e++)<<24;else for(n=0;16>n;++n)t[n]=b[e++]|b[e++]<<8|b[e++]<<16|b[e++]<<24;b=a.g[0],e=a.g[1],n=a.g[2];var r=a.g[3],o=b+(r^e&(n^r))+t[0]+3614090360&4294967295;o=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=e+(o<<7&4294967295|o>>>25))+((o=r+(n^b&(e^n))+t[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=n+(e^r&(b^e))+t[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=e+(b^n&(r^b))+t[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=b+(r^e&(n^r))+t[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=r+(n^b&(e^n))+t[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=n+(e^r&(b^e))+t[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=e+(b^n&(r^b))+t[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=b+(r^e&(n^r))+t[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=r+(n^b&(e^n))+t[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=n+(e^r&(b^e))+t[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=e+(b^n&(r^b))+t[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=b+(r^e&(n^r))+t[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=r+(n^b&(e^n))+t[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=n+(e^r&(b^e))+t[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=e+(b^n&(r^b))+t[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=b+(n^r&(e^n))+t[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=r+(e^n&(b^e))+t[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=n+(b^e&(r^b))+t[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=e+(r^b&(n^r))+t[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=b+(n^r&(e^n))+t[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=r+(e^n&(b^e))+t[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=n+(b^e&(r^b))+t[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=e+(r^b&(n^r))+t[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=b+(n^r&(e^n))+t[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=r+(e^n&(b^e))+t[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=n+(b^e&(r^b))+t[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=e+(r^b&(n^r))+t[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=b+(n^r&(e^n))+t[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=r+(e^n&(b^e))+t[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=n+(b^e&(r^b))+t[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=e+(r^b&(n^r))+t[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=b+(e^n^r)+t[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=r+(b^e^n)+t[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=n+(r^b^e)+t[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=e+(n^r^b)+t[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=b+(e^n^r)+t[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=r+(b^e^n)+t[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=n+(r^b^e)+t[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=e+(n^r^b)+t[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=b+(e^n^r)+t[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=r+(b^e^n)+t[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=n+(r^b^e)+t[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=e+(n^r^b)+t[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=b+(e^n^r)+t[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=r+(b^e^n)+t[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=n+(r^b^e)+t[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=e+(n^r^b)+t[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=b+(n^(e|~r))+t[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=r+(e^(b|~n))+t[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=n+(b^(r|~e))+t[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=e+(r^(n|~b))+t[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=b+(n^(e|~r))+t[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=r+(e^(b|~n))+t[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=n+(b^(r|~e))+t[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=e+(r^(n|~b))+t[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=b+(n^(e|~r))+t[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=r+(e^(b|~n))+t[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=n+(b^(r|~e))+t[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=e+(r^(n|~b))+t[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((r=(b=e+((o=b+(n^(e|~r))+t[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=r+(e^(b|~n))+t[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((n=r+((o=n+(b^(r|~e))+t[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~b))+t[9]+3951481745&4294967295,a.g[0]=a.g[0]+b&4294967295,a.g[1]=a.g[1]+(n+(o<<21&4294967295|o>>>11))&4294967295,a.g[2]=a.g[2]+n&4294967295,a.g[3]=a.g[3]+r&4294967295}function nr(a,b){this.h=b;for(var e=[],t=!0,n=a.length-1;0<=n;n--){var r=0|a[n];t&&r==b||(e[n]=r,t=!1)}this.g=e}(r=mn.prototype).Oa=function(a){this.M=a},r.ha=function(a,b,e,t){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+a);b=b?b.toUpperCase():"GET",this.I=a,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():it.g(),this.C=this.u?tt(this.u):tt(it),this.g.onreadystatechange=q(this.La,this);try{this.G=!0,this.g.open(b,String(a),!0),this.G=!1}catch(e){return void wn(this,e)}if(a=e||"",e=new Map(this.headers),t)if(Object.getPrototypeOf(t)===Object.prototype)for(var n in t)e.set(n,t[n]);else{if("function"!=typeof t.keys||"function"!=typeof t.get)throw Error("Unknown input type for opt_headers: "+String(t));for(const n of t.keys())e.set(n,t.get(n))}t=Array.from(e.keys()).find((e=>"content-type"==e.toLowerCase())),n=h.FormData&&a instanceof h.FormData,!(0<=T(yn,b))||t||n||e.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,n]of e)this.g.setRequestHeader(t,n);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{In(this),0<this.B&&((this.L=function(a){return L&&"number"==typeof a.timeout&&void 0!==a.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=q(this.ua,this)):this.A=De(this.ua,this.B,this)),this.v=!0,this.g.send(a),this.v=!1}catch(e){wn(this,e)}},r.ua=function(){void 0!==l&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,_e(this,"timeout"),this.abort(8))},r.abort=function(a){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=a||7,_e(this,"complete"),_e(this,"abort"),bn(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),bn(this,!0)),mn.$.N.call(this)},r.La=function(){this.s||(this.G||this.v||this.l?vn(this):this.kb())},r.kb=function(){vn(this)},r.isActive=function(){return!!this.g},r.da=function(){try{return 2<Tn(this)?this.g.status:-1}catch(e){return-1}},r.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},r.Wa=function(a){if(this.g){var b=this.g.responseText;return a&&0==b.indexOf(a)&&(b=b.substring(a.length)),pn(b)}},r.Ia=function(){return this.m},r.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(r=On.prototype).ra=8,r.H=1,r.Na=function(a){if(this.m)if(this.m=null,1==this.H){if(!a){this.W=Math.floor(1e5*Math.random()),a=this.W++;const n=new lt(this,this.l,a);let r=this.s;if(this.U&&(r?(r=ee(r),ne(r,this.U)):r=this.U),null!==this.o||this.O||(n.I=r,r=null),this.P)e:{for(var b=0,e=0;e<this.j.length;e++){var t=this.j[e];if(void 0===(t="__data__"in t.map&&"string"==typeof(t=t.map.__data__)?t.length:void 0))break;if(4096<(b+=t)){b=e;break e}if(4096===b||e===this.j.length-1){b=e+1;break e}}b=1e3}else b=1e3;b=Ln(this,n,b),Pt(e=At(this.I),"RID",a),Pt(e,"CVER",22),this.F&&Pt(e,"X-HTTP-Session-Id",this.F),Dn(this,e),r&&(this.O?b="headers="+encodeURIComponent(String(Cn(r)))+"&"+b:this.o&&Sn(e,this.o,r)),en(this.i,n),this.bb&&Pt(e,"TYPE","init"),this.P?(Pt(e,"$req",b),Pt(e,"SID","null"),n.aa=!0,mt(n,e,null)):mt(n,e,b),this.H=2}}else 3==this.H&&(a?Pn(this,a):0==this.j.length||Jt(this.i)||Pn(this))},r.Ma=function(){if(this.u=null,Un(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var a=2*this.S;this.l.info("BP detection timer enabled: "+a),this.B=Je(q(this.jb,this),a)}},r.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Qe(10),xn(this),Un(this))},r.ib=function(){null!=this.v&&(this.v=null,xn(this),jn(this),Qe(19))},r.pb=function(a){a?(this.l.info("Successfully pinged google.com"),Qe(2)):(this.l.info("Failed to ping google.com"),Qe(1))},r.isActive=function(){return!!this.h&&this.h.isActive(this)},(r=Hn.prototype).Ba=function(){},r.Aa=function(){},r.za=function(){},r.ya=function(){},r.isActive=function(){return!0},r.Va=function(){},$n.prototype.g=function(a,b){return new Qn(a,b)},v(Qn,we),Qn.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var a=this.g,b=this.l,e=this.h||void 0;Qe(0),a.Y=b,a.na=e||{},a.G=a.aa,a.I=Kn(a,null,a.Y),Rn(a)},Qn.prototype.close=function(){An(this.g)},Qn.prototype.u=function(a){var b=this.g;if("string"==typeof a){var e={};e.__data__=a,a=e}else this.v&&((e={}).__data__=be(a),a=e);b.j.push(new Qt(b.fb++,a)),3==b.H&&Rn(b)},Qn.prototype.N=function(){this.g.h=null,delete this.j,An(this.g),delete this.g,Qn.$.N.call(this)},v(Yn,ot),v(Jn,at),v(Xn,Hn),Xn.prototype.Ba=function(){_e(this.g,"a")},Xn.prototype.Aa=function(a){_e(this.g,new Yn(a))},Xn.prototype.za=function(a){_e(this.g,new Jn)},Xn.prototype.ya=function(){_e(this.g,"b")},v(Zn,(function(){this.blockSize=-1})),Zn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Zn.prototype.j=function(a,b){void 0===b&&(b=a.length);for(var e=b-this.blockSize,t=this.m,n=this.h,r=0;r<b;){if(0==n)for(;r<=e;)er(this,a,r),r+=this.blockSize;if("string"==typeof a){for(;r<b;)if(t[n++]=a.charCodeAt(r++),n==this.blockSize){er(this,t),n=0;break}}else for(;r<b;)if(t[n++]=a[r++],n==this.blockSize){er(this,t),n=0;break}}this.h=n,this.i+=b},Zn.prototype.l=function(){var a=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);a[0]=128;for(var b=1;b<a.length-8;++b)a[b]=0;var e=8*this.i;for(b=a.length-8;b<a.length;++b)a[b]=255&e,e/=256;for(this.j(a),a=Array(16),b=e=0;4>b;++b)for(var t=0;32>t;t+=8)a[e++]=this.g[b]>>>t&255;return a};var rr={};function ir(a){return-128<=a&&128>a?function(a,b){var e=rr;return Object.prototype.hasOwnProperty.call(e,a)?e[a]:e[a]=b(a)}(a,(function(b){return new nr([0|b],0>b?-1:0)})):new nr([0|a],0>a?-1:0)}function sr(a){if(isNaN(a)||!isFinite(a))return ar;if(0>a)return fr(sr(-a));for(var b=[],e=1,t=0;a>=e;t++)b[t]=a/e|0,e*=or;return new nr(b,0)}var or=4294967296,ar=ir(0),cr=ir(1),lr=ir(16777216);function ur(a){if(0!=a.h)return!1;for(var b=0;b<a.g.length;b++)if(0!=a.g[b])return!1;return!0}function dr(a){return-1==a.h}function fr(a){for(var b=a.g.length,e=[],t=0;t<b;t++)e[t]=~a.g[t];return new nr(e,~a.h).add(cr)}function pr(a,b){return a.add(fr(b))}function mr(a,b){for(;(65535&a[b])!=a[b];)a[b+1]+=a[b]>>>16,a[b]&=65535,b++}function gr(a,b){this.g=a,this.h=b}function yr(a,b){if(ur(b))throw Error("division by zero");if(ur(a))return new gr(ar,ar);if(dr(a))return b=yr(fr(a),b),new gr(fr(b.g),fr(b.h));if(dr(b))return b=yr(a,fr(b)),new gr(fr(b.g),b.h);if(30<a.g.length){if(dr(a)||dr(b))throw Error("slowDivide_ only works with positive integers.");for(var e=cr,t=b;0>=t.X(a);)e=wr(e),t=wr(t);var n=_r(e,1),r=_r(t,1);for(t=_r(t,2),e=_r(e,2);!ur(t);){var o=r.add(t);0>=o.X(a)&&(n=n.add(e),r=o),t=_r(t,1),e=_r(e,1)}return b=pr(a,n.R(b)),new gr(n,b)}for(n=ar;0<=a.X(b);){for(e=Math.max(1,Math.floor(a.ea()/b.ea())),t=48>=(t=Math.ceil(Math.log(e)/Math.LN2))?1:Math.pow(2,t-48),o=(r=sr(e)).R(b);dr(o)||0<o.X(a);)o=(r=sr(e-=t)).R(b);ur(r)&&(r=cr),n=n.add(r),a=pr(a,o)}return new gr(n,a)}function wr(a){for(var b=a.g.length+1,e=[],t=0;t<b;t++)e[t]=a.D(t)<<1|a.D(t-1)>>>31;return new nr(e,a.h)}function _r(a,b){var e=b>>5;b%=32;for(var t=a.g.length-e,n=[],r=0;r<t;r++)n[r]=0<b?a.D(r+e)>>>b|a.D(r+e+1)<<32-b:a.D(r+e);return new nr(n,a.h)}(r=nr.prototype).ea=function(){if(dr(this))return-fr(this).ea();for(var a=0,b=1,e=0;e<this.g.length;e++){var t=this.D(e);a+=(0<=t?t:or+t)*b,b*=or}return a},r.toString=function(a){if(2>(a=a||10)||36<a)throw Error("radix out of range: "+a);if(ur(this))return"0";if(dr(this))return"-"+fr(this).toString(a);for(var b=sr(Math.pow(a,6)),e=this,t="";;){var n=yr(e,b).g,r=((0<(e=pr(e,n.R(b))).g.length?e.g[0]:e.h)>>>0).toString(a);if(ur(e=n))return r+t;for(;6>r.length;)r="0"+r;t=r+t}},r.D=function(a){return 0>a?0:a<this.g.length?this.g[a]:this.h},r.X=function(a){return dr(a=pr(this,a))?-1:ur(a)?0:1},r.abs=function(){return dr(this)?fr(this):this},r.add=function(a){for(var b=Math.max(this.g.length,a.g.length),e=[],t=0,n=0;n<=b;n++){var r=t+(65535&this.D(n))+(65535&a.D(n)),o=(r>>>16)+(this.D(n)>>>16)+(a.D(n)>>>16);t=o>>>16,r&=65535,o&=65535,e[n]=o<<16|r}return new nr(e,-2147483648&e[e.length-1]?-1:0)},r.R=function(a){if(ur(this)||ur(a))return ar;if(dr(this))return dr(a)?fr(this).R(fr(a)):fr(fr(this).R(a));if(dr(a))return fr(this.R(fr(a)));if(0>this.X(lr)&&0>a.X(lr))return sr(this.ea()*a.ea());for(var b=this.g.length+a.g.length,e=[],t=0;t<2*b;t++)e[t]=0;for(t=0;t<this.g.length;t++)for(var n=0;n<a.g.length;n++){var r=this.D(t)>>>16,o=65535&this.D(t),c=a.D(n)>>>16,l=65535&a.D(n);e[2*t+2*n]+=o*l,mr(e,2*t+2*n),e[2*t+2*n+1]+=r*l,mr(e,2*t+2*n+1),e[2*t+2*n+1]+=o*c,mr(e,2*t+2*n+1),e[2*t+2*n+2]+=r*c,mr(e,2*t+2*n+2)}for(t=0;t<b;t++)e[t]=e[2*t+1]<<16|e[2*t];for(t=b;t<2*b;t++)e[t]=0;return new nr(e,0)},r.gb=function(a){return yr(this,a).h},r.and=function(a){for(var b=Math.max(this.g.length,a.g.length),e=[],t=0;t<b;t++)e[t]=this.D(t)&a.D(t);return new nr(e,this.h&a.h)},r.or=function(a){for(var b=Math.max(this.g.length,a.g.length),e=[],t=0;t<b;t++)e[t]=this.D(t)|a.D(t);return new nr(e,this.h|a.h)},r.xor=function(a){for(var b=Math.max(this.g.length,a.g.length),e=[],t=0;t<b;t++)e[t]=this.D(t)^a.D(t);return new nr(e,this.h^a.h)},$n.prototype.createWebChannel=$n.prototype.g,Qn.prototype.send=Qn.prototype.u,Qn.prototype.open=Qn.prototype.m,Qn.prototype.close=Qn.prototype.close,Xe.NO_ERROR=0,Xe.TIMEOUT=8,Xe.HTTP_ERROR=6,Ze.COMPLETE="complete",nt.EventType=st,st.OPEN="a",st.CLOSE="b",st.ERROR="c",st.MESSAGE="d",we.prototype.listen=we.prototype.O,mn.prototype.listenOnce=mn.prototype.P,mn.prototype.getLastError=mn.prototype.Sa,mn.prototype.getLastErrorCode=mn.prototype.Ia,mn.prototype.getStatus=mn.prototype.da,mn.prototype.getResponseJson=mn.prototype.Wa,mn.prototype.getResponseText=mn.prototype.ja,mn.prototype.send=mn.prototype.ha,mn.prototype.setWithCredentials=mn.prototype.Oa,Zn.prototype.digest=Zn.prototype.l,Zn.prototype.reset=Zn.prototype.reset,Zn.prototype.update=Zn.prototype.j,nr.prototype.add=nr.prototype.add,nr.prototype.multiply=nr.prototype.R,nr.prototype.modulo=nr.prototype.gb,nr.prototype.compare=nr.prototype.X,nr.prototype.toNumber=nr.prototype.ea,nr.prototype.toString=nr.prototype.toString,nr.prototype.getBits=nr.prototype.D,nr.fromNumber=sr,nr.fromString=function e(a,b){if(0==a.length)throw Error("number format error: empty string");if(2>(b=b||10)||36<b)throw Error("radix out of range: "+b);if("-"==a.charAt(0))return fr(e(a.substring(1),b));if(0<=a.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=sr(Math.pow(b,8)),n=ar,r=0;r<a.length;r+=8){var o=Math.min(8,a.length-r),c=parseInt(a.substring(r,r+o),b);8>o?(o=sr(Math.pow(b,o)),n=n.R(o).add(sr(c))):n=(n=n.R(t)).add(sr(c))}return n};var vr=c.createWebChannelTransport=function(){return new $n},Ir=c.getStatEventTarget=function(){return Ke()},Tr=c.ErrorCode=Xe,Er=c.EventType=Ze,Cr=c.Event=ze,Sr=c.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},kr=(c.FetchXmlHttpFactory=cn,c.WebChannel=nt),Or=c.XhrIo=mn,Ar=c.Md5=Zn,xr=c.Integer=nr}).call(this,n(58))},336:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return Qi})),n.d(t,"b",(function(){return Yi})),n.d(t,"c",(function(){return At})),n.d(t,"d",(function(){return es})),n.d(t,"e",(function(){return $s})),n.d(t,"f",(function(){return m})),n.d(t,"g",(function(){return si})),n.d(t,"h",(function(){return ai})),n.d(t,"i",(function(){return is})),n.d(t,"j",(function(){return Zs})),n.d(t,"k",(function(){return no})),n.d(t,"l",(function(){return Ts})),n.d(t,"m",(function(){return Cs})),n.d(t,"n",(function(){return zs})),n.d(t,"o",(function(){return Xs})),n.d(t,"p",(function(){return Js})),n.d(t,"q",(function(){return hs})),n.d(t,"r",(function(){return eo})),n.d(t,"s",(function(){return to})),n.d(t,"t",(function(){return so})),n.d(t,"u",(function(){return Ns})),n.d(t,"v",(function(){return Ps})),n.d(t,"w",(function(){return vs})),n.d(t,"x",(function(){return gs})),n.d(t,"y",(function(){return ys})),n.d(t,"z",(function(){return ws})),n.d(t,"A",(function(){return _s})),n.d(t,"B",(function(){return ms})),n.d(t,"C",(function(){return Ls})),n.d(t,"D",(function(){return js})),n.d(t,"E",(function(){return Us})),n.d(t,"F",(function(){return qs})),n.d(t,"G",(function(){return ss})),n.d(t,"H",(function(){return Ws})),n.d(t,"I",(function(){return ns})),n.d(t,"J",(function(){return rs})),n.d(t,"K",(function(){return os})),n.d(t,"L",(function(){return ao})),n.d(t,"M",(function(){return io})),n.d(t,"N",(function(){return as})),n.d(t,"O",(function(){return cs})),n.d(t,"P",(function(){return ls})),n.d(t,"Q",(function(){return As})),n.d(t,"R",(function(){return ks})),n.d(t,"S",(function(){return us}));var r=n(315),o=n(311),c=n(310),l=n(314);const h="@firebase/database",d="1.0.3";let f="";function m(e){f=e}class y{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Object(c.R)(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Object(c.K)(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class w{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Object(c.k)(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const _=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new y(t)}}catch(e){}return new w},v=_("localStorage"),I=_("sessionStorage"),T=new l.b("@firebase/database"),E=function(){let e=1;return function(){return e++}}(),C=function(e){const t=Object(c.Q)(e),n=new c.d;n.update(t);const r=n.digest();return c.g.encodeByteArray(r)},S=function(...e){let t="";for(let i=0;i<e.length;i++){const n=e[i];Array.isArray(n)||n&&"object"==typeof n&&"number"==typeof n.length?t+=S.apply(null,n):t+="object"==typeof n?Object(c.R)(n):n,t+=" "}return t};let k=null,O=!0;const A=function(e,t){Object(c.e)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(T.logLevel=l.a.VERBOSE,k=T.log.bind(T),t&&I.set("logging_enabled",!0)):"function"==typeof e?k=e:(k=null,I.remove("logging_enabled"))},x=function(...e){if(!0===O&&(O=!1,null===k&&!0===I.get("logging_enabled")&&A(!0)),k){const t=S.apply(null,e);k(t)}},N=function(e){return function(...t){x(e,...t)}},R=function(...e){const t="FIREBASE INTERNAL ERROR: "+S(...e);T.error(t)},P=function(...e){const t=`FIREBASE FATAL ERROR: ${S(...e)}`;throw T.error(t),new Error(t)},D=function(...e){const t="FIREBASE WARNING: "+S(...e);T.warn(t)},L=function(data){return"number"==typeof data&&(data!=data||data===Number.POSITIVE_INFINITY||data===Number.NEGATIVE_INFINITY)},M="[MIN_NAME]",j="[MAX_NAME]",F=function(a,b){if(a===b)return 0;if(a===M||b===j)return-1;if(b===M||a===j)return 1;{const e=H(a),t=H(b);return null!==e?null!==t?e-t==0?a.length-b.length:e-t:-1:null!==t?1:a<b?-1:1}},U=function(a,b){return a===b?0:a<b?-1:1},V=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Object(c.R)(t))},B=function(e){if("object"!=typeof e||null===e)return Object(c.R)(e);const t=[];for(const n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=Object(c.R)(t[i]),n+=":",n+=B(e[t[i]]);return n+="}",n},z=function(e,t){const n=e.length;if(n<=t)return[e];const r=[];for(let o=0;o<n;o+=t)o+t>n?r.push(e.substring(o,n)):r.push(e.substring(o,o+t));return r};function W(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const K=function(e){Object(c.e)(!L(e),"Invalid JSON number");const t=1023;let s,n,r,o,i;0===e?(n=0,r=0,s=1/e==-1/0?1:0):(s=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(o=Math.min(Math.floor(Math.log(e)/Math.LN2),t),n=o+t,r=Math.round(e*Math.pow(2,52-o)-Math.pow(2,52))):(n=0,r=Math.round(e/Math.pow(2,-1074))));const l=[];for(i=52;i;i-=1)l.push(r%2?1:0),r=Math.floor(r/2);for(i=11;i;i-=1)l.push(n%2?1:0),n=Math.floor(n/2);l.push(s?1:0),l.reverse();const h=l.join("");let d="";for(i=0;i<64;i+=8){let e=parseInt(h.substr(i,8),2).toString(16);1===e.length&&(e="0"+e),d+=e}return d.toLowerCase()};const G=new RegExp("^-?(0*)\\d{1,10}$"),H=function(e){if(G.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},$=function(e){try{e()}catch(e){setTimeout((()=>{const t=e.stack||"";throw D("Exception was thrown by user callback.",t),e}),Math.floor(0))}},Q=function(e,time){const t=setTimeout(e,time);return"number"==typeof t&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(t):"object"==typeof t&&t.unref&&t.unref(),t};class Y{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((e=>this.appCheck=e))}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){D(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class J{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(x("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',D(e)}}class X{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}X.OWNER="owner";const Z="5",ee=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,te="ac",ne="websocket",re="long_polling";class ie{constructor(e,t,n,r,o=!1,c="",l=!1,h=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=o,this.persistenceKey=c,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=h,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=v.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&v.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function se(e,t,n){let r;if(Object(c.e)("string"==typeof t,"typeof type must == string"),Object(c.e)("object"==typeof n,"typeof params must == object"),t===ne)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==re)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const o=[];return W(n,((e,t)=>{o.push(e+"="+t)})),r+o.join("&")}class oe{constructor(){this.counters_={}}incrementCounter(e,t=1){Object(c.k)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Object(c.n)(this.counters_)}}const ae={},ce={};function le(e){const t=e.toString();return ae[t]||(ae[t]=new oe),ae[t]}class ue{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,data){for(this.pendingResponses[e]=data;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<e.length;++i)e[i]&&$((()=>{this.onMessage_(e[i])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const he="start";class de{constructor(e,t,n,r,o,c,l){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=o,this.transportSessionId=c,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=N(e),this.stats_=le(t),this.urlFn=e=>(this.appCheckToken&&(e[te]=this.appCheckToken),se(t,re,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new ue(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if(Object(c.G)()||"complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new fe(((...e)=>{const[t,n,r,o,c]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===he)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...e)=>{const[t,data]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,data)}),(()=>{this.onClosed_()}),this.urlFn);const e={};e[he]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=Z,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[te]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&ee.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){de.forceAllow_=!0}static forceDisallow(){de.forceDisallow_=!0}static isAvailable(){return!Object(c.G)()&&(!!de.forceAllow_||!(de.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(data){const e=Object(c.R)(data);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const t=Object(c.i)(e),n=z(t,1840);for(let i=0;i<n.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Object(c.G)())return;this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Object(c.R)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class fe{constructor(e,t,n,r){if(this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,Object(c.G)())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=E(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=fe.createIFrame_();let script="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){script='<script>document.domain="'+document.domain+'";<\/script>'}const n="<html><body>"+script+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(n),this.myIFrame.doc.close()}catch(e){x("frame writing exception"),e.stack&&x(e.stack),x(e)}}}static createIFrame_(){const iframe=document.createElement("iframe");if(iframe.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(iframe);try{iframe.contentWindow.document||x("No IE domain setting required")}catch(e){const t=document.domain;iframe.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return iframe.contentDocument?iframe.doc=iframe.contentDocument:iframe.contentWindow?iframe.doc=iframe.contentWindow.document:iframe.document&&(iframe.doc=iframe.document),iframe}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;{const e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,data){this.pendingSegs.push({seg:e,ts:t,d:data}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(r),n()}))}addTag(e,t){Object(c.G)()?this.doNodeLongPoll(e,t):setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{x("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}}),Math.floor(1))}}let pe=null;"undefined"!=typeof MozWebSocket?pe=MozWebSocket:"undefined"!=typeof WebSocket&&(pe=WebSocket);class me{constructor(e,t,n,r,o,c,l){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=N(this.connId),this.stats_=le(t),this.connURL=me.connectionURL_(t,c,l,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,o){const l={};return l.v=Z,!Object(c.G)()&&"undefined"!=typeof location&&location.hostname&&ee.test(location.hostname)&&(l.r="f"),t&&(l.s=t),n&&(l.ls=n),r&&(l[te]=r),o&&(l.p=o),se(e,ne,l)}open(t,n){this.onDisconnect=n,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,v.set("previous_websocket_failure",!0);try{let t;if(Object(c.G)()){const n=this.nodeAdmin?"AdminNode":"Node";t={headers:{"User-Agent":`Firebase/${Z}/${f}/${e.platform}/${n}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(t.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(t.headers["X-Firebase-AppCheck"]=this.appCheckToken);const r=e.env,o=0===this.connURL.indexOf("wss://")?r.HTTPS_PROXY||r.https_proxy:r.HTTP_PROXY||r.http_proxy;o&&(t.proxy={origin:o})}this.mySock=new pe(this.connURL,[],t)}catch(e){this.log_("Error instantiating WebSocket.");const t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){me.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==pe&&!me.forceDisallow_}static previouslyFailed(){return v.isInMemoryStorage||!0===v.get("previous_websocket_failure")}markConnectionHealthy(){v.remove("previous_websocket_failure")}appendFrame_(data){if(this.frames.push(data),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=Object(c.K)(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(data){if(Object(c.e)(null===this.frames,"We already have a frame buffer"),data.length<=6){const e=Number(data);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),data}handleIncomingFrame(e){if(null===this.mySock)return;const data=e.data;if(this.bytesReceived+=data.length,this.stats_.incrementCounter("bytes_received",data.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(data);else{const e=this.extractFrameCount_(data);null!==e&&this.appendFrame_(e)}}send(data){this.resetKeepAlive();const e=Object(c.R)(data);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const t=z(e,16384);t.length>1&&this.sendString_(String(t.length));for(let i=0;i<t.length;i++)this.sendString_(t[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}me.responsesRequiredToBeHealthy=2,me.healthyTimeout=3e4;class ge{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[de,me]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=me&&me.isAvailable();let n=t&&!me.previouslyFailed();if(e.webSocketOnly&&(t||D("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[me];else{const e=this.transports_=[];for(const t of ge.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);ge.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}ge.globalTransportInitialized_=!1;class ye{constructor(e,t,n,r,o,c,l,h,d,f){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=o,this.onMessage_=c,this.onReady_=l,this.onDisconnect_=h,this.onKill_=d,this.lastSessionId=f,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=N("c:"+this.id+":"),this.transportManager_=new ge(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=Q((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=V("t",e),data=V("d",e);if("c"===t)this.onSecondaryControl_(data);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(data)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=V("t",e),data=V("d",e);"c"===t?this.onControl_(data):"d"===t&&this.onDataMessage_(data)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=V("t",e);if("d"in e){const n=e.d;if("h"===t){const e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?R("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):R("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Z!==n&&D("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),Q((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Q((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(v.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(data){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(data)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class we{put(e,data,t,n){}merge(e,data,t,n){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,data,t){}onDisconnectMerge(e,data,t){}onDisconnectCancel(e,t){}reportStats(e){}}class _e{constructor(e){this.allowedEvents_=e,this.listeners_={},Object(c.e)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let i=0;i<n.length;i++)n[i].callback.apply(n[i].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(e){Object(c.e)(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class ve extends _e{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Object(c.E)()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new ve}getInitialEvent(e){return Object(c.e)("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const be=32,Ie=768;class Te{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[t]=this.pieces_[i],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let i=this.pieceNum_;i<this.pieces_.length;i++)""!==this.pieces_[i]&&(e+="/"+this.pieces_[i]);return e||"/"}}function Ee(){return new Te("")}function Ce(path){return path.pieceNum_>=path.pieces_.length?null:path.pieces_[path.pieceNum_]}function Se(path){return path.pieces_.length-path.pieceNum_}function ke(path){let e=path.pieceNum_;return e<path.pieces_.length&&e++,new Te(path.pieces_,e)}function Oe(path){return path.pieceNum_<path.pieces_.length?path.pieces_[path.pieces_.length-1]:null}function Ae(path,e=0){return path.pieces_.slice(path.pieceNum_+e)}function xe(path){if(path.pieceNum_>=path.pieces_.length)return null;const e=[];for(let i=path.pieceNum_;i<path.pieces_.length-1;i++)e.push(path.pieces_[i]);return new Te(e,0)}function Ne(path,e){const t=[];for(let i=path.pieceNum_;i<path.pieces_.length;i++)t.push(path.pieces_[i]);if(e instanceof Te)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{const n=e.split("/");for(let i=0;i<n.length;i++)n[i].length>0&&t.push(n[i])}return new Te(t,0)}function Re(path){return path.pieceNum_>=path.pieces_.length}function Pe(e,t){const n=Ce(e),r=Ce(t);if(null===n)return t;if(n===r)return Pe(ke(e),ke(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function De(e,t){const n=Ae(e,0),r=Ae(t,0);for(let i=0;i<n.length&&i<r.length;i++){const e=F(n[i],r[i]);if(0!==e)return e}return n.length===r.length?0:n.length<r.length?-1:1}function Le(path,e){if(Se(path)!==Se(e))return!1;for(let i=path.pieceNum_,t=e.pieceNum_;i<=path.pieces_.length;i++,t++)if(path.pieces_[i]!==e.pieces_[t])return!1;return!0}function Me(path,e){let i=path.pieceNum_,t=e.pieceNum_;if(Se(path)>Se(e))return!1;for(;i<path.pieces_.length;){if(path.pieces_[i]!==e.pieces_[t])return!1;++i,++t}return!0}class je{constructor(path,e){this.errorPrefix_=e,this.parts_=Ae(path,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Object(c.P)(this.parts_[i]);Fe(this)}}function Fe(e){if(e.byteLength_>Ie)throw new Error(e.errorPrefix_+"has a key path longer than "+Ie+" bytes ("+e.byteLength_+").");if(e.parts_.length>be)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+be+") or object contains a cycle "+Ue(e))}function Ue(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class Ve extends _e{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}static getInstance(){return new Ve}getInitialEvent(e){return Object(c.e)("visible"===e,"Unknown event type: "+e),[this.visible_]}}const qe=1e3;class Be extends we{constructor(e,t,n,r,o,l,h,d){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=l,this.appCheckTokenProvider_=h,this.authOverride_=d,this.id=Be.nextPersistentConnectionId_++,this.log_=N("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=qe,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,d&&!Object(c.G)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Ve.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&ve.getInstance().on("online",this.onOnline_,this)}sendRequest(e,body,t){const n=++this.requestNumber_,r={r:n,a:e,b:body};this.log_(Object(c.R)(r)),Object(c.e)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),t&&(this.requestCBHash_[n]=t)}get(e){this.initConnection_();const t=new c.a,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,n,r){this.initConnection_();const o=e._queryIdentifier,l=e._path.toString();this.log_("Listen called for "+l+" "+o),this.listens.has(l)||this.listens.set(l,new Map),Object(c.e)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Object(c.e)(!this.listens.get(l).has(o),"listen() called twice for same path/queryId.");const h={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(l).set(o,h),this.connected_&&this.sendListen_(h)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);const o={p:n};e.tag&&(o.q=t._queryObject,o.t=e.tag),o.h=e.hashFn(),this.sendRequest("q",o,(o=>{const c=o.d,l=o.s;Be.warnOnListenWarnings_(c,t);(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",o),"ok"!==l&&this.removeListen_(n,r),e.onComplete&&e.onComplete(l,c))}))}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&Object(c.k)(e,"w")){const n=Object(c.O)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();D(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||Object(c.y)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=Object(c.J)(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,data=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,data))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,data=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,data)}))}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),Object(c.e)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const o={p:e};r&&(o.q=n,o.t=r),this.sendRequest("n",o)}onDisconnectPut(e,data,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,data,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:data,onComplete:t})}onDisconnectMerge(e,data,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,data,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:data,onComplete:t})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,data,n){const r={p:t,d:data};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,(e=>{n&&setTimeout((()=>{n(e.s,e.d)}),Math.floor(0))}))}put(e,data,t,n){this.putInternal("p",e,data,t,n)}merge(e,data,t,n){this.putInternal("m",e,data,t,n)}putInternal(e,t,data,n,r){this.initConnection_();const o={p:t,d:data};void 0!==r&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:n}),this.outstandingPutCount_++;const c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Object(c.R)(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,body){this.log_("handleServerMessage",e,body),"d"===e?this.onDataUpdate_(body.p,body.d,!1,body.t):"m"===e?this.onDataUpdate_(body.p,body.d,!0,body.t):"c"===e?this.onListenRevoked_(body.p,body.q):"ac"===e?this.onAuthRevoked_(body.s,body.d):"apc"===e?this.onAppCheckRevoked_(body.s,body.d):"sd"===e?this.onSecurityDebugPacket_(body):R("Unrecognized action received from server: "+Object(c.R)(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Object(c.e)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=qe,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=qe,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=qe),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+Be.nextConnectionId_++,o=this.lastSessionId;let l=!1,h=null;const d=function(){h?h.close():(l=!0,n())},f=function(e){Object(c.e)(h,"sendRequest call when we're not connected not allowed."),h.sendRequest(e)};this.realtime_={close:d,sendRequest:f};const m=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[c,d]=await Promise.all([this.authTokenProvider_.getToken(m),this.appCheckTokenProvider_.getToken(m)]);l?x("getToken() completed but was canceled"):(x("getToken() completed. Creating connection."),this.authToken_=c&&c.accessToken,this.appCheckToken_=d&&d.token,h=new ye(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,(e=>{D(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),o))}catch(e){this.log_("Failed to get token: "+e),l||(this.repoInfo_.nodeAdmin&&D(e),d())}}}interrupt(e){x("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){x("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Object(c.B)(this.interruptReasons_)&&(this.reconnectDelay_=qe,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let i=0;i<this.outstandingPuts_.length;i++){const e=this.outstandingPuts_[i];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[i],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((q=>B(q))).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new Te(e).toString();let r;if(this.listens.has(n)){const map=this.listens.get(n);r=map.get(t),map.delete(t),0===map.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){x("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){x("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(body){this.securityDebugCallback_?this.securityDebugCallback_(body):"msg"in body&&console.log("FIREBASE: "+body.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let i=0;i<this.outstandingPuts_.length;i++)this.outstandingPuts_[i]&&this.sendPut_(i);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let i=0;i<this.outstandingGets_.length;i++)this.outstandingGets_[i]&&this.sendGet_(i)}sendConnectStats_(){const e={};let t="js";Object(c.G)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+f.replace(/\./g,"-")]=1,Object(c.E)()?e["framework.cordova"]=1:Object(c.H)()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=ve.getInstance().currentlyOnline();return Object(c.B)(this.interruptReasons_)&&e}}Be.nextPersistentConnectionId_=0,Be.nextConnectionId_=0;class ze{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new ze(e,t)}}class We{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new ze(M,e),r=new ze(M,t);return 0!==this.compare(n,r)}minPost(){return ze.MIN}}let Ke;class Ge extends We{static get __EMPTY_NODE(){return Ke}static set __EMPTY_NODE(e){Ke=e}compare(a,b){return F(a.name,b.name)}isDefinedOn(e){throw Object(c.f)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return ze.MIN}maxPost(){return new ze(j,Ke)}makePost(e,t){return Object(c.e)("string"==typeof e,"KeyIndex indexValue must always be a string."),new ze(e,Ke)}toString(){return".key"}}const He=new Ge;class $e{constructor(e,t,n,r,o=null){this.isReverse_=r,this.resultGenerator_=o,this.nodeStack_=[];let c=1;for(;!e.isEmpty();)if(c=t?n(e.key,t):1,r&&(c*=-1),c<0)e=this.isReverse_?e.left:e.right;else{if(0===c){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Qe{constructor(e,t,n,r,o){this.key=e,this.value=t,this.color=null!=n?n:Qe.RED,this.left=null!=r?r:Ye.EMPTY_NODE,this.right=null!=o?o:Ye.EMPTY_NODE}copy(e,t,n,r,o){return new Qe(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=o?o:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const o=n(e,r.key);return r=o<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===o?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return Ye.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Ye.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Qe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Qe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Qe.RED=!0,Qe.BLACK=!1;class Ye{constructor(e,t=Ye.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Ye(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Qe.BLACK,null,null))}remove(e){return new Ye(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Qe.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new $e(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new $e(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new $e(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new $e(this.root_,null,this.comparator_,!0,e)}}function Je(e,t){return F(e.name,t.name)}function Xe(e,t){return F(e,t)}let Ze;Ye.EMPTY_NODE=new class{copy(e,t,n,r,o){return this}insert(e,t,n){return new Qe(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const et=function(e){return"number"==typeof e?"number:"+K(e):"string:"+e},tt=function(e){if(e.isLeafNode()){const t=e.val();Object(c.e)("string"==typeof t||"number"==typeof t||"object"==typeof t&&Object(c.k)(t,".sv"),"Priority must be a string or number.")}else Object(c.e)(e===Ze||e.isEmpty(),"priority of unexpected type.");Object(c.e)(e===Ze||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let nt,it,st;class ot{constructor(e,t=ot.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Object(c.e)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),tt(this.priorityNode_)}static set __childrenNodeConstructor(e){nt=e}static get __childrenNodeConstructor(){return nt}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new ot(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:ot.__childrenNodeConstructor.EMPTY_NODE}getChild(path){return Re(path)?this:".priority"===Ce(path)?this.priorityNode_:ot.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:ot.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(path,e){const t=Ce(path);return null===t?e:e.isEmpty()&&".priority"!==t?this:(Object(c.e)(".priority"!==t||1===Se(path),".priority must be the last token in a path"),this.updateImmediateChild(t,ot.__childrenNodeConstructor.EMPTY_NODE.updateChild(ke(path),e)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+et(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?K(this.value_):this.value_,this.lazyHash_=C(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===ot.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof ot.__childrenNodeConstructor?-1:(Object(c.e)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,r=ot.VALUE_TYPE_ORDER.indexOf(t),o=ot.VALUE_TYPE_ORDER.indexOf(n);return Object(c.e)(r>=0,"Unknown leaf type: "+t),Object(c.e)(o>=0,"Unknown leaf type: "+n),r===o?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}ot.VALUE_TYPE_ORDER=["object","boolean","number","string"];const at=new class extends We{compare(a,b){const e=a.node.getPriority(),t=b.node.getPriority(),n=e.compareTo(t);return 0===n?F(a.name,b.name):n}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return ze.MIN}maxPost(){return new ze(j,new ot("[PRIORITY-POST]",st))}makePost(e,t){const n=it(e);return new ze(t,new ot("[PRIORITY-POST]",n))}toString(){return".priority"}},ct=Math.log(2);class lt{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/ct,10)),this.current_=this.count-1;const mask=(n=this.count,parseInt(Array(n+1).join("1"),2));var n;this.bits_=e+1&mask}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const ut=function(e,t,n,r){e.sort(t);const o=function(t,r){const c=r-t;let l,h;if(0===c)return null;if(1===c)return l=e[t],h=n?n(l):l,new Qe(h,l.node,Qe.BLACK,null,null);{const d=parseInt(c/2,10)+t,f=o(t,d),m=o(d+1,r);return l=e[d],h=n?n(l):l,new Qe(h,l.node,Qe.BLACK,f,m)}},c=function(t){let r=null,c=null,l=e.length;const h=function(t,r){const c=l-t,h=l;l-=t;const f=o(c+1,h),m=e[c],y=n?n(m):m;d(new Qe(y,m.node,r,null,f))},d=function(e){r?(r.left=e,r=e):(c=e,r=e)};for(let i=0;i<t.count;++i){const e=t.nextBitIsOne(),n=Math.pow(2,t.count-(i+1));e?h(n,Qe.BLACK):(h(n,Qe.BLACK),h(n,Qe.RED))}return c}(new lt(e.length));return new Ye(r||t,c)};let ht;const ft={};class pt{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return Object(c.e)(ft&&at,"ChildrenNode.ts has not been loaded"),ht=ht||new pt({".priority":ft},{".priority":at}),ht}get(e){const t=Object(c.O)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Ye?t:null}hasIndex(e){return Object(c.k)(this.indexSet_,e.toString())}addIndex(e,t){Object(c.e)(e!==He,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const o=t.getIterator(ze.Wrap);let l,h=o.getNext();for(;h;)r=r||e.isDefinedOn(h.node),n.push(h),h=o.getNext();l=r?ut(n,e.getCompare()):ft;const d=e.toString(),f=Object.assign({},this.indexSet_);f[d]=e;const m=Object.assign({},this.indexes_);return m[d]=l,new pt(m,f)}addToIndexes(e,t){const n=Object(c.L)(this.indexes_,((n,r)=>{const o=Object(c.O)(this.indexSet_,r);if(Object(c.e)(o,"Missing index implementation for "+r),n===ft){if(o.isDefinedOn(e.node)){const n=[],r=t.getIterator(ze.Wrap);let c=r.getNext();for(;c;)c.name!==e.name&&n.push(c),c=r.getNext();return n.push(e),ut(n,o.getCompare())}return ft}{const r=t.get(e.name);let o=n;return r&&(o=o.remove(new ze(e.name,r))),o.insert(e,e.node)}}));return new pt(n,this.indexSet_)}removeFromIndexes(e,t){const n=Object(c.L)(this.indexes_,(n=>{if(n===ft)return n;{const r=t.get(e.name);return r?n.remove(new ze(e.name,r)):n}}));return new pt(n,this.indexSet_)}}let mt;class gt{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&tt(this.priorityNode_),this.children_.isEmpty()&&Object(c.e)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return mt||(mt=new gt(new Ye(Xe),null,pt.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||mt}updatePriority(e){return this.children_.isEmpty()?this:new gt(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?mt:t}}getChild(path){const e=Ce(path);return null===e?this:this.getImmediateChild(e).getChild(ke(path))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(Object(c.e)(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new ze(e,t);let r,o;t.isEmpty()?(r=this.children_.remove(e),o=this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(e,t),o=this.indexMap_.addToIndexes(n,this.children_));const c=r.isEmpty()?mt:this.priorityNode_;return new gt(r,c,o)}}updateChild(path,e){const t=Ce(path);if(null===t)return e;{Object(c.e)(".priority"!==Ce(path)||1===Se(path),".priority must be the last token in a path");const n=this.getImmediateChild(t).updateChild(ke(path),e);return this.updateImmediateChild(t,n)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,r=0,o=!0;if(this.forEachChild(at,((c,l)=>{t[c]=l.val(e),n++,o&&gt.INTEGER_REGEXP_.test(c)?r=Math.max(r,Number(c)):o=!1})),!e&&o&&r<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+et(this.getPriority().val())+":"),this.forEachChild(at,((t,n)=>{const r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":C(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const n=r.getPredecessorKey(new ze(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new ze(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new ze(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,ze.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)<0;)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,ze.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===yt?-1:0}withIndex(e){if(e===He||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new gt(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===He||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(at),n=t.getIterator(at);let r=e.getNext(),o=n.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=e.getNext(),o=n.getNext()}return null===r&&null===o}return!1}return!1}}resolveIndex_(e){return e===He?null:this.indexMap_.get(e.toString())}}gt.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const yt=new class extends gt{constructor(){super(new Ye(Xe),gt.EMPTY_NODE,pt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return gt.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(ze,{MIN:{value:new ze(M,gt.EMPTY_NODE)},MAX:{value:new ze(j,yt)}}),Ge.__EMPTY_NODE=gt.EMPTY_NODE,ot.__childrenNodeConstructor=gt,Ze=yt,function(e){st=e}(yt);const wt=!0;function _t(e,t=null){if(null===e)return gt.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),Object(c.e)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e){return new ot(e,_t(t))}if(e instanceof Array||!wt){let n=gt.EMPTY_NODE;return W(e,((t,r)=>{if(Object(c.k)(e,t)&&"."!==t.substring(0,1)){const e=_t(r);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}})),n.updatePriority(_t(t))}{const n=[];let r=!1;if(W(e,((e,t)=>{if("."!==e.substring(0,1)){const o=_t(t);o.isEmpty()||(r=r||!o.getPriority().isEmpty(),n.push(new ze(e,o)))}})),0===n.length)return gt.EMPTY_NODE;const o=ut(n,Je,(e=>e.name),Xe);if(r){const e=ut(n,at.getCompare());return new gt(o,_t(t),new pt({".priority":e},{".priority":at}))}return new gt(o,_t(t),pt.Default)}}!function(e){it=e}(_t);class vt extends We{constructor(e){super(),this.indexPath_=e,Object(c.e)(!Re(e)&&".priority"!==Ce(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(a,b){const e=this.extractChild(a.node),t=this.extractChild(b.node),n=e.compareTo(t);return 0===n?F(a.name,b.name):n}makePost(e,t){const n=_t(e),r=gt.EMPTY_NODE.updateChild(this.indexPath_,n);return new ze(t,r)}maxPost(){const e=gt.EMPTY_NODE.updateChild(this.indexPath_,yt);return new ze(j,e)}toString(){return Ae(this.indexPath_,0).join("/")}}const bt=new class extends We{compare(a,b){const e=a.node.compareTo(b.node);return 0===e?F(a.name,b.name):e}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return ze.MIN}maxPost(){return ze.MAX}makePost(e,t){const n=_t(e);return new ze(t,n)}toString(){return".value"}};function It(e){return{type:"value",snapshotNode:e}}function Tt(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Et(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Ct(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class St{constructor(e){this.index_=e}updateChild(e,t,n,r,source,o){Object(c.e)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(t);return l.getChild(r).equals(n.getChild(r))&&l.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(Et(t,l)):Object(c.e)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(Tt(t,n)):o.trackChildChange(Ct(t,n,l))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(at,((e,r)=>{t.hasChild(e)||n.trackChildChange(Et(e,r))})),t.isLeafNode()||t.forEachChild(at,((t,r)=>{if(e.hasChild(t)){const o=e.getImmediateChild(t);o.equals(r)||n.trackChildChange(Ct(t,r,o))}else n.trackChildChange(Tt(t,r))}))),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?gt.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class kt{constructor(e){this.indexedFilter_=new St(e.getIndex()),this.index_=e.getIndex(),this.startPost_=kt.getStartPost_(e),this.endPost_=kt.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,r,source,o){return this.matches(new ze(t,n))||(n=gt.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,source,o)}updateFullNode(e,t,n){t.isLeafNode()&&(t=gt.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(gt.EMPTY_NODE);const o=this;return t.forEachChild(at,((e,t)=>{o.matches(new ze(e,t))||(r=r.updateImmediateChild(e,gt.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class Ot{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new kt(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,source,o){return this.rangedFilter_.matches(new ze(t,n))||(n=gt.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,source,o):this.fullLimitUpdateChild_(e,t,n,source,o)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=gt.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;r=gt.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;r=r.updateImmediateChild(t.name,t.node),n++}}}else{let e;r=t.withIndex(this.index_),r=r.updatePriority(gt.EMPTY_NODE),e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);let n=0;for(;e.hasNext();){const t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:r=r.updateImmediateChild(t.name,gt.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,source,r){let o;if(this.reverse_){const e=this.index_.getCompare();o=(a,b)=>e(b,a)}else o=this.index_.getCompare();const l=e;Object(c.e)(l.numChildren()===this.limit_,"");const h=new ze(t,n),d=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),f=this.rangedFilter_.matches(h);if(l.hasChild(t)){const e=l.getImmediateChild(t);let c=source.getChildAfterChild(this.index_,d,this.reverse_);for(;null!=c&&(c.name===t||l.hasChild(c.name));)c=source.getChildAfterChild(this.index_,c,this.reverse_);const m=null==c?1:o(c,h);if(f&&!n.isEmpty()&&m>=0)return null!=r&&r.trackChildChange(Ct(t,n,e)),l.updateImmediateChild(t,n);{null!=r&&r.trackChildChange(Et(t,e));const n=l.updateImmediateChild(t,gt.EMPTY_NODE);return null!=c&&this.rangedFilter_.matches(c)?(null!=r&&r.trackChildChange(Tt(c.name,c.node)),n.updateImmediateChild(c.name,c.node)):n}}return n.isEmpty()?e:f&&o(d,h)>=0?(null!=r&&(r.trackChildChange(Et(d.name,d.node)),r.trackChildChange(Tt(t,n))),l.updateImmediateChild(t,n).updateImmediateChild(d.name,gt.EMPTY_NODE)):e}}class At{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=at}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return Object(c.e)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Object(c.e)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:M}hasEnd(){return this.endSet_}getIndexEndValue(){return Object(c.e)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Object(c.e)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:j}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return Object(c.e)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===at}copy(){const e=new At;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function xt(e,t,n){const r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function Nt(e,t,n){const r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function Rt(e,t){const n=e.copy();return n.index_=t,n}function Pt(e){const t={};if(e.isDefault())return t;let n;if(e.index_===at?n="$priority":e.index_===bt?n="$value":e.index_===He?n="$key":(Object(c.e)(e.index_ instanceof vt,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=Object(c.R)(n),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=Object(c.R)(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+Object(c.R)(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=Object(c.R)(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+Object(c.R)(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function Dt(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==at&&(t.i=e.index_.toString()),t}class Lt extends we{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=N("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(Object(c.e)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,r){const o=e._path.toString();this.log_("Listen called for "+o+" "+e._queryIdentifier);const l=Lt.getListenId_(e,n),h={};this.listens_[l]=h;const d=Pt(e._queryParams);this.restRequest_(o+".json",d,((e,t)=>{let data=t;if(404===e&&(data=null,e=null),null===e&&this.onDataUpdate_(o,data,!1,n),Object(c.O)(this.listens_,l)===h){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",r(t,null)}}))}unlisten(e,t){const n=Lt.getListenId_(e,t);delete this.listens_[n]}get(e){const t=Pt(e._queryParams),n=e._path.toString(),r=new c.a;return this.restRequest_(n+".json",t,((e,t)=>{let data=t;404===e&&(data=null,e=null),null===e?(this.onDataUpdate_(n,data,!1,null),r.resolve(data)):r.reject(new Error(data))})),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([r,o])=>{r&&r.accessToken&&(t.auth=r.accessToken),o&&o.token&&(t.ac=o.token);const l=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Object(c.M)(t);this.log_("Sending REST request for "+l);const h=new XMLHttpRequest;h.onreadystatechange=()=>{if(n&&4===h.readyState){this.log_("REST Response for "+l+" received. status:",h.status,"response:",h.responseText);let e=null;if(h.status>=200&&h.status<300){try{e=Object(c.K)(h.responseText)}catch(e){D("Failed to parse JSON response for "+l+": "+h.responseText)}n(null,e)}else 401!==h.status&&404!==h.status&&D("Got unsuccessful REST response for "+l+" Status: "+h.status),n(h.status);n=null}},h.open("GET",l,!0),h.send()}))}}class Mt{constructor(){this.rootNode_=gt.EMPTY_NODE}getNode(path){return this.rootNode_.getChild(path)}updateSnapshot(path,e){this.rootNode_=this.rootNode_.updateChild(path,e)}}function jt(){return{value:null,children:new Map}}function Ft(e,path,data){if(Re(path))e.value=data,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(path,data);else{const t=Ce(path);e.children.has(t)||e.children.set(t,jt());Ft(e.children.get(t),path=ke(path),data)}}function Ut(e,path){if(Re(path))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;{const t=e.value;return e.value=null,t.forEachChild(at,((t,n)=>{Ft(e,new Te(t),n)})),Ut(e,path)}}if(e.children.size>0){const t=Ce(path);if(path=ke(path),e.children.has(t)){Ut(e.children.get(t),path)&&e.children.delete(t)}return 0===e.children.size}return!0}function Vt(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,r)=>{Vt(r,new Te(t.toString()+"/"+e),n)}))}class qt{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&W(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class Bt{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new qt(e);const n=1e4+2e4*Math.random();Q(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;W(e,((e,r)=>{r>0&&Object(c.k)(this.statsToReport_,e)&&(t[e]=r,n=!0)})),n&&this.server_.reportStats(t),Q(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var zt;function Wt(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(zt||(zt={}));class Kt{constructor(path,e,t){this.path=path,this.affectedTree=e,this.revert=t,this.type=zt.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(Re(this.path)){if(null!=this.affectedTree.value)return Object(c.e)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Te(e));return new Kt(Ee(),t,this.revert)}}return Object(c.e)(Ce(this.path)===e,"operationForChild called for unrelated child."),new Kt(ke(this.path),this.affectedTree,this.revert)}}class Gt{constructor(source,path){this.source=source,this.path=path,this.type=zt.LISTEN_COMPLETE}operationForChild(e){return Re(this.path)?new Gt(this.source,Ee()):new Gt(this.source,ke(this.path))}}class Ht{constructor(source,path,e){this.source=source,this.path=path,this.snap=e,this.type=zt.OVERWRITE}operationForChild(e){return Re(this.path)?new Ht(this.source,Ee(),this.snap.getImmediateChild(e)):new Ht(this.source,ke(this.path),this.snap)}}class $t{constructor(source,path,e){this.source=source,this.path=path,this.children=e,this.type=zt.MERGE}operationForChild(e){if(Re(this.path)){const t=this.children.subtree(new Te(e));return t.isEmpty()?null:t.value?new Ht(this.source,Ee(),t.value):new $t(this.source,Ee(),t)}return Object(c.e)(Ce(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new $t(this.source,ke(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Qt{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(path){if(Re(path))return this.isFullyInitialized()&&!this.filtered_;const e=Ce(path);return this.isCompleteForChild(e)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Yt{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Jt(e,t,n,r,o,l){const h=r.filter((e=>e.type===n));h.sort(((a,b)=>function(e,a,b){if(null==a.childName||null==b.childName)throw Object(c.f)("Should only compare child_ events.");const t=new ze(a.childName,a.snapshotNode),n=new ze(b.childName,b.snapshotNode);return e.index_.compare(t,n)}(e,a,b))),h.forEach((n=>{const r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,l);o.forEach((o=>{o.respondsTo(n.type)&&t.push(o.createEvent(r,e.query_))}))}))}function Xt(e,t){return{eventCache:e,serverCache:t}}function Zt(e,t,n,r){return Xt(new Qt(t,n,r),e.serverCache)}function en(e,t,n,r){return Xt(e.eventCache,new Qt(t,n,r))}function tn(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function nn(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let rn;class sn{constructor(e,t=(()=>(rn||(rn=new Ye(U)),rn))()){this.value=e,this.children=t}static fromObject(e){let t=new sn(null);return W(e,((e,n)=>{t=t.set(new Te(e),n)})),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Ee(),value:this.value};if(Re(e))return null;{const n=Ce(e),r=this.children.get(n);if(null!==r){const o=r.findRootMostMatchingPathAndValue(ke(e),t);if(null!=o){return{path:Ne(new Te(n),o.path),value:o.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(Re(e))return this;{const t=Ce(e),n=this.children.get(t);return null!==n?n.subtree(ke(e)):new sn(null)}}set(e,t){if(Re(e))return new sn(t,this.children);{const n=Ce(e),r=(this.children.get(n)||new sn(null)).set(ke(e),t),o=this.children.insert(n,r);return new sn(this.value,o)}}remove(e){if(Re(e))return this.children.isEmpty()?new sn(null):new sn(null,this.children);{const t=Ce(e),n=this.children.get(t);if(n){const r=n.remove(ke(e));let o;return o=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&o.isEmpty()?new sn(null):new sn(this.value,o)}return this}}get(e){if(Re(e))return this.value;{const t=Ce(e),n=this.children.get(t);return n?n.get(ke(e)):null}}setTree(e,t){if(Re(e))return t;{const n=Ce(e),r=(this.children.get(n)||new sn(null)).setTree(ke(e),t);let o;return o=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new sn(this.value,o)}}fold(e){return this.fold_(Ee(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((r,o)=>{n[r]=o.fold_(Ne(e,r),t)})),t(e,this.value,n)}findOnPath(path,e){return this.findOnPath_(path,Ee(),e)}findOnPath_(e,t,n){const r=!!this.value&&n(t,this.value);if(r)return r;if(Re(e))return null;{const r=Ce(e),o=this.children.get(r);return o?o.findOnPath_(ke(e),Ne(t,r),n):null}}foreachOnPath(path,e){return this.foreachOnPath_(path,Ee(),e)}foreachOnPath_(e,t,n){if(Re(e))return this;{this.value&&n(t,this.value);const r=Ce(e),o=this.children.get(r);return o?o.foreachOnPath_(ke(e),Ne(t,r),n):new sn(null)}}foreach(e){this.foreach_(Ee(),e)}foreach_(e,t){this.children.inorderTraversal(((n,r)=>{r.foreach_(Ne(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class on{constructor(e){this.writeTree_=e}static empty(){return new on(new sn(null))}}function an(e,path,t){if(Re(path))return new on(new sn(t));{const n=e.writeTree_.findRootMostValueAndPath(path);if(null!=n){const r=n.path;let o=n.value;const c=Pe(r,path);return o=o.updateChild(c,t),new on(e.writeTree_.set(r,o))}{const n=new sn(t),r=e.writeTree_.setTree(path,n);return new on(r)}}}function cn(e,path,t){let n=e;return W(t,((e,t)=>{n=an(n,Ne(path,e),t)})),n}function ln(e,path){if(Re(path))return on.empty();{const t=e.writeTree_.setTree(path,new sn(null));return new on(t)}}function un(e,path){return null!=hn(e,path)}function hn(e,path){const t=e.writeTree_.findRootMostValueAndPath(path);return null!=t?e.writeTree_.get(t.path).getChild(Pe(t.path,path)):null}function dn(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(at,((e,n)=>{t.push(new ze(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new ze(e,n.value))})),t}function fn(e,path){if(Re(path))return e;{const t=hn(e,path);return new on(null!=t?new sn(t):e.writeTree_.subtree(path))}}function pn(e){return e.writeTree_.isEmpty()}function mn(e,t){return gn(Ee(),e.writeTree_,t)}function gn(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal(((t,o)=>{".priority"===t?(Object(c.e)(null!==o.value,"Priority writes must always be leaf nodes"),r=o.value):n=gn(Ne(e,t),o,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(Ne(e,".priority"),r)),n}}function yn(e,path){return xn(path,e)}function wn(e,t){const n=e.allWrites.findIndex((s=>s.writeId===t));Object(c.e)(n>=0,"removeWrite called with nonexistent writeId.");const r=e.allWrites[n];e.allWrites.splice(n,1);let o=r.visible,l=!1,i=e.allWrites.length-1;for(;o&&i>=0;){const t=e.allWrites[i];t.visible&&(i>=n&&_n(t,r.path)?o=!1:Me(r.path,t.path)&&(l=!0)),i--}if(o){if(l)return function(e){e.visibleWrites=bn(e.allWrites,vn,Ee()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(r.snap)e.visibleWrites=ln(e.visibleWrites,r.path);else{W(r.children,(t=>{e.visibleWrites=ln(e.visibleWrites,Ne(r.path,t))}))}return!0}return!1}function _n(e,path){if(e.snap)return Me(e.path,path);for(const t in e.children)if(e.children.hasOwnProperty(t)&&Me(Ne(e.path,t),path))return!0;return!1}function vn(e){return e.visible}function bn(e,filter,t){let n=on.empty();for(let i=0;i<e.length;++i){const r=e[i];if(filter(r)){const e=r.path;let o;if(r.snap)Me(t,e)?(o=Pe(t,e),n=an(n,o,r.snap)):Me(e,t)&&(o=Pe(e,t),n=an(n,Ee(),r.snap.getChild(o)));else{if(!r.children)throw Object(c.f)("WriteRecord should have .snap or .children");if(Me(t,e))o=Pe(t,e),n=cn(n,o,r.children);else if(Me(e,t))if(o=Pe(e,t),Re(o))n=cn(n,Ee(),r.children);else{const e=Object(c.O)(r.children,Ce(o));if(e){const t=e.getChild(ke(o));n=an(n,Ee(),t)}}}}}return n}function In(e,t,n,r,o){if(r||o){const c=fn(e.visibleWrites,t);if(!o&&pn(c))return n;if(o||null!=n||un(c,Ee())){const filter=function(e){return(e.visible||o)&&(!r||!~r.indexOf(e.writeId))&&(Me(e.path,t)||Me(t,e.path))};return mn(bn(e.allWrites,filter,t),n||gt.EMPTY_NODE)}return null}{const r=hn(e.visibleWrites,t);if(null!=r)return r;{const r=fn(e.visibleWrites,t);if(pn(r))return n;if(null!=n||un(r,Ee())){return mn(r,n||gt.EMPTY_NODE)}return null}}}function Tn(e,t,n,r){return In(e.writeTree,e.treePath,t,n,r)}function En(e,t){return function(e,t,n){let r=gt.EMPTY_NODE;const o=hn(e.visibleWrites,t);if(o)return o.isLeafNode()||o.forEachChild(at,((e,t)=>{r=r.updateImmediateChild(e,t)})),r;if(n){const o=fn(e.visibleWrites,t);return n.forEachChild(at,((e,t)=>{const n=mn(fn(o,new Te(e)),t);r=r.updateImmediateChild(e,n)})),dn(o).forEach((e=>{r=r.updateImmediateChild(e.name,e.node)})),r}return dn(fn(e.visibleWrites,t)).forEach((e=>{r=r.updateImmediateChild(e.name,e.node)})),r}(e.writeTree,e.treePath,t)}function Cn(e,path,t,n){return function(e,t,n,r,o){Object(c.e)(r||o,"Either existingEventSnap or existingServerSnap must exist");const path=Ne(t,n);if(un(e.visibleWrites,path))return null;{const t=fn(e.visibleWrites,path);return pn(t)?o.getChild(n):mn(t,o.getChild(n))}}(e.writeTree,e.treePath,path,t,n)}function Sn(e,path){return function(e,path){return hn(e.visibleWrites,path)}(e.writeTree,Ne(e.treePath,path))}function kn(e,t,n,r,o,c){return function(e,t,n,r,o,c,l){let h;const d=fn(e.visibleWrites,t),f=hn(d,Ee());if(null!=f)h=f;else{if(null==n)return[];h=mn(d,n)}if(h=h.withIndex(l),h.isEmpty()||h.isLeafNode())return[];{const e=[],t=l.getCompare(),n=c?h.getReverseIteratorFrom(r,l):h.getIteratorFrom(r,l);let d=n.getNext();for(;d&&e.length<o;)0!==t(d,r)&&e.push(d),d=n.getNext();return e}}(e.writeTree,e.treePath,t,n,r,o,c)}function On(e,t,n){return function(e,t,n,r){const path=Ne(t,n),o=hn(e.visibleWrites,path);if(null!=o)return o;if(r.isCompleteForChild(n))return mn(fn(e.visibleWrites,path),r.getNode().getImmediateChild(n));return null}(e.writeTree,e.treePath,t,n)}function An(e,t){return xn(Ne(e.treePath,t),e.writeTree)}function xn(path,e){return{treePath:path,writeTree:e}}class Nn{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;Object(c.e)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),Object(c.e)(".priority"!==n,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const o=r.type;if("child_added"===t&&"child_removed"===o)this.changeMap.set(n,Ct(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===o)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===o)this.changeMap.set(n,Et(n,r.oldSnap));else if("child_changed"===t&&"child_added"===o)this.changeMap.set(n,Tt(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==o)throw Object(c.f)("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,Ct(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const Rn=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class Pn{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Qt(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return On(this.writes_,e,t)}}getChildAfterChild(e,t,n){const r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:nn(this.viewCache_),o=kn(this.writes_,r,t,1,n,e);return 0===o.length?null:o[0]}}function Dn(e,t,n,r,o){const l=new Nn;let h,d;if(n.type===zt.OVERWRITE){const f=n;f.source.fromUser?h=jn(e,t,f.path,f.snap,r,o,l):(Object(c.e)(f.source.fromServer,"Unknown source."),d=f.source.tagged||t.serverCache.isFiltered()&&!Re(f.path),h=Mn(e,t,f.path,f.snap,r,o,d,l))}else if(n.type===zt.MERGE){const f=n;f.source.fromUser?h=function(e,t,path,n,r,o,c){let l=t;return n.foreach(((n,h)=>{const d=Ne(path,n);Fn(t,Ce(d))&&(l=jn(e,l,d,h,r,o,c))})),n.foreach(((n,h)=>{const d=Ne(path,n);Fn(t,Ce(d))||(l=jn(e,l,d,h,r,o,c))})),l}(e,t,f.path,f.children,r,o,l):(Object(c.e)(f.source.fromServer,"Unknown source."),d=f.source.tagged||t.serverCache.isFiltered(),h=Vn(e,t,f.path,f.children,r,o,d,l))}else if(n.type===zt.ACK_USER_WRITE){const d=n;h=d.revert?function(e,t,path,n,r,o){let l;if(null!=Sn(n,path))return t;{const source=new Pn(n,t,r),h=t.eventCache.getNode();let d;if(Re(path)||".priority"===Ce(path)){let r;if(t.serverCache.isFullyInitialized())r=Tn(n,nn(t));else{const e=t.serverCache.getNode();Object(c.e)(e instanceof gt,"serverChildren would be complete if leaf node"),r=En(n,e)}d=e.filter.updateFullNode(h,r,o)}else{const r=Ce(path);let c=On(n,r,t.serverCache);null==c&&t.serverCache.isCompleteForChild(r)&&(c=h.getImmediateChild(r)),d=null!=c?e.filter.updateChild(h,r,c,ke(path),source,o):t.eventCache.getNode().hasChild(r)?e.filter.updateChild(h,r,gt.EMPTY_NODE,ke(path),source,o):h,d.isEmpty()&&t.serverCache.isFullyInitialized()&&(l=Tn(n,nn(t)),l.isLeafNode()&&(d=e.filter.updateFullNode(d,l,o)))}return l=t.serverCache.isFullyInitialized()||null!=Sn(n,Ee()),Zt(t,d,l,e.filter.filtersNodes())}}(e,t,d.path,r,o,l):function(e,t,n,r,o,c,l){if(null!=Sn(o,n))return t;const h=t.serverCache.isFiltered(),d=t.serverCache;if(null!=r.value){if(Re(n)&&d.isFullyInitialized()||d.isCompleteForPath(n))return Mn(e,t,n,d.getNode().getChild(n),o,c,h,l);if(Re(n)){let r=new sn(null);return d.getNode().forEachChild(He,((e,t)=>{r=r.set(new Te(e),t)})),Vn(e,t,n,r,o,c,h,l)}return t}{let f=new sn(null);return r.foreach(((e,t)=>{const r=Ne(n,e);d.isCompleteForPath(r)&&(f=f.set(e,d.getNode().getChild(r)))})),Vn(e,t,n,f,o,c,h,l)}}(e,t,d.path,d.affectedTree,r,o,l)}else{if(n.type!==zt.LISTEN_COMPLETE)throw Object(c.f)("Unknown operation type: "+n.type);h=function(e,t,path,n,r){const o=t.serverCache,c=en(t,o.getNode(),o.isFullyInitialized()||Re(path),o.isFiltered());return Ln(e,c,path,n,Rn,r)}(e,t,n.path,r,l)}const f=l.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){const o=r.getNode().isLeafNode()||r.getNode().isEmpty(),c=tn(e);(n.length>0||!e.eventCache.isFullyInitialized()||o&&!r.getNode().equals(c)||!r.getNode().getPriority().equals(c.getPriority()))&&n.push(It(tn(t)))}}(t,h,f),{viewCache:h,changes:f}}function Ln(e,t,n,r,source,o){const l=t.eventCache;if(null!=Sn(r,n))return t;{let h,d;if(Re(n))if(Object(c.e)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=nn(t),c=En(r,n instanceof gt?n:gt.EMPTY_NODE);h=e.filter.updateFullNode(t.eventCache.getNode(),c,o)}else{const n=Tn(r,nn(t));h=e.filter.updateFullNode(t.eventCache.getNode(),n,o)}else{const f=Ce(n);if(".priority"===f){Object(c.e)(1===Se(n),"Can't have a priority with additional path components");const o=l.getNode();d=t.serverCache.getNode();const f=Cn(r,n,o,d);h=null!=f?e.filter.updatePriority(o,f):l.getNode()}else{const c=ke(n);let m;if(l.isCompleteForChild(f)){d=t.serverCache.getNode();const e=Cn(r,n,l.getNode(),d);m=null!=e?l.getNode().getImmediateChild(f).updateChild(c,e):l.getNode().getImmediateChild(f)}else m=On(r,f,t.serverCache);h=null!=m?e.filter.updateChild(l.getNode(),f,m,c,source,o):l.getNode()}}return Zt(t,h,l.isFullyInitialized()||Re(n),e.filter.filtersNodes())}}function Mn(e,t,n,r,o,c,l,h){const d=t.serverCache;let f;const m=l?e.filter:e.filter.getIndexedFilter();if(Re(n))f=m.updateFullNode(d.getNode(),r,null);else if(m.filtersNodes()&&!d.isFiltered()){const e=d.getNode().updateChild(n,r);f=m.updateFullNode(d.getNode(),e,null)}else{const e=Ce(n);if(!d.isCompleteForPath(n)&&Se(n)>1)return t;const o=ke(n),c=d.getNode().getImmediateChild(e).updateChild(o,r);f=".priority"===e?m.updatePriority(d.getNode(),c):m.updateChild(d.getNode(),e,c,o,Rn,null)}const y=en(t,f,d.isFullyInitialized()||Re(n),m.filtersNodes());return Ln(e,y,n,o,new Pn(o,y,c),h)}function jn(e,t,n,r,o,c,l){const h=t.eventCache;let d,f;const source=new Pn(o,t,c);if(Re(n))f=e.filter.updateFullNode(t.eventCache.getNode(),r,l),d=Zt(t,f,!0,e.filter.filtersNodes());else{const o=Ce(n);if(".priority"===o)f=e.filter.updatePriority(t.eventCache.getNode(),r),d=Zt(t,f,h.isFullyInitialized(),h.isFiltered());else{const c=ke(n),f=h.getNode().getImmediateChild(o);let m;if(Re(c))m=r;else{const e=source.getCompleteChild(o);m=null!=e?".priority"===Oe(c)&&e.getChild(xe(c)).isEmpty()?e:e.updateChild(c,r):gt.EMPTY_NODE}if(f.equals(m))d=t;else{d=Zt(t,e.filter.updateChild(h.getNode(),o,m,c,source,l),h.isFullyInitialized(),e.filter.filtersNodes())}}}return d}function Fn(e,t){return e.eventCache.isCompleteForChild(t)}function Un(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function Vn(e,t,path,n,r,o,c,l){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let h,d=t;h=Re(path)?n:new sn(null).setTree(path,n);const f=t.serverCache.getNode();return h.children.inorderTraversal(((n,h)=>{if(f.hasChild(n)){const f=Un(0,t.serverCache.getNode().getImmediateChild(n),h);d=Mn(e,d,new Te(n),f,r,o,c,l)}})),h.children.inorderTraversal(((n,h)=>{const m=!t.serverCache.isCompleteForChild(n)&&null===h.value;if(!f.hasChild(n)&&!m){const f=Un(0,t.serverCache.getNode().getImmediateChild(n),h);d=Mn(e,d,new Te(n),f,r,o,c,l)}})),d}class qn{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new St(n.getIndex()),filter=(o=n).loadsAllData()?new St(o.getIndex()):o.hasLimit()?new Ot(o):new kt(o);var o;this.processor_=function(filter){return{filter:filter}}(filter);const c=t.serverCache,l=t.eventCache,h=r.updateFullNode(gt.EMPTY_NODE,c.getNode(),null),d=filter.updateFullNode(gt.EMPTY_NODE,l.getNode(),null),f=new Qt(h,c.isFullyInitialized(),r.filtersNodes()),m=new Qt(d,l.isFullyInitialized(),filter.filtersNodes());this.viewCache_=Xt(m,f),this.eventGenerator_=new Yt(this.query_)}get query(){return this.query_}}function Bn(view,path){const e=nn(view.viewCache_);return e&&(view.query._queryParams.loadsAllData()||!Re(path)&&!e.getImmediateChild(Ce(path)).isEmpty())?e.getChild(path):null}function zn(view){return 0===view.eventRegistrations_.length}function Wn(view,e,t){const n=[];if(t){Object(c.e)(null==e,"A cancel should cancel all event registrations.");const path=view.query._path;view.eventRegistrations_.forEach((e=>{const r=e.createCancelEvent(t,path);r&&n.push(r)}))}if(e){let t=[];for(let i=0;i<view.eventRegistrations_.length;++i){const n=view.eventRegistrations_[i];if(n.matches(e)){if(e.hasAnyCallback()){t=t.concat(view.eventRegistrations_.slice(i+1));break}}else t.push(n)}view.eventRegistrations_=t}else view.eventRegistrations_=[];return n}function Kn(view,e,t,n){e.type===zt.MERGE&&null!==e.source.queryId&&(Object(c.e)(nn(view.viewCache_),"We should always have a full cache before handling merges"),Object(c.e)(tn(view.viewCache_),"Missing event cache, even though we have a server cache"));const r=view.viewCache_,o=Dn(view.processor_,r,e,t,n);var l,h;return l=view.processor_,h=o.viewCache,Object(c.e)(h.eventCache.getNode().isIndexed(l.filter.getIndex()),"Event snap not indexed"),Object(c.e)(h.serverCache.getNode().isIndexed(l.filter.getIndex()),"Server snap not indexed"),Object(c.e)(o.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),view.viewCache_=o.viewCache,Gn(view,o.changes,o.viewCache.eventCache.getNode(),null)}function Gn(view,e,t,n){const r=n?[n]:view.eventRegistrations_;return function(e,t,n,r){const o=[],c=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&c.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),Jt(e,o,"child_removed",t,r,n),Jt(e,o,"child_added",t,r,n),Jt(e,o,"child_moved",c,r,n),Jt(e,o,"child_changed",t,r,n),Jt(e,o,"value",t,r,n),o}(view.eventGenerator_,e,t,r)}let Hn,$n;class Qn{constructor(){this.views=new Map}}function Yn(e,t,n,r){const o=t.source.queryId;if(null!==o){const view=e.views.get(o);return Object(c.e)(null!=view,"SyncTree gave us an op for an invalid query."),Kn(view,t,n,r)}{let o=[];for(const view of e.views.values())o=o.concat(Kn(view,t,n,r));return o}}function Jn(e,t,n,r,o){const c=t._queryIdentifier,view=e.views.get(c);if(!view){let e=Tn(n,o?r:null),c=!1;e?c=!0:r instanceof gt?(e=En(n,r),c=!1):(e=gt.EMPTY_NODE,c=!1);const l=Xt(new Qt(e,c,!1),new Qt(r,o,!1));return new qn(t,l)}return view}function Xn(e,t,n,r,o,c){const view=Jn(e,t,r,o,c);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,view),function(view,e){view.eventRegistrations_.push(e)}(view,n),function(view,e){const t=view.viewCache_.eventCache,n=[];t.getNode().isLeafNode()||t.getNode().forEachChild(at,((e,t)=>{n.push(Tt(e,t))}));return t.isFullyInitialized()&&n.push(It(t.getNode())),Gn(view,n,t.getNode(),e)}(view,n)}function Zn(e,t,n,r){const o=t._queryIdentifier,l=[];let h=[];const d=sr(e);if("default"===o)for(const[t,view]of e.views.entries())h=h.concat(Wn(view,n,r)),zn(view)&&(e.views.delete(t),view.query._queryParams.loadsAllData()||l.push(view.query));else{const view=e.views.get(o);view&&(h=h.concat(Wn(view,n,r)),zn(view)&&(e.views.delete(o),view.query._queryParams.loadsAllData()||l.push(view.query)))}return d&&!sr(e)&&l.push(new(Object(c.e)(Hn,"Reference.ts has not been loaded"),Hn)(t._repo,t._path)),{removed:l,events:h}}function er(e){const t=[];for(const view of e.views.values())view.query._queryParams.loadsAllData()||t.push(view);return t}function nr(e,path){let t=null;for(const view of e.views.values())t=t||Bn(view,path);return t}function rr(e,t){if(t._queryParams.loadsAllData())return or(e);{const n=t._queryIdentifier;return e.views.get(n)}}function ir(e,t){return null!=rr(e,t)}function sr(e){return null!=or(e)}function or(e){for(const view of e.views.values())if(view.query._queryParams.loadsAllData())return view;return null}let ar=1;class cr{constructor(e){this.listenProvider_=e,this.syncPointTree_=new sn(null),this.pendingWriteTree_={visibleWrites:on.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function lr(e,path,t,n,r){return function(e,path,t,n,r){Object(c.e)(n>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),e.allWrites.push({path:path,snap:t,writeId:n,visible:r}),r&&(e.visibleWrites=an(e.visibleWrites,path,t)),e.lastWriteId=n}(e.pendingWriteTree_,path,t,n,r),r?_r(e,new Ht({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},path,t)):[]}function ur(e,path,t,n){!function(e,path,t,n){Object(c.e)(n>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:path,children:t,writeId:n,visible:!0}),e.visibleWrites=cn(e.visibleWrites,path,t),e.lastWriteId=n}(e.pendingWriteTree_,path,t,n);const r=sn.fromObject(t);return _r(e,new $t({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},path,r))}function dr(e,t,n=!1){const r=function(e,t){for(let i=0;i<e.allWrites.length;i++){const n=e.allWrites[i];if(n.writeId===t)return n}return null}(e.pendingWriteTree_,t);if(wn(e.pendingWriteTree_,t)){let t=new sn(null);return null!=r.snap?t=t.set(Ee(),!0):W(r.children,(e=>{t=t.set(new Te(e),!0)})),_r(e,new Kt(r.path,t,n))}return[]}function fr(e,path,t){return _r(e,new Ht({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},path,t))}function pr(e,t,n,r,o=!1){const path=t._path,c=e.syncPointTree_.get(path);let l=[];if(c&&("default"===t._queryIdentifier||ir(c,t))){const h=Zn(c,t,n,r);0===c.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(path));const d=h.removed;if(l=h.events,!o){const n=-1!==d.findIndex((e=>e._queryParams.loadsAllData())),o=e.syncPointTree_.findOnPath(path,((e,t)=>sr(t)));if(n&&!o){const t=e.syncPointTree_.subtree(path);if(!t.isEmpty()){const n=function(e){return e.fold(((e,t,n)=>{if(t&&sr(t)){return[or(t)]}{let e=[];return t&&(e=er(t)),W(n,((t,n)=>{e=e.concat(n)})),e}}))}(t);for(let i=0;i<n.length;++i){const view=n[i],t=view.query,r=Tr(e,view);e.listenProvider_.startListening(Ar(t),Er(e,t),r.hashFn,r.onComplete)}}}if(!o&&d.length>0&&!r)if(n){const n=null;e.listenProvider_.stopListening(Ar(t),n)}else d.forEach((t=>{const n=e.queryToTagMap.get(Cr(t));e.listenProvider_.stopListening(Ar(t),n)}))}!function(e,t){for(let n=0;n<t.length;++n){const r=t[n];if(!r._queryParams.loadsAllData()){const t=Cr(r),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,d)}return l}function mr(e,path,t,n){const r=Sr(e,n);if(null!=r){const n=kr(r),o=n.path,c=n.queryId,l=Pe(o,path);return Or(e,o,new Ht(Wt(c),l,t))}return[]}function gr(e,t,n,r=!1){const path=t._path;let o=null,l=!1;e.syncPointTree_.foreachOnPath(path,((e,t)=>{const n=Pe(e,path);o=o||nr(t,n),l=l||sr(t)}));let h,d=e.syncPointTree_.get(path);if(d?(l=l||sr(d),o=o||nr(d,Ee())):(d=new Qn,e.syncPointTree_=e.syncPointTree_.set(path,d)),null!=o)h=!0;else{h=!1,o=gt.EMPTY_NODE;e.syncPointTree_.subtree(path).foreachChild(((e,t)=>{const n=nr(t,Ee());n&&(o=o.updateImmediateChild(e,n))}))}const f=ir(d,t);if(!f&&!t._queryParams.loadsAllData()){const n=Cr(t);Object(c.e)(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");const r=ar++;e.queryToTagMap.set(n,r),e.tagToQueryMap.set(r,n)}let m=Xn(d,t,n,yn(e.pendingWriteTree_,path),o,h);if(!f&&!l&&!r){const view=rr(d,t);m=m.concat(function(e,t,view){const path=t._path,n=Er(e,t),r=Tr(e,view),o=e.listenProvider_.startListening(Ar(t),n,r.hashFn,r.onComplete),l=e.syncPointTree_.subtree(path);if(n)Object(c.e)(!sr(l.value),"If we're adding a query, it shouldn't be shadowed");else{const t=l.fold(((e,t,n)=>{if(!Re(e)&&t&&sr(t))return[or(t).query];{let e=[];return t&&(e=e.concat(er(t).map((view=>view.query)))),W(n,((t,n)=>{e=e.concat(n)})),e}}));for(let i=0;i<t.length;++i){const n=t[i];e.listenProvider_.stopListening(Ar(n),Er(e,n))}}return o}(e,t,view))}return m}function yr(e,path,t){const n=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(path,((e,t)=>{const n=nr(t,Pe(e,path));if(n)return n}));return In(n,path,r,t,!0)}function wr(e,t){const path=t._path;let n=null;e.syncPointTree_.foreachOnPath(path,((e,t)=>{const r=Pe(e,path);n=n||nr(t,r)}));let r=e.syncPointTree_.get(path);r?n=n||nr(r,Ee()):(r=new Qn,e.syncPointTree_=e.syncPointTree_.set(path,r));const o=null!=n,c=o?new Qt(n,!0,!1):null;return function(view){return tn(view.viewCache_)}(Jn(r,t,yn(e.pendingWriteTree_,t._path),o?c.getNode():gt.EMPTY_NODE,o))}function _r(e,t){return vr(t,e.syncPointTree_,null,yn(e.pendingWriteTree_,Ee()))}function vr(e,t,n,r){if(Re(e.path))return Ir(e,t,n,r);{const o=t.get(Ee());null==n&&null!=o&&(n=nr(o,Ee()));let c=[];const l=Ce(e.path),h=e.operationForChild(l),d=t.children.get(l);if(d&&h){const e=n?n.getImmediateChild(l):null,t=An(r,l);c=c.concat(vr(h,d,e,t))}return o&&(c=c.concat(Yn(o,e,r,n))),c}}function Ir(e,t,n,r){const o=t.get(Ee());null==n&&null!=o&&(n=nr(o,Ee()));let c=[];return t.children.inorderTraversal(((t,o)=>{const l=n?n.getImmediateChild(t):null,h=An(r,t),d=e.operationForChild(t);d&&(c=c.concat(Ir(d,o,l,h)))})),o&&(c=c.concat(Yn(o,e,r,n))),c}function Tr(e,view){const t=view.query,n=Er(e,t);return{hashFn:()=>{const e=function(view){return view.viewCache_.serverCache.getNode()}(view)||gt.EMPTY_NODE;return e.hash()},onComplete:r=>{if("ok"===r)return n?function(e,path,t){const n=Sr(e,t);if(n){const t=kr(n),r=t.path,o=t.queryId,c=Pe(r,path);return Or(e,r,new Gt(Wt(o),c))}return[]}(e,t._path,n):function(e,path){return _r(e,new Gt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},path))}(e,t._path);{const n=function(code,e){let t="Unknown Error";"too_big"===code?t="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===code?t="Client doesn't have permission to access the desired data.":"unavailable"===code&&(t="The service is unavailable");const n=new Error(code+" at "+e._path.toString()+": "+t);return n.code=code.toUpperCase(),n}(r,t);return pr(e,t,null,n)}}}}function Er(e,t){const n=Cr(t);return e.queryToTagMap.get(n)}function Cr(e){return e._path.toString()+"$"+e._queryIdentifier}function Sr(e,t){return e.tagToQueryMap.get(t)}function kr(e){const t=e.indexOf("$");return Object(c.e)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Te(e.substr(0,t))}}function Or(e,t,n){const r=e.syncPointTree_.get(t);Object(c.e)(r,"Missing sync point for query tag that we're tracking");return Yn(r,n,yn(e.pendingWriteTree_,t),null)}function Ar(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(Object(c.e)($n,"Reference.ts has not been loaded"),$n)(e._repo,e._path):e}class xr{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new xr(t)}node(){return this.node_}}class Nr{constructor(e,path){this.syncTree_=e,this.path_=path}getImmediateChild(e){const t=Ne(this.path_,e);return new Nr(this.syncTree_,t)}node(){return yr(this.syncTree_,this.path_)}}const Rr=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},Pr=function(e,t,n){return e&&"object"==typeof e?(Object(c.e)(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?Dr(e[".sv"],t,n):"object"==typeof e[".sv"]?Lr(e[".sv"],t):void Object(c.e)(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Dr=function(e,t,n){if("timestamp"===e)return n.timestamp;Object(c.e)(!1,"Unexpected server value: "+e)},Lr=function(e,t,n){e.hasOwnProperty("increment")||Object(c.e)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const r=e.increment;"number"!=typeof r&&Object(c.e)(!1,"Unexpected increment value: "+r);const o=t.node();if(Object(c.e)(null!=o,"Expected ChildrenNode.EMPTY_NODE for nulls"),!o.isLeafNode())return r;const l=o.getValue();return"number"!=typeof l?r:l+r},Mr=function(path,e,t,n){return Fr(e,new Nr(t,path),n)},jr=function(e,t,n){return Fr(e,new xr(t),n)};function Fr(e,t,n){const r=e.getPriority().val(),o=Pr(r,t.getImmediateChild(".priority"),n);let c;if(e.isLeafNode()){const r=e,c=Pr(r.getValue(),t,n);return c!==r.getValue()||o!==r.getPriority().val()?new ot(c,_t(o)):e}{const r=e;return c=r,o!==r.getPriority().val()&&(c=c.updatePriority(new ot(o))),r.forEachChild(at,((e,r)=>{const o=Fr(r,t.getImmediateChild(e),n);o!==r&&(c=c.updateImmediateChild(e,o))})),c}}class Ur{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function Vr(e,t){let path=t instanceof Te?t:new Te(t),n=e,r=Ce(path);for(;null!==r;){const e=Object(c.O)(n.node.children,r)||{children:{},childCount:0};n=new Ur(r,n,e),path=ke(path),r=Ce(path)}return n}function qr(e){return e.node.value}function Br(e,t){e.node.value=t,Hr(e)}function zr(e){return e.node.childCount>0}function Wr(e,t){W(e.node.children,((n,r)=>{t(new Ur(n,e,r))}))}function Kr(e,t,n,r){n&&!r&&t(e),Wr(e,(e=>{Kr(e,t,!0,r)})),n&&r&&t(e)}function Gr(e){return new Te(null===e.parent?e.name:Gr(e.parent)+"/"+e.name)}function Hr(e){null!==e.parent&&function(e,t,n){const r=function(e){return void 0===qr(e)&&!zr(e)}(n),o=Object(c.k)(e.node.children,t);r&&o?(delete e.node.children[t],e.node.childCount--,Hr(e)):r||o||(e.node.children[t]=n.node,e.node.childCount++,Hr(e))}(e.parent,e.name,e)}const $r=/[\[\].#$\/\u0000-\u001F\u007F]/,Qr=/[\[\].#$\u0000-\u001F\u007F]/,Yr=10485760,Jr=function(e){return"string"==typeof e&&0!==e.length&&!$r.test(e)},Xr=function(e){return"string"==typeof e&&0!==e.length&&!Qr.test(e)},Zr=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!L(e)||e&&"object"==typeof e&&Object(c.k)(e,".sv")},ei=function(e,t,path,n){n&&void 0===t||ti(Object(c.q)(e,"value"),t,path)},ti=function(e,data,t){const path=t instanceof Te?new je(t,e):t;if(void 0===data)throw new Error(e+"contains undefined "+Ue(path));if("function"==typeof data)throw new Error(e+"contains a function "+Ue(path)+" with contents = "+data.toString());if(L(data))throw new Error(e+"contains "+data.toString()+" "+Ue(path));if("string"==typeof data&&data.length>Yr/3&&Object(c.P)(data)>Yr)throw new Error(e+"contains a string greater than "+Yr+" utf8 bytes "+Ue(path)+" ('"+data.substring(0,50)+"...')");if(data&&"object"==typeof data){let t=!1,n=!1;if(W(data,((r,o)=>{if(".value"===r)t=!0;else if(".priority"!==r&&".sv"!==r&&(n=!0,!Jr(r)))throw new Error(e+" contains an invalid key ("+r+") "+Ue(path)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=Object(c.P)(t),Fe(e)}(path,r),ti(e,o,path),function(e){const t=e.parts_.pop();e.byteLength_-=Object(c.P)(t),e.parts_.length>0&&(e.byteLength_-=1)}(path)})),t&&n)throw new Error(e+' contains ".value" child '+Ue(path)+" in addition to actual children.")}},ni=function(e,data,path,t){if(t&&void 0===data)return;const n=Object(c.q)(e,"values");if(!data||"object"!=typeof data||Array.isArray(data))throw new Error(n+" must be an object containing the children to replace.");const r=[];W(data,((e,t)=>{const o=new Te(e);if(ti(n,t,Ne(path,o)),".priority"===Oe(o)&&!Zr(t))throw new Error(n+"contains an invalid value for '"+o.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(o)})),function(e,t){let i,n;for(i=0;i<t.length;i++){n=t[i];const r=Ae(n);for(let t=0;t<r.length;t++)if(".priority"===r[t]&&t===r.length-1);else if(!Jr(r[t]))throw new Error(e+"contains an invalid key ("+r[t]+") in path "+n.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(De);let r=null;for(i=0;i<t.length;i++){if(n=t[i],null!==r&&Me(r,n))throw new Error(e+"contains a path "+r.toString()+" that is ancestor of another path "+n.toString());r=n}}(n,r)},ri=function(e,t,n){if(!n||void 0!==t){if(L(t))throw new Error(Object(c.q)(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Zr(t))throw new Error(Object(c.q)(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},ii=function(e,t,n,r){if(!(r&&void 0===n||Jr(n)))throw new Error(Object(c.q)(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},si=function(e,t,n,r){if(!(r&&void 0===n||Xr(n)))throw new Error(Object(c.q)(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},oi=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),si(e,t,n,r)},ai=function(e,path){if(".info"===Ce(path))throw new Error(e+" failed = Can't modify data under /.info/")},ci=function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Jr(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Xr(e)}(n))throw new Error(Object(c.q)(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class ui{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function hi(e,t){let n=null;for(let i=0;i<t.length;i++){const data=t[i],path=data.getPath();null===n||Le(path,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:path}),n.events.push(data)}n&&e.eventLists_.push(n)}function di(e,path,t){hi(e,t),pi(e,(e=>Le(e,path)))}function fi(e,t,n){hi(e,n),pi(e,(e=>Me(e,t)||Me(t,e)))}function pi(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){const r=e.eventLists_[i];if(r){t(r.path)?(mi(e.eventLists_[i]),e.eventLists_[i]=null):n=!1}}n&&(e.eventLists_=[]),e.recursionDepth_--}function mi(e){for(let i=0;i<e.events.length;i++){const t=e.events[i];if(null!==t){e.events[i]=null;const n=t.getEventRunner();k&&x("event: "+t.toString()),$(n)}}}const gi="repo_interrupt",yi=25;class wi{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ui,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=jt(),this.transactionQueueTree_=new Ur,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function _i(e,t,n){if(e.stats_=le(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new Lt(e.repoInfo_,((t,data,n,r)=>{Ii(e,t,data,n,r)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>Ti(e,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Object(c.R)(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new Be(e.repoInfo_,t,((t,data,n,r)=>{Ii(e,t,data,n,r)}),(t=>{Ti(e,t)}),(t=>{!function(e,t){W(t,((t,n)=>{Ei(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(e,t){const n=e.toString();return ce[n]||(ce[n]=t()),ce[n]}(e.repoInfo_,(()=>new Bt(e.stats_,e.server_))),e.infoData_=new Mt,e.infoSyncTree_=new cr({startListening:(t,n,r,o)=>{let c=[];const l=e.infoData_.getNode(t._path);return l.isEmpty()||(c=fr(e.infoSyncTree_,t._path,l),setTimeout((()=>{o("ok")}),0)),c},stopListening:()=>{}}),Ei(e,"connected",!1),e.serverSyncTree_=new cr({startListening:(t,n,r,o)=>(e.server_.listen(t,r,n,((n,data)=>{const r=o(n,data);fi(e.eventQueue_,t._path,r)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function vi(e){const t=e.infoData_.getNode(new Te(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function bi(e){return Rr({timestamp:vi(e)})}function Ii(e,t,data,n,r){e.dataUpdateCount++;const path=new Te(t);data=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,data):data;let o=[];if(r)if(n){const t=Object(c.L)(data,(e=>_t(e)));o=function(e,path,t,n){const r=Sr(e,n);if(r){const n=kr(r),o=n.path,c=n.queryId,l=Pe(o,path),h=sn.fromObject(t);return Or(e,o,new $t(Wt(c),l,h))}return[]}(e.serverSyncTree_,path,t,r)}else{const t=_t(data);o=mr(e.serverSyncTree_,path,t,r)}else if(n){const t=Object(c.L)(data,(e=>_t(e)));o=function(e,path,t){const n=sn.fromObject(t);return _r(e,new $t({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},path,n))}(e.serverSyncTree_,path,t)}else{const t=_t(data);o=fr(e.serverSyncTree_,path,t)}let l=path;o.length>0&&(l=Li(e,path)),fi(e.eventQueue_,l,o)}function Ti(e,t){Ei(e,"connected",t),!1===t&&function(e){Ni(e,"onDisconnectEvents");const t=bi(e),n=jt();Vt(e.onDisconnect_,Ee(),((path,r)=>{const o=Mr(path,r,e.serverSyncTree_,t);Ft(n,path,o)}));let r=[];Vt(n,Ee(),((path,t)=>{r=r.concat(fr(e.serverSyncTree_,path,t));const n=Vi(e,path);Li(e,n)})),e.onDisconnect_=jt(),fi(e.eventQueue_,Ee(),r)}(e)}function Ei(e,t,n){const path=new Te("/.info/"+t),r=_t(n);e.infoData_.updateSnapshot(path,r);const o=fr(e.infoSyncTree_,path,r);fi(e.eventQueue_,path,o)}function Ci(e){return e.nextWriteId_++}function Si(e,path,t,n,r){Ni(e,"set",{path:path.toString(),value:t,priority:n});const o=bi(e),c=_t(t,n),l=yr(e.serverSyncTree_,path),h=jr(c,l,o),d=Ci(e),f=lr(e.serverSyncTree_,path,h,d,!0);hi(e.eventQueue_,f),e.server_.put(path.toString(),c.val(!0),((t,n)=>{const o="ok"===t;o||D("set at "+path+" failed: "+t);const c=dr(e.serverSyncTree_,d,!o);fi(e.eventQueue_,path,c),Ri(e,r,t,n)}));const m=Vi(e,path);Li(e,m),fi(e.eventQueue_,m,[])}function ki(e,path,t){e.server_.onDisconnectCancel(path.toString(),((n,r)=>{"ok"===n&&Ut(e.onDisconnect_,path),Ri(e,t,n,r)}))}function Oi(e,path,t,n){const r=_t(t);e.server_.onDisconnectPut(path.toString(),r.val(!0),((t,o)=>{"ok"===t&&Ft(e.onDisconnect_,path,r),Ri(e,n,t,o)}))}function Ai(e,t,n){let r;r=".info"===Ce(t._path)?pr(e.infoSyncTree_,t,n):pr(e.serverSyncTree_,t,n),di(e.eventQueue_,t._path,r)}function xi(e){e.persistentConnection_&&e.persistentConnection_.interrupt(gi)}function Ni(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),x(n,...t)}function Ri(e,t,n,r){t&&$((()=>{if("ok"===n)t(null);else{const code=(n||"error").toUpperCase();let e=code;r&&(e+=": "+r);const o=new Error(e);o.code=code,t(o)}}))}function Pi(e,path,t){return yr(e.serverSyncTree_,path,t)||gt.EMPTY_NODE}function Di(e,t=e.transactionQueueTree_){if(t||Ui(e,t),qr(t)){const n=ji(e,t);Object(c.e)(n.length>0,"Sending zero length transaction queue");n.every((e=>0===e.status))&&function(e,path,t){const n=t.map((e=>e.currentWriteId)),r=Pi(e,path,n);let o=r;const l=r.hash();for(let i=0;i<t.length;i++){const e=t[i];Object(c.e)(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const n=Pe(path,e.path);o=o.updateChild(n,e.currentOutputSnapshotRaw)}const h=o.val(!0),d=path;e.server_.put(d.toString(),h,(n=>{Ni(e,"transaction put response",{path:d.toString(),status:n});let r=[];if("ok"===n){const n=[];for(let i=0;i<t.length;i++)t[i].status=2,r=r.concat(dr(e.serverSyncTree_,t[i].currentWriteId)),t[i].onComplete&&n.push((()=>t[i].onComplete(null,!0,t[i].currentOutputSnapshotResolved))),t[i].unwatcher();Ui(e,Vr(e.transactionQueueTree_,path)),Di(e,e.transactionQueueTree_),fi(e.eventQueue_,path,r);for(let i=0;i<n.length;i++)$(n[i])}else{if("datastale"===n)for(let i=0;i<t.length;i++)3===t[i].status?t[i].status=4:t[i].status=0;else{D("transaction at "+d.toString()+" failed: "+n);for(let i=0;i<t.length;i++)t[i].status=4,t[i].abortReason=n}Li(e,path)}}),l)}(e,Gr(t),n)}else zr(t)&&Wr(t,(t=>{Di(e,t)}))}function Li(e,t){const n=Mi(e,t),path=Gr(n);return function(e,t,path){if(0===t.length)return;const n=[];let r=[];const o=t.filter((q=>0===q.status)),l=o.map((q=>q.currentWriteId));for(let i=0;i<t.length;i++){const o=t[i],d=Pe(path,o.path);let f,m=!1;if(Object(c.e)(null!==d,"rerunTransactionsUnderNode_: relativePath should not be null."),4===o.status)m=!0,f=o.abortReason,r=r.concat(dr(e.serverSyncTree_,o.currentWriteId,!0));else if(0===o.status)if(o.retryCount>=yi)m=!0,f="maxretry",r=r.concat(dr(e.serverSyncTree_,o.currentWriteId,!0));else{const n=Pi(e,o.path,l);o.currentInputSnapshot=n;const h=t[i].update(n.val());if(void 0!==h){ti("transaction failed: Data returned ",h,o.path);let t=_t(h);"object"==typeof h&&null!=h&&Object(c.k)(h,".priority")||(t=t.updatePriority(n.getPriority()));const d=o.currentWriteId,f=bi(e),m=jr(t,n,f);o.currentOutputSnapshotRaw=t,o.currentOutputSnapshotResolved=m,o.currentWriteId=Ci(e),l.splice(l.indexOf(d),1),r=r.concat(lr(e.serverSyncTree_,o.path,m,o.currentWriteId,o.applyLocally)),r=r.concat(dr(e.serverSyncTree_,d,!0))}else m=!0,f="nodata",r=r.concat(dr(e.serverSyncTree_,o.currentWriteId,!0))}fi(e.eventQueue_,path,r),r=[],m&&(t[i].status=2,h=t[i].unwatcher,setTimeout(h,Math.floor(0)),t[i].onComplete&&("nodata"===f?n.push((()=>t[i].onComplete(null,!1,t[i].currentInputSnapshot))):n.push((()=>t[i].onComplete(new Error(f),!1,null)))))}var h;Ui(e,e.transactionQueueTree_);for(let i=0;i<n.length;i++)$(n[i]);Di(e,e.transactionQueueTree_)}(e,ji(e,n),path),path}function Mi(e,path){let t,n=e.transactionQueueTree_;for(t=Ce(path);null!==t&&void 0===qr(n);)n=Vr(n,t),t=Ce(path=ke(path));return n}function ji(e,t){const n=[];return Fi(e,t,n),n.sort(((a,b)=>a.order-b.order)),n}function Fi(e,t,n){const r=qr(t);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);Wr(t,(t=>{Fi(e,t,n)}))}function Ui(e,t){const n=qr(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,Br(t,n.length>0?n:void 0)}Wr(t,(t=>{Ui(e,t)}))}function Vi(e,path){const t=Gr(Mi(e,path)),n=Vr(e.transactionQueueTree_,path);return function(e,t,n){let r=n?e:e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}}(n,(t=>{qi(e,t)})),qi(e,n),Kr(n,(t=>{qi(e,t)})),t}function qi(e,t){const n=qr(t);if(n){const r=[];let o=[],l=-1;for(let i=0;i<n.length;i++)3===n[i].status||(1===n[i].status?(Object(c.e)(l===i-1,"All SENT items should be at beginning of queue."),l=i,n[i].status=3,n[i].abortReason="set"):(Object(c.e)(0===n[i].status,"Unexpected transaction status in abort"),n[i].unwatcher(),o=o.concat(dr(e.serverSyncTree_,n[i].currentWriteId,!0)),n[i].onComplete&&r.push(n[i].onComplete.bind(null,new Error("set"),!1,null))));-1===l?Br(t,void 0):n.length=l+1,fi(e.eventQueue_,Gr(t),o);for(let i=0;i<r.length;i++)$(r[i])}}const Bi=function(e,t){const n=zi(e),r=n.namespace;"firebase.com"===n.domain&&P(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||P("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&D("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const o="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new ie(n.host,n.secure,r,o,t,"",r!==n.subdomain),path:new Te(n.pathString)}},zi=function(e){let t="",n="",r="",o="",c="",l=!0,h="https",d=443;if("string"==typeof e){let f=e.indexOf("//");f>=0&&(h=e.substring(0,f-1),e=e.substring(f+2));let m=e.indexOf("/");-1===m&&(m=e.length);let y=e.indexOf("?");-1===y&&(y=e.length),t=e.substring(0,Math.min(m,y)),m<y&&(o=function(e){let t="";const n=e.split("/");for(let i=0;i<n.length;i++)if(n[i].length>0){let e=n[i];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(e){}t+="/"+e}return t}(e.substring(m,y)));const w=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):D(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,y)));f=t.indexOf(":"),f>=0?(l="https"===h||"wss"===h,d=parseInt(t.substring(f+1),10)):f=t.length;const _=t.slice(0,f);if("localhost"===_.toLowerCase())n="localhost";else if(_.split(".").length<=2)n=_;else{const e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),c=r}"ns"in w&&(c=w.ns)}return{host:t,port:d,domain:n,subdomain:r,secure:l,scheme:h,pathString:o,namespace:c}},Wi="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Ki=function(){let e=0;const t=[];return function(n){const r=n===e;let i;e=n;const o=new Array(8);for(i=7;i>=0;i--)o[i]=Wi.charAt(n%64),n=Math.floor(n/64);Object(c.e)(0===n,"Cannot push at time == 0");let l=o.join("");if(r){for(i=11;i>=0&&63===t[i];i--)t[i]=0;t[i]++}else for(i=0;i<12;i++)t[i]=Math.floor(64*Math.random());for(i=0;i<12;i++)l+=Wi.charAt(t[i]);return Object(c.e)(20===l.length,"nextPushId: Length should be 20."),l}}();class Gi{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Object(c.R)(this.snapshot.exportVal())}}class Hi{constructor(e,t,path){this.eventRegistration=e,this.error=t,this.path=path}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class $i{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return Object(c.e)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Qi{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new c.a;return ki(this._repo,this._path,e.wrapCallback((()=>{}))),e.promise}remove(){ai("OnDisconnect.remove",this._path);const e=new c.a;return Oi(this._repo,this._path,null,e.wrapCallback((()=>{}))),e.promise}set(e){ai("OnDisconnect.set",this._path),ei("OnDisconnect.set",e,this._path,!1);const t=new c.a;return Oi(this._repo,this._path,e,t.wrapCallback((()=>{}))),t.promise}setWithPriority(e,t){ai("OnDisconnect.setWithPriority",this._path),ei("OnDisconnect.setWithPriority",e,this._path,!1),ri("OnDisconnect.setWithPriority",t,!1);const n=new c.a;return function(e,path,t,n,r){const o=_t(t,n);e.server_.onDisconnectPut(path.toString(),o.val(!0),((t,n)=>{"ok"===t&&Ft(e.onDisconnect_,path,o),Ri(0,r,t,n)}))}(this._repo,this._path,e,t,n.wrapCallback((()=>{}))),n.promise}update(e){ai("OnDisconnect.update",this._path),ni("OnDisconnect.update",e,this._path,!1);const t=new c.a;return function(e,path,t,n){if(Object(c.B)(t))return x("onDisconnect().update() called with empty data.  Don't do anything."),void Ri(0,n,"ok",void 0);e.server_.onDisconnectMerge(path.toString(),t,((r,o)=>{"ok"===r&&W(t,((t,n)=>{const r=_t(n);Ft(e.onDisconnect_,Ne(path,t),r)})),Ri(0,n,r,o)}))}(this._repo,this._path,e,t.wrapCallback((()=>{}))),t.promise}}class Yi{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return Re(this._path)?null:Oe(this._path)}get ref(){return new es(this._repo,this._path)}get _queryIdentifier(){const e=Dt(this._queryParams),t=B(e);return"{}"===t?"default":t}get _queryObject(){return Dt(this._queryParams)}isEqual(e){if(!((e=Object(c.w)(e))instanceof Yi))return!1;const t=this._repo===e._repo,n=Le(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(path){let e="";for(let i=path.pieceNum_;i<path.pieces_.length;i++)""!==path.pieces_[i]&&(e+="/"+encodeURIComponent(String(path.pieces_[i])));return e||"/"}(this._path)}}function Ji(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function Xi(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===He){const r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",o="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==M)throw new Error(r);if("string"!=typeof t)throw new Error(o)}if(e.hasEnd()){if(e.getIndexEndName()!==j)throw new Error(r);if("string"!=typeof n)throw new Error(o)}}else if(e.getIndex()===at){if(null!=t&&!Zr(t)||null!=n&&!Zr(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Object(c.e)(e.getIndex()instanceof vt||e.getIndex()===bt,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Zi(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class es extends Yi{constructor(e,path){super(e,path,new At,!1)}get parent(){const e=xe(this._path);return null===e?null:new es(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class ts{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(path){const e=new Te(path),t=is(this.ref,path);return new ts(this._node.getChild(e),t,at)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,((t,n)=>e(new ts(n,is(this.ref,t),at))))}hasChild(path){const e=new Te(path);return!this._node.getChild(e).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ns(e,path){return(e=Object(c.w)(e))._checkNotDeleted("ref"),void 0!==path?is(e._root,path):e._root}function rs(e,t){(e=Object(c.w)(e))._checkNotDeleted("refFromURL");const n=Bi(t,e._repo.repoInfo_.nodeAdmin);ci("refFromURL",n);const r=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||r.host===e._repo.repoInfo_.host||P("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+e._repo.repoInfo_.host+")"),ns(e,n.path.toString())}function is(e,path){return null===Ce((e=Object(c.w)(e))._path)?oi("child","path",path,!1):si("child","path",path,!1),new es(e._repo,Ne(e._path,path))}function ss(e,t){e=Object(c.w)(e),ai("push",e._path),ei("push",t,e._path,!0);const n=vi(e._repo),r=Ki(n),o=is(e,r),l=is(e,r);let h;return h=null!=t?as(l,t).then((()=>l)):Promise.resolve(l),o.then=h.then.bind(h),o.catch=h.then.bind(h,void 0),o}function os(e){return ai("remove",e._path),as(e,null)}function as(e,t){e=Object(c.w)(e),ai("set",e._path),ei("set",t,e._path,!1);const n=new c.a;return Si(e._repo,e._path,t,null,n.wrapCallback((()=>{}))),n.promise}function cs(e,t){e=Object(c.w)(e),ai("setPriority",e._path),ri("setPriority",t,!1);const n=new c.a;return Si(e._repo,Ne(e._path,".priority"),t,null,n.wrapCallback((()=>{}))),n.promise}function ls(e,t,n){if(ai("setWithPriority",e._path),ei("setWithPriority",t,e._path,!1),ri("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";const r=new c.a;return Si(e._repo,e._path,t,n,r.wrapCallback((()=>{}))),r.promise}function us(e,t){ni("update",t,e._path,!1);const n=new c.a;return function(e,path,t,n){Ni(e,"update",{path:path.toString(),value:t});let r=!0;const o=bi(e),c={};if(W(t,((t,n)=>{r=!1,c[t]=Mr(Ne(path,t),_t(n),e.serverSyncTree_,o)})),r)x("update() called with empty data.  Don't do anything."),Ri(0,n,"ok",void 0);else{const r=Ci(e),o=ur(e.serverSyncTree_,path,c,r);hi(e.eventQueue_,o),e.server_.merge(path.toString(),t,((t,o)=>{const c="ok"===t;c||D("update at "+path+" failed: "+t);const l=dr(e.serverSyncTree_,r,!c),h=l.length>0?Li(e,path):path;fi(e.eventQueue_,h,l),Ri(0,n,t,o)})),W(t,(t=>{const n=Vi(e,Ne(path,t));Li(e,n)})),fi(e.eventQueue_,path,[])}}(e._repo,e._path,t,n.wrapCallback((()=>{}))),n.promise}function hs(e){e=Object(c.w)(e);const t=new $i((()=>{})),n=new ds(t);return function(e,t,n){const r=wr(e.serverSyncTree_,t);return null!=r?Promise.resolve(r):e.server_.get(t).then((r=>{const o=_t(r).withIndex(t._queryParams.getIndex());let c;if(gr(e.serverSyncTree_,t,n,!0),t._queryParams.loadsAllData())c=fr(e.serverSyncTree_,t._path,o);else{const n=Er(e.serverSyncTree_,t);c=mr(e.serverSyncTree_,t._path,o,n)}return fi(e.eventQueue_,t._path,c),pr(e.serverSyncTree_,t,n,null,!0),o}),(n=>(Ni(e,"get for query "+Object(c.R)(t)+" failed: "+n),Promise.reject(new Error(n)))))}(e._repo,e,n).then((t=>new ts(t,new es(e._repo,e._path),e._queryParams.getIndex())))}class ds{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new Gi("value",this,new ts(e.snapshotNode,new es(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,path){return this.callbackContext.hasCancelCallback?new Hi(this,e,path):null}matches(e){return e instanceof ds&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class fs{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,path){return this.callbackContext.hasCancelCallback?new Hi(this,e,path):null}createEvent(e,t){Object(c.e)(null!=e.childName,"Child events should have a childName.");const n=is(new es(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new Gi(e.type,this,new ts(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof fs&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function ps(e,t,n,r,o){let c;if("object"==typeof r&&(c=void 0,o=r),"function"==typeof r&&(c=r),o&&o.onlyOnce){const t=n,r=(n,r)=>{Ai(e._repo,e,h),t(n,r)};r.userCallback=n.userCallback,r.context=n.context,n=r}const l=new $i(n,c||void 0),h="value"===t?new ds(l):new fs(t,l);return function(e,t,n){let r;r=".info"===Ce(t._path)?gr(e.infoSyncTree_,t,n):gr(e.serverSyncTree_,t,n),di(e.eventQueue_,t._path,r)}(e._repo,e,h),()=>Ai(e._repo,e,h)}function ms(e,t,n,r){return ps(e,"value",t,n,r)}function gs(e,t,n,r){return ps(e,"child_added",t,n,r)}function ys(e,t,n,r){return ps(e,"child_changed",t,n,r)}function ws(e,t,n,r){return ps(e,"child_moved",t,n,r)}function _s(e,t,n,r){return ps(e,"child_removed",t,n,r)}function vs(e,t,n){let r=null;const o=n?new $i(n):null;"value"===t?r=new ds(o):t&&(r=new fs(t,o)),Ai(e._repo,e,r)}class bs{}class Is extends bs{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){ei("endAt",this._value,e._path,!0);const t=Nt(e._queryParams,this._value,this._key);if(Zi(t),Xi(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Yi(e._repo,e._path,t,e._orderByCalled)}}function Ts(e,t){return ii("endAt","key",t,!0),new Is(e,t)}class Es extends bs{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){ei("endBefore",this._value,e._path,!1);const t=function(e,t,n){let r;return r=e.index_===He||n?Nt(e,t,n):Nt(e,t,M),r.endBeforeSet_=!0,r}(e._queryParams,this._value,this._key);if(Zi(t),Xi(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Yi(e._repo,e._path,t,e._orderByCalled)}}function Cs(e,t){return ii("endBefore","key",t,!0),new Es(e,t)}class Ss extends bs{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){ei("startAt",this._value,e._path,!0);const t=xt(e._queryParams,this._value,this._key);if(Zi(t),Xi(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Yi(e._repo,e._path,t,e._orderByCalled)}}function ks(e=null,t){return ii("startAt","key",t,!0),new Ss(e,t)}class Os extends bs{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){ei("startAfter",this._value,e._path,!1);const t=function(e,t,n){let r;return r=e.index_===He||n?xt(e,t,n):xt(e,t,j),r.startAfterSet_=!0,r}(e._queryParams,this._value,this._key);if(Zi(t),Xi(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Yi(e._repo,e._path,t,e._orderByCalled)}}function As(e,t){return ii("startAfter","key",t,!0),new Os(e,t)}class xs extends bs{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Yi(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}(e._queryParams,this._limit),e._orderByCalled)}}function Ns(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new xs(e)}class Rs extends bs{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Yi(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}(e._queryParams,this._limit),e._orderByCalled)}}function Ps(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Rs(e)}class Ds extends bs{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Ji(e,"orderByChild");const t=new Te(this._path);if(Re(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const n=new vt(t),r=Rt(e._queryParams,n);return Xi(r),new Yi(e._repo,e._path,r,!0)}}function Ls(path){if("$key"===path)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===path)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===path)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return si("orderByChild","path",path,!1),new Ds(path)}class Ms extends bs{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Ji(e,"orderByKey");const t=Rt(e._queryParams,He);return Xi(t),new Yi(e._repo,e._path,t,!0)}}function js(){return new Ms}class Fs extends bs{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Ji(e,"orderByPriority");const t=Rt(e._queryParams,at);return Xi(t),new Yi(e._repo,e._path,t,!0)}}function Us(){return new Fs}class Vs extends bs{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Ji(e,"orderByValue");const t=Rt(e._queryParams,bt);return Xi(t),new Yi(e._repo,e._path,t,!0)}}function qs(){return new Vs}class Bs extends bs{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(ei("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Is(this._value,this._key)._apply(new Ss(this._value,this._key)._apply(e))}}function zs(e,t){return ii("equalTo","key",t,!0),new Bs(e,t)}function Ws(e,...t){let n=Object(c.w)(e);for(const e of t)n=e._apply(n);return n}!function(e){Object(c.e)(!Hn,"__referenceConstructor has already been defined"),Hn=e}(es),function(e){Object(c.e)(!$n,"__referenceConstructor has already been defined"),$n=e}(es);const Ks="FIREBASE_DATABASE_EMULATOR_HOST",Gs={};let Hs=!1;function $s(t,n,r,o,c){let l=o||t.options.databaseURL;void 0===l&&(t.options.projectId||P("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),x("Using default host for project ",t.options.projectId),l=`${t.options.projectId}-default-rtdb.firebaseio.com`);let h,d,f=Bi(l,c),m=f.repoInfo;void 0!==e&&e.env&&(d=e.env[Ks]),d?(h=!0,l=`http://${d}?ns=${m.namespace}`,f=Bi(l,c),m=f.repoInfo):h=!f.repoInfo.secure;const y=c&&h?new X(X.OWNER):new J(t.name,t.options,n);ci("Invalid Firebase Database URL",f),Re(f.path)||P("Database URL must point to the root of a Firebase Database (not including a child path).");const w=function(e,t,n,r){let o=Gs[t.name];o||(o={},Gs[t.name]=o);let c=o[e.toURLString()];c&&P("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return c=new wi(e,Hs,n,r),o[e.toURLString()]=c,c}(m,t,y,new Y(t.name,r));return new Qs(w,t)}class Qs{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(_i(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new es(this._repo,Ee())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const n=Gs[t];n&&n[e.key]===e||P(`Database ${t}(${e.repoInfo_}) has already been deleted.`),xi(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&P("Cannot call "+e+" on a deleted database.")}}function Ys(){ge.IS_TRANSPORT_INITIALIZED&&D("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Js(){Ys(),de.forceDisallow()}function Xs(){Ys(),me.forceDisallow(),de.forceAllow()}function Zs(e,t,n,r={}){(e=Object(c.w)(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&P("Cannot call useEmulator() after instance has already been initialized.");const o=e._repoInternal;let l;if(o.repoInfo_.nodeAdmin)r.mockUserToken&&P('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),l=new X(X.OWNER);else if(r.mockUserToken){const t="string"==typeof r.mockUserToken?r.mockUserToken:Object(c.l)(r.mockUserToken,e.app.options.projectId);l=new X(t)}!function(e,t,n,r){e.repoInfo_=new ie(`${t}:${n}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0),r&&(e.authTokenProvider_=r)}(o,t,n,l)}function eo(e){(e=Object(c.w)(e))._checkNotDeleted("goOffline"),xi(e._repo)}function to(e){var t;(e=Object(c.w)(e))._checkNotDeleted("goOnline"),(t=e._repo).persistentConnection_&&t.persistentConnection_.resume(gi)}function no(e,t){A(e,t)}const ro={".sv":"timestamp"};function io(){return ro}function so(e){return{".sv":{increment:e}}}class oo{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function ao(e,t,n){var r;if(e=Object(c.w)(e),ai("Reference.transaction",e._path),".length"===e.key||".keys"===e.key)throw"Reference.transaction failed: "+e.key+" is a read-only object.";const o=null===(r=null==n?void 0:n.applyLocally)||void 0===r||r,l=new c.a,h=ms(e,(()=>{}));return function(e,path,t,n,r,o){Ni(e,"transaction on "+path);const l={path:path,update:t,onComplete:n,status:null,order:E(),applyLocally:o,retryCount:0,unwatcher:r,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},h=Pi(e,path,void 0);l.currentInputSnapshot=h;const d=l.update(h.val());if(void 0===d)l.unwatcher(),l.currentOutputSnapshotRaw=null,l.currentOutputSnapshotResolved=null,l.onComplete&&l.onComplete(null,!1,l.currentInputSnapshot);else{ti("transaction failed: Data returned ",d,l.path),l.status=0;const t=Vr(e.transactionQueueTree_,path),n=qr(t)||[];let r;n.push(l),Br(t,n),"object"==typeof d&&null!==d&&Object(c.k)(d,".priority")?(r=Object(c.O)(d,".priority"),Object(c.e)(Zr(r),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):r=(yr(e.serverSyncTree_,path)||gt.EMPTY_NODE).getPriority().val();const o=bi(e),f=_t(d,r),m=jr(f,h,o);l.currentOutputSnapshotRaw=f,l.currentOutputSnapshotResolved=m,l.currentWriteId=Ci(e);const y=lr(e.serverSyncTree_,path,m,l.currentWriteId,l.applyLocally);fi(e.eventQueue_,path,y),Di(e,e.transactionQueueTree_)}}(e._repo,e._path,t,((t,n,r)=>{let o=null;t?l.reject(t):(o=new ts(r,new es(e._repo,e._path),at),l.resolve(new oo(n,o)))}),h,o),l.promise}Be.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Be.prototype.echo=function(data,e){this.sendRequest("echo",{d:data},e)};var co;m(r.SDK_VERSION),Object(r._registerComponent)(new o.a("database",((e,{instanceIdentifier:t})=>$s(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)),"PUBLIC").setMultipleInstances(!0)),Object(r.registerVersion)(h,d,co),Object(r.registerVersion)(h,d,"esm2017")}).call(this,n(166))},351:function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return Ue})),n.d(t,"c",(function(){return Xe})),n.d(t,"d",(function(){return nt})),n.d(t,"e",(function(){return st})),n.d(t,"f",(function(){return it})),n.d(t,"g",(function(){return $e})),n.d(t,"h",(function(){return tt})),n.d(t,"i",(function(){return Kn})),n.d(t,"j",(function(){return $r})),n.d(t,"k",(function(){return d})),n.d(t,"l",(function(){return Fn})),n.d(t,"m",(function(){return ot})),n.d(t,"n",(function(){return at})),n.d(t,"o",(function(){return ct})),n.d(t,"p",(function(){return O})),n.d(t,"q",(function(){return Oe})),n.d(t,"r",(function(){return T})),n.d(t,"s",(function(){return mn})),n.d(t,"t",(function(){return le})),n.d(t,"u",(function(){return gr})),n.d(t,"v",(function(){return cr})),n.d(t,"w",(function(){return de})),n.d(t,"y",(function(){return Pt})),n.d(t,"z",(function(){return hn})),n.d(t,"A",(function(){return Kr})),n.d(t,"B",(function(){return fn})),n.d(t,"C",(function(){return Dt})),n.d(t,"D",(function(){return Rt})),n.d(t,"E",(function(){return Me})),n.d(t,"G",(function(){return Mt})),n.d(t,"H",(function(){return y})),n.d(t,"I",(function(){return qt})),n.d(t,"J",(function(){return en})),n.d(t,"K",(function(){return rn})),n.d(t,"L",(function(){return mr})),n.d(t,"M",(function(){return he})),n.d(t,"N",(function(){return On})),n.d(t,"O",(function(){return Ut})),n.d(t,"P",(function(){return Tt})),n.d(t,"Q",(function(){return qn})),n.d(t,"R",(function(){return nr})),n.d(t,"S",(function(){return pr})),n.d(t,"T",(function(){return an})),n.d(t,"U",(function(){return Et})),n.d(t,"V",(function(){return Bn})),n.d(t,"W",(function(){return er})),n.d(t,"X",(function(){return fr})),n.d(t,"Y",(function(){return Bt})),n.d(t,"Z",(function(){return Nt})),n.d(t,"ab",(function(){return Ft})),n.d(t,"bb",(function(){return ft})),n.d(t,"cb",(function(){return It})),n.d(t,"db",(function(){return Ct})),n.d(t,"eb",(function(){return jt})),n.d(t,"fb",(function(){return Vt})),n.d(t,"gb",(function(){return Vn})),n.d(t,"hb",(function(){return Zn})),n.d(t,"ib",(function(){return dr})),n.d(t,"jb",(function(){return yt})),n.d(t,"kb",(function(){return Kt})),n.d(t,"lb",(function(){return Gt})),n.d(t,"mb",(function(){return Wn})),n.d(t,"nb",(function(){return Wt})),n.d(t,"ob",(function(){return zt})),n.d(t,"pb",(function(){return Lt})),n.d(t,"x",(function(){return fi})),n.d(t,"F",(function(){return hi}));var r=n(310),o=n(315),c=n(314);function l(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;var h=n(311);const d={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},f={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function m(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const y=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}},w=m,_=new r.b("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),v=new c.b("@firebase/auth");function I(e,...t){v.logLevel<=c.a.ERROR&&v.error(`Auth (${o.SDK_VERSION}): ${e}`,...t)}function T(e,...t){throw k(e,...t)}function E(e,...t){return k(e,...t)}function C(e,code,t){const n=Object.assign(Object.assign({},w()),{[code]:t});return new r.b("auth","Firebase",n).create(code,{appName:e.name})}function S(e,object,t){if(!(object instanceof t))throw t.name!==object.constructor.name&&T(e,"argument-error"),C(e,"argument-error",`Type of ${object.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function k(e,...t){if("string"!=typeof e){const code=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(code,...n)}return _.create(e,...t)}function O(e,t,...n){if(!e)throw k(t,...n)}function A(e){const t="INTERNAL ASSERTION FAILED: "+e;throw I(t),new Error(t)}function x(e,t){e||A(t)}function N(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function R(){return"http:"===P()||"https:"===P()}function P(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class D{constructor(e,t){this.shortDelay=e,this.longDelay=t,x(t>e,"Short delay should be less than long delay!"),this.isMobile=Object(r.E)()||Object(r.H)()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(R()||Object(r.A)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function L(e,path){x(e.emulator,"Emulator should always be set here");const{url:t}=e.emulator;return path?`${t}${path.startsWith("/")?path.slice(1):path}`:t}class M{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void A("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void A("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void A("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const j={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},F=new D(3e4,6e4);function U(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function V(e,t,path,n,o={}){return B(e,o,(async()=>{let body={},o={};n&&("GET"===t?o=n:body={body:JSON.stringify(n)});const c=Object(r.M)(Object.assign({key:e.config.apiKey},o)).slice(1),l=await e._getAdditionalHeaders();return l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode),M.fetch()(W(e,e.config.apiHost,path,c),Object.assign({method:t,headers:l,referrerPolicy:"no-referrer"},body))}))}async function B(e,t,n){e._canInitEmulator=!1;const o=Object.assign(Object.assign({},j),t);try{const t=new G(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const c=await r.json();if("needConfirmation"in c)throw H(e,"account-exists-with-different-credential",c);if(r.ok&&!("errorMessage"in c))return c;{const t=r.ok?c.errorMessage:c.error.message,[n,l]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw H(e,"credential-already-in-use",c);if("EMAIL_EXISTS"===n)throw H(e,"email-already-in-use",c);if("USER_DISABLED"===n)throw H(e,"user-disabled",c);const h=o[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw C(e,h,l);T(e,h)}}catch(t){if(t instanceof r.c)throw t;T(e,"network-request-failed",{message:String(t)})}}async function z(e,t,path,n,r={}){const o=await V(e,t,path,n,r);return"mfaPendingCredential"in o&&T(e,"multi-factor-auth-required",{_serverResponse:o}),o}function W(e,t,path,n){const base=`${t}${path}?${n}`;return e.config.emulator?L(e.config,base):`${e.config.apiScheme}://${base}`}function K(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class G{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(E(this.auth,"network-request-failed"))),F.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function H(e,code,t){const n={appName:e.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const r=E(e,code,n);return r.customData._tokenResponse=t,r}function $(e){return void 0!==e&&void 0!==e.getResponse}function Q(e){return void 0!==e&&void 0!==e.enterprise}class Y{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return K(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}async function J(e,t){return V(e,"GET","/v2/recaptchaConfig",U(e,t))}function X(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Z(e){return 1e3*Number(e)}function ee(e){const[t,n,o]=e.split(".");if(void 0===t||void 0===n||void 0===o)return I("JWT malformed, contained fewer than 3 sections"),null;try{const e=Object(r.h)(n);return e?JSON.parse(e):(I("Failed to decode base64 JWT payload"),null)}catch(e){return I("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function te(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof r.c&&function({code:code}){return"auth/user-disabled"===code||"auth/user-token-expired"===code}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class ne{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class re{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=X(this.lastLoginAt),this.creationTime=X(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ie(e){var t;const n=e.auth,r=await e.getIdToken(),o=await te(e,async function(e,t){return V(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));O(null==o?void 0:o.users.length,n,"internal-error");const c=o.users[0];e._notifyReloadListener(c);const h=(null===(t=c.providerUserInfo)||void 0===t?void 0:t.length)?c.providerUserInfo.map((e=>{var{providerId:t}=e,n=l(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[];const d=(f=e.providerData,m=h,[...f.filter((e=>!m.some((t=>t.providerId===e.providerId)))),...m]);var f,m;const y=e.isAnonymous,w=!(e.email&&c.passwordHash||(null==d?void 0:d.length)),_=!!y&&w,v={uid:c.localId,displayName:c.displayName||null,photoURL:c.photoUrl||null,email:c.email||null,emailVerified:c.emailVerified||!1,phoneNumber:c.phoneNumber||null,tenantId:c.tenantId||null,providerData:d,metadata:new re(c.createdAt,c.lastLoginAt),isAnonymous:_};Object.assign(e,v)}class se{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){O(e.idToken,"internal-error"),O(void 0!==e.idToken,"internal-error"),O(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=ee(e);return O(t,"internal-error"),O(void 0!==t.exp,"internal-error"),O(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return O(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:o,expiresIn:c}=await async function(e,t){const n=await B(e,{},(async()=>{const body=Object(r.M)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:o}=e.config,c=W(e,n,"/v1/token",`key=${o}`),l=await e._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",M.fetch()(c,{method:"POST",headers:l,body:body})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,o,Number(c))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,object){const{refreshToken:t,accessToken:n,expirationTime:r}=object,o=new se;return t&&(O("string"==typeof t,"internal-error",{appName:e}),o.refreshToken=t),n&&(O("string"==typeof n,"internal-error",{appName:e}),o.accessToken=n),r&&(O("number"==typeof r,"internal-error",{appName:e}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new se,this.toJSON())}_performRefresh(){return A("not implemented")}}function oe(e,t){O("string"==typeof e||void 0===e,"internal-error",{appName:t})}class ae{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,o=l(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ne(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=o.displayName||null,this.email=o.email||null,this.emailVerified=o.emailVerified||!1,this.phoneNumber=o.phoneNumber||null,this.photoURL=o.photoURL||null,this.isAnonymous=o.isAnonymous||!1,this.tenantId=o.tenantId||null,this.providerData=o.providerData?[...o.providerData]:[],this.metadata=new re(o.createdAt||void 0,o.lastLoginAt||void 0)}async getIdToken(e){const t=await te(this,this.stsTokenManager.getToken(this.auth,e));return O(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=Object(r.w)(e),o=await n.getIdToken(t),c=ee(o);O(c&&c.exp&&c.auth_time&&c.iat,n.auth,"internal-error");const l="object"==typeof c.firebase?c.firebase:void 0,h=null==l?void 0:l.sign_in_provider;return{claims:c,token:o,authTime:X(Z(c.auth_time)),issuedAtTime:X(Z(c.iat)),expirationTime:X(Z(c.exp)),signInProvider:h||null,signInSecondFactor:(null==l?void 0:l.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=Object(r.w)(e);await ie(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(O(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ae(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){O(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await ie(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await te(this,async function(e,t){return V(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,object){var t,n,r,o,c,l,h,d;const f=null!==(t=object.displayName)&&void 0!==t?t:void 0,m=null!==(n=object.email)&&void 0!==n?n:void 0,y=null!==(r=object.phoneNumber)&&void 0!==r?r:void 0,w=null!==(o=object.photoURL)&&void 0!==o?o:void 0,_=null!==(c=object.tenantId)&&void 0!==c?c:void 0,v=null!==(l=object._redirectEventId)&&void 0!==l?l:void 0,I=null!==(h=object.createdAt)&&void 0!==h?h:void 0,T=null!==(d=object.lastLoginAt)&&void 0!==d?d:void 0,{uid:E,emailVerified:C,isAnonymous:S,providerData:k,stsTokenManager:A}=object;O(E&&A,e,"internal-error");const x=se.fromJSON(this.name,A);O("string"==typeof E,e,"internal-error"),oe(f,e.name),oe(m,e.name),O("boolean"==typeof C,e,"internal-error"),O("boolean"==typeof S,e,"internal-error"),oe(y,e.name),oe(w,e.name),oe(_,e.name),oe(v,e.name),oe(I,e.name),oe(T,e.name);const N=new ae({uid:E,auth:e,email:m,emailVerified:C,displayName:f,isAnonymous:S,photoURL:w,phoneNumber:y,tenantId:_,stsTokenManager:x,createdAt:I,lastLoginAt:T});return k&&Array.isArray(k)&&(N.providerData=k.map((e=>Object.assign({},e)))),v&&(N._redirectEventId=v),N}static async _fromIdTokenResponse(e,t,n=!1){const r=new se;r.updateFromServerResponse(t);const o=new ae({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await ie(o),o}}const ce=new Map;function le(e){x(e instanceof Function,"Expected a class definition");let t=ce.get(e);return t?(x(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,ce.set(e,t),t)}class ue{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}ue.type="NONE";const he=ue;function de(e,t,n){return`firebase:${e}:${t}:${n}`}class fe{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:o}=this.auth;this.fullUserKey=de(this.userKey,r.apiKey,o),this.fullPersistenceKey=de("persistence",r.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ae._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new fe(le(he),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let o=r[0]||le(he);const c=de(n,e.config.apiKey,e.name);let l=null;for(const n of t)try{const t=await n._get(c);if(t){const r=ae._fromJSON(e,t);n!==o&&(l=r),o=n;break}}catch(e){}const h=r.filter((p=>p._shouldAllowMigration));return o._shouldAllowMigration&&h.length?(o=h[0],l&&await o._set(c,l.toJSON()),await Promise.all(t.map((async e=>{if(e!==o)try{await e._remove(c)}catch(e){}}))),new fe(o,e,n)):new fe(o,e,n)}}function pe(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(we(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(me(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(ve(t))return"Blackberry";if(be(t))return"Webos";if(ge(t))return"Safari";if((t.includes("chrome/")||ye(t))&&!t.includes("edge/"))return"Chrome";if(_e(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function me(e=Object(r.x)()){return/firefox\//i.test(e)}function ge(e=Object(r.x)()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ye(e=Object(r.x)()){return/crios\//i.test(e)}function we(e=Object(r.x)()){return/iemobile/i.test(e)}function _e(e=Object(r.x)()){return/android/i.test(e)}function ve(e=Object(r.x)()){return/blackberry/i.test(e)}function be(e=Object(r.x)()){return/webos/i.test(e)}function Ie(e=Object(r.x)()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Te(e=Object(r.x)()){return Ie(e)||_e(e)||be(e)||ve(e)||/windows phone/i.test(e)||we(e)}function Ee(e,t=[]){let n;switch(e){case"Browser":n=pe(Object(r.x)());break;case"Worker":n=`${pe(Object(r.x)())}-${e}`;break;default:n=e}const c=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${o.SDK_VERSION}/${c}`}class Ce{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class Se{constructor(e){var t,n,r,o;const c=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=c.minPasswordLength)&&void 0!==t?t:6,c.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=c.maxPasswordLength),void 0!==c.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=c.containsLowercaseCharacter),void 0!==c.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=c.containsUppercaseCharacter),void 0!==c.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=c.containsNumericCharacter),void 0!==c.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=c.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(o=e.forceUpgradeOnSignin)&&void 0!==o&&o,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,o,c,l;const h={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,h),this.validatePasswordCharacterOptions(e,h),h.isValid&&(h.isValid=null===(t=h.meetsMinPasswordLength)||void 0===t||t),h.isValid&&(h.isValid=null===(n=h.meetsMaxPasswordLength)||void 0===n||n),h.isValid&&(h.isValid=null===(r=h.containsLowercaseLetter)||void 0===r||r),h.isValid&&(h.isValid=null===(o=h.containsUppercaseLetter)||void 0===o||o),h.isValid&&(h.isValid=null===(c=h.containsNumericCharacter)||void 0===c||c),h.isValid&&(h.isValid=null===(l=h.containsNonAlphanumericCharacter)||void 0===l||l),h}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class ke{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ae(this),this.idTokenSubscription=new Ae(this),this.beforeStateQueue=new Ce(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=_,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=le(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await fe.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let r=n,o=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,c=null==r?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);n&&n!==c||!(null==l?void 0:l.user)||(r=l.user,o=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(o)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return O(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ie(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?Object(r.w)(e):null;return t&&O(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&O(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(le(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return V(e,"GET","/v2/passwordPolicy",U(e,t))}(this),t=new Se(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new r.b("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return V(e,"POST","/v2/accounts:revokeToken",U(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&le(e)||this._popupRedirectResolver;O(t,this,"argument-error"),this.redirectPersistenceManager=await fe.create(this,[le(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const o="function"==typeof t?t:t.next.bind(t);let c=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(O(l,this,"internal-error"),l.then((()=>{c||o(this.currentUser)})),"function"==typeof t){const o=e.addObserver(t,n,r);return()=>{c=!0,o()}}{const n=e.addObserver(t);return()=>{c=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return O(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ee(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){v.logLevel<=c.a.WARN&&v.warn(`Auth (${o.SDK_VERSION}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function Oe(e){return Object(r.w)(e)}class Ae{constructor(e){this.auth=e,this.observer=null,this.addObserver=Object(r.m)((e=>this.observer=e))}get next(){return O(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let xe={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Ne(e){return xe.loadJS(e)}function Re(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Pe{constructor(e){this.type="recaptcha-enterprise",this.auth=Oe(e)}async verify(e="verify",t=!1){function n(t,n,r){const o=window.grecaptcha;Q(o)?o.enterprise.ready((()=>{o.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{J(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new Y(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((o=>{if(!t&&Q(window.grecaptcha))n(o,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=xe.recaptchaEnterpriseScript;0!==t.length&&(t+=o),Ne(t).then((()=>{n(o,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function De(e,t,n,r=!1){const o=new Pe(e);let c;try{c=await o.verify(n)}catch(e){c=await o.verify(n,!0)}const l=Object.assign({},t);return r?Object.assign(l,{captchaResp:c}):Object.assign(l,{captchaResponse:c}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function Le(e,t,n,r){var o;if(null===(o=e._getRecaptchaConfig())||void 0===o?void 0:o.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await De(e,t,n,"getOobCode"===n);return r(e,o)}return r(e,t).catch((async o=>{if("auth/missing-recaptcha-token"===o.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await De(e,t,n,"getOobCode"===n);return r(e,o)}return Promise.reject(o)}))}function Me(e,t,n){const r=Oe(e);O(r._canInitEmulator,r,"emulator-config-failed"),O(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const o=!!(null==n?void 0:n.disableWarnings),c=je(t),{host:l,port:h}=function(e){const t=je(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",o=/^(\[[^\]]+\])(:|$)/.exec(r);if(o){const e=o[1];return{host:e,port:Fe(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Fe(t)}}}(t),d=null===h?"":`:${h}`;r.config.emulator={url:`${c}//${l}${d}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:l,port:h,protocol:c.replace(":",""),options:Object.freeze({disableWarnings:o})}),o||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function je(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Fe(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Ue{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return A("not implemented")}_getIdTokenResponse(e){return A("not implemented")}_linkToIdToken(e,t){return A("not implemented")}_getReauthenticationResolver(e){return A("not implemented")}}async function Ve(e,t){return V(e,"POST","/v1/accounts:resetPassword",U(e,t))}async function qe(e,t){return V(e,"POST","/v1/accounts:signUp",t)}async function Be(e,t){return z(e,"POST","/v1/accounts:signInWithPassword",U(e,t))}async function ze(e,t){return V(e,"POST","/v1/accounts:sendOobCode",U(e,t))}async function We(e,t){return ze(e,t)}async function Ke(e,t){return ze(e,t)}class Ge extends Ue{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Ge(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Ge(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Le(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Be);case"emailLink":return async function(e,t){return z(e,"POST","/v1/accounts:signInWithEmailLink",U(e,t))}(e,{email:this._email,oobCode:this._password});default:T(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Le(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",qe);case"emailLink":return async function(e,t){return z(e,"POST","/v1/accounts:signInWithEmailLink",U(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:T(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function He(e,t){return z(e,"POST","/v1/accounts:signInWithIdp",U(e,t))}class $e extends Ue{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new $e(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):T("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,o=l(t,["providerId","signInMethod"]);if(!n||!r)return null;const c=new $e(n,r);return c.idToken=o.idToken||void 0,c.accessToken=o.accessToken||void 0,c.secret=o.secret,c.nonce=o.nonce,c.pendingToken=o.pendingToken||null,c}_getIdTokenResponse(e){return He(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,He(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,He(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Object(r.M)(t)}return e}}const Qe={USER_NOT_FOUND:"user-not-found"};class Ye extends Ue{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Ye({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Ye({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return z(e,"POST","/v1/accounts:signInWithPhoneNumber",U(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await z(e,"POST","/v1/accounts:signInWithPhoneNumber",U(e,t));if(n.temporaryProof)throw H(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return z(e,"POST","/v1/accounts:signInWithPhoneNumber",U(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Qe)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:o}=e;return n||t||r||o?new Ye({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:o}):null}}class Je{constructor(e){var t,n,o,c,l,h;const d=Object(r.N)(Object(r.r)(e)),f=null!==(t=d.apiKey)&&void 0!==t?t:null,code=null!==(n=d.oobCode)&&void 0!==n?n:null,m=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(o=d.mode)&&void 0!==o?o:null);O(f&&code&&m,"argument-error"),this.apiKey=f,this.operation=m,this.code=code,this.continueUrl=null!==(c=d.continueUrl)&&void 0!==c?c:null,this.languageCode=null!==(l=d.languageCode)&&void 0!==l?l:null,this.tenantId=null!==(h=d.tenantId)&&void 0!==h?h:null}static parseLink(link){const e=function(e){const link=Object(r.N)(Object(r.r)(e)).link,t=link?Object(r.N)(Object(r.r)(link)).deep_link_id:null,n=Object(r.N)(Object(r.r)(e)).deep_link_id;return(n?Object(r.N)(Object(r.r)(n)).link:null)||n||t||link||e}(link);try{return new Je(e)}catch(e){return null}}}class Xe{constructor(){this.providerId=Xe.PROVIDER_ID}static credential(e,t){return Ge._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Je.parseLink(t);return O(n,"argument-error"),Ge._fromEmailAndCode(e,n.code,n.tenantId)}}Xe.PROVIDER_ID="password",Xe.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Xe.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Ze{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class et extends Ze{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class tt extends et{static credentialFromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return O("providerId"in t&&"signInMethod"in t,"argument-error"),$e._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return O(e.idToken||e.accessToken,"argument-error"),$e._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return tt.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return tt.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:o,nonce:c,providerId:l}=e;if(!(n||r||t||o))return null;if(!l)return null;try{return new tt(l)._credential({idToken:t,accessToken:n,nonce:c,pendingToken:o})}catch(e){return null}}}class nt extends et{constructor(){super("facebook.com")}static credential(e){return $e._fromParams({providerId:nt.PROVIDER_ID,signInMethod:nt.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return nt.credentialFromTaggedObject(e)}static credentialFromError(e){return nt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return nt.credential(e.oauthAccessToken)}catch(e){return null}}}nt.FACEBOOK_SIGN_IN_METHOD="facebook.com",nt.PROVIDER_ID="facebook.com";class it extends et{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return $e._fromParams({providerId:it.PROVIDER_ID,signInMethod:it.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return it.credentialFromTaggedObject(e)}static credentialFromError(e){return it.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return it.credential(t,n)}catch(e){return null}}}it.GOOGLE_SIGN_IN_METHOD="google.com",it.PROVIDER_ID="google.com";class st extends et{constructor(){super("github.com")}static credential(e){return $e._fromParams({providerId:st.PROVIDER_ID,signInMethod:st.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return st.credentialFromTaggedObject(e)}static credentialFromError(e){return st.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return st.credential(e.oauthAccessToken)}catch(e){return null}}}st.GITHUB_SIGN_IN_METHOD="github.com",st.PROVIDER_ID="github.com";class ot extends Ue{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return He(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,He(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,He(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,pendingToken:o}=t;return n&&r&&o&&n===r?new ot(n,o):null}static _create(e,t){return new ot(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class at extends Ze{constructor(e){O(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return at.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return at.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=ot.fromJSON(e);return O(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return ot._create(n,t)}catch(e){return null}}}class ct extends et{constructor(){super("twitter.com")}static credential(e,t){return $e._fromParams({providerId:ct.PROVIDER_ID,signInMethod:ct.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ct.credentialFromTaggedObject(e)}static credentialFromError(e){return ct.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return ct.credential(t,n)}catch(e){return null}}}async function lt(e,t){return z(e,"POST","/v1/accounts:signUp",U(e,t))}ct.TWITTER_SIGN_IN_METHOD="twitter.com",ct.PROVIDER_ID="twitter.com";class ut{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const o=await ae._fromIdTokenResponse(e,n,r),c=ht(n);return new ut({user:o,providerId:c,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=ht(n);return new ut({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function ht(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}async function ft(e){var t;const n=Oe(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new ut({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await lt(n,{returnSecureToken:!0}),o=await ut._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(o.user),o}class pt extends r.c{constructor(e,t,n,r){var o;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,pt.prototype),this.customData={appName:e.name,tenantId:null!==(o=e.tenantId)&&void 0!==o?o:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new pt(e,t,n,r)}}function mt(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw pt._fromErrorAndOperation(e,n,t,r);throw n}))}function gt(e){return new Set(e.map((({providerId:e})=>e)).filter((e=>!!e)))}async function yt(e,t){const n=Object(r.w)(e);await _t(!0,n,t);const{providerUserInfo:o}=await async function(e,t){return V(e,"POST","/v1/accounts:update",t)}(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),c=gt(o||[]);return n.providerData=n.providerData.filter((e=>c.has(e.providerId))),c.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function wt(e,t,n=!1){const r=await te(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return ut._forOperation(e,"link",r)}async function _t(e,t,n){await ie(t);const code=!1===e?"provider-already-linked":"no-such-provider";O(gt(t.providerData).has(n)===e,t.auth,code)}async function vt(e,t,n=!1){const{auth:r}=e,o="reauthenticate";try{const c=await te(e,mt(r,o,t,e),n);O(c.idToken,r,"internal-error");const l=ee(c.idToken);O(l,r,"internal-error");const{sub:h}=l;return O(e.uid===h,r,"user-mismatch"),ut._forOperation(e,o,c)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&T(r,"user-mismatch"),e}}async function bt(e,t,n=!1){const r="signIn",o=await mt(e,r,t),c=await ut._fromIdTokenResponse(e,r,o);return n||await e._updateCurrentUser(c.user),c}async function It(e,t){return bt(Oe(e),t)}async function Tt(e,t){const n=Object(r.w)(e);return await _t(!1,n,t.providerId),wt(n,t)}async function Et(e,t){return vt(Object(r.w)(e),t)}async function Ct(e,t){const n=Oe(e),r=await async function(e,t){return z(e,"POST","/v1/accounts:signInWithCustomToken",U(e,t))}(n,{token:t,returnSecureToken:!0}),o=await ut._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(o.user),o}class St{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?kt._fromServerResponse(e,t):"totpInfo"in t?Ot._fromServerResponse(e,t):T(e,"internal-error")}}class kt extends St{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new kt(t)}}class Ot extends St{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Ot(t)}}function At(e,t,n){var r;O((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),O(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(O(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(O(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function xt(e){const t=Oe(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function Nt(e,t,n){const r=Oe(e),o={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};n&&At(r,o,n),await Le(r,o,"getOobCode",We)}async function Rt(e,t,n){await Ve(Object(r.w)(e),{oobCode:t,newPassword:n}).catch((async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&xt(e),t}))}async function Pt(e,t){await async function(e,t){return V(e,"POST","/v1/accounts:update",U(e,t))}(Object(r.w)(e),{oobCode:t})}async function Dt(e,t){const n=Object(r.w)(e),o=await Ve(n,{oobCode:t}),c=o.requestType;switch(O(c,n,"internal-error"),c){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":O(o.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":O(o.mfaInfo,n,"internal-error");default:O(o.email,n,"internal-error")}let l=null;return o.mfaInfo&&(l=St._fromServerResponse(Oe(n),o.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===o.requestType?o.newEmail:o.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===o.requestType?o.email:o.newEmail)||null,multiFactorInfo:l},operation:c}}async function Lt(e,code){const{data:data}=await Dt(Object(r.w)(e),code);return data.email}async function Mt(e,t,n){const r=Oe(e),o=Le(r,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",lt),c=await o.catch((t=>{throw"auth/password-does-not-meet-requirements"===t.code&&xt(e),t})),l=await ut._fromIdTokenResponse(r,"signIn",c);return await r._updateCurrentUser(l.user),l}function jt(e,t,n){return It(Object(r.w)(e),Xe.credential(t,n)).catch((async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&xt(e),t}))}async function Ft(e,t,n){const r=Oe(e),o={requestType:"EMAIL_SIGNIN",email:t,clientType:"CLIENT_TYPE_WEB"};!function(e,t){O(t.handleCodeInApp,r,"argument-error"),t&&At(r,e,t)}(o,n),await Le(r,o,"getOobCode",Ke)}function Ut(e,t){const n=Je.parseLink(t);return"EMAIL_SIGNIN"===(null==n?void 0:n.operation)}async function Vt(e,t,n){const o=Object(r.w)(e),c=Xe.credentialWithLink(t,n||N());return O(c._tenantId===(o.tenantId||null),o,"tenant-id-mismatch"),It(o,c)}async function qt(e,t){const n={identifier:t,continueUri:R()?N():"http://localhost"},{signinMethods:o}=await async function(e,t){return V(e,"POST","/v1/accounts:createAuthUri",U(e,t))}(Object(r.w)(e),n);return o||[]}async function Bt(e,t){const n=Object(r.w)(e),o={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&At(n.auth,o,t);const{email:c}=await async function(e,t){return ze(e,t)}(n.auth,o);c!==e.email&&await e.reload()}async function zt(e,t,n){const o=Object(r.w)(e),c={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&At(o.auth,c,n);const{email:l}=await async function(e,t){return ze(e,t)}(o.auth,c);l!==e.email&&await e.reload()}async function Wt(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const o=Object(r.w)(e),c={idToken:await o.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},l=await te(o,async function(e,t){return V(e,"POST","/v1/accounts:update",t)}(o.auth,c));o.displayName=l.displayName||null,o.photoURL=l.photoUrl||null;const h=o.providerData.find((({providerId:e})=>"password"===e));h&&(h.displayName=o.displayName,h.photoURL=o.photoURL),await o._updateTokensIfNecessary(l)}function Kt(e,t){return Ht(Object(r.w)(e),t,null)}function Gt(e,t){return Ht(Object(r.w)(e),null,t)}async function Ht(e,t,n){const{auth:r}=e,o={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(o.email=t),n&&(o.password=n);const c=await te(e,async function(e,t){return V(e,"POST","/v1/accounts:update",t)}(r,o));await e._updateTokensIfNecessary(c,!0)}class $t{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class Qt extends $t{constructor(e,t,n,r){super(e,t,n),this.username=r}}class Yt extends $t{constructor(e,t){super(e,"facebook.com",t)}}class Jt extends Qt{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class Xt extends $t{constructor(e,t){super(e,"google.com",t)}}class Zt extends Qt{constructor(e,t,n){super(e,"twitter.com",t,n)}}function en(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;const{providerId:r}=e,o=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},c=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null==e?void 0:e.idToken)){const r=null===(n=null===(t=ee(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n.sign_in_provider;if(r)return new $t(c,"anonymous"!==r&&"custom"!==r?r:null)}if(!r)return null;switch(r){case"facebook.com":return new Yt(c,o);case"github.com":return new Jt(c,o);case"google.com":return new Xt(c,o);case"twitter.com":return new Zt(c,o,e.screenName||null);case"custom":case"anonymous":return new $t(c,null);default:return new $t(c,r,o)}}(n)}class tn{constructor(e,t,n){this.type=e,this.credential=t,this.user=n}static _fromIdtoken(e,t){return new tn("enroll",e,t)}static _fromMfaPendingCredential(e){return new tn("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return tn._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return tn._fromIdtoken(e.multiFactorSession.idToken)}return null}}class nn{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=Oe(e),r=t.customData._serverResponse,o=(r.mfaInfo||[]).map((e=>St._fromServerResponse(n,e)));O(r.mfaPendingCredential,n,"internal-error");const c=tn._fromMfaPendingCredential(r.mfaPendingCredential);return new nn(c,o,(async e=>{const o=await e._process(n,c);delete r.mfaInfo,delete r.mfaPendingCredential;const l=Object.assign(Object.assign({},r),{idToken:o.idToken,refreshToken:o.refreshToken});switch(t.operationType){case"signIn":const e=await ut._fromIdTokenResponse(n,t.operationType,l);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return O(t.user,n,"internal-error"),ut._forOperation(t.user,t.operationType,l);default:T(n,"internal-error")}}))}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function rn(e,t){var n;const o=Object(r.w)(e),c=t;return O(t.customData.operationType,o,"argument-error"),O(null===(n=c.customData._serverResponse)||void 0===n?void 0:n.mfaPendingCredential,o,"argument-error"),nn._fromError(o,c)}class sn{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload((t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map((t=>St._fromServerResponse(e.auth,t))))}))}static _fromUser(e){return new sn(e)}async getSession(){return tn._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const n=e,r=await this.getSession(),o=await te(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(o),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid,n=await this.user.getIdToken();try{const e=await te(this.user,(r=this.user.auth,o={idToken:n,mfaEnrollmentId:t},V(r,"POST","/v2/accounts/mfaEnrollment:withdraw",U(r,o))));this.enrolledFactors=this.enrolledFactors.filter((({uid:e})=>e!==t)),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(e){throw e}var r,o}}const on=new WeakMap;function an(e){const t=Object(r.w)(e);return on.has(t)||on.set(t,sn._fromUser(t)),on.get(t)}const cn="__sak";class ln{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(cn,"1"),this.storage.removeItem(cn),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class un extends ln{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=Object(r.x)();return ge(e)||Ie(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Te(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const o=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},c=this.storage.getItem(n);Object(r.C)()&&10===document.documentMode&&c!==e.newValue&&e.newValue!==e.oldValue?setTimeout(o,10):o()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}un.type="LOCAL";const hn=un;class dn extends ln{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}dn.type="SESSION";const fn=dn;class pn{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new pn(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:data}=t.data,o=this.handlersMap[r];if(!(null==o?void 0:o.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const c=Array.from(o).map((async e=>e(t.origin,data))),l=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(c);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:l})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function mn(e="",t=10){let n="";for(let i=0;i<t;i++)n+=Math.floor(10*Math.random());return e+n}pn.receivers=[];class gn{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,data,t=50){const n="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!n)throw new Error("connection_unavailable");let r,o;return new Promise(((c,l)=>{const h=mn("",20);n.port1.start();const d=setTimeout((()=>{l(new Error("unsupported_event"))}),t);o={messageChannel:n,onMessage(e){const t=e;if(t.data.eventId===h)switch(t.data.status){case"ack":clearTimeout(d),r=setTimeout((()=>{l(new Error("timeout"))}),3e3);break;case"done":clearTimeout(r),c(t.data.response);break;default:clearTimeout(d),clearTimeout(r),l(new Error("invalid_response"))}}},this.handlers.add(o),n.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:data},[n.port2])})).finally((()=>{o&&this.removeMessageHandler(o)}))}}function yn(){return window}function wn(){return void 0!==yn().WorkerGlobalScope&&"function"==typeof yn().importScripts}const _n="firebaseLocalStorageDb",vn="firebaseLocalStorage",bn="fbase_key";class In{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Tn(e,t){return e.transaction([vn],t?"readwrite":"readonly").objectStore(vn)}function En(){const e=indexedDB.open(_n,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(vn,{keyPath:bn})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(vn)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(_n);return new In(e).toPromise()}(),t(await En()))}))}))}async function Cn(e,t,n){const r=Tn(e,!0).put({[bn]:t,value:n});return new In(r).toPromise()}function Sn(e,t){const n=Tn(e,!0).delete(t);return new In(n).toPromise()}class kn{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await En()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return wn()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=pn._getInstance(wn()?self:null),this.receiver._subscribe("keyChanged",(async(e,data)=>({keyProcessed:(await this._poll()).includes(data.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new gn(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await En();return await Cn(e,cn,"1"),await Sn(e,cn),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Cn(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Tn(e,!1).get(t),data=await new In(n).toPromise();return void 0===data?null:data.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Sn(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Tn(e,!1).getAll();return new In(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:o}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(o)&&(this.notifyListeners(r,o),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}kn.type="LOCAL";const On=kn;const An=1e12;class xn{constructor(e){this.auth=e,this.counter=An,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new Nn(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||An;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||An;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const n=e||An;return null===(t=this._widgets.get(n))||void 0===t||t.execute(),""}}class Nn{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"==typeof e?document.getElementById(e):e;O(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout((()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let i=0;i<e;i++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout((()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()}),6e4)}),500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Rn=Re("rcb"),Pn=new D(3e4,6e4);class Dn{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(e=yn().grecaptcha)||void 0===e?void 0:e.render)}load(e,t=""){return O(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)&&$(yn().grecaptcha)?Promise.resolve(yn().grecaptcha):new Promise(((n,o)=>{const c=yn().setTimeout((()=>{o(E(e,"network-request-failed"))}),Pn.get());yn()[Rn]=()=>{yn().clearTimeout(c),delete yn()[Rn];const r=yn().grecaptcha;if(!r||!$(r))return void o(E(e,"internal-error"));const l=r.render;r.render=(e,t)=>{const n=l(e,t);return this.counter++,n},this.hostLanguage=t,n(r)};Ne(`${xe.recaptchaV2Script}?${Object(r.M)({onload:Rn,render:"explicit",hl:t})}`).catch((()=>{clearTimeout(c),o(E(e,"internal-error"))}))}))}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(null===(t=yn().grecaptcha)||void 0===t?void 0:t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Ln{async load(e){return new xn(e)}clearedOneInstance(){}}const Mn="recaptcha",jn={theme:"light",type:"image"};class Fn{constructor(e,t,n=Object.assign({},jn)){this.parameters=n,this.type=Mn,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Oe(e),this.isInvisible="invisible"===this.parameters.size,O("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"==typeof t?document.getElementById(t):t;O(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Ln:new Dn,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),n=t.getResponse(e);return n||new Promise((n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)}))}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch((e=>{throw this.renderPromise=null,e}))),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach((e=>{this.container.removeChild(e)}))}validateStartingState(){O(!this.parameters.sitekey,this.auth,"argument-error"),O(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),O("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach((e=>e(t))),"function"==typeof e)e(t);else if("string"==typeof e){const n=yn()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){O(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){O(R()&&!wn(),this.auth,"internal-error"),await function(){let e=null;return new Promise((t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()})).catch((t=>{throw e&&window.removeEventListener("load",e),t}))}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await V(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);O(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return O(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Un{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Ye._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function Vn(e,t,n){const o=Oe(e),c=await zn(o,t,Object(r.w)(n));return new Un(c,(e=>It(o,e)))}async function qn(e,t,n){const o=Object(r.w)(e);await _t(!1,o,"phone");const c=await zn(o.auth,t,Object(r.w)(n));return new Un(c,(e=>Tt(o,e)))}async function Bn(e,t,n){const o=Object(r.w)(e),c=await zn(o.auth,t,Object(r.w)(n));return new Un(c,(e=>Et(o,e)))}async function zn(e,t,n){var r;const o=await n.verify();try{let c;if(O("string"==typeof o,e,"argument-error"),O(n.type===Mn,e,"argument-error"),c="string"==typeof t?{phoneNumber:t}:t,"session"in c){const t=c.session;if("phoneNumber"in c){O("enroll"===t.type,e,"internal-error");const n=await function(e,t){return V(e,"POST","/v2/accounts/mfaEnrollment:start",U(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:c.phoneNumber,recaptchaToken:o}});return n.phoneSessionInfo.sessionInfo}{O("signin"===t.type,e,"internal-error");const n=(null===(r=c.multiFactorHint)||void 0===r?void 0:r.uid)||c.multiFactorUid;O(n,e,"missing-multi-factor-info");const l=await function(e,t){return V(e,"POST","/v2/accounts/mfaSignIn:start",U(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:o}});return l.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return V(e,"POST","/v1/accounts:sendVerificationCode",U(e,t))}(e,{phoneNumber:c.phoneNumber,recaptchaToken:o});return t}}finally{n._reset()}}async function Wn(e,t){await wt(Object(r.w)(e),t)}class Kn{constructor(e){this.providerId=Kn.PROVIDER_ID,this.auth=Oe(e)}verifyPhoneNumber(e,t){return zn(this.auth,e,Object(r.w)(t))}static credential(e,t){return Ye._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Kn.credentialFromTaggedObject(t)}static credentialFromError(e){return Kn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Ye._fromTokenResponse(t,n):null}}function Gn(e,t){return t?le(t):(O(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Kn.PROVIDER_ID="phone",Kn.PHONE_SIGN_IN_METHOD="phone";class Hn extends Ue{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return He(e,this._buildIdpRequest())}_linkToIdToken(e,t){return He(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return He(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function $n(e){return bt(e.auth,new Hn(e),e.bypassAuthState)}function Qn(e){const{auth:t,user:n}=e;return O(n,t,"internal-error"),vt(n,new Hn(e),e.bypassAuthState)}async function Yn(e){const{auth:t,user:n}=e;return O(n,t,"internal-error"),wt(n,new Hn(e),e.bypassAuthState)}class Jn{constructor(e,filter,t,n,r=!1){this.auth=e,this.resolver=t,this.user=n,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(filter)?filter:[filter]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:o,error:c,type:l}=e;if(c)return void this.reject(c);const h={auth:this.auth,requestUri:t,sessionId:n,tenantId:o||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(h))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return $n;case"linkViaPopup":case"linkViaRedirect":return Yn;case"reauthViaPopup":case"reauthViaRedirect":return Qn;default:T(this.auth,"internal-error")}}resolve(e){x(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){x(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Xn=new D(2e3,1e4);async function Zn(e,t,n){const r=Oe(e);S(e,t,Ze);const o=Gn(r,n);return new rr(r,"signInViaPopup",t,o).executeNotNull()}async function er(e,t,n){const o=Object(r.w)(e);S(o.auth,t,Ze);const c=Gn(o.auth,n);return new rr(o.auth,"reauthViaPopup",t,c,o).executeNotNull()}async function nr(e,t,n){const o=Object(r.w)(e);S(o.auth,t,Ze);const c=Gn(o.auth,n);return new rr(o.auth,"linkViaPopup",t,c,o).executeNotNull()}class rr extends Jn{constructor(e,filter,t,n,r){super(e,filter,n,r),this.provider=t,this.authWindow=null,this.pollId=null,rr.currentPopupAction&&rr.currentPopupAction.cancel(),rr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return O(e,this.auth,"internal-error"),e}async onExecution(){x(1===this.filter.length,"Popup operations only handle one event");const e=mn();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(E(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(E(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,rr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(E(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,Xn.get())};e()}}rr.currentPopupAction=null;const ir="pendingRedirect",sr=new Map;class or extends Jn{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=sr.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=ur(t),r=lr(e);if(!await r._isAvailable())return!1;const o="true"===await r._get(n);return await r._remove(n),o}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}sr.set(this.auth._key(),e)}return this.bypassAuthState||sr.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function ar(e,t){return lr(e)._set(ur(t),"true")}function cr(e,t){sr.set(e._key(),t)}function lr(e){return le(e._redirectPersistence)}function ur(e){return de(ir,e.config.apiKey,e.name)}function dr(e,t,n){return async function(e,t,n){const r=Oe(e);S(e,t,Ze),await r._initializationPromise;const o=Gn(r,n);return await ar(o,r),o._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}function fr(e,t,n){return async function(e,t,n){const o=Object(r.w)(e);S(o.auth,t,Ze),await o.auth._initializationPromise;const c=Gn(o.auth,n);await ar(c,o.auth);const l=await yr(o);return c._openRedirect(o.auth,t,"reauthViaRedirect",l)}(e,t,n)}function pr(e,t,n){return async function(e,t,n){const o=Object(r.w)(e);S(o.auth,t,Ze),await o.auth._initializationPromise;const c=Gn(o.auth,n);await _t(!1,o,t.providerId),await ar(c,o.auth);const l=await yr(o);return c._openRedirect(o.auth,t,"linkViaRedirect",l)}(e,t,n)}async function mr(e,t){return await Oe(e)._initializationPromise,gr(e,t,!1)}async function gr(e,t,n=!1){const r=Oe(e),o=Gn(r,t),c=new or(r,o,n),l=await c.execute();return l&&!n&&(delete l.user._redirectEventId,await r._persistUserIfCurrent(l.user),await r._setRedirectUser(null,t)),l}async function yr(e){const t=mn(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class wr{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return vr(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!vr(e)){const code=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(E(this.auth,code))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(_r(e))}saveEventToCache(e){this.cachedEventUids.add(_r(e)),this.lastProcessedEventTime=Date.now()}}function _r(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function vr({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function Ir(e,t={}){return V(e,"GET","/v1/projects",t)}const Tr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Er=/^https?/;function Cr(e){const t=N(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const o=new URL(e);return""===o.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&o.hostname===r}if(!Er.test(n))return!1;if(Tr.test(e))return r===e;const o=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+o+"|"+o+")$","i").test(r)}const Sr=new D(3e4,6e4);function kr(){const e=yn().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let i=0;i<e.CP.length;i++)e.CP[i]=null}function Or(e){return new Promise(((t,n)=>{var r,o,c;function l(){kr(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{kr(),n(E(e,"network-request-failed"))},timeout:Sr.get()})}if(null===(o=null===(r=yn().gapi)||void 0===r?void 0:r.iframes)||void 0===o?void 0:o.Iframe)t(gapi.iframes.getContext());else{if(!(null===(c=yn().gapi)||void 0===c?void 0:c.load)){const t=Re("iframefcb");return yn()[t]=()=>{gapi.load?l():n(E(e,"network-request-failed"))},Ne(`${xe.gapiScript}?onload=${t}`).catch((e=>n(e)))}l()}})).catch((e=>{throw Ar=null,e}))}let Ar=null;const xr=new D(5e3,15e3),Nr="__/auth/iframe",Rr="emulator/auth/iframe",Pr={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Dr=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Lr(e){const t=e.config;O(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?L(t,Rr):`https://${e.config.authDomain}/${Nr}`,c={apiKey:t.apiKey,appName:e.name,v:o.SDK_VERSION},l=Dr.get(e.config.apiHost);l&&(c.eid=l);const h=e._getFrameworks();return h.length&&(c.fw=h.join(",")),`${n}?${Object(r.M)(c).slice(1)}`}async function Mr(e){const t=await function(e){return Ar=Ar||Or(e),Ar}(e),n=yn().gapi;return O(n,e,"internal-error"),t.open({where:document.body,url:Lr(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Pr,dontclear:!0},(iframe=>new Promise((async(t,n)=>{await iframe.restyle({setHideOnLeave:!1});const r=E(e,"network-request-failed"),o=yn().setTimeout((()=>{n(r)}),xr.get());function c(){yn().clearTimeout(o),t(iframe)}iframe.ping(c).then(c,(()=>{n(r)}))}))))}const jr={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Fr{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Ur(e,t,n,o=500,c=600){const l=Math.max((window.screen.availHeight-c)/2,0).toString(),h=Math.max((window.screen.availWidth-o)/2,0).toString();let d="";const f=Object.assign(Object.assign({},jr),{width:o.toString(),height:c.toString(),top:l,left:h}),m=Object(r.x)().toLowerCase();n&&(d=ye(m)?"_blank":n),me(m)&&(t=t||"http://localhost",f.scrollbars="yes");const y=Object.entries(f).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=Object(r.x)()){var t;return Ie(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(m)&&"_self"!==d)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",d),new Fr(null);const w=window.open(t||"",d,y);O(w,e,"popup-blocked");try{w.focus()}catch(e){}return new Fr(w)}const Vr="__/auth/handler",qr="emulator/auth/handler",Br=encodeURIComponent("fac");async function zr(e,t,n,c,l,h){O(e.config.authDomain,e,"auth-domain-config-required"),O(e.config.apiKey,e,"invalid-api-key");const d={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:c,v:o.SDK_VERSION,eventId:l};if(t instanceof Ze){t.setDefaultLanguage(e.languageCode),d.providerId=t.providerId||"",Object(r.B)(t.getCustomParameters())||(d.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(h||{}))d[e]=t}if(t instanceof et){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(d.scopes=e.join(","))}e.tenantId&&(d.tid=e.tenantId);const f=d;for(const e of Object.keys(f))void 0===f[e]&&delete f[e];const m=await e._getAppCheckToken(),y=m?`#${Br}=${encodeURIComponent(m)}`:"";return`${function({config:e}){if(!e.emulator)return`https://${e.authDomain}/${Vr}`;return L(e,qr)}(e)}?${Object(r.M)(f).slice(1)}${y}`}const Wr="webStorageSupport";const Kr=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=fn,this._completeRedirectFn=gr,this._overrideRedirectResult=cr}async _openPopup(e,t,n,r){var o;x(null===(o=this.eventManagers[e._key()])||void 0===o?void 0:o.manager,"_initialize() not called before _openPopup()");return Ur(e,await zr(e,t,n,N(),r),mn())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){yn().location.href=e}(await zr(e,t,n,N(),r)),new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(x(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const iframe=await Mr(e),t=new wr(e);return iframe.register("authEvent",(n=>{O(null==n?void 0:n.authEvent,e,"invalid-auth-event");return{status:t.onEvent(n.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:t},this.iframes[e._key()]=iframe,t}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Wr,{type:Wr},(n=>{var r;const o=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[Wr];void 0!==o&&t(!!o),T(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await Ir(e);for(const e of t)try{if(Cr(e))return}catch(e){}T(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Te()||ge()||Ie()}};class Gr{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return A("unexpected MultiFactorSessionType")}}}class Hr extends Gr{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Hr(e)}_finalizeEnroll(e,t,n){return function(e,t){return V(e,"POST","/v2/accounts/mfaEnrollment:finalize",U(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return V(e,"POST","/v2/accounts/mfaSignIn:finalize",U(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class $r{constructor(){}static assertion(e){return Hr._fromCredential(e)}}$r.FACTOR_ID="phone";var Qr="@firebase/auth",Yr="1.6.1";class Jr{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){O(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}Object(r.v)("authIdTokenMaxAge");var Xr;function Zr(){return window}xe={loadJS:e=>new Promise(((t,n)=>{const r=document.createElement("script");var o,c;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=E("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(c=null===(o=document.getElementsByTagName("head"))||void 0===o?void 0:o[0])&&void 0!==c?c:document).appendChild(r)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Xr="Browser",Object(o._registerComponent)(new h.a("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:c,authDomain:l}=n.options;O(c&&!c.includes(":"),"invalid-api-key",{appName:n.name});const h={apiKey:c,authDomain:l,clientPlatform:Xr,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ee(Xr)},d=new ke(n,r,o,h);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(le);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(d,t),d}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),Object(o._registerComponent)(new h.a("auth-internal",(e=>(e=>new Jr(e))(Oe(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),Object(o.registerVersion)(Qr,Yr,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Xr)),Object(o.registerVersion)(Qr,Yr,"esm2017");async function ei(e,t,n){var r;const{BuildInfo:o}=Zr();x(t.sessionId,"AuthEvent did not contain a session ID");const c=await async function(e){const t=function(e){if(x(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),view=new Uint8Array(t);for(let i=0;i<e.length;i++)view[i]=e.charCodeAt(i);return view}(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(t.sessionId),l={};return Ie()?l.ibi=o.packageName:_e()?l.apn=o.packageName:T(e,"operation-not-supported-in-this-environment"),o.displayName&&(l.appDisplayName=o.displayName),l.sessionId=c,zr(e,n,t.type,void 0,null!==(r=t.eventId)&&void 0!==r?r:void 0,l)}function ti(e){const{cordova:t}=Zr();return new Promise((n=>{t.plugins.browsertab.isAvailable((o=>{let c=null;o?t.plugins.browsertab.openUrl(e):c=t.InAppBrowser.open(e,function(e=Object(r.x)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}()?"_blank":"_system","location=yes"),n(c)}))}))}const ni=20;class ri extends wr{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise((e=>{this.resolveInialized=e}))}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach((t=>t(e))),super.onEvent(e)}async initialized(){await this.initPromise}}async function ii(e){const t=await ai()._get(ci(e));return t&&await ai()._remove(ci(e)),t}function si(e,t){var n,r;const o=function(e){const t=ui(e),link=t.link?decodeURIComponent(t.link):void 0,n=ui(link).link,r=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return ui(r).link||r||n||link||e}(t);if(o.includes("/__/auth/callback")){const t=ui(o),c=t.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(t.firebaseError)):null,code=null===(r=null===(n=null==c?void 0:c.code)||void 0===n?void 0:n.split("auth/"))||void 0===r?void 0:r[1],l=code?E(code):null;return l?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:l,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:o,postBody:null}}return null}function oi(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let i=0;i<ni;i++){const n=Math.floor(62*Math.random());e.push(t.charAt(n))}return e.join("")}function ai(){return le(hn)}function ci(e){return de("authEvent",e.config.apiKey,e.name)}function ui(e){if(!(null==e?void 0:e.includes("?")))return{};const[t,...n]=e.split("?");return Object(r.N)(n.join("?"))}const hi=class{constructor(){this._redirectPersistence=fn,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=gr,this._overrideRedirectResult=cr}async _initialize(e){const t=e._key();let n=this.eventManagers.get(t);return n||(n=new ri(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){T(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){!function(e){var t,n,r,o,c,l,h,d,f,m;const y=Zr();O("function"==typeof(null===(t=null==y?void 0:y.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),O(void 0!==(null===(n=null==y?void 0:y.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),O("function"==typeof(null===(c=null===(o=null===(r=null==y?void 0:y.cordova)||void 0===r?void 0:r.plugins)||void 0===o?void 0:o.browsertab)||void 0===c?void 0:c.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),O("function"==typeof(null===(d=null===(h=null===(l=null==y?void 0:y.cordova)||void 0===l?void 0:l.plugins)||void 0===h?void 0:h.browsertab)||void 0===d?void 0:d.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),O("function"==typeof(null===(m=null===(f=null==y?void 0:y.cordova)||void 0===f?void 0:f.InAppBrowser)||void 0===m?void 0:m.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);const o=await this._initialize(e);await o.initialized(),o.resetRedirect(),sr.clear(),await this._originValidation(e);const c=function(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:oi(),postBody:null,tenantId:e.tenantId,error:E(e,"no-auth-event")}}(e,n,r);await function(e,t){return ai()._set(ci(e),t)}(e,c);const l=await ei(e,c,t);return async function(e,t,n){const{cordova:r}=Zr();let o=()=>{};try{await new Promise(((c,l)=>{let h=null;function d(){var e;c();const t=null===(e=r.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==n?void 0:n.close)&&n.close()}function f(){h||(h=window.setTimeout((()=>{l(E(e,"redirect-cancelled-by-user"))}),2e3))}function m(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&f()}t.addPassiveListener(d),document.addEventListener("resume",f,!1),_e()&&document.addEventListener("visibilitychange",m,!1),o=()=>{t.removePassiveListener(d),document.removeEventListener("resume",f,!1),document.removeEventListener("visibilitychange",m,!1),h&&window.clearTimeout(h)}}))}finally{o()}}(e,o,await ti(l))}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){const{BuildInfo:t}=Zr(),n={};Ie()?n.iosBundleId=t.packageName:_e()?n.androidPackageName=t.packageName:T(e,"operation-not-supported-in-this-environment"),await Ir(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:n,handleOpenURL:r,BuildInfo:o}=Zr(),c=setTimeout((async()=>{await ii(e),t.onEvent(di())}),500),l=async n=>{clearTimeout(c);const r=await ii(e);let o=null;r&&(null==n?void 0:n.url)&&(o=si(r,n.url)),t.onEvent(o||di())};void 0!==n&&"function"==typeof n.subscribe&&n.subscribe(null,l);const h=r,d=`${o.packageName.toLowerCase()}://`;Zr().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(d)&&l({url:e}),"function"==typeof h)try{h(e)}catch(e){console.error(e)}}}};function di(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:E("no-auth-event")}}function fi(e,t){Oe(e)._logFramework(t)}}}]);